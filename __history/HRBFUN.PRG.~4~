#INCLUDE "COMMCTRL.CH"
#INCLUDE "HRBMENU.CH"
#include "wvwtools.ch"
#INCLUDE "wingdi.ch"
#INCLUDE "winuser.ch"                       
//SQLRDD***********************************
#include "sqlrdd.ch"
#include "pgs.ch"          // Needed if you plan to use native connection to Postgres
#include "mysql.ch"        // Needed if you plan to use native connection to MySQL
#include "oracle.ch"       // Needed if you plan to use native connection to Oracle
#include "firebird.ch"     // Needed if you plan to use native connection to Firebird
*******************************************
//REQUEST SQLRDD             // SQLRDD should be linked in
//REQUEST SR_FIREBIRD        // Needed if you plan to use native connection to Firebird
REQUEST DBFCDX
REQUEST DBFFPT
//#define mvar ' '
MEMVAR mdata_sis,cod_operado,nivel_acess,mversao,sistema,;
       memp_resa,cor,mend_firm,mcid_firm,mfone_firm,mcgc_firm,getlist,mt_cor
***************
* FUNCAO DE CORES
*******************
FUNCTION setcor(nTipCor,mtipo)
************************
//SETCOLOR('W/G,B/W,,,W/B')
//RETURN NIL
//mt_cor:='V'
//mt_cor:= m_cfg[52]
//mt_cor:= 'A'

//GetSysColor( COLOR_WINDOWTEXT )
//RGB(   0,  51, 153 )
//RGB(   0, 255, 255 )
//GetSysColor( COLOR_BTNFACE )
//RGB( 100, 135, 220 )
//RGB( 227,  92,  47 )
IF nTipCor = 1 .AND. mtipo = NIL
        SETCOLOR('B+/W*,W/B,,,N/W*')
ELSEIF nTipCor = 2 .AND. mtipo = NIL
        SETCOLOR('W*/B,W/N,,,N/W*')                     && cor para os SAY
ELSEIF nTipCor = 3 .AND. mtipo = NIL
        SETCOLOR('n/W*,W/n,x')                     && cor para os SAY
ELSEIF nTipCor = 4 .AND. mtipo = NIL
        SETCOLOR('W/B+,B/w*,,,GR+/B')
ELSEIF nTipCor = 5 .AND. mtipo = NIL
        SETCOLOR('R/W*,W/R,,,GR+/B')
ELSEIF nTipCor = 10 .AND. mtipo = NIL
        SETCOLOR('n/w,w/b,,,b/w')
ELSEIF nTipCor = 30 .AND. mtipo = NIL
        SETCOLOR('b/w,b/w,x')                     && cor para os SAY
ELSEIF nTipCor = 31 .AND. mtipo = NIL
        SETCOLOR('r+/w*,w/b+,x')                     && cor para os SAY
ELSE
        SETCOLOR('n/W*,B/w*,,,gr+/n')
ENDIF
RETURN .T.
***************************** F I M ****************************************
***************************
* TELA DE APRESENTACAO
***************************
FUNCTION tela(mtitulo,tip)
************************
LOCAL la,ca,lb,cb
MEMVAR mversao
WVW_SetMousePos(,00,00)
op_tela(01,05,14,96,'INFORMACOES DA HRB Sistemas Ltda.',,'*')
IF tip = NIL
        la := ca := 00
        lb := 09
        cb := 79
        setcor(2)
        DEVPOS(la,ca);DEVOUT(PADC(mtitulo+' >>>'+mversao+'<<<',80))
ELSE
        la := ca := 00
        lb := 10
        cb := 79
ENDIF
botao(00,06,06,18)
limpa(00,06,06,18)
WVW_DrawImage( ,01,05,09,20,ALLTRIM(m_cfg[5])+'HRB.ICO',.T.,.F.)
DEVPOS(la+10,ca+5);DEVOUT('   HRB Sistemas')
DEVPOS(la+11,ca+5);DEVOUT('www.hrbsistemas.com.br')
DEVPOS(la+12,ca+5);DEVOUT('SISCOM - '+DTOC(directory('siscom.exe') [1][3]))
DEVPOS(la+1,ca+27);DEVOUT(PADC('.: H R B   Sistemas de Informatica :.',62))
DEVPOS(la+2,ca+27);DEVOUT(PADC('Rua Tenente Joao Cicero, 415/Sl.05 - Boa Viagem - Recife - PE.',62))
DEVPOS(la+3,ca+27);DEVOUT('Fone....:(81)3325.6663 - (Tacaimbo)(81)3755.1489')
DEVPOS(la+4,ca+27);DEVOUT('Suporte.:(81)9169.9097 - MSN-Email:suporte@hrbsistemas.com.br')
DEVPOS(la+5,ca+27);DEVOUT('Ze Helio:(81)9239.9698 - MSN-Email:zehelio@hrbsistemas.com.br')
DEVPOS(la+6,ca+27);DEVOUT('Eduarda :(81)9171.6768 - MSN-Email:eduarda@hrbsistemas.com.br')
DEVPOS(la+7,ca+27);DEVOUT('Camilla :(81)9171.5365 - MSN-Email:camilla@hrbsistemas.com.br')
DEVPOS(la+8,ca+27);DEVOUT('Flavio  :(81)9171.8740 - MSN-Email:flavio@hrbsistemas.com.br')
DEVPOS(la+9,ca+27);DEVOUT('Helio Beltrao Jr.      - MSN-Email:helio@hrbsistemas.com.br')
setcor(3)
DEVPOS(la+10,ca+27);DEVOUT(PADC('Horario de atendimento: 08:00 as 12:00 e 14:00 as 18:00',62))
setcor(1)
DEVPOS(la+11,ca+27);DEVOUT(PADC('Direito Copia (C)1994-20'+SUBSTR(DTOC(directory('siscom.exe') [1][3]),7,2)+' da HRB Sistemas',62))
IF tip <> NIL
        DEVPOS(la+12,ca+27);DEVOUT(PADC('CNPJ: 11.156.983/0001-76  - Insc.Mun.: 291.454-9',62))
ENDIF
WVW_SetMouseMove(,.F.)
mensagem('Pressione qualquer tecla p/ continuar')
INKEY(1)
INKEY(0)
wvw_lclosewindow()
RETURN .T.
************************** f i m ******************************
************************************
* FUNCAO PARA QUALIDADE DE IMPRESSAO
************************************
FUNCTION imprt(imp,tipo,linha,col)
******************************
*e chr(27)+"w1" aumenta a altura da fonte, e "w0" volta ao normal
IF col = NIL
        col := 0
ENDIF
IF linha = NIL
        linha := 0
ENDIF
IF imp = 'M' .AND. tipo = 'C'	//CONDENSADO
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+CHR(15))
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'N'	//NORMAL DRAFT
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(18))
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'N+'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"E")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'N-'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"F")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'R'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"k0")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'S'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"k1")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'T+'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"x1")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'T-'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"x0")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'S+'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+CHR(45)+"1")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'S-'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+CHR(45)+"0")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'E'
       DEVPOS(PROW()+linha,col);DEVOUT(CHR(14))
       RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'M'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(15)+CHR(14))
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'P8'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'0')
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'A'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'W'+'1')
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'P6'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'2')
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'W1'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'W'+'1')
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'W0'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'W'+'0')
        RETURN .T.
/*
ELSEIF imp = 'J' .AND. tipo = 'C'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s16.67H')
*        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s15H')
        RETURN NIL
ELSEIF imp = 'J' .AND. tipo = 'N'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s10H')
        RETURN NIL
ELSEIF imp = 'J' .AND. tipo = 'M'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s10H')
        RETURN NIL
ELSEIF imp = 'J' .AND. tipo = 'E'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s5H')
        RETURN NIL
ELSEIF imp = 'J' .AND. tipo = 'P8'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s1P')
        RETURN NIL
ELSEIF imp = 'J' .AND. tipo = 'P6'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s0P')
        RETURN NIL
*/
ELSEIF imp = 'D' .AND. tipo = 'C'
        DEVPOS(PROW()+linha,col);DEVOUT('M')
        RETURN .T.
ELSEIF imp = 'D' .AND. tipo = 'N'
        DEVPOS(PROW()+linha,col);DEVOUT('P')
        RETURN .T.
ELSEIF imp = 'D' .AND. tipo = 'E'
        DEVPOS(PROW()+linha,col);DEVOUT('P')
        RETURN .T.
ELSE
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(18))
        RETURN .T.
ENDIF

RETURN NIL
******************************** F I M ********************************
#INCLUDE "winuser.ch"
FUNCTION atencao(men,tipo)
**********************
//men := RTRIM(men)
//WVW_MessageBox( ,men,' ATENCAO ',MB_ICONEXCLAMATION + MB_ICONQUESTION + MB_SYSTEMMODAL  )
//WVW_MessageBox( ,men,' ATENCAO ',MB_ICONEXCLAMATION + MB_SYSTEMMODAL  )
//WVW_MessageBox( ,men,' ATENCAO ',MB_OK)
IF tipo = NIL
        WVW_MessageBox( ,men,' ATENCAO ',MB_ICONWARNING)
ELSE        
        WVW_MessageBox( ,men,' ATENCAO ',MB_ICONERROR )
ENDIF
RETURN .T.
******************************* F I M ********************************
FUNCTION mensagem1(men,mop,mcond,linha,mop_linha,mesc,mmensagem)
**********************
LOCAL linhas,i,lin,li,ci,la,ca,mpos
CLEAR GETS
setcor(1)
men := RTRIM(men)
IF LEN(men) > 60
        mpos := 60
ELSEIF LEN(men) < LEN('Opcao ['+IF(mcond=NIL,'',mcond)+']:')
        mpos := LEN('Opcao ['+IF(mcond=NIL,'',mcond)+']:')
ELSE
        mpos := LEN(men)
ENDIF
linhas := MLCOUNT(men,mpos)
IF mop_linha = NIL
        li := ci := 10
ELSE
        li := mop_linha
        ci := 10
ENDIF
IF linha <> NIL
        IF linha + linhas + 2 > 24
                li := 24 - (linhas + 2)
        ELSE
                li := linha
        ENDIF
ENDIF
la := li+linhas+2
ca := ci+1+mpos+1
op_tela(li,ci,la,ca,'ESCOLHA A OPCAO')
IF mmensagem <> NIL
	mensagem(mmensagem)
ENDIF
IF mop = NIL
        INKEY(0)
        setcor(1)
        wvw_lclosewindow()
        RETURN .T.
ELSE
        i := 0
        FOR i = 1 TO  linhas
                LIN := MEMOLINE(men,mpos,i,,)
                DEVPOS(i,01);DEVOUT(PADC(RTRIM(LIN),mpos))
        NEXT
        setcor(1)
        //WVW_DrawBoxGet(,00,COL()+1,1)
	IF mcond <> NIL
		DEVPOS(ROW()+1,01);DEVOUT('Opcao ['+mcond+']:')
        	IF mcond = ' '
		        @ ROW(),COL()+1 GET mop PICT '@!' VALID IF(EMPTY(mop),.F.,.T.)
		ELSE
		        @ ROW(),COL()+1 GET mop PICT '@!' VALID mop $ mcond .AND. IF(mesc <> NIL .AND. LASTKEY() = 27,.F.,.T.)
		ENDIF
	ELSE
        	DEVPOS(ROW()+1,01);DEVOUT('Opcao:')
	        @ ROW(),COL()+1 GET mop PICT '@!' VALID IF(mesc <> NIL .AND. LASTKEY() = 27,.F.,.T.)
	ENDIF
        READ
        setcor(1)
        wvw_lclosewindow()
        RETURN mop
ENDIF
setcor(1)
wvw_lclosewindow()
RETURN .F.
******************************* F I M ********************************
FUNCTION mensagem2(men,mvar,masc,mcond,mtp_var,linha)
**********************
LOCAL linhas:=0,i:=0,lin:=0,li,ci,la,ca,mpos:=0,mtam_var:=0
setcor(1)
men := RTRIM(men)
IF LEN(men) > 60
        mpos := 60
        //ci := 10
ELSE
        mpos := LEN(men)
        //ci := (80-LEN(men)) / 2
ENDIF
linhas := MLCOUNT(men,mpos)

//li := 12
li := 15
ci := 20
IF linha <> NIL
        IF linha + linhas + 2 > 24
                li := 24 - (linhas + 2)
        ELSE
                li := linha
        ENDIF
ENDIF
la := li+linhas+2
ca := ci+1+mpos+1
op_tela(li,ci,la,ca,'MENSAGEM','*' )
FOR i = 1 TO  linhas
        LIN := MEMOLINE(men,mpos,i,,)
        DEVPOS(i,1);DEVOUT(PADC(RTRIM(LIN),mpos))
NEXT
IF mtp_var = 'N'
        mtam_var := LEN(masc)
ELSE
        mtam_var := LEN(mvar)
ENDIF
setcor(1)
DEVPOS(i,1);DEVOUT('Digite:')
WVW_DrawBoxGet(,i,9,mtam_var)
@ i,9 GET mvar PICT '@!' VALID IF(mcond<>NIL,mvar $ mcond,.T.)
READ
setcor(1)       
wvw_lclosewindow()
RETURN mvar
******************************* F I M ********************************
FUNCTION mensagem(men)
**********************
WVW_SBSetText(,1,'Mensagem: '+men)
RETURN NIL
******************************* F I M ****************************************
**************************
* LIMPA UMA AREA
**************************
FUNCTION limpa(li,ci,lb,cb)
***************************
@ li,ci CLEAR TO lb,cb
RETURN .T.
***************** F I M **************************
*********************
* CABECALHO DA JANELA
*********************
FUNCTION janela(li,cb,cab,p,lado)
****************
LOCAL mcor
mcor := SETCOLOR()
IF p = NIL
        setcor(3,'*')
ELSE
        setcor(3)
ENDIF
IF lado = NIL
        DEVPOS(li,cb-(LEN(cab)+2));DEVOUT(cab)
ELSE
        DEVPOS(li,cb+2);DEVOUT(cab)
ENDIF
SETCOLOR(mcor)
RETURN NIL
***************************** F I M ********************************************
***************************
* CABECALHO RELATORIO
***************************
FUNCTION cabecalho(pag,tit,tipo,vprg,memp,vgru,vsubg,vforn,vcli,vven,vope)
**************************************************************************
LOCAL mtraco2:=REPLI('=',132),mcons_cons:={}

WHILE .T.
        imprt(m_cfg[34],'N')
        imprt(m_cfg[34],'N+')
        IF mmult_emp = 'N'
                DEVPOS(PROW()+1,00);DEVOUT(memp_resa)
        ELSE
                IF memp = NIL .OR. EMPTY(memp)
                        DEVPOS(PROW()+1,00);DEVOUT(memp_resa)
                ELSE
                        ver_emp(memp)
                        DEVPOS(PROW()+1,00);DEVOUT(ALLTRIM(IF(emp->nome_cab = 'F',emp->fantasia,emp->razao)))
                ENDIF
        ENDIF
        imprt(m_cfg[34],'N-')
        imprt(m_cfg[34],'N')
        DEVPOS(PROW()+1,00);DEVOUT(tit)
        DEVPOS(PROW(),00);DEVOUT(PADL(mdata_sis,80))
        IF tipo <> NIL
                DEVPOS(PROW()+1,00);DEVOUT(tipo)
        ELSE
                DEVPOS(PROW()+1,00);DEVOUT(REPLI('*',LEN(tit)))
        ENDIF
        DEVPOS(PROW(),00);DEVOUT(PADL('Pagina: '+ STRZERO(pag,3),80))
        imprt(m_cfg[34],'C')
        DEVPOS(PROW()+1,00);DEVOUT(memp_resa)
        IF vprg = NIL
                DEVPOS(PROW(),00);DEVOUT(PADL(sistema+' '+mversao,132))
        ELSE
                DEVPOS(PROW(),00);DEVOUT(PADL(sistema+' '+mversao+' - ('+vprg+')',132))
        ENDIF
        imprt(m_cfg[34],'C')
        DEVPOS(PROW()+1,00);DEVOUT(mtraco2)
        imprt(m_cfg[34],'N')
        cons_cons := {}
        IF ! EMPTY(vgru)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM sacgrupo WHERE gru_sub LIKE "+sr_cdbvalue(vgru+'%'),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('GRUPO.....: '+vgru+' - '+cons_cons[1,2])
                ENDIF
        ENDIF
        IF ! EMPTY(vsubg)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM sacgrupo WHERE gru_sub = "+sr_cdbvalue(vsubg),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('SUB-GRUPO.: '+vsubg+' - '+cons_cons[1,2])
                ENDIF
        ENDIF
        IF ! EMPTY(vforn)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(vforn),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('FORNECEDOR: '+vforn+' - '+cons_cons[1,2])
                ENDIF
        ENDIF
        IF ! EMPTY(vcli)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM saccli WHERE cod_cli = "+sr_cdbvalue(vcli),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('CLIENTE...: '+vcli+' - '+cons_cons[1,3])
                ENDIF
        ENDIF
        IF ! EMPTY(vven)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM insopera WHERE scod_op = "+sr_cdbvalue(vven),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('VENDEDOR..: '+vven+' - '+cons_cons[1,2])
                ENDIF
        ENDIF
        IF ! EMPTY(vope)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM insopera WHERE scod_op = "+sr_cdbvalue(vope),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('OPERADOR..: '+vope+' - '+cons_cons[1,2])
                ENDIF
        ENDIF
        IF LEN(cons_cons) > 0
                imprt(m_cfg[34],'C')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco2)
                imprt(m_cfg[34],'N')
        ENDIF
        RETURN NIL
ENDDO
RETURN NIL
******************************* F I M *********************************
******************************************
* FUNCAO PARA BLOQUEIO DE ARQUIVO EM REDE
******************************************
FUNCTION bloqarq
***********************
LOCAL vtela
vtela := SAVESCREEN(23,00,23,79)
IF FLOCK()
        RESTSCREEN(23,00,23,79,vtela)
        RETURN (.T.)
ENDIF
mensagem('Aguarde... Tentando Bloquear o Arquivo: '+ALIAS(SELE()))
WHILE LASTKEY() <> 27
        IF FLOCK()
                RESTSCREEN(23,00,23,79,vtela)
                RETURN (.T.)
        ENDIF
ENDDO
RESTSCREEN(23,00,23,79,vtela)
RETURN (.F.)
************************** F I M ***********************************
******************************************
* FUNCAO PARA BLOQUEAR REGISTRO EM REDE
******************************************
FUNCTION bloqreg
***********************
LOCAL vtela

vtela := SAVESCREEN(23,00,23,79)
IF RLOCK()
        RESTSCREEN(23,00,23,79,vtela)
        RETURN (.T.)
ENDIF
mensagem('Registro Arq.:'+ALIAS(SELE())+' estar sendo acessado p/outro usuario !!!')

WHILE LASTKEY() <> 27
        IF DBRLOCK()
                RESTSCREEN(23,00,23,79,vtela)
                RETURN (.T.)
        ENDIF
ENDDO
RESTSCREEN(23,00,23,79,vtela)
RETURN (.F.)
****************************** F I M ***************************
****************************************************
* FUNCAO TENTA ADICIONA REGISTRO NO ARQUIVO EM REDE
*****************************************************
FUNCTION adireg
**********************
APPEND BLANK
IF ! NETERR()
        RETURN .T.
ENDIF
WHILE LASTKEY() <> 27
        mensagem('Aguarde...Acessando o Arquivo: '+ALIAS(SELE()))
        APPEND BLANK
        IF ! NETERR()
                RETURN .T.
        ENDIF
ENDDO
RETURN .F.
*************************** F I M *********************************
********************************
* FUNCAO PARA ABRIR ARQUIVOS
********************************
FUNCTION AbriArq(arq,al,tp,sit,vlocal,vext,vcamin,vmens)
**********************
LOCAL mcam:='',mcamcfg,mlocal:='',mestacao:='',mver:='',m_cfg1:={}

mestacao := ver_ini()

SET AUTOPEN ON
IF SELECT(al) > 0 .AND. tp = NIL
        RETURN .T.
ENDIF

WHILE .T.
        IF m_line = 'ON' .AND. sit = NIL
                IF tp = 'E'
                        IF SELECT(al) > 0
                                (al)->(DBCLOSEAREA())
                        ENDIF
                        USE (arq) ALIAS (al) EXCLUSIVE NEW VIA 'SQLRDD'
                        IF ! NETERR()
                                RETURN .T.
                        ELSE
                                atencao('Este ARQUIVO esta sendo usado por outro usuario, Aguarde...Tentando Acesso ao Arquivo: '+UPPER(arq)+' EXCLUSIVO')
                        ENDIF
                ELSE
                        IF SELECT(al) > 0
                                RETURN .T.
                        ENDIF
                        USE (arq) ALIAS (al) SHARED NEW VIA 'SQLRDD'
                        IF ! NETERR()
                                RETURN .T.
                        ELSE
                                atencao('Este ARQUIVO esta sendo usado EXCLUSIVO por outro usuario, Aguarde...Tentando Acesso ao Arquivo: '+UPPER(arq)+' COMPARTILHADO')
                        ENDIF
                ENDIF
                IF LASTKEY() = 27
                        atencao('Nao foi possivel acessar este Arquivo: '+mcam+UPPER(arq))
                        RETURN .F.
                ENDIF
        ELSE
                IF tp = 'E'
                        IF SELECT(al) > 0
                                (al)->(DBCLOSEAREA())
                        ENDIF
                        USE (arq) ALIAS (al) EXCLUSIVE NEW VIA 'DBFCDX'
                        IF ! NETERR()
                                RETURN .T.
                        ELSE
                                atencao('Este ARQUIVO esta sendo usado por outro usuario, Aguarde...Tentando Acesso ao Arquivo: '+UPPER(arq)+' EXCLUSIVO')
                        ENDIF
                ELSE
                        IF SELECT(al) > 0
                                RETURN .T.
                        ENDIF
                        USE (arq) ALIAS (al) SHARED NEW VIA 'DBFCDX'
                        IF ! NETERR()
                                RETURN .T.
                        ELSE
                                atencao('Este ARQUIVO esta sendo usado EXCLUSIVO por outro usuario, Aguarde...Tentando Acesso ao Arquivo: '+UPPER(arq)+' COMPARTILHADO')
                        ENDIF
                ENDIF
                IF LASTKEY() = 27
                        atencao('Nao foi possivel acessar este Arquivo: '+mcam+UPPER(arq))
                        RETURN .F.
                ENDIF
        ENDIF
ENDDO
RETURN .F.
*************************** F I M *********************************
***************************
* VER NIVEL DE ACESSO
***************************
FUNCTION ver_nivel(mmodulo,mdescri,mnivel,mconf_nivel,mamb,mopera)
***************************************************
LOCAL msele,morde,mtela_nivel,cons_nivel:={}

msele := 0
IF ver_modulo(mmodulo)
        RETURN .T.
ENDIF
IF mnum_principal <> NIL
        exibi_prg(mmodulo)
ENDIF
mmodulo := mmodulo+SPACE(20-LEN(mmodulo))
WHILE .T.
        cons_nivel := {}
        sr_getconnection():exec("SELECT * FROM sacconf WHERE modulo = "+sr_cdbvalue(mmodulo),,.t.,@cons_nivel)
        IF LEN(cons_nivel) > 0
                sr_getconnection():exec("UPDATE sacconf SET descri = "+sr_cdbvalue(SUBSTR(mdescri,1,60))+" WHERE modulo = "+sr_cdbvalue(mmodulo),,.f.)
                sr_getconnection():exec("COMMIT",,.f.)
                IF (mopera = '999' .OR. cod_operado = '999')
                        RETURN .T.
                ENDIF
                IF RAT(IF(EMPTY(SUBSTR(mconf_nivel,1,1)),'*',SUBSTR(mconf_nivel,1,1)),cons_nivel[1,3]) = 0 .AND. RAT(IF(EMPTY(SUBSTR(mconf_nivel,2,1)),'*',SUBSTR(mconf_nivel,2,1)),cons_nivel[1,3]) = 0
                        IF mamb = NIL
                                atencao(mdescri+' - ACESSO NAO AUTORIZADO PARA ESTE AMBIENTE - NIVEL: '+mconf_nivel,2)
                                IF ! aut_sen(mdescri+' - Senha de Liberacao do Ambiente:','LIB_AMB',,'',,'AMBIE')
                                        RETURN .F.
                                ELSE
                                        RETURN .T.
                                ENDIF
                        ELSE
                                RETURN .F.
                        ENDIF
                ELSE
                        RETURN .T.
                ENDIF
        ELSE
                sr_getconnection():exec('INSERT INTO sacconf (modulo,descri,'+;
                        'nivel,SR_DELETED )'+;
                        ' VALUES ('+;
                        sr_cdbvalue(ALLTRIM(mmodulo))+','+; //1
                        sr_cdbvalue(SUBSTR(mdescri,1,60))+','+; //2
                        sr_cdbvalue(ALLTRIM(mnivel))+','+; //3
                        sr_cdbvalue(' ')+')',,.f.)
                sr_getconnection():exec("COMMIT",,.f.)
        ENDIF
ENDDO
RETURN .T.
*********************************** f i m **************************************
***************************
* VER NIVEL DE MODULO
***************************
FUNCTION ver_modulo(mmodulo)
***************************************************
LOCAL msele,morde,mtela_nivel,mcons_nivel:={}

mmodulo := mmodulo+SPACE(20-LEN(mmodulo))
mcons_nivel := {}
sr_getconnection():exec("SELECT * FROM sacconf WHERE modulo = "+sr_cdbvalue(mmodulo),,.t.,@mcons_nivel)
IF LEN(mcons_nivel) > 0 .AND. SUBSTR(mcons_nivel[1,3],1,1) = '0'
        RETURN .T.
ELSE
        RETURN .F.
ENDIF
RETURN NIL
*********************************** f i m **************************************
***************************************
* FUNCAO PARA INICIALIZACAO DO SISTEMA
***************************************
FUNCTION inicializa()
*************************
LOCAL msenha,mnivel,mcod_op,msele,morde,mmen,mcor,mdir,;
      mnum_term:='001',marquivo:=' '

mcor := SETCOLOR()
IF FILE(curdrive()+':\HRBCFG.INI')
        RETURN NIL
ELSE
        op_tela(10,10,13,90)
        WHILE .T.
                setcor(1)
                msenha = SPACE(21)
                DEVPOS(00,00);DEVOUT('Numero de Serie...:')
                DEVPOS(00,30);DEVOUT('Data do Computador:')
                DEVPOS(01,00);DEVOUT('Codigo de ACESSO..:')
                setcor(3)
                DEVPOS(00,20);DEVOUT(ver_serie())
                DEVPOS(00,50);DEVOUT(DATE())
                setcor(1)
                WVW_DrawBoxGet(,01,20,21)

                @ 01,20 GET msenha
                READ
                IF LASTKEY() = 27
                        EXIT
                ENDIF
                setcor(1)
*               IF msenha == '19681966'
                IF ALLTRIM(msenha) == '9239'+ALLTRIM(ver_serie())+SUBSTR(DTOC(DATE()),1,2)+SUBSTR(DTOC(DATE()),7,2)+SUBSTR(DTOC(DATE()),4,2)+'92441';
                   .OR. ALLTRIM(msenha) == '9239'+ALLTRIM(ver_serie())+SUBSTR(DTOC(DATE()),1,2)+SUBSTR(DTOC(DATE()),7,2)+SUBSTR(DTOC(DATE()),4,2)+'92440'
                        IF SUBSTR(ALLTRIM(msenha),LEN(ALLTRIM(msenha)),1) = '1'
                                IF VAL(m_set[1,8]) <= 0
                                        atencao('Nao e possivel Incluir mais este terminal, Nao tem ACESSO DISPONIVEL, Favor entrar em contato com a HRB Sistemas')
                                        EXIT
                                ENDIF

                                sr_getconnection():exec("UPDATE sacsetup SET impress = "+sr_cdbvalue(STRZERO(VAL(m_set[1,8]) - 1,3)),,.f.)
                                sr_getconnection():exec("COMMIT",,.f.)
                                m_set:={}
                                sr_getconnection():exec("SELECT * FROM sacsetup",,.t.,@m_set)
                                m_set[1,123] := DCRIPTO(SUBSTR(m_set[1,123],1,14))+DCRIPTO(SUBSTR(m_set[1,123],15,6))
                        ENDIF
                        WVW_DrawBoxGet(,02,20,3)
                        SET DEVI TO PRINT
                        SET PRINT ON
                        SET PRINT TO (curdrive()+':\HRBCFG.INI')
                        DEVPOS(00,00);DEVOUT(mnum_term)
                        DEVPOS(01,00);DEVOUT(' ')
                        SET PRINT TO;SET PRINT OFF;SET DEVI TO SCREEN
                        wvw_lclosewindow()
                        RETURN .T.
                ELSE
                        atencao('Codigo de Acesso nao e valido...')
                        LOOP
                ENDIF
        ENDDO
        op_tela(00,00,24,79)
        setcor(5)
        DEVPOS(01,1);DEVOUT('ÚÛÛÛÚÛÛÛ ÚÛÛÛÛÛÛÛ ÚÛÛÛÛÛÛÛ')
        DEVPOS(02,1);DEVOUT('³ÛÛÛ³ÛÛÛ ³ÛÛÛ¿ÛÛÛ ³ÛÛÛ¿ÛÛÛ')
        DEVPOS(03,1);DEVOUT('³ÛÛÛÛÛÛÛ ³ÛÛÛÛÛÛÛ ³ÛÛÛÛÛÛÙ')
        DEVPOS(04,1);DEVOUT('³ÛÛÛ¿ÛÛÛ ³ÛÛÛ¿ÛÛÙ ³ÛÛÛ¿ÛÛÛ')
        DEVPOS(05,1);DEVOUT('³ÛÛÛ³ÛÛÛ ³ÛÛÛ³ÛÛÛ ³ÛÛÛÛÛÛÛ')
        DEVPOS(06,1);DEVOUT('ÀÄÄÙÀÄÄÙ ÀÄÄÙÀÄÄÙ ÀÄÄÄÄÄÄÙ')
        DEVPOS(07,1);DEVOUT(' Sistemas de Informatica  ')
        SETCOLOR('n/W,X')
        DEVPOS(01,10);DEVOUT('ÚÛÛÛÛÛÛÛ')
        DEVPOS(02,10);DEVOUT('³ÛÛÛ¿ÛÛÛ')
        DEVPOS(03,10);DEVOUT('³ÛÛÛÛÛÛÛ')
        DEVPOS(04,10);DEVOUT('³ÛÛÛ¿ÛÛÙ')
        DEVPOS(05,10);DEVOUT('³ÛÛÛ³ÛÛÛ')
        DEVPOS(06,10);DEVOUT('ÀÄÄÙÀÄÄÙ')
        setcor(1)
        @ 04,29 SAY 'Copia Exclusiva: '
        @ 05,29 SAY '___________________________________________'
        setcor(5)
        DEVPOS(04,46);DEVOUT(memp_resa)
        setcor(3)
        @ 07,28 to 12,74 double
        DEVPOS(08,30);DEVOUT('Rua Ten. Joao Cicero, 415 - Sl.05 - Boa Viagem')
        DEVPOS(09,30);DEVOUT('Recife - PE. - Fone: (81)3755.1489 - 3325.6663')
        DEVPOS(10,30);DEVOUT('Ze Helio:(81)9239.9698 - Camilla:(81)9171.5365')
        DEVPOS(11,30);DEVOUT('www.hrbsistemas.com.br - e-mail: suporte@hrbsistemas.com.br',setcor(5))
        @ 14,02 to 17,77 double
        SETCOLOR('r/w')
        DEVPOS(15,04);DEVOUT('               C O P I A    I L E G A L   !!!                      ',setcor(3))
        DEVPOS(16,04);DEVOUT('Para Adiquiri o Sistema Ligue (81)3755.1489/3325.6663, Desligue o Computador')
        DEVPOS(20,00);DEVOUT('')
        SETCOLOR('W/N,X')
        apaga_hrb() //apaga o arquivo de controle "HRB.001"
        QUIT
ENDIF
RETURN NIL
********************************** f i m **************************************
***************************
* FINALIZA OS SISTEMAS
***************************
FUNCTION fim(msist,mtti)
*************
LOCAL opcao,lci := 05,cci := 25,lba := 17,cba := 53,tela
tela := SAVESCREEN(00,00,24,79)
opcao := 0
WHILE .T.
        IF (msist = NIL .OR. SUBSTR(msist,1,8) <> '"SISCOM"') .AND. mtti = NIL
                SET CURSOR ON
        	sr_getconnection():exec("UPDATE insopera SET sult_fim = " + sr_cdbvalue(DATE())  +;
                                        ",shora_fim = " + sr_cdbvalue(TIME())+;
                                        ",sh_i_c = '     '"+;
                                        " WHERE scod_op = " + sr_cdbvalue(cod_operado),,.f.)
	       	sr_getconnection():exec("COMMIT",,.f.)
/*
                IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
                **************************
                SELE('sen');ORDSETFOCUS(2)
                GO TOP
                **************************

                IF ! sen->(DBSEEK(cod_operado))
                        atencao('Operador foi Excluido !!!')
                ELSE
                        IF BLOQREG()
                                sen-> sult_fim := DATE()
                                sen-> shora_fim := TIME()
                                sen-> sh_i_c := '     '
                                COMMIT
                                UNLOCK
                        ELSE
                                atencao('Nao foi possivel Acessar o Arquivo !!!')
                                RETURN NIL
                        ENDIF
                ENDIF
                DBUNLOCK()
                DBCOMMITALL()
                DBCLOSEALL()
*/
                SETCOLOR(cor)
                limpa(00,00,24,79)
                CLEAR MEMORY
                apaga_hrb() //apaga o arquivo de controle "HRB.001"
                QUIT
        ENDIF
        IF mtti = NIL
                setcor(3)
                botao(lci,cci,lba,cba,,' ESCOLHA A OPCAO ')
                botao(lci+2,cci+1,lci+4,cba-1)
                botao(lci+5,cci+1,lci+7,cba-1)
                botao(lci+8,cci+1,lci+10,cba-1)
                setcor(9)
                @ lci+3,cci+2 PROMPT '   Finalizar o sistema   ' MESSAGE '** Sai do sistema **'
                @ lci+6,cci+2 PROMPT ' Nao finalizar o sistema ' MESSAGE '** Retorna ao sistema **'
                //@ lci+9,cci+2 PROMPT '     Deixar na senha     ' MESSAGE '** Deixa na senha **'
                SET INTEN ON
                MENU TO opcao
                IF LASTKEY() = 27
                        RESTSCREEN(00,00,24,79,tela)
                        setcor(1)
                        RETURN NIL
                ENDIF
        ELSE
                opcao := 1
        ENDIF

        DO CASE
                CASE opcao = 1
                        SET CURSOR ON
                        IF mtti = NIL

		        	sr_getconnection():exec("UPDATE insopera SET sult_fim = " + sr_cdbvalue(DATE())  +;
                		                        ",shora_fim = " + sr_cdbvalue(TIME())+;
                                		        ",sh_i_c = '     '"+;
		                                        " WHERE scod_op = " + sr_cdbvalue(cod_operado),,.f.)
	       			sr_getconnection():exec("COMMIT",,.f.)
/*
                                IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
                                *************
                                SELE('sen');ORDSETFOCUS(2)
                                GO TOP
                                *************

                                IF ! sen->(DBSEEK(cod_operado))
                                        atencao('Operador foi Excluido !!!')
                                ELSE
                                        IF BLOQREG()
                                                sen-> sult_fim := DATE()
                                                sen-> shora_fim := TIME()
                                                sen-> sh_i_c := '     '
                                                COMMIT
                                                UNLOCK
                                        ELSE
                                                atencao('Nao foi possivel Acessar o Arquivo !!!')
                                                RETURN NIL
                                        ENDIF
                                ENDIF
                                DBUNLOCK()
                                DBCOMMITALL()
                                DBCLOSEALL()
*/
                        ENDIF
                        CLEAR MEMORY
                        INKEY(1)
                        apaga_hrb() //apaga o arquivo de controle "HRB.001"
                        wvw_lclosewindow()
                        QUIT
                CASE opcao = 2
                        RESTSCREEN(00,00,24,79,tela)
                        setcor(1)
                        RETURN NIL
                CASE opcao = 3
                        RESTSCREEN(00,00,24,79,tela)
                        setcor(1)
                        //alt_senha()
                        RETURN NIL
       ENDCASE
ENDDO
RETURN NIL
***************************** F I M *********************************************
*****************************
* FUNCAO PARA CRIPTOGRAFA
*****************************
FUNCTION cripto(mexp,q,mprod)
*********************
LOCAL mletra:={},maux:={},msenha,i
IF LASTKEY() = 27
        RETURN .F.
ENDIF
IF LEN(mexp) < 2 .OR. (LEN(mexp) > 8 .AND. q = NIL)
        atencao('Senha Invalida !!!')
        RETURN .F.
ENDIF
msenha := ''
i:=0
FOR i = 1 TO LEN(mexp)
        AADD(mletra,SUBSTR(mexp,i,1))
NEXT
i:=0
FOR i = 1 TO LEN(mexp)
        IF mletra[i] = 'A'
                AADD(maux,CHR(189)) //¢
        ELSEIF mletra[i] = 'B'
                AADD(maux,CHR(184)) //©
        ELSEIF mletra[i] = 'C'
                AADD(maux,CHR(154)) //Ü
        ELSEIF mletra[i] = 'D'
                AADD(maux,CHR(181)) //Á
        ELSEIF mletra[i] = 'E'
                AADD(maux,CHR(228)) //õ
        ELSEIF mletra[i] = 'F'
                AADD(maux,CHR(230)) //µ
        ELSEIF mletra[i] = 'G'
                AADD(maux,CHR(232)) //Þ
        ELSEIF mletra[i] = 'H'
                AADD(maux,CHR(218)) //+
        ELSEIF mletra[i] = 'I'
                AADD(maux,CHR(204)) //¦
        ELSEIF mletra[i] = 'J'
                AADD(maux,CHR(236)) //ý
        ELSEIF mletra[i] = 'K'
                AADD(maux,CHR(231)) //þ
        ELSEIF mletra[i] = 'L'
                AADD(maux,CHR(245)) //§
        ELSEIF mletra[i] = 'M'
                AADD(maux,CHR(225)) //ß
        ELSEIF mletra[i] = 'N'
                AADD(maux,CHR(237)) //Ý
        ELSEIF mletra[i] = 'O'
                AADD(maux,CHR(224)) //Ó
        ELSEIF mletra[i] = 'P'
                AADD(maux,CHR(208))
        ELSEIF mletra[i] = 'Q'
                AADD(maux,CHR(166))
        ELSEIF mletra[i] = 'R'
                AADD(maux,CHR(168))
        ELSEIF mletra[i] = 'S'
                AADD(maux,CHR(172))
        ELSEIF mletra[i] = 'T'
                AADD(maux,CHR(157))
        ELSEIF mletra[i] = 'U'
                AADD(maux,CHR(140))
        ELSEIF mletra[i] = 'W'
                AADD(maux,CHR(174))
        ELSEIF mletra[i] = 'V'
                AADD(maux,CHR(20))
        ELSEIF mletra[i] = 'X'
                AADD(maux,CHR(223))
        ELSEIF mletra[i] = 'Y'
                AADD(maux,CHR(239))
        ELSEIF mletra[i] = 'Z'
                AADD(maux,CHR(235))
        ELSEIF mletra[i] = '0'
                AADD(maux,CHR(251))
        ELSEIF mletra[i] = '1'
                AADD(maux,CHR(253))
        ELSEIF mletra[i] = '2'
                AADD(maux,CHR(252))
        ELSEIF mletra[i] = '3'
                AADD(maux,CHR(248))
        ELSEIF mletra[i] = '4'
                AADD(maux,CHR(216))
        ELSEIF mletra[i] = '5'
                AADD(maux,CHR(200))
        ELSEIF mletra[i] = '6'
                AADD(maux,CHR(136))
        ELSEIF mletra[i] = '7'
                AADD(maux,CHR(127))
        ELSEIF mletra[i] = '8'
                AADD(maux,CHR(21))
        ELSEIF mletra[i] = '9'
                AADD(maux,CHR(23))     
        ELSEIF mletra[i] = ' '
                AADD(maux,'0')     
        ELSEIF mletra[i] = '*'
                AADD(maux,'1')     
        ELSEIF mletra[i] = '-'
                AADD(maux,'2')     
        ELSEIF mletra[i] = '/'
                AADD(maux,'3')     
        ELSEIF mletra[i] = '.'
                AADD(maux,'4')     
        ELSEIF mletra[i] = ','
                AADD(maux,'5')     
        ELSEIF mletra[i] = '"'
                AADD(maux,'A')     
        ELSEIF mletra[i] = "'"
                AADD(maux,'6')     
        ELSEIF mletra[i] = '('
                AADD(maux,'7')     
        ELSEIF mletra[i] = ')'
                AADD(maux,'8')     
        ELSEIF mletra[i] = '='
                AADD(maux,'9')     
        ELSEIF mletra[i] = '%'
                AADD(maux,'B')     
        ELSEIF mletra[i] = '*'
                AADD(maux,'C')     
        ELSEIF mletra[i] = '+'
                AADD(maux,'D')     
        ELSEIF mletra[i] = '@'
                AADD(maux,'E')     
        ELSEIF mletra[i] = ']'
                AADD(maux,'F')     
        ELSEIF mletra[i] = '['
                AADD(maux,'G')     
        ELSEIF mletra[i] = '{'
                AADD(maux,'I')     
        ELSEIF mletra[i] = '}'
                AADD(maux,'J')     
        ELSEIF mletra[i] = '&'
                AADD(maux,'K')     
        ELSEIF mletra[i] = '#'
                AADD(maux,'L')     
        ELSEIF mletra[i] = '!'
                AADD(maux,'M')     
        ELSEIF mletra[i] = ':'
                AADD(maux,'N')     
        ELSEIF mletra[i] = ';'
                AADD(maux,'O')     
        ELSEIF mletra[i] = '?'
                AADD(maux,'P')     
        ELSEIF mletra[i] = '|'
                AADD(maux,'Q')     
        ELSEIF mletra[i] = '\'
                AADD(maux,'R')     
        ELSEIF mletra[i] = 'ç'
                AADD(maux,'S')     
        ELSEIF mletra[i] = 'Ç'
                AADD(maux,'T')     
        ELSEIF mletra[i] = 'Ã'
                AADD(maux,'U')     
        ELSEIF mletra[i] = 'ã'
                AADD(maux,'V')     
        ELSEIF mletra[i] = 'Õ'
                AADD(maux,'X')     
        ELSEIF mletra[i] = 'õ'
                AADD(maux,'Y')     
        ELSEIF mletra[i] = 'Á'
                AADD(maux,'Z')     
        ELSEIF mletra[i] = 'á'
                AADD(maux,'a')     
        ELSEIF mletra[i] = 'º'
                AADD(maux,'b')     
        ELSEIF mletra[i] = 'ª'
                AADD(maux,'c')     
        ELSEIF mletra[i] = NIL
                AADD(maux,'d')     
        ELSE
                IF mprod <> NIL
                        op_tela(10,10,13,90)
                        cons_aret:={}
                        sr_getconnection():exec("SELECT cod_merc,merc FROM sacmerc WHERE cod_barr = " + sr_cdbvalue(SUBSTR(mexp,1,14)) ,,.t.,@cons_aret)
                        IF LEN(cons_aret) > 0
                                DEVPOS(00,00);DEVOUT('Letra Ant.:'+IF(i > 1,mletra[i-1],'')+' - Letra Errada: '+mletra[i])
                                DEVPOS(01,00);DEVOUT('Codigo...: '+cons_aret[1,1])
                                DEVPOS(02,00);DEVOUT('Descricao: ')
                                @ 02,COL()+1 GET cons_aret[1,2] PICT '@!'
                                READ
                                //IF 'S' = op_simnao('S','Confirma a Alteracao:')
                                        sr_getconnection():exec("UPDATE sacmerc SET merc = " + sr_cdbvalue(cons_aret[1,2])+" WHERE cod_barr = " + sr_cdbvalue(SUBSTR(mexp,1,14)),,.f.)
                                        sr_getconnection():exec("commit",,.f.)
                                        mexp := cons_aret[1,1]+cons_aret[1,2]+SUBSTR(mexp,55)
                                        i:=0
                                        mletra := {}
                                        FOR i = 1 TO LEN(mexp)
                                                AADD(mletra,SUBSTR(mexp,i,1))
                                        NEXT
                                        i:=0
                                //ENDIF
                                                                
                        ENDIF
                        fecha_tela()
                ELSE                        
                        ATENCAO(IF(i > 1,mletra[i-1],'')+' - '+mletra[i]+' - Palavra:'+mexp)
                        LOOP
                ENDIF
        ENDIF
NEXT
i:=0
msenha := maux[2] + maux[1]
FOR i = 3 TO LEN(mexp)
        msenha := msenha + maux[i]
NEXT
RETURN msenha
*************************** F I M ***********************************************
*****************************
* FUNCAO PARA DES-CRIPTOGRAFA
*****************************
FUNCTION dcripto(mexp)
*********************
LOCAL mletra:={},maux:={},msenha,i
ASIZE(mletra,0)
ASIZE(maux,0)
msenha := ''
i:=0
FOR i = 1 TO LEN(mexp)
        IF SUBSTR(mexp,i,1) = ' ' .OR. SUBSTR(mexp,i,1) = NIL
                LOOP
        ENDIF
        AADD(mletra,SUBSTR(mexp,i,1))
NEXT
i:=0
IF EMPTY(mletra)
        RETURN NIL
ENDIF
FOR i = 1 TO LEN(mletra)
        IF mletra[i] = CHR(189)
                AADD(maux,'A')
        ELSEIF mletra[i] = CHR(184)
                AADD(maux,'B')
        ELSEIF mletra[i] = CHR(154)
                AADD(maux,'C')
        ELSEIF mletra[i] = CHR(181)
                AADD(maux,'D')
        ELSEIF mletra[i] = CHR(228)
                AADD(maux,'E')
        ELSEIF mletra[i] = CHR(230)
                AADD(maux,'F')
        ELSEIF mletra[i] = CHR(232)
                AADD(maux,'G')
        ELSEIF mletra[i] = CHR(218)
                AADD(maux,'H')
        ELSEIF mletra[i] = CHR(204)
                AADD(maux,'I')
        ELSEIF mletra[i] = CHR(236)
                AADD(maux,'J')
        ELSEIF mletra[i] = CHR(231)
                AADD(maux,'K')
        ELSEIF mletra[i] = CHR(245)
                AADD(maux,'L')
        ELSEIF mletra[i] = CHR(225)
                AADD(maux,'M')
        ELSEIF mletra[i] = CHR(237)
                AADD(maux,'N')
        ELSEIF mletra[i] = CHR(224)
                AADD(maux,'O')
        ELSEIF mletra[i] = CHR(208)
                AADD(maux,'P')
        ELSEIF mletra[i] = CHR(166)
                AADD(maux,'Q')
        ELSEIF mletra[i] = CHR(168)
                AADD(maux,'R')
        ELSEIF mletra[i] = CHR(172)
                AADD(maux,'S')
        ELSEIF mletra[i] = CHR(157)
                AADD(maux,'T')
        ELSEIF mletra[i] = CHR(140)
                AADD(maux,'U')
        ELSEIF mletra[i] = CHR(174)
                AADD(maux,'W')
        ELSEIF mletra[i] = CHR(20)
                AADD(maux,'V')
        ELSEIF mletra[i] = CHR(223)
                AADD(maux,'X')
        ELSEIF mletra[i] = CHR(239)
                AADD(maux,'Y')
        ELSEIF mletra[i] = CHR(235)
                AADD(maux,'Z')
        ELSEIF mletra[i] = CHR(251)
                AADD(maux,'0')
        ELSEIF mletra[i] = CHR(253)
                AADD(maux,'1')
        ELSEIF mletra[i] = CHR(252)
                AADD(maux,'2')
        ELSEIF mletra[i] = CHR(248)
                AADD(maux,'3')
        ELSEIF mletra[i] = CHR(216)
                AADD(maux,'4')
        ELSEIF mletra[i] = CHR(200)
                AADD(maux,'5')
        ELSEIF mletra[i] = CHR(136)
                AADD(maux,'6')
        ELSEIF mletra[i] = CHR(127)
                AADD(maux,'7')
        ELSEIF mletra[i] = CHR(21)
                AADD(maux,'8')
        ELSEIF mletra[i] = CHR(23)
                AADD(maux,'9')
        ELSEIF mletra[i] = '0'
                AADD(maux,' ')     
        ELSEIF mletra[i] = '1'
                AADD(maux,'*')     
        ELSEIF mletra[i] = '2'
                AADD(maux,'-')     
        ELSEIF mletra[i] = '3'
                AADD(maux,'/')     
        ELSEIF mletra[i] = '4'
                AADD(maux,'.')     
        ELSEIF mletra[i] = '5'
                AADD(maux,',')     
        ELSEIF mletra[i] = 'A'
                AADD(maux,'"')     
        ELSEIF mletra[i] = '6'
                AADD(maux,"'")     
        ELSEIF mletra[i] = '7'
                AADD(maux,'(')     
        ELSEIF mletra[i] = '8'
                AADD(maux,')')     
        ELSEIF mletra[i] = '9'
                AADD(maux,'=')     
        ELSEIF mletra[i] = 'B'
                AADD(maux,'%')     
        ELSEIF mletra[i] = 'C'
                AADD(maux,'*')     
        ELSEIF mletra[i] = 'D'
                AADD(maux,'+')     
        ELSEIF mletra[i] = 'E'
                AADD(maux,'@')     
        ELSEIF mletra[i] = 'F'
                AADD(maux,']')     
        ELSEIF mletra[i] = 'G'
                AADD(maux,'[')     
        ELSEIF mletra[i] = 'I'
                AADD(maux,'{')     
        ELSEIF mletra[i] = 'J'
                AADD(maux,'}')     
        ELSEIF mletra[i] = 'K'
                AADD(maux,'&')     
        ELSEIF mletra[i] = 'L'
                AADD(maux,'#')     
        ELSEIF mletra[i] = 'M'
                AADD(maux,'!')     
        ELSEIF mletra[i] = 'N'
                AADD(maux,':')     
        ELSEIF mletra[i] = 'O'
                AADD(maux,';')     
        ELSEIF mletra[i] = 'P'
                AADD(maux,'?')     
        ELSEIF mletra[i] = 'Q'
                AADD(maux,'|')     
        ELSEIF mletra[i] = 'R'
                AADD(maux,'\')     
        ELSEIF mletra[i] = 'S'
                AADD(maux,'ç')     
        ELSEIF mletra[i] = 'Ç'
                AADD(maux,'Ç')     
        ELSEIF mletra[i] = 'U'
                AADD(maux,'Ã')     
        ELSEIF mletra[i] = 'V'
                AADD(maux,'ã')     
        ELSEIF mletra[i] = 'X'
                AADD(maux,'Õ')     
        ELSEIF mletra[i] = 'Y'
                AADD(maux,'õ')     
        ELSEIF mletra[i] = 'Z'
                AADD(maux,'Á')     
        ELSEIF mletra[i] = 'A'
                AADD(maux,'á')     
        ELSEIF mletra[i] = 'b'
                AADD(maux,'º')     
        ELSEIF mletra[i] = 'c'
                AADD(maux,'ª')     
        ELSEIF mletra[i] = 'd'
                AADD(maux,NIL)     
        ELSE
                LOOP
        ENDIF
NEXT
i:=0
msenha := maux[2] + maux[1]
FOR i = 3 TO LEN(maux)
        msenha := msenha + maux[i]
NEXT
RETURN msenha
******************************* F I M ******************************************
// Function PegaChar
// Programada por Paulo Nasi em 21.04.1992
// Recupera caracter digitado pelo usuario
Function PegaChar
*****************
SETPOS(25,00)
RETURN Inkey(0)
******************************* F I M ******************************************
//
// Function PegaSenha
// Programada por Paulo Nasi em 29.06.1993
// Pega senha digitada pela usuario
//
Procedure PegaSenha ( Senha, LinSenha, ColSenha , cor,mtamanho )
****************************************************************
#include 'INKEY.CH'
Local SenhaTamMax  := 8
Local CharDigitado
Local SenhaTela    := ""
IF mtamanho <> NIL
	senhatammax := mtamanho
ENDIF
limpa(linsenha,colsenha,linsenha,colsenha+9)
WHILE Len(SenhaTela) <= SenhaTamMax
   CharDigitado := PegaChar()
   Do CASE
      CASE CharDigitado >= 97 .And. CharDigitado <= 122   /* ALFA MINUSCULA */
           Senha     := Senha + Upper(Chr(CharDigitado))
           SenhaTela := SenhaTela + "*"
      CASE CharDigitado >= 65 .And. CharDigitado <= 90    /* ALFA MAIUSCULA */
           Senha     := Senha + Chr(CharDigitado)
           SenhaTela := SenhaTela + "*"
      CASE CharDigitado >= 48 .And. CharDigitado <= 57    /* NUMERICO */
           Senha     := Senha + Chr(CharDigitado)
           SenhaTela := SenhaTela + "*"
      CASE (CharDigitado = K_LEFT) .Or. (CharDigitado = K_BS)
           IF Len(Senha) != 0
              Senha     := Left(Senha,Len(Senha)-1)
              SenhaTela := Left(SenhaTela,Len(SenhaTela)-1)
           ENDIF
      CASE CharDigitado = K_ENTER
           EXIT
      CASE CharDigitado = K_ESC
           Senha := "NAO"
           EXIT
   EndCASE
   IF cor <> NIL
          SETCOLOR(cor)
   ENDIF
   @ LinSenha,ColSenha Say PadR(SenhaTela,SenhaTamMax)
ENDDO
RETURN
********************************* f i m ********************************
**************************
* EMITE TEXTOS
*************************
FUNCTION texto
***************
LOCAL lci,cci,lba,cba,opcao,mtexto,mnome,mquantd,i,linhas,linha,;
      lin,mcont,mcidade
PRIVATE mtraco,mtipo_imp,mimp_tipo:=0,marq:=SPACE(35)
lci := cci := 0
lba := 30
cba := 76
mtraco := REPLI('=',80)
opcao := SPACE(1)
*----------------------------------------------------
IF ! AbriArq('texto','tex');RETURN NIL;ENDIF
*----------------------------------------------------
SET KEY -9 TO ctrl_w()
op_tela(00,10,30,90,'T E X T O')
WHILE .T.
********* VARIAVEIS DE IMPRESSAO *******************
        mtipo_imp := m_cfg[34]
****************************************************
        mnome := SPACE(30)
        **************************
        mcidade := m_set[1,134]
        **************************
        **************************
        SELE('tex');ORDSETFOCUS(1)
        GO TOP
        **************************
        setcor(3)
        @ lci+1,cci TO lci+1,cba
        setcor(1)
        DEVPOS(lci,cci+1);DEVOUT('Digite o nome do arquivo:')
        WVW_DrawBoxGet(,lci,cci+27,30)

        @ lci,cci+27 GET mnome PICT '@!'
        READ
        IF LASTKEY() = 27
                SET KEY -9 TO
                EXIT
        ENDIF
        IF ! tex->(DBSEEK(RTRIM(mnome)))
                GO TOP
        ENDIF
        mnome := ver_texto()
        IF LASTKEY() = 27
                LOOP
        ENDIF              
        IF mnome = '<DEFAULT>'
                mnome := SPACE(30)
        ENDIF
        setcor(3)
        DEVPOS(lci,cci+27);DEVOUT(mnome)
        setcor(1)
        Mensagem('Tecle <F10> Grava e Imprimir - <Ctrl+Y>Apagar linha p/linha - <ESC> p/Abandonar')
        mtexto := MEMOEDIT(tex->texto,lci+2,cci+1,lba-1,cba-1,,,,,,7)
*       tex-> texto := MEMOEDIT(texto,lci+1,cci+2,lba-1,cba-1,,,,,,7)

        IF LASTKEY() = 27
                LOOP
        ENDIF
        opcao := op_simnao('S','Deseja GRAVAR o Texto:')
        IF opcao = 'S'
                op_tela(10,10,12,70,'NOME DO ARQUIVO')
                DEVPOS(01,00);DEVOUT('Digite o Nome do Arquivo que deseja GRAVAR:')
                @ 01,COL()+1 GET mnome VALID IF(EMPTY(mnome),.F.,.T.)
                READ
                wvw_lclosewindow()
                IF LASTKEY() = 27
                        LOOP
                ENDIF
                IF ! tex->(DBSEEK(mnome))
                        sr_getconnection():exec('INSERT INTO texto (data,texto,nome,SR_DELETED )'+;
                                ' VALUES ('+sr_cdbvalue(mdata_sis)+','+; //1
                                sr_cdbvalue(mtexto)+','+; //2
                                sr_cdbvalue(mnome)+','+; //3
                                sr_cdbvalue(' ')+')',,.f.)
                        sr_getconnection():exec("COMMIT",,.f.)
                ELSE
                        opcao := op_simnao('S','Este Arquivo ja existe deseja Substituir:')
                        IF opcao = 'N'
                                LOOP
                        ENDIF
                        sr_getconnection():exec("UPDATE texto SET data = " + sr_cdbvalue(mdata_sis)  +;
                                ",texto = " + sr_cdbvalue(mtexto)+;
                                ",nome = " + sr_cdbvalue(mnome)  +;
                                " WHERE nome = " + sr_cdbvalue(mnome),,.f.)
                        sr_getconnection():exec("COMMIT",,.f.)
                ENDIF
/*
                tex->data  := mdata_sis
                tex->texto := mtexto
                tex->nome  := mnome
                DBUNLOCK()
                DBCOMMIT()
*/
        ENDIF
        mquantd := 1
        op_tela(10,10,13,40,'C O P I A S')
        DEVPOS(01,00);DEVOUT('Quantidade de Copias:')
        @ 01,COL()+1 GET mquantd PICT '99' VALID IF(mquantd = 0,.F.,.T.)
        READ
        wvw_lclosewindow()
        IF ! imp_arq('TEXTO.TXT','R')
                LOOP
        ENDIF
        tex->(DBSEEK(mnome))
        FOR i = 1 TO mquantd
                imprt(mtipo_imp,'E')
                DEVPOS(PROW(),00);DEVOUT(memp_resa)
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(mend_firm)
                DEVPOS(PROW()+1,00);DEVOUT(mcid_firm+' - Fone: '+mfone_firm)
                DEVPOS(PROW()+1,00);DEVOUT('Insc.: '+m_set[1,128]+'  CGC: '+mcgc_firm)
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                @ PROW()+2,01 SAY ' '
                linhas := MLCOUNT(tex->texto,70)

                FOR linha = 1 TO  linhas
                        lin := MEMOLINE(tex->texto,70,linha,,)
*                       DEVPOS(PROW()+1,05);DEVOUT(IMPAC(LIN))
                        @ PROW()+1,05 SAY lin
                        IF PROW() >= 58
                                EJECT
                                mcont = 0
                        ENDIF
                NEXT

                @ PROW()+4,10 SAY RTRIM(mcidade)+','
                @ PROW(),PCOL()+1 SAY imp_data(mdata_sis)
                @ PROW()+4,10 SAY REPLI('-',LEN(memp_resa)+2)
                @ PROW()+1,10 SAY memp_resa
                EJECT
                SETPRC(00,00)
                SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
                conf_impressao('TEXTO.TXT')
        NEXT
ENDDO
wvw_lclosewindow()
RETURN NIL
************************ F I M ************************************************************************
***************************************
* CONSULTA FORMULA DE CALCULO DE CUSTO
***************************************
FUNCTION form_calc
*******************
LOCAL lci,cci,lba,cba,opcao,mtexto,linha,linhas,lin
PRIVATE mtraco
SETMODE(50,80)
lci := 00
cci := 00
lba := 25
cba := 79
mtraco := REPLI('=',80)
opcao := SPACE(1)
SET KEY -9 TO ctrl_w()
op_tela(lci,cci,lba,cba,'  CONSULTA DA FORMULA DE CUSTO  ')
WHILE .T.
        setcor(1)
        Mensagem('Tecle <F10> p/Imprimir - <ESC> p/Abandonar')
        mtexto := MEMOREAD('calcust.txt')
        mtexto := MEMOEDIT(mtexto,lci+1,cci+1,lba-1,cba-1,,,,,,)
*       mtexto := MEMOEDIT(mtexto,lci+1,cci+1,lba-1,cba-1,,,,,,7)
        IF LASTKEY() = 27
                SETMODE(25,80)
                UNLOCK
                SET KEY -9 TO
                EXIT
        ENDIF
        opcao := op_simnao('S','Deseja Imprimir:')
        IF opcao = 'S'
                mensagem('Espere o Final da Impressao OK')
                SET DEVI TO PRINT
                SET PRINT TO (m_cfg[32])
                imprt(m_cfg[34],'E')
                DEVPOS(PROW(),00);DEVOUT(memp_resa)
                imprt(m_cfg[34],'N')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+3,00);DEVOUT(' ')
                linhas := 0
                linhas := MLCOUNT(MEMOREAD('calcust.txt'),76)
                linha := 0
                FOR linha = 1 TO  linhas
                        lin := MEMOLINE(MEMOREAD('calcust.txt'),76,linha,,)
                        @ PROW()+1,00 SAY lin
                        IF PROW() >= 58
                                EJECT
                                imprt(m_cfg[34],'E')
                                DEVPOS(PROW(),00);DEVOUT(memp_resa)
                                imprt(m_cfg[34],'N')
                                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                                DEVPOS(PROW()+1,00);DEVOUT('Continuacao da formula')
                                DEVPOS(PROW()+2,00);DEVOUT(' ')
                        ENDIF
                NEXT
                EJECT
                SETPRC(00,00)
                SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
        ELSE
                LOOP
        ENDIF
ENDDO
wvw_lclosewindow()
RETURN NIL
*********************************** F I M *******************************************
********************************
* FUNCAO P/CONSULTAR TEXTO
********************************
FUNCTION ver_texto
******************
LOCAL lci,cci,lba,cba,msele,morde,men,opcao,;
      oconsprod,ocolprod[2],i,nkey
lci := cci := 0
lba := 25
cba := 40
msele := SELE()
morde := INDEXORD()
*************
SELE('tex');ORDSETFOCUS(1)
*************
men := SAVESCREEN(24,00,24,79)
mensagem('<ENTER>p/Confirma - <ESC> Retornar')
op_tela(0,0,25,40,' ARQUIVOS ')
oconsprod := TBROWSEDB(lci,cci,lba,cba)
ocolprod[1] := TBCOLUMNNEW('Arquivos',{||tex->nome})
ocolprod[2] := TBCOLUMNNEW('  DATA  ',{||tex->data })
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                IF tex->nome <> '<DEFAULT>'
                        opcao := mensagem1('Escolha <A>lterar <E>xcluir:','A','A,E')
                        IF opcao = 'A'
                                EXIT
                        ELSE
                                opcao := op_simnao('S','Confirma a EXCLUSAO:')
                                IF opcao = 'N'
                                        LOOP
                                ELSE
                                        BLOQREG()
                                        DELE
                                        DBCOMMIT()
                                        DBUNLOCK()
                                        GO TOP
                                        oconsprod := TBROWSEDB(lci,cci,lba,cba)
                                        ocolprod[1] := TBCOLUMNNEW('Arquivos',{||tex->nome})
                                        ocolprod[2] := TBCOLUMNNEW('  data  ',{||tex->data })
                                        i:=0
                                        FOR i=1 TO LEN(ocolprod)
                                                oconsprod:ADDCOLUMN(ocolprod[i])
                                        NEXT
                                        oconsprod:HEADSEP := CHR(196)
                                        oconsprod:COLSEP := CHR(179)
                                        LOOP
                                ENDIF
                        ENDIF
                ELSE
                        EXIT
                ENDIF
        ELSE
                genkey(oconsprod,nkey)
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
wvw_lclosewindow()
RETURN tex->nome
******************************* f i m *********************************************
*********************
* FUNCAO F10 = CTRL+W
*********************
FUNCTION ctrl_w
***************
KEYBOARD CHR(23)
RETURN .T.
******************************* f i m *********************************************
***********************************
* IMPRESSAO EM ITALICO
***********************************
FUNCTION pitalico(P)
**********************
IF P = .T.
        DEVPOS(PROW(),00);DEVOUT("4")
ELSEIF P=.F. .OR. P = NIL
        DEVPOS(PROW(),00);DEVOUT("5")
ENDIF
RETURN NIL
************************** f i m *****************************************
**#ifdef COM_CALE
FUNCTION CALE      // Rotina para exibir calend rio
*************
LOCAL cale_tela:=SAVESCREEN(0,0,25,79), cor_atual:=SETCOLOR(),;
      col_dia, dia_1, lisu_:=6, cosu_:=58, liin_:=20, coin_:=79,;
      i_, cl_, m_e_s, a_n_o, ult_dia,datac,;
      tbc:={;
             {K_DOWN, {||datac:=datac-30}},;
             {K_UP,   {||datac:=datac+30}},;
             {K_RIGHT,{||datac:=datac+365}},;
             {K_LEFT, {||datac:=datac-365}};
           },x,k,nm,sinal_,arqconf
PRIVATE op_sis:=0,vr_cale
*vr_cale=NOVAPOSI(@lisu_,@cosu_,@liin_,@coin_)                  // posicao atual do calendario
botao(lisu_,cosu_,liin_,coin_)                            // monta tela de apresentacao
@ lisu_+2,cosu_+1 SAY "Do 2a 3a 4a 5a 6a Sa"
@ lisu_+ 9,cosu_+1 SAY REPL("Ä",coin_-cosu_-1)
@ lisu_+10,cosu_+2 SAY " Incrementa o MES"                    // montra teclas disponiveis
@ lisu_+11,cosu_+2 SAY " Decrementa o MES"
@ lisu_+12,cosu_+2 SAY CHR(26)+" Incrementa o ANO"
@ lisu_+13,cosu_+2 SAY CHR(27)+" Decrementa o ANO"
datac := DATE()
WHILE .t.
*        @ lisu_+1,cosu_+1 SAY PADL(TRIM(NMES(datac))+" - "+STR(YEAR(datac)),20)
        dia_1=DOW(datac-DAY(datac)+1)                  // dia da semana do 1o. dia do mes
        cl_=lisu_+3
        @ cl_,cosu_+1 CLEAR TO liin_-6,coin_-1         // limpa area dos dias
        col_dia=1+cosu_+3*(dia_1-1)                    // coluna inicai do 1o. dia do mes
        m_e_s=MONTH(datac)                             // mes
        a_n_o=YEAR(datac)                              // ano
        IF INT(m_e_s/2) = m_e_s/2                      // acha ultimo dia do mes
                ult_dia=IF(m_e_s<8,IF(m_e_s=2,IF(INT(a_n_o/4)=a_n_o/4,29,28),30),31)
        ELSE
                ult_dia=IF(m_e_s<8,31,30)
        ENDI
        FOR i_=1 TO ult_dia                            // imprime os dias
                IF DAY(DATE())=i_                         // se for heje
                        setcor(3,'*')                  // enfatiza
                ENDI
                @ cl_,col_dia SAY PADL(STR(i_,2),2)       // imprime o dia na tela
                setcor(1)                       // retorna a cor normal
                col_dia+=3                                // proxima coluna
                IF dia_1/7=INT(dia_1/7)                   // fim da tela do calendario
                        cl_++ ; col_dia=cosu_+1              // passa para proxima linha
                ENDI
                dia_1++                                   // proximo dia
        NEXT
        x=SETCURSOR(0)                                 // apaga cursor, x=cursor atual
        #ifdef COM_MOUSE
                k=MOUSETECLA(lisu_+10,cosu_+2,liin_-1,cosu_+2)
        #ELSE
                #ifdef COM_TUTOR
                        k=IN_KEY(0)                          // aguarda pressionar tecla
                #ELSE
                        k=INKEY(0)                           // aguarda pressionar tecla
                #endi
        #endi
        SETCURSOR(x)                                   // volta tamanho original do cursor
        nm=ASCAN(tbc,{|ve_a| k=ve_a[1]})               // procura tecla dentro do vetor tbc (e' o CASE)
        IF nm!=0                                       // achou!
                EVAL(tbc[nm,2])                           // portanto, executa a acao...
        ELSE
                IF k=K_ALT_F8                             // muda calendario de posicao
*                        MUDA_PJ(@lisu_,@cosu_,@liin_,@coin_,cale_tela,.t.)
                        sinal_=" "
*                       PUBL &vr_cale.:=STR(lisu_,2)+STR(cosu_,2)
                        &vr_cale.:=STR(lisu_,2)+STR(cosu_,2)
                        SAVE TO (arqconf) ALL LIKE drv*      // salva as coordenadas em disco
                ELSE                                      // tecla sem acao, portanto,
                        EXIT                                 // fora...
                ENDI
        ENDI
ENDDO
RESTSCREEN(0,0,25,79,cale_tela)               // restaura tela e
#ifdef COM_MOUSE
        IF drvmouse                                    // se o mouse esta' ativo
                DO WHIL MOUSEGET(0,0)!=0                  // espera que os botoes sejam
                ENDD                                      // liberados (nao pressionados)
        ENDI
#endi
RETU
**#endi
******************************** F I M *******************************
*************************
* menu DE ERROS
*************************
FUNCTION erro
***************
//m_set:={}
//sr_getconnection():exec("SELECT * FROM sacsetup",,.t.,@m_set)
//atencao(SUBSTR(m_set[1,82],1,2)+'/'+SUBSTR(m_set[1,82],3,2)+'/'+SUBSTR(m_set[1,82],5,2)+' - '+DTOC(DATE()))
IF ! EMPTY(m_set[1,82]) .AND. (DATE() >= CTOD(SUBSTR(m_set[1,82],1,2)+'/'+SUBSTR(m_set[1,82],3,2)+'/'+SUBSTR(m_set[1,82],5,2));
                .OR. SUBSTR(m_set[1,82],12,1) = '*')
        IF m_line = 'ON'
                sr_getconnection():exec("UPDATE sacsetup SET sysdatlm = " + sr_cdbvalue(ALLTRIM(SUBSTR(m_set[1,82],1,11)+'*')) + " WHERE sr_recno = 1 ",,.f.)
        ENDIF
        atencao('ATENCAO: Existe alguma TABELA com Problema de Corrupcao favor entrar en contato com a << HRB Sistemas - Fone:(81)(81)3755.1489 - 3325.6663 >> para Verificar as TABELAS',1)
        apaga_hrb() //apaga o arquivo de controle "HRB.001"
        QUIT
ENDIF
RETURN NIL
/*
IF ! ABRIARQ('sacped_s','ped_s');RETURN NIL;ENDIF
************
SELE('ped_s');ORDSETFOCUS(100)
ped_s->(DBSEEK('popop'))
************
DBCLOSEALL()
*/
*********************** f i m ************************************
#INCLUDE "wingdi.ch"
#INCLUDE "winuser.ch"

FUNCTION SUB_BANNER(LIN,COL,STRING,VCOR)
//Wvw_DrawLabel( ,lin,col, string,2,0 , rgb(0,0,255), rgb(198,198,198), 'Arial Black',30,35 , , , , , )
DEVPOS(lin,col);DEVOUT("")
IF vcor = NIL
        WVW_DrawLabel(,lin,col,string,,,,, 'Arial Black',80,40,,,,,)
ELSE
        WVW_DrawLabel(,lin,col,string,,,240,, 'Arial Black',80,40,,,,,)
ENDIF
//WVW_DrawLabel(,lin,col,string,,,,, 'Arial Black',90,50,,PROOF_QUALITY )
//WVW_DrawLabel(,lin,col,string,,,,,"Courier new",90,50,,PROOF_QUALITY )

RETURN NIL

*****************************
* RETORNA 11 DE MARCO DE 1995
*****************************
FUNCTION imp_data(mdata)
*************************
LOCAL mmes,mimp_data,mpoint
SET CENTURY ON
mmes := NMES(mdata)
mimp_data := SUBSTR(DTOC(mdata),1,2)+' de '+RTRIM(mmes)+' de '+SUBSTR(DTOC(mdata),7)
SET CENTURY OFF
RETURN mimp_data
*************************** f i m *******************************************
FUNCTION botao(l,c,ll,cc,t,titulo,lado,cor_tit,mtamanho)
WVW_SetPaintRefresh(0)
IF mtamanho = NIL
        mtamanho := 0
ENDIF
IF t <> NIL
        cc := c + 5 + LEN(t) + mtamanho
ENDIF
IF titulo <> NIL
        wvw_drawboxraised(,l,c,ll,cc)
        @ l,c clear to ll,cc
        setcor(2)
        IF lado = NIL
                //WVW_DrawBoxGet(,l-1,cc-(LEN(titulo)+2),LEN(' '+titulo+' '))
                //SETPOS(l-1,cc-(LEN(titulo)+2));DISPOUT(' '+titulo+' ')
                WVW_DrawBoxGet(,l-1,c,cc-c+1)
                SETPOS(l-1,c);DISPOUT(' '+titulo+SPACE((cc-c)-(LEN(titulo)+1)+1))
        ELSE
                WVW_DrawBoxGet(,l-1,c+2,LEN(' '+titulo+' '))
                SETPOS(l,c+2);DISPOUT(' '+titulo+' ')
        ENDIF
        setcor(1)

ELSE
        WVW_DrawBoxRecessed(,l,c,ll,cc)
        @ l,c clear to ll,cc 
ENDIF
IF t <> NIL
        DEVPOS(l+1,c+1);DEVOUT(t)
ENDIF
setcor(1)
RETURN NIL
************************** F I M ******************************
FUNCTION botao1(l,c,ll,cc,t,titulo,lado,cor_tit,mtamanho)
****************
WVW_SetPaintRefresh(0)
IF mtamanho = NIL
        mtamanho := 0
ENDIF
IF t <> NIL
        cc := c + 5 + LEN(t) + 0
ENDIF
wvw_drawboxraised(,l,c,ll,cc)
IF t <> NIL
        setcolor('w/b')
        @ l,c clear to ll,cc
        DEVPOS(l+1,c+2);DEVOUT(t)
ENDIF
setcor(1)
RETURN NIL
************************** F I M ******************************
**************************
* VERIFICA O DIA DA SEMANA
**************************
FUNCTION datseman(dds)
**************************
LOCAL dsemana

IF DOW(dds) = 1
        dsemana = 'Domingo'
ELSEIF DOW(dds) = 2
        dsemana = 'Segunda-feira'
ELSEIF DOW(dds) = 3
        dsemana = 'Terca-feira'
ELSEIF DOW(dds) = 4
        dsemana = 'Quarta-feira'
ELSEIF DOW(dds) = 5
        dsemana = 'Quinta-feira'
ELSEIF DOW(dds) = 6
        dsemana = 'Sexta-feira'
ELSEIF DOW(dds) = 7
        dsemana = 'Sabado'
ENDIF
RETURN dsemana
************************** F I M ******************************
*****************************
* EXIBIR O PRG
*****************************
FUNCTION exibi_prg(vprg)
**********************
WVW_SBSetText(mnum_principal,1,vprg)
RETURN NIL
*****************************  F I M **************************************
*
* Funcao de Calculadora
* Desenvolvida : Anonimo
*                A pessoa que envio nao quer os creditos
*
* Utilize as Ctrol+setas de movimentacao para mover pela tela
*
* Para colocar a calculadoraem seu sistemas adicione as seguintes linhas
* em seu programa principal
*
* Set procedure to calc.prg (Ou o nome que voce salvou a rotina)
* 
*
* Quando voce teclar F2 a calculadora sera acionada
*
* Somente para teste compile assim mesmo, quando for colocar em seu sistema
* retire a linha abaixo

*CALCU()  && Retire esta linha quando colocar a caluculadora em seu sistema

* Funcao

FUNCTION CALCU()
****************
IF ! MYRUN2('c:\windows\system32\calc.exe')
	atencao('NAO FOI ENCONTRADA A CALCULADORA COM WINDOWS FAVOR ENTRAR EM CONTATO COM O GERENTE DOS COMPUTADORES....')
ENDIF
RETURN  NIL
/*
LOCAL tela_data
LOCAL mdata_ini := mdata_fim := CTOD('  /  /  ')
LOCAL nI
LOCAL nCALCU_X := ROW()
LOCAL nCALCU_Y := COL()
LOCAL cCOR := SETCOLOR()
LOCAL lVERDAD := .F.
LOCAL nMovCal_X := 2
LOCAL nMovCal_Y := -6
//LOCAL nMovCal_Y := 0
*LOCAL cTELA := SAVESCREEN(nMovCal_X+0,nMovCal_Y+47,nMovCal_X+16,nMovCal_Y+79)
LOCAL cTELA := SAVESCREEN(nMovCal_X-1,nMovCal_Y+50,nMovCal_X+14,nMovCal_Y+79)
LOCAL cVAR := "cALGA"
LOCAL cDIG := CHR(0)
LOCAL nRESULT := 0
LOCAL cUOPER := ""
LOCAL cPERC := " "
LOCAL cCURSOR := SETCURSOR()
PRIVATE aBotCalc := {},cALGA := SPACE(14),cDEC := "",cMovTela,cxx,cOpera,cC_Alga,;
 cC_Dec
SET CURSOR OFF
*JANEL(00 + nMOVCAL_X,49 + nMOVCAL_Y,15 + nMOVCAL_X,79 + nMOVCAL_Y,"Calculadora")
JANEL(00 + nMOVCAL_X,52 + nMOVCAL_Y,13 + nMOVCAL_X,77 + nMOVCAL_Y,"Calculadora")
setcor(2)
@ 01 + nMOVCAL_X,53 + nMOVCAL_Y SAY REPL(CHR(220),23)
@ 02 + nMOVCAL_X,53 + nMOVCAL_Y SAY CHR(219) + SPACE(21) + CHR(219)
@ 03 + nMOVCAL_X,53 + nMOVCAL_Y SAY REPL(CHR(223),23)
BOTCALC(04 + nMOVCAL_X,53 + nMOVCAL_Y," 7 ","07/01")
BOTCALC(04 + nMOVCAL_X,58 + nMOVCAL_Y," 8 ","07/01")
BOTCALC(04 + nMOVCAL_X,63 + nMOVCAL_Y," 9 ","07/01")
BOTCALC(06 + nMOVCAL_X,53 + nMOVCAL_Y," 4 ","07/01")
BOTCALC(06 + nMOVCAL_X,58 + nMOVCAL_Y," 5 ","07/01")
BOTCALC(06 + nMOVCAL_X,63 + nMOVCAL_Y," 6 ","07/01")
BOTCALC(08 + nMOVCAL_X,53 + nMOVCAL_Y," 1 ","07/01")
BOTCALC(08 + nMOVCAL_X,58 + nMOVCAL_Y," 2 ","07/01")
BOTCALC(08 + nMOVCAL_X,63 + nMOVCAL_Y," 3 ","07/01")
BOTCALC(10 + nMOVCAL_X,53 + nMOVCAL_Y,"  0  ","07/01")
BOTCALC(10 + nMOVCAL_X,61 + nMOVCAL_Y,"  .  ","07/01")
BOTCALC(04 + nMOVCAL_X,nMOVCAL_Y + 69," - ","07/01")
BOTCALC(10 + nMOVCAL_X,nMOVCAL_Y + 74," % ","07/01")
BOTCALC(06 + nMOVCAL_X,nMOVCAL_Y + 69," + ","07/01")
BOTCALC(06 + nMOVCAL_X,nMOVCAL_Y + 74," * ","07/01")
BOTCALC(08 + nMOVCAL_X,nMOVCAL_Y + 74," / ","07/01")
BOTCALC(08 + nMOVCAL_X,nMOVCAL_Y + 69," = ","07/01")
BOTCALC(04 + nMOVCAL_X,nMOVCAL_Y + 74,"C/E","07/01")
SETCOLOR("W")
@ 02+nMOVCAL_X,54 + nMOVCAL_Y SAY " " + STR(nRESULT,19,4) + " "
DO WHILE cDIG <> CHR(27)
        cDIG := CHR(INKEY(0))
        IF cDIG == "7" .OR. cDIG == CHR(1);BOTCALC(04+nMOVCAL_X,53+nMOVCAL_Y," 7 ","07/01",.T.)
        ELSEIF cDIG == "8" .OR. cDIG == CHR(5);BOTCALC(04+nMOVCAL_X,58+nMOVCAL_Y," 8 ","07/01",.T.)
        ELSEIF cDIG == "9" .OR. cDIG == CHR(18);BOTCALC(04+nMOVCAL_X,63+nMOVCAL_Y," 9 ","07/01",.T.)
        ELSEIF cDIG == "4" .OR. cDIG == CHR(19);BOTCALC(06+nMOVCAL_X,53+nMOVCAL_Y," 4 ","07/01",.T.)
        ELSEIF cDIG == "5" .OR. cDIG == CHR(76);BOTCALC(06+nMOVCAL_X,58+nMOVCAL_Y," 5 ","07/01",.T.)
        ELSEIF cDIG == "6" .OR. cDIG == CHR(4);BOTCALC(06+nMOVCAL_X,63+nMOVCAL_Y," 6 ","07/01",.T.)
        ELSEIF cDIG == "1" .OR. cDIG == CHR(6);BOTCALC(08+nMOVCAL_X,53+nMOVCAL_Y," 1 ","07/01",.T.)
        ELSEIF cDIG == "2" .OR. cDIG == CHR(24);BOTCALC(08+nMOVCAL_X,58+nMOVCAL_Y," 2 ","07/01",.T.)
        ELSEIF cDIG == "3" .OR. cDIG == CHR(3);BOTCALC(08+nMOVCAL_X,63+nMOVCAL_Y," 3 ","07/01",.T.)
        ELSEIF cDIG == "0" .OR. cDIG == CHR(22);BOTCALC(10+nMOVCAL_X,53+nMOVCAL_Y,"  0  ","07/01",.T.)
        ELSEIF cDIG == "." .OR. cDIG == CHR(7);BOTCALC(10+nMOVCAL_X,61+nMOVCAL_Y,"  .  ","07/01",.T.)
        ELSEIF cDIG == "-";BOTCALC(04+nMOVCAL_X,nMOVCAL_Y+69," - ","07/01",.T.)
        ELSEIF cDIG == "%";BOTCALC(10+nMOVCAL_X,nMOVCAL_Y+74," % ","07/01",.T.)
        ELSEIF cDIG == "+";BOTCALC(06+nMOVCAL_X,nMOVCAL_Y+69," + ","07/01",.T.)
        ELSEIF cDIG == "*";BOTCALC(06+nMOVCAL_X,nMOVCAL_Y+74," * ","07/01",.T.)
        ELSEIF cDIG == "/";BOTCALC(08+nMOVCAL_X,nMOVCAL_Y+74," / ","07/01",.T.)
        ELSEIF cDIG == "=" .OR. ASC(cDIG) == 13;BOTCALC(08+nMOVCAL_X,nMOVCAL_Y+69," = ","07/01",.T.)
        ELSEIF AT(cDIG,"cCeE") <> 0;BOTCALC(04+nMOVCAL_X,nMOVCAL_Y+74,"C/E","07/01",.T.)
        ENDIF
        SETCOLOR("W")
        IF AT(cDIG,CHR(26)+CHR(2)+CHR(141)+CHR(145)) <> 0
                cMovTela := SAVESCREEN(nMOVCAL_X+0,nMOVCAL_Y+52,nMOVCAL_X+13,nMOVCAL_Y+77)
                RESTSCREEN(nMOVCAL_X-1,nMOVCAL_Y+50,nMOVCAL_X+14,nMOVCAL_Y+79,cTELA)
                IF cDIG == CHR(26);nMOVCAL_Y--
                ELSEIF cDIG == CHR(2);nMOVCAL_Y++
                ELSEIF cDIG == CHR(141);nMOVCAL_X--
                ELSEIF cDIG == CHR(145);nMOVCAL_X++
                ENDIF
                IF nMOVCAL_X == 0 ; nMOVCAL_X := 1 ; ENDIF
                IF nMOVCAL_X + 0 < 0;nMOVCAL_X := 0
                ELSEIF nMOVCAL_X + 17 > 24;nMOVCAL_X := 24 - 17
                ELSEIF nMOVCAL_Y + 47 < 0;nMOVCAL_Y := -47
                ELSEIF nMOVCAL_Y + 79 > 79;nMOVCAL_Y := 0
                ENDIF
                cTela := SAVESCREEN(nMOVCAL_X-1,nMOVCAL_Y+50,nMOVCAL_X+14,nMOVCAL_Y+79)
                RESTSCREEN(nMOVCAL_X+0,nMOVCAL_Y+52,nMOVCAL_X+13,nMOVCAL_Y+77,cMovTela)
        ENDIF
        IF cDIG == CHR(27);EXIT;ENDIF
        cXX := AT(cDIG,CHR(22)+CHR(7)+CHR(6)+CHR(24)+CHR(3)+CHR(19)+CHR(76)+CHR(4)+CHR(1)+CHR(5)+CHR(18))
        IF cXX <> 0;cDIG := SUBS("0.123456789",cXX,1);ENDIF
        cVAR := IF(cDIG == ".","cDEC",cVAR)
        cALGA := IF(cDIG == "." .AND. cALGA == SPACE(14),SPACE(13) + "0",cALGA)
        IF cDIG == "%"
                IF lVERDAD
                        cPERC := IF(cPERC == "%"," ","%")
                        setcor(6)
                        *        SETCOLOR("00/03")
                        @ 02+nMOVCAL_X,75+nMOVCAL_Y SAY cPERC
                        SETCOLOR("W")
                 ELSE
                        @ 02+nMOVCAL_X,55+nMOVCAL_Y SAY SPACE(13)+"0.0000"
                 ENDIF
        ELSEIF cDIG $ "0123456789" .AND. LEN(LTRIM(&cVAR))<>IF(cVAR == "cDEC",4,14)
                &cVAR := IF(cVAR == "cDEC",&cVAR + cDIG,SUBS(&cVAR + cDIG,2))
                @ 02+nMOVCAL_X,55+nMOVCAL_Y SAY cALGA + "." + SUBS(cDEC+SUBS("00000",LEN(cDEC)+1),1,4)
                lVERDAD := IF(lVERDAD .AND. cUOPER $ "=" + CHR(13),.F.,lVERDAD)
        ELSEIF cDIG $ "+-/*=" + CHR(13)
                IF lVERDAD
                        IF VAL(cALGA + "." + cDEC) <> 0
                                IF cPERC == "%"
                                        cOpera := STR(nRESULT,19,4) + cUOPER + "(" + STR(nRESULT,19,4) + "*" + cALGA + "." + SUBS(cDEC + SUBS("00000",LEN(cDEC) + 1),1,4) + ")/100.000"
                                ELSE
                                        cOpera := STR(nRESULT,19,4) + cUOPER + cALGA + "." + SUBS(cDEC + SUBS("00000",LEN(cDEC)+1),1,4)
                                ENDIF
                                nRESULT := &cOpera
                                IF STR(nRESULT,19,4) == REPL("*",19)
                                        @ 02 + nMOVCAL_X,55 + nMOVCAL_Y SAY "    * E R R O *    "
                                        nRESULT := 0
                                        setcor(6)
                                        *              SETCOLOR("00/03")
                                        @ 02+nMOVCAL_X,53+nMOVCAL_Y SAY " "
                                        @ 02+nMOVCAL_X,75+nMOVCAL_Y SAY " "
                                        SETCOLOR("W")
                                ELSE
                                        @ 02+nMOVCAL_X,55+nMOVCAL_Y SAY STR(nRESULT,19,4)
                                ENDIF
                        ENDIF
                ELSEIF cDIG $ "+-/*"
                       lVERDAD := .T.
                       nRESULT := VAL(cALGA + "." + cDEC)
                ENDIF
                setcor(6)
                *     SETCOLOR("00/03")
                @ 02+nMOVCAL_X,53+nMOVCAL_Y SAY IF(cDIG $ "+-/*",cDIG," ")
                @ 02+nMOVCAL_X,75+nMOVCAL_Y SAY " "
                SETCOLOR("W")
                cVAR := "cALGA"
                cALGA := SPACE(14)
                cDEC := ""
                cUOPER := cDIG
                cPERC := " "
        ELSEIF cDIG $ "EeCc"
                cVAR := "cALGA"
                cALGA := SPACE(14)
                cDEC := ""
                cPERC := " "
                IF cDIG $ "Cc"
                        lVERDAD := .F.
                        setcor(6)
                        *         SETCOLOR("00/03")
                        @ 02+nMOVCAL_X,53+nMOVCAL_Y SAY " "
                        @ 02+nMOVCAL_X,75+nMOVCAL_Y SAY " "
                        SETCOLOR("W")
                ENDIF
                @ 02+nMOVCAL_X,55+nMOVCAL_Y SAY SPACE(13)+"0.0000"
        ELSEIF cDIG == CHR(116)  .OR.  cDIG == CHR(84)
                IF VAL(cAlga+"."+cDec) <> 0
                        KEYBOARD CHR(K_CTRL_Y)+ALLTRIM(cALGA)+SUBSTR(ALLTRIM(TRANSFORM(VAL("."+cDEC),GETACTIVE():PICTURE)),2)
                ELSEIF nResult <> 0
                        cC_Alga := STR(INT(nResult))
                        cC_Dec  := VAL(SUBSTR(ALLTRIM(STR(nResult-INT(nResult))),3))
                        KEYBOARD CHR(K_CTRL_Y)+ALLTRIM(cC_Alga)+SUBSTR(ALLTRIM(TRANSFORM(VAL("."+cDEC),GETACTIVE():PICTURE)),2)
                ENDIF
                EXIT
        ENDIF
ENDDO
SETCOLOR(cCOR)
RESTSCREEN(nMOVCAL_X-1,50+nMOVCAL_Y,14+nMOVCAL_X,79+nMOVCAL_Y,cTela)
SETCURSOR(cCURSOR)
@ nCALCU_X,nCALCU_Y SAY ""
RETURN NIL


***************************************************************************

STATIC FUNCTION BOTCALC(nBotX,nBotY,cBotN,cBotC)
MEMVAR aBotCalc

IF PCOUNT() == 5
   IF cBotN == " = "
      SETCOLOR("N/"+ALLTRIM(SUBS(cBotC,4)))
      @ nBotX + 0,nBotY + 2 SAY " "
      @ nBotX + 1,nBotY + 2 SAY " "
      @ nBotX + 2,nBotY + 2 SAY " "
      @ nBotX + 3,nBotY - 1 SAY "   "
      SETCOLOR("00/07")
      @ nBotX + 0,nBotY - 1 SAY "   "
      @ nBotX + 1,nBotY - 1 SAY " = "
      @ nBotX + 2,nBotY - 1 SAY "   "
   ELSE
      SETCOLOR("N/"+ALLTRIM(SUBS(cBotC,4)))
      @ nBotX,nBotY + LEN(cBotN) - 1 SAY " "
      @ nBotX + 1,nBotY - 1 SAY REPL(" ",LEN(cBotN))
      SETCOLOR("00/07")
      @ nBotX,nBotY - 1 SAY cBotN
   ENDIF
   INKEY(.1)
   SETCOLOR("N/"+ALLTRIM(SUBS(cBotC,4)))
   IF cBotN == " = "
*     @ nBotX + 0,nBotY - 1 SAY ""
*     @ nBotX + 1,nBotY - 1 SAY "ê"
*     @ nBotX + 2,nBotY - 1 SAY "ê"
*     @ nBotX + 3,nBotY - 1 SAY "ááá"
      @ nBotX + 0,nBotY - 1 SAY " "
      @ nBotX + 1,nBotY - 1 SAY " "
      @ nBotX + 2,nBotY - 1 SAY " "
      @ nBotX + 3,nBotY - 1 SAY "   "
   ELSE
*     @ nBotX,nBotY - 1 SAY ""
*     @ nBotX + 1,nBotY - 1 SAY REPL("á",LEN(cBotN))
      @ nBotX,nBotY - 1 SAY " "
      @ nBotX + 1,nBotY - 1 SAY REPL(" ",LEN(cBotN))
   ENDIF
ENDIF
SETCOLOR("00/07")
IF cBotN == " = "
   @ nBotX + 0,nBotY SAY "   "
   @ nBotX + 1,nBotY SAY " = "
   @ nBotX + 2,nBotY SAY "   "
   AADD(aBotCalc,{nBotX+0,nBotY,nBotX+2,nBotY+LEN(SPACE(03))," = "})
ELSE
   @ nBotX,nBotY SAY cBotN
   AADD(aBotCalc,{nBotX,nBotY,nBotX,nBotY+LEN(cBotN),cBotN})
ENDIF
SETCOLOR("N/"+ALLTRIM(SUBS(cBotC,4)))
IF cBotN == " = "
*  @ nBotX + 0,nBoTY - 1 SAY ""
*  @ nBotX + 1,nBoTY - 1 SAY "ê"
*  @ nBotX + 2,nBoTY - 1 SAY "ê"
*  @ nBotX + 3,nBoTY - 1 SAY "ááá"
   @ nBotX + 0,nBoTY - 1 SAY " "
   @ nBotX + 1,nBoTY - 1 SAY " "
   @ nBotX + 2,nBoTY - 1 SAY " "
   @ nBotX + 3,nBoTY - 1 SAY "   "
ELSE
*  @ nBotX,nBotY - 1 SAY ""
*  @ nBotX + 1,nBotY - 1 SAY REPL("á",LEN(cBotN))
   @ nBotX,nBotY - 1 SAY " "
   @ nBotX + 1,nBotY - 1 SAY REPL(" ",LEN(cBotN))
ENDIF
RETURN .T.

*

STATIC FUNCTION JANEL(nCoord1,nCoord2,nCoord3,nCoord4,cTexto)
IF PCOUNT() # 5
   cTexto := ""
ENDIF
setcor(6)
*SETCOLOR("07/01")
@ nCoord1,nCoord2 CLEAR TO nCoord3,nCoord4
setcor(2)
*SETCOLOR("00/03")
//@ nCoord1,nCoord2,nCoord3,nCoord4 BOX " "
botao1(nCoord1,nCoord2,nCoord3,nCoord4)
@ nCoord1,nCoord2 SAY "ç"
IF LEN(TRIM(cTexto)) > 0
   @ nCoord1,nCoord2+(((nCoord4+1-nCoord2)-LEN(cTexto))/2) SAY cTexto
ENDIF
//@ nCoord3-1,nCoord2+2 SAY 'Calcular DATAS: [D]'
RETURN NIL
************************** F I M ***************************************8
*/
***********************
* mensagem dos GET'S
***********************
FUNCTION men_get(men_li,men_ci,mensagem,mcol)
WVW_SBSetText(,1,'Mensagem: '+mensagem)
RETURN .T.
***********************
* LIMPA mensagem dos GET'S
***********************
FUNCTION lim_get
WVW_SBSetText(,1,' ')
RETURN .T.
******************************* F I M ********************************
*************************************
* FUNCAO PROGRESSAO DE IMPRESSAO
*************************************
FUNCTION prog_imp(no,mcampo)
*******************
LOCAL mno:=0
mno := VAL(SUBSTR(STRZERO((no/2),10,2),8,2))
IF mno = 0
        WVW_SBSetText(,1,'Mensagem:  Aguarde o Final da Impressao: /  + - No.Reg.:'+STRZERO(no,6)+' - '+IF(mcampo=NIL,'',mcampo))
ELSE
        WVW_SBSetText(,1,'Mensagem:  Aguarde o Final da Impressao: \  X - No.Reg.:'+STRZERO(no,6)+' - '+IF(mcampo=NIL,'',mcampo))
ENDIF
RETURN NIL
******************************* F I M ********************************
*************************
* MENU ALTERACAO FIRMAS
*************************
FUNCTION incl_firma(t)
*******************
LOCAL mprg:='INCL_FIRMA',;
      opcao,mrazao,mfantasia,mend,mbairro,mcidade,mcgc,mserie,mfone,;
      mdataini,mcgc_aux,mlogradouro,mcont_numer,mcont_compl,mcont_bairro,;
      mcont_cep,mcontato,mcont_tel,mnome_cab,;
      lci,cci,lba,cba,tela,minsc,mcep,memail,mcont_cpf,mprodepe,mcodemp,minsc_mun,mcnae,mnumero,mcomplemento,;
      aret:={},m_emp:={}

IF ! ver_nivel(mprg,'INCLUSAO E ALTERACAO DA EMPRESA','1',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF
lci:=cci:=0
lba:=24
cba:=100

mcomplemento := SPACE(10)
mrazao    := SPACE(35)
mfantasia := SPACE(35)
mnome_cab := SPACE(1)
mend      := SPACE(40)
mfone     := SPACE(30)
mbairro   := mcidade   := SPACE(20)
mcep      := SPACE(8)
mcgc      := mcgc_aux  := minsc := SPACE(14)
mserie    := mnumero := SPACE(6)
memail    := SPACE(50)
mdataini  := DATE()
mlogradouro := SPACE(34)
mcont_numer := SPACE(5)
mcont_compl := SPACE(22)
mcont_bairr := SPACE(15)
mcont_cep := SPACE(8)
mcontato  := SPACE(28)
mcont_tel := SPACE(12)
mcont_cpf := SPACE(11)
minsc_mun := SPACE(14)
mcnae     := SPACE(14)

mrazao    := m_set[1,129]
mfantasia := m_set[1,130]
mnome_cab := m_set[1,131]
mend      := m_set[1,132]
mbairro   := m_set[1,133]
mcidade   := m_set[1,134]
mcep      := m_set[1,135]
memail    := m_set[1,137]

mlogradouro := m_set[1,139]
mcont_numer := m_set[1,140]
mcont_compl := m_set[1,141]
mcont_bairr := m_set[1,142]
mcont_cep := m_set[1,143]
mcontato  := m_set[1,144]
mcont_tel := m_set[1,145]
mcont_cpf := m_set[1,146]
mprodepe  := m_set[1,148]
mcodemp   := m_set[1,124]
IF EMPTY(m_set[1,123])
        mcgc      := mcgc_aux  := SPACE(14)
        mserie    := SPACE(6)
ELSE
        mcgc      := mcgc_aux  := SUBSTR(m_set[1,123],1,14)
        mserie    := SUBSTR(m_set[1,123],15,6)
ENDIF
minsc     := m_set[1,128]
mfone     := m_set[1,136]
mdataini  := m_set[1,138]
minsc_mun := m_set[1,156]
mcnae     := m_set[1,157]
mnumero   := m_set[1,160]
mcomplemento := m_set[1,161]
op_tela(lci,cci,lba,cba,' CONFIGURACAO DO SISTEMA P/FIRMA')
WHILE .T.
        opcao = 'S'
        setcor(3)
        @ lci+16,cci TO lci+16,cba
        setcor(1)
        DEVPOS(lci+1,cci+2);DEVOUT('Codigo da Empresa....:')
        DEVPOS(lci+1,cci+39);DEVOUT('Data de Inicio:')
        //DEVPOS(lci+2,cci+2);DEVOUT('1a.Linha Apresentacao:')
        //DEVPOS(lci+3,cci+2);DEVOUT('2a.Linha Apresentacao:')
        //DEVPOS(lci+4,cci+2);DEVOUT('3a.Linha Apresentacao:')
        DEVPOS(lci+5,cci+2);DEVOUT('Razao Social.........:')
        DEVPOS(lci+6,cci+2);DEVOUT('Nome Fantasia........:')
        DEVPOS(lci+7,cci+2);DEVOUT('Nome p/Cabecalho dos documentos [F]antasia [R]azao:')
        DEVPOS(lci+8,cci+2);DEVOUT('CNPJ.................:')
        DEVPOS(lci+8,cci+45);DEVOUT('Inscricao:')

        DEVPOS(lci+9,cci+2);DEVOUT('Inscricao Municipal..:')
        DEVPOS(lci+9,cci+45);DEVOUT('CNAE:')

        DEVPOS(lci+10,cci+2);DEVOUT('Endereco.............:')
        DEVPOS(lci+10,cci+67);DEVOUT('Numero:')
        DEVPOS(lci+10,cci+82);DEVOUT('Compl.:')
        DEVPOS(lci+11,cci+2);DEVOUT('Bairro...............:')
        DEVPOS(lci+12,cci+2);DEVOUT('Cidade ..............:')
        DEVPOS(lci+12,cci+57);DEVOUT('CEP:')
        DEVPOS(lci+13,cci+2);DEVOUT('Telefones e Fax .....:')
        DEVPOS(lci+14,cci+2);DEVOUT('EMAIL................:')
        DEVPOS(lci+15,cci+2);DEVOUT('Serie................:')

        DEVPOS(lci+17,cci+2);DEVOUT('Nome p/contato.......:')
        DEVPOS(lci+17,cci+55);DEVOUT('CPF:')
        DEVPOS(lci+18,cci+2);DEVOUT('Logradouro...........:')
        DEVPOS(lci+19,cci+2);DEVOUT('Numero e Complemento.:       - ')
        DEVPOS(lci+20,cci+2);DEVOUT('Bairro...............:')
        DEVPOS(lci+21,cci+2);DEVOUT('CEP..................:')
        DEVPOS(lci+21,cci+33);DEVOUT('Telefone:')
        DEVPOS(lci+22,cci+2);DEVOUT('Optante do PRODEPE...:')
        IF t = NIL
                IF cod_operado = '999'
                        DEVPOS(lci+15,cci+25);DEVOUT(mserie)
                ENDIF
        ENDIF
        @ lci+1,cci+25 GET mcodemp PICT '999'
        @ lci+1,cci+55 GET mdataini
        @ lci+5,cci+25 GET mrazao VALID IF(EMPTY(mrazao),.F.,.T.)
        @ lci+6,cci+25 GET mfantasia VALID IF(EMPTY(mfantasia),.F.,.T.)
        @ lci+7,cci+54 GET mnome_cab PICT '@!' VALID mnome_cab $ 'F,R'
        @ lci+8,cci+25 GET mcgc PICT '@@r 99.999.999/9999-99' VALID IF(VCGC(mcgc),.T.,.F.) WHEN cod_operado = '999'
        @ lci+8,cci+56 GET minsc PICT '@!'

        @ lci+9,cci+25 GET minsc_mun PICT '@!'
        @ lci+9,cci+51 GET mcnae PICT '@!'

        @ lci+10,cci+25 GET mend
        @ lci+10,cci+74 GET mnumero
        @ lci+10,cci+89 GET mcomplemento
        @ lci+11,cci+25 GET mbairro
        @ lci+12,cci+25 GET mcidade
        @ lci+12,cci+62 GET mcep
        @ lci+13,cci+25 GET mfone
        @ lci+14,cci+25 GET memail
        @ lci+17,cci+25 GET mcontato PICT '@!'
        @ lci+17,cci+60 GET mcont_cpf PICT '99999999999'
        @ lci+18,cci+25 GET mlogradouro PICT '@!'
        @ lci+19,cci+25 GET mcont_numer PICT '@!'
        @ lci+19,cci+33 GET mcont_compl PICT '@!'
        @ lci+20,cci+25 GET mcont_bairr PICT '@!'
        @ lci+21,cci+25 GET mcont_cep PICT '@!'
        @ lci+21,cci+43 GET mcont_tel PICT '@!'
        @ lci+22,cci+25 GET mprodepe PICT '@!' VALID mprodepe $ 'S,N'
        READ
        IF LASTKEY() = 27
                SET CURSOR ON
                EXIT
        ENDIF
        IF mcgc <> mcgc_aux .OR. cod_operado = '999'
                IF ! EMPTY(mserie)
                        opcao := op_simnao('S','Deseja alterar o No.de Serie:')
                        IF LASTKEY() = 27 .OR. opcao = 'N'
                                EXIT
                        ELSE
                                mserie = ''
                                pegasenha(@mserie,lci+15,cci+25,setcor(2))
                                setcor(1)
                         ENDIF
                ELSE
                        mserie = ''
                        pegasenha(@mserie,lci+15,cci+25,setcor(2))
                ENDIF
        ENDIF
        setcor(1)
        opcao := op_simnao('S','Confirma a Inclusao da Firma:')
        IF opcao = 'N'
                EXIT
        ENDIF
        m_set:={}
        sr_getconnection():exec("SELECT * FROM sacsetup",,.t.,@m_set)
        IF LEN(m_set) = 0
                sr_getconnection():exec('INSERT INTO sacsetup ('+;
                'codemp     ,'+;
                'razao      ,'+;
                'fantasia   ,'+;
                'nome_cab   ,'+;
                'end_firma  ,'+;
                'bairro     ,'+;
                'cidade     ,'+;
                'cep        ,'+;
                'fone       ,'+;
                'email      ,'+;
                'insc       ,'+;
                'dataini    ,'+;
                'serie      ,'+;
                'logradouro ,'+;
                'cont_numer ,'+;
                'cont_compl ,'+;
                'cont_bairr ,'+;
                'cep        ,'+;
                'contato    ,'+;
                'cont_tel   ,'+;
                'cont_cpf   ,'+;
                'prodepe    ,'+;
                'insc_mun   ,'+;
                'cnae       ,'+;
                'numero     ,'+;
                'complemento,'+;
                'SR_RECNO   ,'+;
                'SR_DELETED)'+;
                ' VALUES ('+;
                sr_cdbvalue(mcodemp                                              )+','+; //1
                sr_cdbvalue(mrazao                                               )+','+; //5
                sr_cdbvalue(mfantasia                                            )+','+; //6
                sr_cdbvalue(mnome_cab                                            )+','+; //7
                sr_cdbvalue(mend                                                 )+','+; //8
                sr_cdbvalue(mbairro                                              )+','+;//9
                sr_cdbvalue(mcidade                                              )+','+;//10
                sr_cdbvalue(mcep                                                 )+','+;//9
                sr_cdbvalue(mfone                                                )+','+;//9
                sr_cdbvalue(memail                                               )+','+;//9
                sr_cdbvalue(minsc                                                )+','+;//9
                sr_cdbvalue(mdataini                                             )+','+;//9
                sr_cdbvalue(CRIPTO(ALLTRIM(mcgc),'*')+CRIPTO(ALLTRIM(mserie),'*'))+','+;//9
                sr_cdbvalue( mlogradouro                                         )+','+;//9
                sr_cdbvalue( mcont_numer                                         )+','+;//9
                sr_cdbvalue( mcont_compl                                         )+','+;//9
                sr_cdbvalue( mcont_bairr                                         )+','+;//9
                sr_cdbvalue( mcont_cep                                           )+','+;//9
                sr_cdbvalue( mcontato                                            )+','+;//9
                sr_cdbvalue( mcont_tel                                           )+','+;//9
                sr_cdbvalue( mcont_cpf                                           )+','+;//9
                sr_cdbvalue( mprodepe                                            )+','+;//9
                sr_cdbvalue( minsc_mun                                           )+','+;//9
                sr_cdbvalue(mcnae                                                )+','+;//9
                sr_cdbvalue(mnumero                                              )+','+;//9
                sr_cdbvalue(mcomplemento                                         )+','+;//9
                sr_cdbvalue(1                                                    )+','+;//9
                sr_cdbvalue(' ')+')',,.f.)
                sr_getconnection():exec('COMMIT',,.f.)
        ELSE
                ccomm := "UPDATE sacsetup SET "
                ccomm := ccomm + " razao      = "+sr_cdbvalue(mrazao                                               )
                ccomm := ccomm + ",fantasia   = "+sr_cdbvalue(mfantasia                                            )
                ccomm := ccomm + ",nome_cab   = "+sr_cdbvalue(mnome_cab                                            )
                ccomm := ccomm + ",end_firma  = "+sr_cdbvalue(mend                                                 )
                ccomm := ccomm + ",bairro     = "+sr_cdbvalue(mbairro                                              )
                ccomm := ccomm + ",cidade     = "+sr_cdbvalue(mcidade                                              )
                ccomm := ccomm + ",cep        = "+sr_cdbvalue(mcep                                                 )
                ccomm := ccomm + ",fone       = "+sr_cdbvalue(mfone                                                )
                ccomm := ccomm + ",email      = "+sr_cdbvalue(memail                                               )
                ccomm := ccomm + ",insc       = "+sr_cdbvalue(minsc                                                )
                ccomm := ccomm + ",dataini    = "+sr_cdbvalue(mdataini                                             )
                ccomm := ccomm + ",logradouro = "+sr_cdbvalue(mlogradouro                                         )
                ccomm := ccomm + ",cont_numer = "+sr_cdbvalue(mcont_numer                                         )
                ccomm := ccomm + ",cont_compl = "+sr_cdbvalue(mcont_compl                                         )
                ccomm := ccomm + ",cont_bairr = "+sr_cdbvalue(mcont_bairr                                         )
                ccomm := ccomm + ",cont_cep   = "+sr_cdbvalue(mcont_cep                                           )
                ccomm := ccomm + ",contato    = "+sr_cdbvalue(mcontato                                            )
                ccomm := ccomm + ",cont_tel   = "+sr_cdbvalue(mcont_tel                                           )
                ccomm := ccomm + ",cont_cpf   = "+sr_cdbvalue(mcont_cpf                                           )
                ccomm := ccomm + ",prodepe    = "+sr_cdbvalue(mprodepe                                            )
                ccomm := ccomm + ",insc_mun   = "+sr_cdbvalue(minsc_mun                                           )
                ccomm := ccomm + ",cnae       = "+sr_cdbvalue(mcnae                                                )
                ccomm := ccomm + ",numero     = "+sr_cdbvalue(mnumero                                              )
                ccomm := ccomm + ",complemento= "+sr_cdbvalue(mcomplemento                                         )
                ccomm := ccomm + ",serie      = "+sr_cdbvalue(CRIPTO(ALLTRIM(mcgc),'*')+CRIPTO(ALLTRIM(mserie),'*'))
                ccomm := ccomm + " WHERE sr_recno = 1"
                sr_getconnection():exec(ccomm,,.f.)
                sr_getconnection():exec('COMMIT',,.f.)
        ENDIF
        // Atualizando a matriz m_set (SACSETUP->Configuracoes)
        m_set:={}
        sr_getconnection():exec("SELECT * FROM sacsetup",,.t.,@m_set)
        m_set[1,123] := DCRIPTO(SUBSTR(m_set[1,123],1,14))+DCRIPTO(SUBSTR(m_set[1,123],15,6))

        m_emp:={}
        sr_getconnection():exec("SELECT * FROM sacemp",,.t.,@m_emp)
        IF LEN(m_emp) = 0
                sr_getconnection():exec('INSERT INTO sacemp ('+;
                'codemp   ,'+;
                'razao    ,'+;
                'fantasia ,'+;
                'nome_cab ,'+;
                'endereco ,'+;
                'bairro   ,'+;
                'cidade   ,'+;
                'cep      ,'+;
                'fone     ,'+;
                'email    ,'+;
                'insc     ,'+;
                'dataini  ,'+;
                'cnpj     ,'+;
                'SR_DELETED)'+;
                ' VALUES ('+;
                sr_cdbvalue(mcodemp      )+','+; //1
                sr_cdbvalue(mrazao       )+','+; //5
                sr_cdbvalue(mfantasia    )+','+; //6
                sr_cdbvalue(mnome_cab    )+','+; //7
                sr_cdbvalue(mend         )+','+; //8
                sr_cdbvalue(mbairro      )+','+;//9
                sr_cdbvalue(mcidade      )+','+;//10
                sr_cdbvalue(mcep         )+','+;//9
                sr_cdbvalue(mfone        )+','+;//9
                sr_cdbvalue(memail       )+','+;//9
                sr_cdbvalue(minsc        )+','+;//9
                sr_cdbvalue(mdataini     )+','+;//9
                sr_cdbvalue(ALLTRIM(mcgc))+','+;//9
                sr_cdbvalue(' ')+')',,.f.)
                sr_getconnection():exec('COMMIT',,.f.)
        ELSE
                ccomm := "UPDATE sacemp SET "
                ccomm := ccomm + " codemp   = "+sr_cdbvalue(mcodemp       )
                ccomm := ccomm + ",razao    = "+sr_cdbvalue(mrazao        )
                ccomm := ccomm + ",fantasia = "+sr_cdbvalue(mfantasia     )
                ccomm := ccomm + ",nome_cab = "+sr_cdbvalue(mnome_cab     )
                ccomm := ccomm + ",endereco = "+sr_cdbvalue(mend          )
                ccomm := ccomm + ",bairro   = "+sr_cdbvalue(mbairro       )
                ccomm := ccomm + ",cidade   = "+sr_cdbvalue(mcidade       )
                ccomm := ccomm + ",cep      = "+sr_cdbvalue(mcep          )
                ccomm := ccomm + ",fone     = "+sr_cdbvalue(mfone         )
                ccomm := ccomm + ",email    = "+sr_cdbvalue(memail        )
                ccomm := ccomm + ",insc     = "+sr_cdbvalue(minsc         )
                ccomm := ccomm + ",dataini  = "+sr_cdbvalue(mdataini      )
                ccomm := ccomm + ",cnpj     = "+sr_cdbvalue(ALLTRIM(mcgc) )
                ccomm := ccomm + " WHERE codemp = "+sr_cdbvalue(mcodemp)
                sr_getconnection():exec(ccomm,,.f.)
                sr_getconnection():exec('COMMIT',,.f.)
                BLOQREG()
        ENDIF
        EXIT
ENDDO
wvw_lclosewindow()
RETURN .T.
************************ F I M ***********************************************
/******************************************************************************
* Essa funcao foi feita co base nos dados fornecidos pelo site do Sintegra    *
* http://www.sintegra.gov.br/insc_est.html, calculos e teste foram feitos     *
* apenas com as IEs encontradas como exemplo em 24/04/2003.                   *
* Apesar de alguns estados terem os mesmos peso para a multiplicacao, e o     *
* mesmo roteiro critico achei melhor gerar um codigo especifico para cada     *
* estado, prevendo um possivel mudanca no roteiro                             *
* No caso de alguem fazer alguma melhoria, ou correcao nesta funcao peco por  *
* favor envie uma copia cada um desses e-mails:                               *
* <brock_carlos@yahoo.com.br>, <cal@materiavirtual.com.br>                    *
******************************************************************************/
/*
Function TestaIe( cIe1, cUF )
******************************
Local nI, nX, cTemp := "", nT2, nMod := 11
local cIe2 := "", nSoma := 0, cProd := "", aUF
Local nD1, nD2
Local aP1, aP2, nPt,mopc:=' ',nt1
Private nACt, nALt, nAMt, nAPt, nBAt, nCEt, nDFt, nESt, nGOt
Private nMAt, nMGt, nMSt, nMTt, nPAt, nPBt, nPEt, nPIt, nPRt
Private nROt, nRRt, nRSt, nSEt, nSCt, nSPt, nTOt, nRJt, nRNt
Private aAC1, aAL1, aAM1, aAP1, aBA1, aCE1, aDF1, aES1, aGO1
Private aMA1, aMG1, aMS1, aMT1, aPA1, aPB1, aPI1, aPE1, aPR1
Private aRJ1, aRN1, aRO1, aRR1, aRS1, aSE1, aSC1, aSP1, aTO1
aUf:= { "AC", "AL", "AM", "AP", "BA", "CE", "DF", "ES", "GO", "MA", "MG", "MS",;
        "MT", "PA", "PB", "PE", "PI", "PR", "RJ", "RN", "RO", "RR", "RS",  "SC",;
        "SE", "SP","TO", }
cUf := Upper( cUf )
IF cie1 = 'ISENTO' .OR. EMPTY(cie1)
        RETURN .T.
ENDIF
If AScan( aUf, {|nI| cUf == nI} ) == 0
        IF aut_sen('O INSCRICAO ESTADUAL nao confere senha de autorizacao:','LIB_INSC')
                IF LASTKEY() = 27
                        RETURN .F.
                ENDIF
                RETURN .T.
        ENDIF
        Return( .F. )
ENDIF
// Tamanho da IE
nACt := 13; nALt := 09; nAMt := 09; nAPt := 09; nBAt := 08; nCEt := 09
nDFt := 13; nESt := 09; nGOt := 09; nMAt := 09; nMGt := 13; nMSt := 09
nMTt := 11; nPAt := 09; nPBt := 09; nPEt := 14; nPIt := 09; nPRt := 10
nRJt := 08; nRNt := 09; nROt := 09; nRRt := 09; nRSt := 10; nSEt := 09
nSCt := 09; nSPt := 12; nTOt := 11
// Pesos da multiplicao para IE
aAC1 := { { 04, 03, 02, 09, 08, 07, 06, 05, 04, 03, 02 },;
          { 05, 04, 03, 02, 09, 08, 07, 06, 05, 04, 03, 02 } }
aAL1 := { { 02, 03, 04, 05, 06, 07, 08, 09 }, }
aAM1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aAP1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aBA1 := { { 07, 06, 05, 04, 03, 02}, { 08, 07, 06, 05, 04, 03, 02 } }
aCE1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aDF1 := { { 04, 03, 02, 09, 08, 07, 06, 05, 04, 03, 02 },;
          { 05, 04, 03, 02, 09, 08, 07, 06, 05, 04, 03, 02 } }
aES1 := { { 09, 09, 09, 09, 09, 09, 09, 09, 09 }, }
aGO1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aMA1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aMG1 := { { 01, 02, 01, 02, 01, 02, 01, 02, 01, 02, 01, 02 },;
          { 03, 02, 11, 10, 09, 08, 07, 06, 05, 04, 03, 02 } }
aMS1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aMT1 := { { 03, 02, 09, 08, 07, 06, 05, 04, 03, 02 }, }
aPA1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aPB1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aPI1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aPE1 := { { 05, 04, 03, 02, 01, 09, 08, 07, 06, 05, 04, 03, 02 }, }
aPR1 := { { 03, 02, 07, 06, 05, 04, 03, 02 },;
          { 04, 03, 02, 07, 06, 05, 04, 03, 02 } }
aRJ1 := { { 02, 07, 06, 05, 04, 03, 02 }, {  } }
aRN1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aRO1 := { { 06, 05, 04, 03, 02 }, }
aRR1 := { { 01, 02, 03, 04, 05, 06, 07, 08 }, }
aRS1 := { { 02, 09, 08, 07, 06, 05, 04, 03, 02 }, {  } }
aSE1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aSC1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }
aSP1 := { { 01, 03, 04, 05, 06, 07, 08, 10 },;
          { 03, 02, 10, 09, 08, 07, 06, 05, 04, 03, 02 } }
aTO1 := { { 09, 08, 07, 06, 05, 04, 03, 02 }, }

aP1 := &("a"+cUF+"1")[1]
aP2 := &("a"+cUF+"1")[2]
nPt := &("n"+cUF+"t")
For nI := 1 To Len(cIe1)
        cTemp += If( SubStr( cIe1, nI, 1 ) $ "0123456789", SubStr( cIe1, nI, 1 ), "" )
Next
cIe1  := cTemp
If Len( cIE1 ) <> nPt
        IF aut_sen('O INSCRICAO ESTADUAL nao confere senha de autorizacao:','LIB_INSC')
                IF LASTKEY() = 27
                        RETURN .F.
                ENDIF
                RETURN .T.
        ENDIF
        Return .F.
ENDIF
// A partir de alguns pontos já da pra fazer a validacao das IEs, mas sao + 3
// linhas de codigo q quer queira, quer nao, vao gerar mais simblolos dentro do
// obj, entao achei melhor terminar o calculo

Do Case
   Case cUF == "AC"
        cIe2 := SubStr( cIe1, 1, 11 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1 := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Ltrim( Str( Int( nD1 ) ) )
        nSoma := 0
        AEval( aP2, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD2 := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Ltrim( Str( Int( nD2 ) ) )
   Case cUF == "AL"
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := Mod( nSoma, nMod )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
   Case cUF == "AP"
        Do Case
           Case cIe1 >= "03000001" .and. cIe1 <= "03017000"
                nSoma := 5; nT2 := 0
           Case cIe1 >= "03017001" .and. cIe1 <= "03019022"
                nSoma := 9; nT1 := 1
           Case cIe1 >= "03019023"
                nSoma := 0; nT2 := 0
        EndCase
        If Substr(cIe1, 1, 2) <> "03"
           Return(.F.)
        ENDIF
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := nMod - Mod( nSoma, nMod )
        nD1  := If( nD1 == 10, 0, nD1)
        nD1  := If( nD1 == nMod, nT2, nD1)
        cIe2 += AllTrim( Str( Int( nD1 ) ) )
   Case cUF == "AM"
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1 := If( nSoma < nMod, nMod - nSoma,;
                  If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) ) )
        cIe2 += AllTrim( Str( Int( nD1 ) ) )
   Case cUF == "BA" // tem q ser baiano pra ser do contra, eles calculan o 2 dig prim, e usam pro 1 dig
        nMod := If( SubStr( cIe1, 1, 1 ) $ "0123458", 10, 11 )
        cIe2 := SubStr( cIe1, 1, 6 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD2 := If(nMod == 10, nMod - Mod( nSoma, nMod ),;
                  If( nMod - Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) ) )
        cIe2 += AllTrim( Str( Int( nD2 ) ) )
        nSoma := 0
        AEval( aP2, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1 := If(nMod == 10, nMod - Mod( nSoma, nMod ),;
                  If( nMod - Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) ) )
        cIe2 := SubStr( cIe1, 1, 6 ) + AllTrim( Str( Int( nD1 ) ) ) + AllTrim( Str( Int( nD2 ) ) )
   Case cUF == "DF"
        cIe2 := SubStr( cIe1, 1, 11 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := nMod - Mod( nSoma, nMod )
        nD1  := If( nD1 >= 10, 0, nD1 )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
        nSoma := 0
        AEval( aP2, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD2  := nMod - Mod( nSoma, nMod )
        nD2  := If( nD2 >= 10, 0, nD2 )
        cIe2 += Right( Str( Int( nD2 ) ), 1 )
   Case cUF == "CE"
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1 := nMod - Mod( nSoma, nMod )
        nD1 := If( nD1 >= 10, 0, nD1 )
        cIe2 += AllTrim( Str( Int( nD1 ) ) )
   Case cUF == "ES"
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
   Case cUF == "GO"  // Essa foi a mais anormal de todas
        nD2 := Val( Right( cIe1, 1 ) )
        cIe2 := SubStr( cIe1, 1, 2 )
        If cIE2 == "10" .OR. cIE2 == "11" .OR. cIE2 == "15"
           cIe2 := SubStr( cIe1, 1, 8 )
           If cIe1 == "110944020" .OR. cIe1 == "110944021"
              cIe2 := cIe1
            Else
              AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
              Do Case
                 Case Mod( nSoma, nMod ) == 0
                      nD1 := 0
                 Case Mod( nSoma, nMod ) == 1 .AND. cIE2 >= "10103105" .AND. cIE2 <= "10119997"
                      nD1 := 1
                 Case Mod( nSoma, nMod ) == 1 .AND. cIE2 < "10103105" .AND. cIE2 > "10119997"
                      nD1 := 0
                 Case Mod( nSoma, nMod ) > 1
                      nD1 := nMod - Mod( nSoma, nMod )
              EndCase
              cIe2 += Right( Str( Int( nD1 ) ), 1 )
           ENDIF
        ENDIF
   Case cUF == "MA"
        If Left( cIe1, 2 ) == "12"
           cIe2 := SubStr( cIe1, 1, 8 )
           AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
           nD1 := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
           cIe2 += AllTrim( Str( Int( nD1 ) ) )
        ENDIF
   Case cUF == "MG"
        cIe2 := SubStr( cIe1, 1, 3 ) + "0" + Substr( cIe1, 4, 8 ) //0 inutil, 0*2 = 0, pq? 4o. peso.
        AEval( aP1, { |nI, nX| cProd += LTrim( Str( Int( Val( SubStr( cIe2, nX, 1) ) * nI ) ) ) } )
        For nI := 1 to Len( cProd )
            nSoma += Val( SubStr( cProd, nI, 1 ) )
        Next
        cProd := StrZero( nSoma, 3 )
        nD1   := ( Val( SubStr( CProd, 2, 1 ) + "0" ) + 10 )
        nD1   -= nSoma
        cIe2  := SubStr( cIe1, 1, 11 ) + Right( Str( Int( nD1 ) ), 1 )
        nSoma := 0
        AEval( aP2, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD2  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Right( Str( Int( nD2 ) ), 1 )
   Case cUF == "MS"
        cIe2 := SubStr( cIe1, 1, 08 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1 := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) ) //isso é a mesma coisa do site
        cIe2 += LTrim( Str( Int( nD1 ) ) )
   Case cUF == "MT"
        cIe2 := SubStr( cIe1, 1, 10 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1 := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += LTrim( Str( Int( nD1 ) ) )
   Case cUF == "PA"
        If Left(cIe1, 2) == "15"
           cIe2 := SubStr( cIe1, 1, 8 )
           AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
           nD1 := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
           cIe2 := SubStr( cIe1, 1, 8) + AllTrim( Str( Int( nD1 ) ) )
        ENDIF
   Case cUF == "PB"
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
   Case cUF == "PE"
        cIe2 := SubStr( cIe1, 1, 13 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
   Case cUF == "PI"
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += AllTrim( Str( Int( nD1 ) ) )
   Case cUF == "PR"
        cIE2 := SubStr( cIe1, 1, Len( cIe1 ) - 2 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1   := nMod - Mod( nSoma, nMod )
        nD1   := If( nD1 == 10, 0, nD1 )
        cIe2  += AllTrim( Str( Int( nD1 ) ) )
        nSoma := 0
        AEval( aP2,{ |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD2  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
   Case cUF == "RJ"
        cIe2 := SubStr( cIe1, 1, 7 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
   Case cUF == "RN"
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
   Case cUF == "RO"
        cIe2 := SubStr( cIe1, 4, 5 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1 := If( Mod( nSoma, nMod )>= 10, 10, 11 ) - Mod( nSoma, nMod )
        cIe2 := SubStr( cIe1, 1, 8) + AllTrim( Str( Int( nD1 ) ) )
   Case cUF == "RR"
        If Substr( cIe1, 1 , 2 ) == "24"
           nMod := 9
           cIe2 := SubStr( cIe1, 1, 8 )
           AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
           nD1  := Mod( nSoma, nMod )
           cIe2 += Right( Str( Int( nD1 ) ), 1 )
        ENDIF
   Case cUF == "RS"
        cIe2 := SubStr( cIe1, 1, 9 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
   Case cUF == "SC"
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
   Case cUF == "SE"
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 += Right( Str( Int( nD1 ) ), 1 )
   Case cUF == "SP"
        cIe2 := SubStr( cIe1, 1, 8 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := Mod( nSoma, nMod )
        cIe2 += Right( Str( Int( nD1 ) ), 1 ) + SubStr( cIe1, 10, 2 )
        nSoma := 0
        AEval( aP2, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD2 := If( Mod( nSoma, nMod )>= 10, 10, 11 ) - Mod( nSoma, nMod )
        cIe2 += Right( Str( Int( nD2 ) ), 1 )
   Case cUF == "TO"
*        altd()
        cIe2 := SubStr( cIe1, 1, 2 ) + SubStr( cIe1, 5, 6 )
        AEval( aP1, { |nI, nX| nSoma += Val( SubStr( cIe2, nX, 1) ) * nI } )
        nD1  := If( Mod( nSoma, nMod ) <= 1, 0, nMod - Mod( nSoma, nMod ) )
        cIe2 := SubStr( cIe1, 1, 10 ) + Right( Str( Int( nD1 ) ), 1 )
   Otherwise
        IF aut_sen('O INSCRICAO ESTADUAL nao confere senha de autorizacao:','LIB_AMB')
                IF LASTKEY() = 27
                        RETURN .F.
                ENDIF
                RETURN .T.
        ENDIF
        Return .F.
EndCase
IF cie1 <> cie2
        IF aut_sen('O INSCRICAO ESTADUAL nao confere senha de autorizacao:','LIB_INSC')
                IF LASTKEY() = 27
                        RETURN .F.
                ENDIF
                RETURN .T.
        ENDIF
        RETURN .F.
ENDIF
Return( cIe1 == cIe2 )
*/
***************************   F I M   *******************************8
*********************************************************
* FUNCAO P/CONSULTAR, INCLUIR, ALTERAR E EXCLUIR SENHAS
*********************************************************

FUNCTION sacsenha(mop)
*****************
LOCAL mprg:='SACSENHA',;
      f7tela,f7tela1,f7lci,f7cci,f7lba,f7cba,f7msele,f7morde,f7men,;
      oconsprod,ocolprod[11],f7i,f7nkey,f7opcao,tela1,opcao,mreg,li,ci,lb,cb,;
      mnome := SPACE(30),vsenha1:='',vsenha := '',vnivel1 := SPACE(1),vnivel2 := SPACE(1),;
      mcomissao := 0,mcom_praz := 0,mcom_oper := 0,mcota := 0,mdata_cad,msituacao,;
      mcod_ven,mult_alt,mexpira,vtipo,vtipo_sis,vsen_atual:='',mdoc_apagar:=' ',mestoq_min:=' ',mestoq_med:=0,;
      mcons_inso:={}

MEMVAR mcod_vend

IF ! ver_nivel(mprg,'MENU DE SENHAS','15',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF
setcor(1)
mcod_vend := f7lci := f7cci := 0
f7lba := 24
f7cba := 80

li := ci := 0
lb := 15
cb := 52

op_tela(05,05,29,85,memp_resa+SPACE(50)+" Cadastro de Operadores / Outros ")

f7msele := SELE()
f7morde := INDEXORD()
***********************************************
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
SELE('sen');ORDSETFOCUS(2)
GO TOP
***********************************************

oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
f7i:=0
FOR f7i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[f7i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('<P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        f7nkey := 0
        WHILE f7nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                f7nkey := INKEY(0)
        ENDDO
        IF f7nkey == K_ESC
                mcod_vend := 0
                EXIT
        ELSEIF f7nkey = 73 .OR. f7nkey = 105
                IF ! ver_nivel(mprg,'INCLUSAO DE OPERADORES','1',nivel_acess,,'AMBIE')
                        wvw_lclosewindow()
                        RETURN NIL
                ENDIF
                op_tela(10,10,28,62,' Inclusao ')
                WHILE .T.
                        mcons_inso := {}
                	sr_getconnection():exec("SELECT * FROM insopera WHERE NOT scod_op = '999' AND NOT scod_op = '111' ORDER BY scod_op",,.t.,@mcons_inso)
                        IF LEN(mcons_inso) = 0
                                mcod_vend = 1
                        ELSE
                                mcod_vend = VAL(mcons_inso[LEN(mcons_inso),1]) + 1
                        ENDIF
                        mnome = SPACE(30)
                        vsenha = ''
                        vnivel1 := vnivel2 := vtipo := vtipo_sis := SPACE(1)
                        mcomissao := mcom_praz := mcom_oper := mcota := mexpira := mestoq_med:=0
                        opcao = 'S'
			mdoc_apagar := mestoq_min := ' '
                        setcor(3)
                        @ li+5,ci TO li+5,cb
                        janela(li+5,ci,' Comissao do Vendedor ','*','*')
                        @ li+7,ci TO li+7,cb
                        janela(li+7,ci+1,' Comissao do Operador ','*','*')
                        @ li+9,ci TO li+9,cb
                        setcor(1)
                        mensagem('Preencha os Campos - <ESC> p/Retornar')
                        DEVPOS(li+1,ci+2);DEVOUT('Cod.Operador..:')
                        DEVPOS(li+2,ci+2);DEVOUT('Nome..........:')
                        DEVPOS(li+3,ci+2);DEVOUT('Tipo..........:')
                        DEVPOS(li+3,ci+21);DEVOUT('Modulo:')
                        DEVPOS(li+4,ci+2);DEVOUT('Nivel.........:   e  ')
                        DEVPOS(li+6,ci+2);DEVOUT('Comissao (%)..:')
                        DEVPOS(li+6,ci+24);DEVOUT('Comissao Aprazo (%):')
                        DEVPOS(li+8,ci+2);DEVOUT('Comissao (%)..:')
                        DEVPOS(li+10,ci+2);DEVOUT('Cota R$.......:')
                        DEVPOS(li+11,ci+2);DEVOUT('Data..........:')
                        DEVPOS(li+12,ci+2);DEVOUT('SENHA.........:')
                        DEVPOS(li+13,ci+2);DEVOUT('Confirma SENHA:')
                        DEVPOS(li+14,ci+2);DEVOUT('Qtd.dias Expira Senha..........:')
                        DEVPOS(li+15,ci+2);DEVOUT('Alerta Documento Apagar........:')
                        DEVPOS(li+16,ci+2);DEVOUT('Alerta Estoque Abaixo do Minimo:')
                        DEVPOS(li+17,ci+2);DEVOUT('Alerta Estoque Media por Dias..:')
                        @ li+1,ci+18 GET mcod_vend PICT '999' VALID IF(EMPTY(mcod_vend),.F.,.T.)
                        READ
                        IF LASTKEY() = 27
                                EXIT
                        ENDIF
                        mcons_inso := {}
                	sr_getconnection():exec("SELECT * FROM insopera WHERE scod_op = "+sr_cdbvalue(STRZERO(mcod_vend,3)),,.t.,@mcons_inso)
                        IF LEN(mcons_inso) > 0
                                atencao('Codigo ja Existe no cadastro !!!')
                                LOOP
                        ENDIF
                        setcor(3)
                        mdata_cad = mdata_sis
                        DEVPOS(li+1,ci+18);DEVOUT(STRZERO(mcod_vend,3))
                        DEVPOS(li+10,ci+18);DEVOUT(mdata_cad)
                        setcor(1)
                        WVW_DrawBoxGet(,li+2,ci+18,LEN(mnome))
                        WVW_DrawBoxGet(,li+3,ci+18,LEN(vtipo))
                        WVW_DrawBoxGet(,li+3,ci+28,LEN(vtipo_sis))
                        WVW_DrawBoxGet(,li+4,ci+18,1)
                        WVW_DrawBoxGet(,li+4,ci+22,1)
                        WVW_DrawBoxGet(,li+6,ci+18,5)
                        WVW_DrawBoxGet(,li+6,ci+45,5)
                        WVW_DrawBoxGet(,li+8,ci+18,5)
                        WVW_DrawBoxGet(,li+10,ci+18,13)
                        WVW_DrawBoxGet(,li+12,ci+18,10)
                        WVW_DrawBoxGet(,li+13,ci+18,10)
                        WVW_DrawBoxGet(,li+14,ci+25,3)
                        WVW_DrawBoxGet(,li+15,ci+35,3)
                        WVW_DrawBoxGet(,li+16,ci+35,1)
                        WVW_DrawBoxGet(,li+17,ci+35,1)
                        @ li+2,ci+18 GET mnome PICT '@!'
                        @ li+3,ci+18 GET vtipo PICT '@!' VALID vtipo $ 'O,V,G,A,B' .AND. lim_get() WHEN men_get(li+4,ci,'[O]perador - [V]endedor - [G]erente - [A]dministrador - [B]loqueado')
                        @ li+3,ci+28 GET vtipo_sis PICT '@!' VALID vtipo_sis $ 'S,V,C,M' .AND. lim_get() WHEN men_get(li+4,ci,'[S]iscom - [V]enda - [C]aixa - [M]Caixa/Venda')
                        @ li+4,ci+18 GET vnivel1 PICT '9'      //VALID vnivel $ '1,2,3,4,5,6,7,8,9,0'
                        @ li+4,ci+22 GET vnivel2 PICT '9'      //VALID vnivel $ '1,2,3,4,5,6,7,8,9,0'
                        @ li+6,ci+18 GET mcomissao PICT '99.99'
                        @ li+6,ci+45 GET mcom_praz PICT '99.99'
                        @ li+8,ci+18 GET mcom_oper PICT '99.99'
                        @ li+10,ci+18 GET mcota PICT '99,999,999.99'
                        READ
                        IF LASTKEY() = 27
                                LOOP
                        ENDIF
                        WHILE .T.
                                vsenha := vsenha1 := ''
                                mensagem('Digite sua Senha')
                                pegasenha(@vsenha,li+12,ci+18,setcor(2))
                                setcor(1)
                                IF LEN(vsenha) <= 1 .OR. EMPTY(vsenha)
                                        LOOP
                                ENDIF
                                IF vsenha = 'NAO'
                                        EXIT
                                ENDIF
                                mensagem('Digite Novamente sua Senha')
                                pegasenha(@vsenha1,li+13,ci+18,setcor(2))
                                setcor(1)
                                IF LEN(vsenha1) <= 1
                                        LOOP
                                ENDIF
                                IF vsenha1 = 'NAO'
                                        EXIT
                                ENDIF
				mdoc_apagar := mestoq_min := ' '

                                WVW_DrawBoxGet(,li+14,ci+25,3)
                                @ li+14,ci+35 GET mexpira PICT '999'
                                @ li+15,ci+35 GET mdoc_apagar PICT '@!' VALID mdoc_apagar $ ' ,X'
                                @ li+16,ci+35 GET mestoq_min PICT '@!' VALID mestoq_min $ ' ,X'  
                                @ li+17,ci+35 GET mestoq_med PICT '999'
                                READ
                                IF vsenha == vsenha1
                                        opcao := op_simnao('S','Confirma a Inclusao do Operador:')
                                        IF opcao = 'N'
                                                EXIT
                                        ELSE
                                                sr_getconnection():exec('INSERT INTO insopera ('+;
                                                        'scod_op,'+;
                                                        'stipo,'+;
                                                        'stipo_sis,'+;
                                                        'snome  ,'+;
                                                        'ssenha      ,'+;
                                                        'sdata_cad ,'+;
                                                        'snivel ,'+;
                                                        'scomissao     ,'+;
                                                        'scom_oper     ,'+;
                                                        'scom_praz,'+;
                                                        'scota,'+;
                                                        'sult_e_c,'+;
                                                        'sexpira,'+;
                                                        'doc_apagar,'+;
                                                        'estoq_min,'+;
                                                        'estoq_med,'+;
                                                        'SR_DELETED )'+;
                                                        ' VALUES ('+;
                                                        sr_cdbvalue(STRZERO(mcod_vend,3))+','+; //1
                                                        sr_cdbvalue(vtipo)+','+; //2
                                                        sr_cdbvalue(vtipo_sis)+','+; //3
                                                        sr_cdbvalue(mnome)+','+; //4
                                                        sr_cdbvalue(CRIPTO(vsenha))+','+; //5
                                                        sr_cdbvalue(mdata_sis)+','+; //6
                                                        sr_cdbvalue(vnivel1+vnivel2)+','+; //7
                                                        sr_cdbvalue(mcomissao)+','+; //7
                                                        sr_cdbvalue(mcom_oper)+','+; //7
                                                        sr_cdbvalue(IF(EMPTY(mcom_praz),mcomissao,mcom_praz))+','+; //7
                                                        sr_cdbvalue(mcota)+','+; //7
                                                        sr_cdbvalue(mdata_sis)+','+; //7
                                                        sr_cdbvalue(mexpira)+','+; //7
                                                        sr_cdbvalue(mdoc_apagar)+','+; //7
                                                        sr_cdbvalue(mestoq_min)+','+; //7
                                                        sr_cdbvalue(mestoq_med)+','+; //7
                                                        sr_cdbvalue(' ')+')',,.f.)
                                                        sr_getconnection():exec("COMMIT",,.f.)

/*
                                                ADIREG()
                                                sen-> scod_op := STRZERO(mcod_vend,3)
                                                sen-> stipo := vtipo
                                                sen-> stipo_sis := vtipo_sis
                                                sen-> snome := mnome
                                                sen-> ssenha := CRIPTO(vsenha)
                                                sen-> sdata_cad := mdata_sis
                                                sen-> snivel := vnivel1+vnivel2
                                                sen-> scomissao := mcomissao
                                                sen-> scom_oper := mcom_oper
                                                IF EMPTY(mcom_praz)
                                                        sen-> scom_praz := mcomissao
                                                ELSE
                                                        sen-> scom_praz := mcom_praz
                                                ENDIF
                                                sen-> scota := mcota
                                                sen-> sult_e_c := mdata_sis
                                                sen-> sexpira  := mexpira
                                                sen-> doc_apagar  := mdoc_apagar
						sen-> estoq_min := mestoq_min
						sen-> estoq_med := mestoq_med
                                                COMMIT
                                                UNLOCK
*/
                                                EXIT
                                        ENDIF
                                ELSE
                                        atencao('Senha Digitada Errada, Tente novamente !!!')
                                        LOOP
                                ENDIF
                        ENDDO
                        *************
                        SELE('sen');ORDSETFOCUS(2)
                        GO TOP
                        *************
                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
                        ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
                        ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
                        ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
                        ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
                        ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
                        ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
                        ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
                        ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
                        ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
                        f7i:=0
                        FOR f7i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                        EXIT
                ENDDO
                wvw_lclosewindow()
        ELSEIF f7nkey == K_ENTER
                mreg := RECNO()
                mcod_ven := VAL(sen->scod_op)
                mcod_vend := VAL(sen->scod_op)
                IF mop = '*'
                        f7opcao := mensagem1('Deseja <A>lterar <E>xcluir:','A','A,E')
                        IF LASTKEY() = 27
                                EXIT
                        ELSEIF f7opcao = 'A'
                                IF ! ver_nivel(mprg,'ALTERACAO DE OPERADORES','1',nivel_acess,,'AMBIE')
                                        EXIT
                                ENDIF
                                IF cod_operado <> '999' .AND. sen->scod_op = '999'
                                        atencao('Nao e possivel alterar este OPERADOR')
                                        EXIT
                                ENDIF
                                //GO mreg
                                CLEAR GETS
                                op_tela(10,10,28,63,' Alteracao ')
                                WHILE .T.
                                        mnome = SPACE(30)
                                        vnivel1 := vnivel2 := vtipo := SPACE(1)
                                        opcao = SPACE(1)
                                        mcomissao := mcom_praz := mcom_oper := ;
                                        mcota := 0
                                        vsenha := vsenha1 := ''
                                        mensagem('Digite o Codigo do Operador a ser Alterado - <ESC> p/Abandonar')
                                        setcor(3)
                                        @ li+5,ci TO li+5,cb
                                        janela(li+4,ci,' Comissao do Vendedor ','*','*')
                                        @ li+7,ci TO li+7,cb
                                        janela(li+7,ci+1,' Comissao do Operador ','*','*')
                                        @ li+9,ci TO li+9,cb
                                        setcor(1)
                                        mensagem('Preencha os Campos - <ESC> p/Retornar')
                                        DEVPOS(li+1,ci+2);DEVOUT('Cod.Operador..:')
                                        DEVPOS(li+2,ci+2);DEVOUT('Nome..........:')
                                        DEVPOS(li+3,ci+2);DEVOUT('Tipo..........:')
                                        DEVPOS(li+3,ci+21);DEVOUT('Modulo:')
                                        DEVPOS(li+4,ci+2);DEVOUT('Nivel.........:   e  ')
                                        DEVPOS(li+6,ci+2);DEVOUT('Comissao (%)..:')
                                        DEVPOS(li+6,ci+24);DEVOUT('Comissao Aprazo (%):')
                                        DEVPOS(li+8,ci+2);DEVOUT('Comissao (%)..:')
                                        DEVPOS(li+10,ci+2);DEVOUT('Cota R$.......:')
                                        DEVPOS(li+11,ci+2);DEVOUT('Data..........:')
                                        DEVPOS(li+12,ci+2);DEVOUT('SENHA ATUAL...:')
                                        DEVPOS(li+13,ci+2);DEVOUT('SENHA.........:')
                                        DEVPOS(li+14,ci+2);DEVOUT('Confirma SENHA:')
                                        DEVPOS(li+15,ci+2);DEVOUT('Quantidade de dias Expira Senha:')
		                        DEVPOS(li+16,ci+2);DEVOUT('Alerta Documento Apagar........:')
                		        DEVPOS(li+17,ci+2);DEVOUT('Alerta Estoque Abaixo do Minimo:')
                        		DEVPOS(li+18,ci+2);DEVOUT('Alerta Estoque Media por Dias..:')

                                        vsenha := ''
                                        mnome := sen->snome
                                        vtipo   := sen->stipo
                                        vtipo_sis   := sen->stipo_sis
                                        vnivel1 := SUBSTR(sen->snivel,1,1)
                                        vnivel2 := SUBSTR(sen->snivel,2,1)
                                        mcomissao := sen->scomissao
                                        mcom_praz := sen->scom_praz
                                        mcom_oper := sen->scom_oper
                                        mcota := sen->scota
                                        msituacao := sen->sh_i_c
                                        mexpira   := sen->sexpira
					mdoc_apagar := sen->doc_apagar
					mestoq_min := sen->estoq_min
					mestoq_med := sen->estoq_med
                                        setcor(3)
                                        DEVPOS(li+1,ci+18);DEVOUT(sen->scod_op)
                                        DEVPOS(li+10,ci+18);DEVOUT(sen->sdata_cad )
                                        DEVPOS(li+15,ci+35);DEVOUT(sen->sexpira)
                                        setcor(1)
                                        
                                        WVW_DrawBoxGet(,li+2,ci+18,LEN(mnome))
                                        WVW_DrawBoxGet(,li+3,ci+18,LEN(vtipo))
                                        WVW_DrawBoxGet(,li+3,ci+28,LEN(vtipo_sis))
                                        WVW_DrawBoxGet(,li+4,ci+18,1)
                                        WVW_DrawBoxGet(,li+4,ci+22,1)
                                        WVW_DrawBoxGet(,li+6,ci+18,5)
                                        WVW_DrawBoxGet(,li+6,ci+45,5)
                                        WVW_DrawBoxGet(,li+8,ci+18,5)
                                        WVW_DrawBoxGet(,li+10,ci+18,13)
                                        WVW_DrawBoxGet(,li+12,ci+18,10)
                                        WVW_DrawBoxGet(,li+13,ci+18,10)
                                        WVW_DrawBoxGet(,li+14,ci+18,10)
                                        WVW_DrawBoxGet(,li+15,ci+35,3)
                                        WVW_DrawBoxGet(,li+16,ci+35,1)
                                        WVW_DrawBoxGet(,li+17,ci+35,1)
                                        WVW_DrawBoxGet(,li+18,ci+35,3)
                                        @ li+2,ci+18 GET mnome PICT '@!'
                                        @ li+3,ci+18 GET vtipo PICT '@!' VALID vtipo $ 'O,V,G,A,B' .AND. lim_get() WHEN men_get(li+4,ci,'[O]perador - [V]endedor - [G]erente - [A]dministrador - [B]loqueado')
                                        @ li+3,ci+28 GET vtipo_sis PICT '@!' VALID vtipo_sis $ 'S,V,C,M' .AND. lim_get() WHEN men_get(li+4,ci,'[S]iscom - [V]enda - [C]aixa - [M]Caixa/Venda')
                                        @ li+4,ci+18 GET vnivel1 PICT '9'      //VALID vnivel $ '1,2,3,4,5,6,7,8,9,0'
                                        @ li+4,ci+22 GET vnivel2 PICT '9'      //VALID vnivel $ '1,2,3,4,5,6,7,8,9,0'
                                        @ li+6,ci+18 GET mcomissao PICT '99.99'
                                        @ li+6,ci+45 GET mcom_praz PICT '99.99'
                                        @ li+8,ci+18 GET mcom_oper PICT '99.99'
                                        @ li+10,ci+18 GET mcota PICT '99,999,999.99'
                                        READ
                                        IF LASTKEY() = 27
                                                EXIT
                                        ENDIF
                                        opcao := op_simnao('N','Deseja alterar a senha:')
                                        IF LASTKEY() = 27
                                                UNLOCK
                                                LOOP
                                        ENDIF
                                        IF opcao = 'S'
                                                WHILE .T.
                                                        vsen_atual = ''
                                                        vsenha = ''
                                                        vsenha1 = ''
                                                        mensagem('Digite sua Senha ATUAL')
                                                        pegasenha(@vsen_atual,li+12,ci+18,setcor(2))
                                                        IF EMPTY(vsen_atual)
                                                                setcor(1)
                                                                IF ! aut_sen('Senha para Liberar a Alteracao de SENHA: ','LIB_ALTSENHA')
                                                                        LOOP
                                                                ENDIF
                                                                GO mreg
                                                        ELSEIF ALLTRIM(DCRIPTO(sen->ssenha)) <> ALLTRIM(vsen_atual)
                                                                atencao('Senha nao Confere, Digite a Senha Atual...')
                                                                LOOP
                                                        ENDIF
                                                        mensagem('Digite sua Senha')
                                                        pegasenha(@vsenha,li+13,ci+18,setcor(2))
                                                        setcor(1)
                                                        IF LEN(vsenha) <= 1 .OR. EMPTY(vsenha)
                                                                LOOP
                                                        ENDIF
                                                        IF vsenha = 'NAO'
                                                                vsenha := ''
                                                                EXIT
                                                        ENDIF
                                                        mensagem('Digite Novamente sua Senha')
                                                        pegasenha(@vsenha1,li+14,ci+18,setcor(2))
                                                        setcor(1)
                                                        IF LEN(vsenha1) <= 1
                                                                LOOP
                                                        ENDIF
                                                        IF vsenha1 = 'NAO'
                                                                vsenha := ''
                                                                EXIT
                                                        ENDIF
                                                        IF vsenha == vsenha1
                                                                EXIT
                                                        ELSE
                                                                atencao('Senha Digitada Errada, Tente novamente !!!')
                                                                LOOP
                                                        ENDIF
                                                ENDDO
                                        ENDIF
                                        @ li+15,ci+35 GET mexpira PICT '999'
	                                @ li+16,ci+35 GET mdoc_apagar PICT '@!' VALID mdoc_apagar $ ' ,X'
        	                        @ li+17,ci+35 GET mestoq_min PICT '@!' VALID mestoq_min $ ' ,X'
                	                @ li+18,ci+35 GET mestoq_med PICT '999'
                                        READ
                                        opcao := op_simnao('S','Confirma a Alteracao:')
                                        IF opcao = 'N'
                                                LOOP
                                        ELSE
                                                IF ! BLOQREG()
                                                        atencao('Nao foi possivel acessar o Arquivo !!!')
                                                        LOOP
                                                ENDIF
                                                sen-> snome := mnome
                                                sen-> stipo  := vtipo
                                                sen-> stipo_sis  := vtipo_sis
                                                sen-> snivel := vnivel1+vnivel2
                                                sen-> scomissao := mcomissao
                                                sen-> scom_praz := mcom_praz
                                                sen-> scom_oper := mcom_oper
                                                sen-> scota := mcota
                                                sen-> sh_i_c:= msituacao
                                                sen-> sexpira := mexpira
                                                sen-> doc_apagar  := mdoc_apagar
						sen-> estoq_min := mestoq_min
						sen-> estoq_med := mestoq_med
                                                IF ! EMPTY(vsenha)
                                                        sen-> ssenha := CRIPTO(vsenha)
                                                        sen-> sult_e_c:= mdata_sis
                                                ENDIF
                                                DBCOMMIT()
                                                DBUNLOCK()
                                        ENDIF
                                        *************
                                        SELE('sen');ORDSETFOCUS(2)
                                        GO TOP
                                        *************
                                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
                                        ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
                                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
                                        ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
                                        ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
                                        ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
                                        ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
                                        ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
                                        ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
                                        ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
                                        ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
                                        f7i:=0
                                        FOR f7i=1 TO LEN(ocolprod)
                                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                                        NEXT
                                        oconsprod:HEADSEP := CHR(196)
                                        oconsprod:COLSEP := CHR(179)
                                        oconsprod:FORCESTABLE()
                                        EXIT
                                ENDDO
                                wvw_lclosewindow()
                        ELSEIF f7opcao = 'E'
                                IF ! ver_nivel(mprg,'EXCLUSAO DE OPERADORES','1',nivel_acess,,'AMBIE')
                                        EXIT
                                ENDIF
                                IF cod_operado <> '999' .AND. sen->scod_op = '999'
                                        atencao('Nao e possivel alterar este OPERADOR')
                                        EXIT
                                ENDIF
                                //GO mreg
                                CLEAR GETS
                                op_tela(00,00,17,53,' Exclusao ')
                                WHILE .T.
                                        mensagem('Digite o Codigo do Operador a ser Alterado - <ESC> p/Abandonar')
                                        setcor(3)
                                        @ li+4,ci TO li+4,cb
                                        janela(li+4,ci,' Comissao do Vendedor ','*','*')
                                        @ li+6,ci TO li+6,cb
                                        janela(li+6,ci+1,' Comissao do Operador ','*','*')
                                        @ li+8,ci TO li+8,cb
                                        mensagem('Preencha os Campos - <ESC> p/Retornar')
                                        DEVPOS(li+1,ci+2);DEVOUT('Cod.Operador..:')
                                        DEVPOS(li+2,ci+2);DEVOUT('Nome..........:')
                                        DEVPOS(li+3,ci+2);DEVOUT('Nivel.........:   e')
                                        DEVPOS(li+5,ci+2);DEVOUT('Comissao (%)..:')
                                        DEVPOS(li+5,ci+24);DEVOUT('Comissao Aprazo (%):')
                                        DEVPOS(li+7,ci+2);DEVOUT('Comissao (%)..:')
                                        DEVPOS(li+9,ci+2);DEVOUT('Cota R$.......:')
                                        DEVPOS(li+10,ci+2);DEVOUT('Data..........:')
                                        DEVPOS(li+11,ci+2);DEVOUT('SENHA.........:')
                                        DEVPOS(li+12,ci+2);DEVOUT('Confirma SENHA:')

                                        vnivel1 := SUBSTR(sen->snivel,1,1)
                                        vnivel2 := SUBSTR(sen->snivel,2,1)
                                        setcor(3)
                                        DEVPOS(li+1,ci+18);DEVOUT(STRZERO(mcod_vend,3))
                                        DEVPOS(li+10,ci+18);DEVOUT(sen->sdata_cad)
                                        DEVPOS(li+2,ci+18);DEVOUT(sen->snome)
                                        DEVPOS(li+3,ci+18);DEVOUT(vnivel1)
                                        DEVPOS(li+3,ci+22);DEVOUT(vnivel2)
                                        DEVPOS(li+5,ci+18);DEVOUTPICT(sen->scomissao,'99.99')
                                        DEVPOS(li+5,ci+45);DEVOUTPICT(sen->scom_praz,'99.99')
                                        DEVPOS(li+7,ci+18);DEVOUTPICT(sen->scom_oper,'99.99')
                                        DEVPOS(li+9,ci+18);DEVOUTPICT(sen->scota,'99,999,999.99')
                                        setcor(1)
                                        opcao := op_simnao('N','Deseja a Exclusao do Operador:')
                                        IF opcao = 'N'
                                                EXIT
                                        ENDIF
                                        IF opcao = 'S'
                                                IF ! BLOQREG()
                                                        atencao('Nao foi possivel acessar o Arquivo !!!')
                                                        LOOP
                                                ENDIF
                                                DELE
                                                DBCOMMIT()
                                                DBUNLOCK()
                                                sr_getconnection():exec("DELETE FROM insopera WHERE SR_DELETED = 'T'",,.f.)
                                                sr_getconnection():exec("COMMIT",,.f.)
                                        ENDIF
                                        *************
                                        SELE('sen');ORDSETFOCUS(2)
                                        GO TOP
                                        *************
                                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
                                        ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
                                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
                                        ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
                                        ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
                                        ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
                                        ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
                                        ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
                                        ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
                                        ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
                                        ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
                                        f7i:=0
                                        FOR f7i=1 TO LEN(ocolprod)
                                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                                        NEXT
                                        oconsprod:HEADSEP := CHR(196)
                                        oconsprod:COLSEP := CHR(179)
                                        oconsprod:FORCESTABLE()
                                        EXIT
                                ENDDO
                                wvw_lclosewindow()
                        ENDIF
                ELSE
                        CLEAR GETS
                        EXIT
                ENDIF
                *************
                SELE('sen');ORDSETFOCUS(2)
                GO TOP
                *************
                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
                ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
                ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
                ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
                ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
                ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
                ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
                ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
                ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
                ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
                ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
                f7i:=0
                FOR f7i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,f7nkey,'sen')
                        *************
                        SELE('sen');ORDSETFOCUS(2)
                        GO TOP
                        *************
                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
                        ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
                        ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
                        ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
                        ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
                        ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
                        ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
                        ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
                        ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
                        ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
                        f7i:=0
                        FOR f7i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f7msele);IF(f7morde>0,ORDSETFOCUS(f7morde),)
wvw_lclosewindow()
IF f7nkey == K_ESC
        RELEASE ALL
        RETURN mcod_ven
ELSE
        RELEASE ALL
        RETURN mcod_ven
ENDIF
RETURN NIL
******************************* f i m *********************************************
*************************** F I M **********************************
***************************
* ALTERA A DATA DO SISTEMA
***************************
FUNCTION alt_data
******************
LOCAL mcor,dat,mdata
dat := SAVESCREEN(01,00,24,79)
SET CURSOR ON
mcor := SETCOLOR()
setcor(1)
op_tela(10,10,11,40,' Alteracao ')
DEVPOS(00,00);DEVOUT('Data do Sistema:')
*EVPOS(12,11);DEVOUT('Hora do Sistema:')
*EVPOS(12,28);DEVOUT(TIME())
mdata := mdata_sis
CLEAR GETS
setcor(1)
@ 00,18 GET mdata
READ
IF mdata <> mdata_sis
        IF ! ver_nivel('ALT_DATA','ALTERACAO DA DATA DO SISTEMA','1245',nivel_acess,,'AMBIE')
                CLEAR GETS
                wvw_lclosewindow()
                RETURN NIL
        ENDIF
ENDIF
mdata_sis := mdata
CLEAR GETS
wvw_lclosewindow()
RETURN NIL
******************************* F I M ***********************************
***********************************************
* LER ARQUIVOS DO DOS
***********************************************
FUNCTION sacler(mrel)
******************
LOCAL mprg := 'SACLER',;
      opcao,lci,cci,msele,morde,mno_ped

MEMVAR getlist,nivel_acess

PRIVATE mtipo_imp,mimp_tipo:=0,marq:=SPACE(35),mtipo_pg,mporta_imp,mquantd

IF ! ver_nivel(mprg,'LER ARQUIVOS DO DOS','1245',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF
lci := cci := 0
*---------------------------------------------
op_tela(10,10,12,80,' Ler Arquivos Texto')
WHILE .T.
        marq := '\'+CURDIR()+'\'+SPACE(32)
        setcor(1)
        mensagem('Digite o Caminho do Arquivo e o nome e extensao do Arquivo - <ESC>p/Retornar')
        DEVPOS(lci+1,cci+1);DEVOUT('Caminho do Arquivo (com extensao)..:')
        @ lci+1,cci+38 GET marq PICT '@S30!'
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        marq := RTRIM(marq)
        IF ! SR_PhFile((marq)) 
                atencao('Nao foi possivel encontrar este ARQUIVO')
                LOOP
        ENDIF
        conf_impressao(marq)
        //lertexto(marq)
        //MYRUN('NOTEPAD.EXE '+marq)
	//PrintFileRaw(GetDefaultPrinter(),marq,"teste de impressao")


ENDDO
wvw_lclosewindow()
RETURN NIL
********************************* f i m **********************************
*#include "inkey.ch"              // constantes de codigos das teclas
*********************************************************
* FUNCAO P/CONSULTAR, INCLUIR, ALTERAR E EXCLUIR ACESSORIOS
*********************************************************
FUNCTION sacos2(mop)
*****************
LOCAL mprg:='SACOS2',;
      f7tela,f7tela1,f7lci,f7cci,f7lba,f7cba,f7msele,f7morde,f7men,;
      oconsprod,ocolprod[2],f7i,f7nkey,f7opcao,cod,desc,;
      tela1,opcao,mreg

IF ! ver_nivel(mprg,'CADASTRO DE ACESSORIOS','15',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF
f7lci := f7cci := 00
f7lba := 15
f7cba := 32


f7msele := SELE()
f7morde := INDEXORD()
***********************************************
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
IF ! AbriArq('sacsetup','set');RETURN NIL;ENDIF
IF ! AbriArq('sacosac','osac');RETURN NIL;ENDIF
SELE('osac');ORDSETFOCUS(1)
***********************************************
f7men := SAVESCREEN(24,00,24,79)

op_tela(f7lci,f7cci-1,f7lba+4,f7cba,,' ACESSORIOS ')
oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
ocolprod[1] := TBCOLUMNNEW('Codigo',{||osac->codigo})
ocolprod[2] := TBCOLUMNNEW('Descricao',{||osac->descri})
f7i:=0
FOR f7i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[f7i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('<P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        f7nkey := 0
        WHILE f7nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                f7nkey := INKEY(0)
        ENDDO
        IF f7nkey == K_ESC
                EXIT
        ELSEIF f7nkey = 73 .OR. f7nkey = 105
                tela1 := SAVESCREEN(01,00,24,79)
                CLEAR GETS
                WHILE .T.
                        *************
                        SELE('osac');ORDSETFOCUS(1)
                        GO BOTT
                        *************
                        mensagem('Digite o Nome da Acessorio - <ESC> p/Retornar')
                        cod=STRZERO(VAL(osac->codigo)+1,3)
                        desc=SPACE(20)
                        botao(f7lba+1,f7cci-1,f7lba+3,f7cba+1,,' Inclusao de Acessorios ','*')

                        @ f7lba+2,f7cci GET cod PICT '999'
                        READ
                        IF lastkey()=27 .or. cod="   "
                                go top
                                EXIT
                        ENDIF
                        IF osac->(DBSEEK(cod))
                                atencao("Este Acessorio ja  existe!")
                                LOOP
                        ENDIF
                        @ f7lba+2,f7cci+10 GET desc PICT '@!'
                        READ
                        IF LASTKEY() = 27 .OR. EMPTY(desc)
                                GO TOP
                                EXIT
                        ENDIF
                        opcao := 'S'
                        opcao := op_simnao('S','Confirma Inclusao:')
                        IF opcao = 'S'
                                IF ADIREG()
                                        osac->codigo := cod
                                        osac->descri := desc
                                        COMMIT
                                        UNLOCK
                                        mreg := RECNO()
                                        *************
                                        SELE('osac');ORDSETFOCUS(2)
                                        GO mreg
                                        *************
                                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||osac->codigo})
                                        ocolprod[2] := TBCOLUMNNEW('Descricao',{||osac->descri})
                                        f7i:=0
                                        FOR f7i=1 TO LEN(ocolprod)
                                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                                        NEXT
                                        oconsprod:HEADSEP := CHR(196)
                                        oconsprod:COLSEP := CHR(179)
                                        oconsprod:FORCESTABLE()
                                        EXIT
                                ELSE
                                        atencao('Nao foi possivel acessar o Arquivo !!!')
                                        ORDSETFOCUS(3)
                                        LOOP
                                ENDIF
                        ENDIF
                ENDDO
        ELSEIF f7nkey == K_ENTER
                cod     := osac->codigo
                desc    := osac->descri
                IF mop = '*'
                        CLEAR GETS
                        f7opcao := mensagem1('Deseja <A>lterar <E>xcluir:','A','A,E')
                        IF LASTKEY() = 27
                                EXIT
                        ELSEIF f7opcao = 'A'
                                tela1 := SAVESCREEN(01,00,24,79)
                                WHILE .T.
                                        mensagem('Digite o Codigo da Despesa a ser Alterado - <ESC> p/Retornar')
                                        botao(f7lba+1,f7cci-1,f7lba+3,f7cba+1,,' Alteracao Acessorio ','*')
                                        setcor(3)
                                        DEVPOS(f7lba+2,f7cci+1);DEVOUT(osac->codigo)
                                        setcor(1)
                                        @ f7lba+2,f7cci+10 GET desc PICT '@!'
                                        READ
                                        IF LASTKEY() = 27
                                                GO TOP
                                                EXIT
                                        ENDIF
                                        opcao := op_simnao('S','Confirma Alteracao:')
                                        IF opcao = 'N'
                                                UNLOCK
                                                LOOP
                                        ENDIF
                                        IF opcao = 'S'
                                                IF ! BLOQREG()
                                                        atencao('Nao foi possivel acessar o Arquivo !!!')
                                                        LOOP
                                                ENDIF
                                                osac-> codigo := cod
                                                osac-> descri := desc
                                                DBCOMMITALL()
                                                DBUNLOCKALL()
                                                SELE('osac');ORDSETFOCUS(1)
                                                EXIT
                                        ENDIF
                                ENDDO
                        ELSEIF f7opcao = 'E'
                                tela1 := SAVESCREEN(01,00,24,79)
                                WHILE .T.
                                        botao(f7lba+1,f7cci-1,f7lba+3,f7cba+1,,' Exclusao de Acessorios ','*')
                                        setcor(3)
                                        DEVPOS(f7lba+2,f7cci+1);DEVOUT(osac->codigo)
                                        DEVPOS(f7lba+2,f7cci+10);DEVOUT(osac->descri)
                                        setcor(1)
                                        opcao := op_simnao('S','Confirma Exclusao:')
                                        IF LASTKEY() = 27 .OR. opcao = 'N'
                                                EXIT
                                        ENDIF
                                        IF opcao = 'S'
                                                IF ! BLOQARQ()
                                                        atencao('Nao foi possivel acessar o Arquivo !!!')
                                                        LOOP
                                                ENDIF
                                                DELE
                                                COMMIT
                                                UNLOCK
                                                sr_getconnection():exec("DELETE FROM sacosac WHERE SR_DELETED = 'T'",,.f.)
                                                sr_getconnection():exec("COMMIT",,.f.)
                                                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                                                ocolprod[1] := TBCOLUMNNEW('Codigo',{||osac->codigo})
                                                ocolprod[2] := TBCOLUMNNEW('Descricao',{||osac->descri})
                                                f7i:=0
                                                FOR f7i=1 TO LEN(ocolprod)
                                                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                                                NEXT
                                                oconsprod:HEADSEP := CHR(196)
                                                oconsprod:COLSEP := CHR(179)
                                                oconsprod:FORCESTABLE()
                                                EXIT
                                        ENDIF
                                ENDDO
                        ENDIF
                ELSE
                        EXIT
                ENDIF
                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                ocolprod[1] := TBCOLUMNNEW('Codigo',{||osac->codigo})
                ocolprod[2] := TBCOLUMNNEW('Descricao',{||osac->descri})
                f7i:=0
                FOR f7i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,f7nkey,'osac')
                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||osac->codigo})
                        ocolprod[2] := TBCOLUMNNEW('Descricao',{||osac->descri})
                        f7i:=0
                        FOR f7i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f7msele);IF(f7morde>0,ORDSETFOCUS(f7morde),)
RESTSCREEN(01,00,24,79,tela1)
wvw_lclosewindow()
IF f7nkey == K_ENTER
        RELEASE ALL
        RETURN osac->codigo
ELSEIF f7nkey == K_ESC
        RELEASE ALL
        RETURN NIL
ENDIF
RETURN NIL
***************************  F I M  **********************************
******************
* VERIFICA ACESSORIO
******************
FUNCTION ver_acess(vcd,li,ci,t,mzero,p)
**********************
LOCAL msele,morde

IF ((mzero <> NIL .OR. mzero = 0) .AND. mzero <> 1) .AND. EMPTY(vcd)
        RETURN .T.
ENDIF

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacosac','osac');RETURN NIL;ENDIF

WHILE .T.
        **************
        SELE('osac');ORDSETFOCUS(1)
        GO TOP
        **************

        SEEK vcd

        IF t = .T. .AND. FOUND()
                vcd := SPACE(3)
                atencao('Codigo ja Cadastrado !!!')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF
        IF ! FOUND()
                vcd := SPACE(3)
                IF p = NIL
                        atencao('Codigo nao Cadastrado !!!')
                ENDIF
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF
        IF li = NIL
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
        setcor(3)
        DEVPOS(li,ci);DEVOUT(osac->descri)
        setcor(1)
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDDO
RETURN NIL
********************** F I M ********************************
**************************************
* VER ARQUIVO DE INICIALIZACAO
**************************************
#include "fileio.ch"
FUNCTION ver_ini
LOCAL ret_tam:=0,pos_ret,var_ret_cmd,var_aux,i:=0
IF ! FILE(curdrive()+':\HRBCFG.INI') .AND. FILE(curdrive()+':\CFGHRB.INI')
        SET DEVI TO PRINT
        SET PRINT ON
        SET PRINT TO (curdrive()+':\HRBCFG.INI')
        DEVPOS(00,00);DEVOUT('001')
        DEVPOS(01,00);DEVOUT(' ')
        SET PRINT TO;SET PRINT OFF;SET DEVI TO SCREEN
ELSEIF ! FILE(curdrive()+':\HRBCFG.INI')
        RETURN '001'
ENDIF
While RET_TAM = 0
        H_Handle := Fopen(curdrive()+":\HRBCFG.INI")
        RET_TAM =  FSeek( H_Handle, 0, FS_END )
        Fclose(H_Handle)
enddo
H_Handle:= Fopen(curdrive()+":\HRBCFG.INI")
POS_RET = 0
VAR_RET_CMD=" "
VAR_AUX =" "
*if RET_TAM > 0
        FOR POS_RET = 1 to RET_TAM - 1
                fread( H_Handle, @VAR_AUX, 1)
                if VAR_AUX <> chr(13)
                        VAR_RET_CMD= VAR_RET_CMD + VAR_AUX
                end if
        next
*endif
fclose(H_Handle)
RETURN SUBSTR(ALLTRIM(var_ret_cmd),1,3)
*************************** f i m ****************************
**********************
* OPCAO SIM OU NAO
**********************
FUNCTION op_simnao(mtipo_op,mensagem,mtitulo)
*********************************************
LOCAL mopcao_simnao
mopcao_simnao := WVW_MessageBox( ,mensagem,IF(mtitulo=NIL,' Escolha a Opcao ',mtitulo),MB_YESNO + MB_ICONQUESTION + MB_SYSTEMMODAL + IF(mtipo_op = 'S',MB_DEFBUTTON1,MB_DEFBUTTON2))
IF mopcao_simnao = 6
        RETURN 'S'
ELSE
        RETURN 'N'
ENDIF
RETURN NIL
*************************** f i m ****************************
*************************
* OPCAO SIM,NAO OU CANCEL
*************************
FUNCTION op_simnaocan(mtipo_op,mensagem,mtitulo)
************************************************
LOCAL mopcao_simnao

mopcao_simnao := WVW_MessageBox( ,mensagem,IF(mtitulo=NIL,' Escolha a Opcao ',mtitulo),MB_YESNOCANCEL + MB_ICONQUESTION + MB_SYSTEMMODAL + IF(mtipo_op = 'C',MB_DEFBUTTON3,IF(mtipo_op = 'S',MB_DEFBUTTON1,MB_DEFBUTTON2)))
IF mopcao_simnao = 6
        RETURN 'S'
ELSEIF mopcao_simnao = 7
        RETURN 'N'
ELSE
        RETURN 'C'
ENDIF
RETURN NIL

*************************** f i m ****************************
**********************
* OPCAO TELA
**********************
FUNCTION op_tela(op_l,op_c,op_lb,op_cb,op_mensagem,mli,mcent,mclose)
********************************************************************
//SETMODE(50,120)
wvw_maximize()
wvw_nopenwindow(,op_l,op_c,op_lb,op_cb)
Wvw_SetTitle( ,op_mensagem)
IF mclose <> NIL
        wvw_noclose()
ENDIF
IF mcent # NIL  //.OR. (op_lb >= 50 .OR. op_cb = 90)
        WVW_CenterWindow(,.T.,.T.)
ENDIF
IF mli = NIL
        WVW_SBCreate()
        WVW_SBAddPart(,,800,0,.F.)
ENDIF
RETURN NIL
*************************** f i m ****************************
**********************
* EXECUTAR PROGRAMAS EXTERNOS
**********************
FUNC MYRUN( cComando )
*********************************
local oShell, RET
oShell := CreateObject( "WScript.Shell" )
RET := oShell:Run( "%comspec% /c " + cComando, 0, .T. )
oShell := NIL
return iif( RET = 0, .T., .F. )
*********************************
***********************
FUNCTION MyRun2( cRun )
***********************
Local hIn, hOut, nRet //, hProc
Local hProc := HB_OpenProcess(cRun , @hIn, @hOut, @hOut )

IF hProc < 0
   	FClose( hProc )
   	FClose( hIn )
   	FClose( hOut )
   	Return(.F.)
	//atencao("Error: " + valtoprg(FError()))
ENDIF
nRet := HB_ProcessValue( hProc,.f. )
IF nRet > 0
   	FClose( hProc )
   	FClose( hIn )
   	FClose( hOut )
   	Return(.F.)
endif
FClose( hProc )
FClose( hIn )
FClose( hOut )
Return(.T.)
************************* F I M ****************************************
******************
* VERIFICA VENDA AVISTA
******************
FUNCTION venda_av(vnum_ped)
**********************
LOCAL msele,morde,mped

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('saccaixa','caix');RETURN NIL;ENDIF
**************
SELE('caix');ORDSETFOCUS(6)
GO TOP
**************
mped := 'PD'+vnum_ped
IF caix->(DBSEEK(mped+'DN'))
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN caix->valor
ELSE
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN 0
ENDIF

RETURN NIL
********************** F I M ********************************
***************************
* ACHA O IP DA MAQUINA
***************************
FUNCTION GetIp()
****************
LOCAL aHosts,cName,;
      cEstacao:=netname(.f.)
InetInit()
aHosts := InetGetHosts( cEstacao )
IF aHosts == NIL
   aHosts := InetGetAlias( cEstacao )
ENDIF
IF Empty(aHosts)
   aHosts := InetGetAlias( cEstacao )
ENDIF
InetCleanup()
RETURN  ahosts[1 ]
********************************  F I M  ********************************************
FUNCTION hdserial(p_hddrive)
// Funcao...: Executar a leitura do numero de serie do HD -------------------.
STATIC vhdserial
vhdserial := HdGetSerial(p_hddrive)
vhdserial := IIF(VALTYPE(vhdserial) == 'N',ALLTRIM(STR(vhdserial)),vhdserial)  //hb_NumToHex(vhdserial)
vhdserial := SUBSTR(vhdserial,1,4) + SUBSTR(vhdserial,5,4)
RETURN(vhdserial)
// Fim da funcao de leitura de serie de HD ----------------------------------.
// --------------------------------------------------------------------------.
// Funcao...: FunÆo em "C" para ler o numero serial do HD ------------------.
#pragma BEGINDUMP
#define HB_OS_WIN_32_USED
#include <windows.h>
#include "winbase.h"
#include "winuser.h"
#include "item.api"
#include "hbapi.h"
HB_FUNC (HDGETSERIAL)
{
unsigned long SerialNumber;
GetVolumeInformation(hb_parc(1),NULL,0,&SerialNumber,NULL,NULL,NULL,0);
hb_retnl(SerialNumber);
}
#pragma enddump
// Fim da funcao em "C" para ler numero serial de HD

***************************  F I M ***********************************
* CONVERTE DBF para BANCO DE DADOS
**********************************
#include "directry.ch"
#include "sqlrdd.ch"       // SQLRDD Main include

Function dbf2sql()
******************
local nCnn, nDrv, cDriver

clear screen

cDriver := "DBFCDX"
RddSetDefault( cDriver )

SET DELETED ON

upload( ".\", "", cDriver )

Return NIL

/*------------------------------------------------------------------------*/
Function upload( cBaseDir, cPrefix, cDriver )
*********************************************
local aFiles:={}, aStruct, aFile, cFile,;
insopera := 'X',;
sacsetup := 'X',;
sacped_s := 'X',;
sacorcam := 'X',;
sacmov  := 'X',;
sacmovnt := 'X',;
sactotnt := 'X',;
saccaixa := 'X',;
saccheq := 'X',;
sacdupr := 'X',;
saccred := 'X',;
sacdupp := 'X',;
sacemp  := 'X',;
sacgrupo := 'X',;
sacmerc := 'X',;
sactbmer := 'X',;
sacforn := 'X',;
saccli  := 'X',;
sacped_e := 'X',;
sacped_c := 'X',;
sacorc_c := 'X',;
sacnoped := 'X',;
sacnoorc := 'X',;
sacnorom := 'X',;
sacnopro := 'X',;
sactotb := 'X',;
sacicm  := 'X',;
sacnota := 'X',;
sacnotae := 'X',;
sacnotab := 'X',;
sacuf   := 'X',;
saccarta := 'X',;
saccadde := 'X',;
sacdesp := 'X',;
sactran := 'X',;
sacav   := 'X',;
sacop   := 'X',;
sacespe := 'X',;
sacdolar := 'X',;
sacbal  := 'X',;
sacselnf := 'X',;
sacfin  := 'X',;
sacban1 := 'X',;
sacban2 := 'X',;
sacban3 := 'X',;
sacban4 := 'X',;
sacban5 := 'X',;
sacban6 := 'X',;
sacban7 := 'X',;
sacban8 := 'X',;
sacban9 := 'X',;
sacban10 := 'X',;
sacban11 := 'X',;
sacban12 := 'X',;
sacban13 := 'X',;
sacban14 := 'X',;
sacban15 := 'X',;
sacserie := 'X',;
sactabpg := 'X',;
sacobs  := 'X',;
saccid  := 'X',;
saclog  := 'X',;
sactabme := 'X',;
sacconf := 'X',;
merc_det := 'X',;
saccep  := 'X',;
sacvisi := 'X',;
sacsoli := 'X',;
regiao  := 'X',;
sactipdc := 'X',;
sacreme := 'X',;
sacimpdu := 'X',;
sacmensa := 'X',;
sacctvis := 'X',;
sacroma := 'X',;
sacprodu := 'X',;
sacsef  := 'X',;
sacbalan := 'X',;
sacoss  := 'X',;
sacospro := 'X',;
sacosno := 'X',;
sacosac := 'X',;
sacass  := 'X',;
sacsolpr := 'X',;
sacrl   := 'X',;
sacproto := 'X',;
sacrepro := 'X',;
saccotac := 'X',;
saccbped := 'X',;
saccborc := 'X',;
sacpcli := 'X',;
sachist := 'X',;
sacmovb := 'X',;
saccomi := 'X',;
sacperf := 'X',;
sacsincl := 'X',;
sacnotp := 'X',;
sactped := 'X',;
saccons := 'X',;
sacceplo := 'X',;
sacmovcn := 'X',;
texto   := 'X'

SETMODE(50,100)
SETCOLOR('B+/W*,W/B,,,N/W*')
WVW_SetFont(,'Ms Sans Serif',12, 8,, PROOF_QUALITY )  // 800X600
op_tela(0,0,50,100,"Convertento DBF's para BANCO DE DADOS em USO")
@ 00,01 SAY 'Deseja o INSOPERA:' GET insopera PICT '@!'
@ 01,01 SAY 'Deseja o SACSETUP:' GET sacsetup PICT '@!'
@ 02,01 SAY 'Deseja o SACPED_S:' GET sacped_s PICT '@!'
@ 03,01 SAY 'Deseja o SACORCAM:' GET sacorcam PICT '@!'
@ 04,01 SAY 'Deseja o SACMOV  :' GET sacmov   PICT '@!'
@ 05,01 SAY 'Deseja o SACMOVNT:' GET sacmovnt PICT '@!'
@ 06,01 SAY 'Deseja o SACTOTNT:' GET sactotnt PICT '@!'
@ 07,01 SAY 'Deseja o SACCAIXA:' GET saccaixa PICT '@!'
@ 08,01 SAY 'Deseja o SACCHEQ :' GET saccheq  PICT '@!'
@ 09,01 SAY 'Deseja o SACDUPR :'GET sacdupr  PICT '@!'
@ 10,01 SAY 'Deseja o SACCRED :'GET saccred  PICT '@!'
@ 11,01 SAY 'Deseja o SACDUPP :'GET sacdupp  PICT '@!'
@ 12,01 SAY 'Deseja o SACEMP  :'GET sacemp   PICT '@!'
@ 13,01 SAY 'Deseja o SACGRUPO:'GET sacgrupo PICT '@!'
@ 14,01 SAY 'Deseja o SACMERC :'GET sacmerc  PICT '@!'
@ 15,01 SAY 'Deseja o SACTBMER:'GET sactbmer PICT '@!'
@ 16,01 SAY 'Deseja o SACFORN :'GET sacforn  PICT '@!'
@ 17,01 SAY 'Deseja o SACCLI  :'GET saccli   PICT '@!'
@ 18,01 SAY 'Deseja o SACPED_E:'GET sacped_e PICT '@!'
@ 19,01 SAY 'Deseja o SACPED_C:'GET sacped_c PICT '@!'
@ 20,01 SAY 'Deseja o SACORC_C:'GET sacorc_c PICT '@!'
@ 21,01 SAY 'Deseja o SACNOPED:'GET sacnoped PICT '@!'
@ 22,01 SAY 'Deseja o SACNOORC:'GET sacnoorc PICT '@!'
@ 23,01 SAY 'Deseja o SACNOROM:'GET sacnorom PICT '@!'
@ 24,01 SAY 'Deseja o SACNOPRO:'GET sacnopro PICT '@!'
@ 25,01 SAY 'Deseja o SACTOTB :'GET sactotb  PICT '@!'
@ 26,01 SAY 'Deseja o SACICM  :'GET sacicm   PICT '@!'
@ 27,01 SAY 'Deseja o SACNOTA :'GET sacnota  PICT '@!'
@ 28,01 SAY 'Deseja o SACNOTAE:'GET sacnotae PICT '@!'
@ 29,01 SAY 'Deseja o SACNOTAB:'GET sacnotab PICT '@!'
@ 30,01 SAY 'Deseja o SACUF   :'GET sacuf    PICT '@!'
@ 31,01 SAY 'Deseja o SACCARTA:'GET saccarta PICT '@!'
@ 32,01 SAY 'Deseja o SACCADDE:'GET saccadde PICT '@!'
@ 33,01 SAY 'Deseja o SACDESP :'GET sacdesp  PICT '@!'
@ 34,01 SAY 'Deseja o SACTRAN :'GET sactran  PICT '@!'
@ 35,01 SAY 'Deseja o SACAV   :'GET sacav    PICT '@!'
@ 36,01 SAY 'Deseja o SACOP   :'GET sacop    PICT '@!'
@ 37,01 SAY 'Deseja o SACESPE :'GET sacespe  PICT '@!'
@ 38,01 SAY 'Deseja o SACDOLAR:'GET sacdolar PICT '@!'
@ 39,01 SAY 'Deseja o SACBAL  :'GET sacbal   PICT '@!'
@ 40,01 SAY 'Deseja o SACSELNF:'GET sacselnf PICT '@!'
@ 41,01 SAY 'Deseja o SACFIN  :'GET sacfin   PICT '@!'
@ 42,01 SAY 'Deseja o SACBAN1 :'GET sacban1  PICT '@!'
@ 43,01 SAY 'Deseja o SACBAN2 :'GET sacban2  PICT '@!'
@ 44,01 SAY 'Deseja o SACBAN3 :'GET sacban3  PICT '@!'
@ 45,01 SAY 'Deseja o SACBAN4 :'GET sacban4  PICT '@!'
@ 46,01 SAY 'Deseja o SACBAN5 :'GET sacban5  PICT '@!'
@ 47,01 SAY 'Deseja o SACBAN6 :'GET sacban6  PICT '@!'
@ 48,01 SAY 'Deseja o SACBAN7 :'GET sacban7  PICT '@!'
@ 49,01 SAY 'Deseja o SACBAN8 :'GET sacban8  PICT '@!'
@ 50,01 SAY 'Deseja o SACBAN9 :'GET sacban9  PICT '@!'

@ 00,50 SAY 'Deseja o SACBAN10:' GET sacban10 PICT '@!'
@ 01,50 SAY 'Deseja o SACBAN11:' GET sacban11 PICT '@!'
@ 02,50 SAY 'Deseja o SACBAN12:' GET sacban12 PICT '@!'
@ 03,50 SAY 'Deseja o SACBAN13:' GET sacban13 PICT '@!'
@ 04,50 SAY 'Deseja o SACBAN14:' GET sacban14 PICT '@!'
@ 05,50 SAY 'Deseja o SACBAN15:' GET sacban15 PICT '@!'
@ 06,50 SAY 'Deseja o SACSERIE:' GET sacserie PICT '@!'
@ 07,50 SAY 'Deseja o SACTABPG:' GET sactabpg PICT '@!'
@ 08,50 SAY 'Deseja o SACOBS  :' GET sacobs   PICT '@!'
@ 09,50 SAY 'Deseja o SACCID  :'GET saccid   PICT '@!'
@ 10,50 SAY 'Deseja o SACLOG  :'GET saclog   PICT '@!'
@ 11,50 SAY 'Deseja o SACTABME:'GET sactabme PICT '@!'
@ 12,50 SAY 'Deseja o SACCONF :'GET sacconf  PICT '@!'
@ 13,50 SAY 'Deseja o MERC_DET:'GET merc_det PICT '@!'
@ 14,50 SAY 'Deseja o SACCEP  :'GET saccep   PICT '@!'
@ 15,50 SAY 'Deseja o SACVISI :'GET sacvisi  PICT '@!'
@ 16,50 SAY 'Deseja o SACSOLI :'GET sacsoli  PICT '@!'
@ 17,50 SAY 'Deseja o REGIAO  :'GET regiao   PICT '@!'
@ 18,50 SAY 'Deseja o SACTIPDC:'GET sactipdc PICT '@!'
@ 19,50 SAY 'Deseja o SACREME :'GET sacreme  PICT '@!'
@ 20,50 SAY 'Deseja o SACIMPDU:'GET sacimpdu PICT '@!'
@ 21,50 SAY 'Deseja o SACMENSA:'GET sacmensa PICT '@!'
@ 22,50 SAY 'Deseja o SACCTVIS:'GET sacctvis PICT '@!'
@ 23,50 SAY 'Deseja o SACROMA :'GET sacroma  PICT '@!'
@ 24,50 SAY 'Deseja o SACPRODU:'GET sacprodu PICT '@!'
@ 25,50 SAY 'Deseja o SACSEF  :'GET sacsef   PICT '@!'
@ 26,50 SAY 'Deseja o SACBALAN:'GET sacbalan PICT '@!'
@ 27,50 SAY 'Deseja o SACOSS  :'GET sacoss   PICT '@!'
@ 28,50 SAY 'Deseja o SACOSPRO:'GET sacospro PICT '@!'
@ 29,50 SAY 'Deseja o SACOSNO :'GET sacosno  PICT '@!'
@ 30,50 SAY 'Deseja o SACOSAC :'GET sacosac  PICT '@!'
@ 31,50 SAY 'Deseja o SACASS  :'GET sacass   PICT '@!'
@ 32,50 SAY 'Deseja o SACSOLPR:'GET sacsolpr PICT '@!'
@ 33,50 SAY 'Deseja o SACRL   :'GET sacrl    PICT '@!'
@ 34,50 SAY 'Deseja o SACPROTO:'GET sacproto PICT '@!'
@ 35,50 SAY 'Deseja o SACREPRO:'GET sacrepro PICT '@!'
@ 36,50 SAY 'Deseja o SACCOTAC:'GET saccotac PICT '@!'
@ 37,50 SAY 'Deseja o SACCBPED:'GET saccbped PICT '@!'
@ 38,50 SAY 'Deseja o SACCBORC:'GET saccborc PICT '@!'
@ 39,50 SAY 'Deseja o SACPCLI :'GET sacpcli  PICT '@!'
@ 40,50 SAY 'Deseja o SACHIST :'GET sachist  PICT '@!'
@ 41,50 SAY 'Deseja o SACMOVB :'GET sacmovb  PICT '@!'
@ 42,50 SAY 'Deseja o SACCOMI :'GET saccomi  PICT '@!'
@ 43,50 SAY 'Deseja o SACPERF :'GET sacperf  PICT '@!'
@ 44,50 SAY 'Deseja o SACSINCL:'GET sacsincl PICT '@!'
@ 45,50 SAY 'Deseja o SACNOTP :'GET sacnotp  PICT '@!'
@ 46,50 SAY 'Deseja o SACTPED :'GET sactped  PICT '@!'
@ 47,50 SAY 'Deseja o SACCEPLO:'GET sacceplo PICT '@!'
@ 48,50 SAY 'Deseja o SACMOVCN:'GET sacmovcn PICT '@!'
@ 49,50 SAY 'Deseja o TEXTO   :'GET texto    PICT '@!'
READ
IF LASTKEY() = 27
        QUIT
ENDIF

IF ! EMPTY(insopera)
        dbUseArea( .T., "DBFCDX","insopera", "ORIG" )
        DEVPOS(00,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "insopera", "DEST", .F. )
        Append from "insopera" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(00,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacsetup)
        dbUseArea( .T., "DBFCDX","sacsetup", "ORIG" )
        DEVPOS(01,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacsetup", "DEST", .F. )
        Append from "sacsetup" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(01,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacped_s)
        dbUseArea( .T., "DBFCDX","sacped_s", "ORIG" )
        DEVPOS(02,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacped_s", "DEST", .F. )
        Append from "sacped_s" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(02,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacorcam)
        dbUseArea( .T., "DBFCDX","sacorcam", "ORIG" )
        DEVPOS(03,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacorcam", "DEST", .F. )
        Append from "sacorcam" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(03,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacmov)
        dbUseArea( .T., "DBFCDX","sacmov", "ORIG" )
        DEVPOS(04,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacmov", "DEST", .F. )
        Append from "sacmov" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(04,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacmovnt)
        dbUseArea( .T., "DBFCDX","sacmovnt", "ORIG" )
        DEVPOS(05,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacmovnt", "DEST", .F. )
        Append from "sacmovnt" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(05,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sactotnt)
        dbUseArea( .T., "DBFCDX","sactotnt", "ORIG" )
        DEVPOS(06,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sactotnt", "DEST", .F. )
        Append from "sactotnt" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(06,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(saccaixa)
        dbUseArea( .T., "DBFCDX","saccaixa", "ORIG" )
        DEVPOS(07,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccaixa", "DEST", .F. )
        Append from "saccaixa" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(07,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(saccheq)
        dbUseArea( .T., "DBFCDX","saccheq", "ORIG" )
        DEVPOS(08,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccheq", "DEST", .F. )
        Append from "saccheq" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(08,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacdupr)
        dbUseArea( .T., "DBFCDX","sacdupr", "ORIG" )
        DEVPOS(09,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacdupr", "DEST", .F. )
        Append from "sacdupr" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(09,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(saccred)
        dbUseArea( .T., "DBFCDX","saccred", "ORIG" )
        DEVPOS(10,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccred", "DEST", .F. )
        Append from "saccred" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(10,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacdupp)
        dbUseArea( .T., "DBFCDX","sacdupp", "ORIG" )
        DEVPOS(11,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacdupp", "DEST", .F. )
        Append from "sacdupp" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(11,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacemp)
        dbUseArea( .T., "DBFCDX","sacemp", "ORIG" )
        DEVPOS(12,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacemp", "DEST", .F. )
        Append from "sacemp" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(12,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacgrupo)
        dbUseArea( .T., "DBFCDX","sacgrupo", "ORIG" )
        DEVPOS(13,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacgrupo", "DEST", .F. )
        Append from "sacgrupo" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(13,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacmerc)
        dbUseArea( .T., "DBFCDX","sacmerc", "ORIG" )
        DEVPOS(14,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacmerc", "DEST", .F. )
        Append from "sacmerc" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(14,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sactbmer)
        dbUseArea( .T., "DBFCDX","sactbmer", "ORIG" )
        DEVPOS(15,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sactbmer", "DEST", .F. )
        Append from "sactbmer" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(15,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacforn)
        dbUseArea( .T., "DBFCDX","sacforn", "ORIG" )
        DEVPOS(16,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacforn", "DEST", .F. )
        Append from "sacforn" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(16,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(saccli)
        dbUseArea( .T., "DBFCDX","saccli", "cli" )
        DEVPOS(17,22);DEVOUT("Importanto: " + alltrim(str(cli->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccli", "DEST", .F. )
        Append from "saccli" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(17,22);DEVOUT("Importanto: " + alltrim(str(cli->( lastrec())))+' OK')
        //cli->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacped_e)
        dbUseArea( .T., "DBFCDX","sacped_e", "ORIG" )
        DEVPOS(18,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacped_e", "DEST", .F. )
        Append from "sacped_e" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(18,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(sacped_c)
        dbUseArea( .T., "DBFCDX","sacped_c", "ORIG" )
        DEVPOS(19,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacped_c", "DEST", .F. )
        Append from "sacped_c" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(19,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacorc_c)
        dbUseArea( .T., "DBFCDX","sacorc_c", "ORIG" )
        DEVPOS(20,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacorc_c", "DEST", .F. )
        Append from "sacorc_c" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(20,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacnoped)
        dbUseArea( .T., "DBFCDX","sacnoped", "ORIG" )
        DEVPOS(21,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacnoped", "DEST", .F. )
        Append from "sacnoped" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(21,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacnoorc)
        dbUseArea( .T., "DBFCDX","sacnoorc", "ORIG" )
        DEVPOS(22,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacnoorc", "DEST", .F. )
        Append from "sacnoorc" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(22,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacnorom)
        dbUseArea( .T., "DBFCDX","sacnorom", "ORIG" )
        DEVPOS(23,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacnorom", "DEST", .F. )
        Append from "sacnorom" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(23,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacnopro)
        dbUseArea( .T., "DBFCDX","sacnopro", "ORIG" )
        DEVPOS(24,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacnopro", "DEST", .F. )
        Append from "sacnopro" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(24,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sactotb)
        dbUseArea( .T., "DBFCDX","sactotb", "ORIG" )
        DEVPOS(25,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sactotb", "DEST", .F. )
        Append from "sactotb" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(25,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacicm)
        dbUseArea( .T., "DBFCDX","sacicm", "ORIG" )
        DEVPOS(26,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacicm", "DEST", .F. )
        Append from "sacicm" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(26,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacnota)
        dbUseArea( .T., "DBFCDX","sacnota", "ORIG" )
        DEVPOS(27,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacnota", "DEST", .F. )
        Append from "sacnota" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(27,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacnotae)
        dbUseArea( .T., "DBFCDX","sacnotae", "ORIG" )
        DEVPOS(28,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacnotae", "DEST", .F. )
        Append from "sacnotae" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(28,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacnotab)
        dbUseArea( .T., "DBFCDX","sacnotab", "ORIG" )
        DEVPOS(29,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacnotab", "DEST", .F. )
        Append from "sacnotab" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(29,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacuf)
        dbUseArea( .T., "DBFCDX","sacuf", "ORIG" )
        DEVPOS(30,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacuf", "DEST", .F. )
        Append from "sacuf" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(30,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(saccarta)
        dbUseArea( .T., "DBFCDX","saccarta", "ORIG" )
        DEVPOS(31,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccarta", "DEST", .F. )
        Append from "saccarta" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(31,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(saccadde)
        dbUseArea( .T., "DBFCDX","saccadde", "ORIG" )
        DEVPOS(32,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccadde", "DEST", .F. )
        Append from "saccadde" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(32,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacdesp)
        dbUseArea( .T., "DBFCDX","sacdesp", "ORIG" )
        DEVPOS(33,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacdesp", "DEST", .F. )
        Append from "sacdesp" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(33,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sactran)
        dbUseArea( .T., "DBFCDX","sactran", "ORIG" )
        DEVPOS(34,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sactran", "DEST", .F. )
        Append from "sactran" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(34,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacav)
        dbUseArea( .T., "DBFCDX","sacav", "ORIG" )
        DEVPOS(35,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacav", "DEST", .F. )
        Append from "sacav" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(35,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacop)
        dbUseArea( .T., "DBFCDX","sacop", "ORIG" )
        DEVPOS(36,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacop", "DEST", .F. )
        Append from "sacop" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(36,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacespe)
        dbUseArea( .T., "DBFCDX","sacespe", "ORIG" )
        DEVPOS(37,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacespe", "DEST", .F. )
        Append from "sacespe" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(37,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacdolar)
        dbUseArea( .T., "DBFCDX","sacdolar", "ORIG" )
        DEVPOS(38,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacdolar", "DEST", .F. )
        Append from "sacdolar" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(38,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacbal)
        dbUseArea( .T., "DBFCDX","sacbal", "ORIG" )
        DEVPOS(39,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacbal", "DEST", .F. )
        Append from "sacbal" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(39,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacselnf)
        dbUseArea( .T., "DBFCDX","sacselnf", "ORIG" )
        DEVPOS(40,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacselnf", "DEST", .F. )
        Append from "sacselnf" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(40,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacfin)
        dbUseArea( .T., "DBFCDX","sacfin", "ORIG" )
        DEVPOS(41,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacfin", "DEST", .F. )
        Append from "sacfin" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(41,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban1)
        dbUseArea( .T., "DBFCDX","sacban1", "ORIG" )
        DEVPOS(42,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban1", "DEST", .F. )
        Append from "sacban1" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(42,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban2)
        dbUseArea( .T., "DBFCDX","sacban2", "ORIG" )
        DEVPOS(43,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban2", "DEST", .F. )
        Append from "sacban2" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(43,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban3)
        dbUseArea( .T., "DBFCDX","sacban3", "ORIG" )
        DEVPOS(44,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban3", "DEST", .F. )
        Append from "sacban3" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(44,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban4)
        dbUseArea( .T., "DBFCDX","sacban4", "ORIG" )
        DEVPOS(45,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban4", "DEST", .F. )
        Append from "sacban4" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(45,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban5)
        dbUseArea( .T., "DBFCDX","sacban5", "ORIG" )
        DEVPOS(46,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban5", "DEST", .F. )
        Append from "sacban5" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(46,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban6)
        dbUseArea( .T., "DBFCDX","sacban6", "ORIG" )
        DEVPOS(47,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban6", "DEST", .F. )
        Append from "sacban6" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(47,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban7)
        dbUseArea( .T., "DBFCDX","sacban7", "ORIG" )
        DEVPOS(48,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban7", "DEST", .F. )
        Append from "sacban7" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(48,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban8)
        dbUseArea( .T., "DBFCDX","sacban8", "ORIG" )
        DEVPOS(49,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban8", "DEST", .F. )
        Append from "sacban8" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(49,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban9)
        dbUseArea( .T., "DBFCDX","sacban9", "ORIG" )
        DEVPOS(50,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban9", "DEST", .F. )
        Append from "sacban9" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(50,22);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(sacban10)
        dbUseArea( .T., "DBFCDX","sacban10", "ORIG" )
        DEVPOS(00,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban10", "DEST", .F. )
        Append from "sacban10" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(00,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban11)
        dbUseArea( .T., "DBFCDX","sacban11", "ORIG" )
        DEVPOS(01,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban11", "DEST", .F. )
        Append from "sacban11" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(01,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban12)
        dbUseArea( .T., "DBFCDX","sacban12", "ORIG" )
        DEVPOS(02,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban12", "DEST", .F. )
        Append from "sacban12" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(02,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban13)
        dbUseArea( .T., "DBFCDX","sacban13", "ORIG" )
        DEVPOS(03,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban13", "DEST", .F. )
        Append from "sacban13" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(03,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban14)
        dbUseArea( .T., "DBFCDX","sacban14", "ORIG" )
        DEVPOS(04,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban14", "DEST", .F. )
        Append from "sacban14" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(04,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacban15)
        dbUseArea( .T., "DBFCDX","sacban15", "ORIG" )
        DEVPOS(05,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacban15", "DEST", .F. )
        Append from "sacban15" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(05,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacserie)
        dbUseArea( .T., "DBFCDX","sacserie", "ORIG" )
        DEVPOS(06,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacserie", "DEST", .F. )
        Append from "sacserie" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(06,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sactabpg)
        dbUseArea( .T., "DBFCDX","sactabpg", "ORIG" )
        DEVPOS(07,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sactabpg", "DEST", .F. )
        Append from "sactabpg" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(07,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacobs)
        dbUseArea( .T., "DBFCDX","sacobs", "ORIG" )
        DEVPOS(08,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacobs", "DEST", .F. )
        Append from "sacobs" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(08,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(saccid)
        dbUseArea( .T., "DBFCDX","saccid", "ORIG" )
        DEVPOS(09,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccid", "DEST", .F. )
        Append from "saccid" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(09,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(saclog)
        dbUseArea( .T., "DBFCDX","saclog", "ORIG" )
        DEVPOS(10,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saclog", "DEST", .F. )
        Append from "saclog" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(10,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sactabme)
        dbUseArea( .T., "DBFCDX","sactabme", "ORIG" )
        DEVPOS(11,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sactabme", "DEST", .F. )
        Append from "sactabme" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(11,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacconf)
        dbUseArea( .T., "DBFCDX","sacconf", "ORIG" )
        DEVPOS(12,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacconf", "DEST", .F. )
        Append from "sacconf" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(12,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(merc_det)
        dbUseArea( .T., "DBFCDX","merc_det", "ORIG" )
        DEVPOS(13,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "merc_det", "DEST", .F. )
        Append from "merc_det" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(13,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(saccep)
        dbUseArea( .T., "DBFCDX","saccep", "ORIG" )
        DEVPOS(14,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccep", "DEST", .F. )
        Append from "saccep" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(14,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacvisi)
        dbUseArea( .T., "DBFCDX","sacvisi", "ORIG" )
        DEVPOS(15,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacvisi", "DEST", .F. )
        Append from "sacvisi" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(15,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacsoli)
        dbUseArea( .T., "DBFCDX","sacsoli", "ORIG" )
        DEVPOS(16,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacsoli", "DEST", .F. )
        Append from "sacsoli" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(16,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(regiao)
        dbUseArea( .T., "DBFCDX","regiao", "cli" )
        DEVPOS(17,72);DEVOUT("Importanto: " + alltrim(str(cli->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "regiao", "DEST", .F. )
        Append from "regiao" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(17,72);DEVOUT("Importanto: " + alltrim(str(cli->( lastrec())))+' OK')
        //cli->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sactipdc)
        dbUseArea( .T., "DBFCDX","sactipdc", "ORIG" )
        DEVPOS(18,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sactipdc", "DEST", .F. )
        Append from "sactipdc" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(18,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacreme)
        dbUseArea( .T., "DBFCDX","sacreme", "ORIG" )
        DEVPOS(19,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacreme", "DEST", .F. )
        Append from "sacreme" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(19,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacimpdu)
        dbUseArea( .T., "DBFCDX","sacimpdu", "ORIG" )
        DEVPOS(20,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacimpdu", "DEST", .F. )
        Append from "sacimpdu" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(20,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacmensa)
        dbUseArea( .T., "DBFCDX","sacmensa", "ORIG" )
        DEVPOS(21,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacmensa", "DEST", .F. )
        Append from "sacmensa" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(21,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacctvis)
        dbUseArea( .T., "DBFCDX","sacctvis", "ORIG" )
        DEVPOS(22,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacctvis", "DEST", .F. )
        Append from "sacctvis" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(22,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacroma)
        dbUseArea( .T., "DBFCDX","sacroma", "ORIG" )
        DEVPOS(23,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacroma", "DEST", .F. )
        Append from "sacroma" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(23,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacprodu)
        dbUseArea( .T., "DBFCDX","sacprodu", "ORIG" )
        DEVPOS(24,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacprodu", "DEST", .F. )
        Append from "sacprodu" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(24,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacsef)
        dbUseArea( .T., "DBFCDX","sacsef", "ORIG" )
        DEVPOS(25,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacsef", "DEST", .F. )
        Append from "sacsef" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(25,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacbalan)
        dbUseArea( .T., "DBFCDX","sacbalan", "ORIG" )
        DEVPOS(26,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacbalan", "DEST", .F. )
        Append from "sacbalan" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(26,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacoss)
        dbUseArea( .T., "DBFCDX","sacoss", "ORIG" )
        DEVPOS(27,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacoss", "DEST", .F. )
        Append from "sacoss" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(27,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacospro)
        dbUseArea( .T., "DBFCDX","sacospro", "ORIG" )
        DEVPOS(28,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacospro", "DEST", .F. )
        Append from "sacospro" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(28,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacosno)
        dbUseArea( .T., "DBFCDX","sacosno", "ORIG" )
        DEVPOS(29,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacosno", "DEST", .F. )
        Append from "sacosno" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(29,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacosac)
        dbUseArea( .T., "DBFCDX","sacosac", "ORIG" )
        DEVPOS(30,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacosac", "DEST", .F. )
        Append from "sacosac" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(30,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacass)
        dbUseArea( .T., "DBFCDX","sacass", "ORIG" )
        DEVPOS(31,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacass", "DEST", .F. )
        Append from "sacass" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(31,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(sacsolpr)
        dbUseArea( .T., "DBFCDX","sacsolpr", "ORIG" )
        DEVPOS(32,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacsolpr", "DEST", .F. )
        Append from "sacsolpr" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(32,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(sacrl)
        dbUseArea( .T., "DBFCDX","sacrl", "ORIG" )
        DEVPOS(33,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacrl", "DEST", .F. )
        Append from "sacrl" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(33,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(sacproto)
        dbUseArea( .T., "DBFCDX","sacproto", "ORIG" )
        DEVPOS(34,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacproto", "DEST", .F. )
        Append from "sacproto" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(34,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(sacrepro)
        dbUseArea( .T., "DBFCDX","sacrepro", "ORIG" )
        DEVPOS(35,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacrepro", "DEST", .F. )
        Append from "sacrepro" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(35,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(saccotac)
        dbUseArea( .T., "DBFCDX","saccotac", "ORIG" )
        DEVPOS(36,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccotac", "DEST", .F. )
        Append from "saccotac" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(36,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(saccbped)
        dbUseArea( .T., "DBFCDX","saccbped", "ORIG" )
        DEVPOS(37,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccbped", "DEST", .F. )
        Append from "saccbped" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(37,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(saccborc)
        dbUseArea( .T., "DBFCDX","saccborc", "ORIG" )
        DEVPOS(38,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccborc", "DEST", .F. )
        Append from "saccborc" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(38,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacpcli)
        dbUseArea( .T., "DBFCDX","sacpcli", "ORIG" )
        DEVPOS(39,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacpcli", "DEST", .F. )
        Append from "sacpcli" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(39,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sachist)
        dbUseArea( .T., "DBFCDX","sachist", "ORIG" )
        DEVPOS(40,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sachist", "DEST", .F. )
        Append from "sachist" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(40,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacmovb)
        dbUseArea( .T., "DBFCDX","sacmovb", "ORIG" )
        DEVPOS(41,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacmovb", "DEST", .F. )
        Append from "sacmovb" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(41,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(saccomi)
        dbUseArea( .T., "DBFCDX","saccomi", "ORIG" )
        DEVPOS(42,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "saccomi", "DEST", .F. )
        Append from "saccomi" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(42,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacperf)
        dbUseArea( .T., "DBFCDX","sacperf", "ORIG" )
        DEVPOS(43,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacperf", "DEST", .F. )
        Append from "sacperf" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(43,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacsincl)
        dbUseArea( .T., "DBFCDX","sacsincl", "ORIG" )
        DEVPOS(44,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacsincl", "DEST", .F. )
        Append from "sacsincl" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(44,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacnotp)
        dbUseArea( .T., "DBFCDX","sacnotp", "ORIG" )
        DEVPOS(45,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacnotp", "DEST", .F. )
        Append from "sacnotp" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(45,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(sactped)
        dbUseArea( .T., "DBFCDX","sactped", "ORIG" )
        DEVPOS(46,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sactped", "DEST", .F. )
        Append from "sactped" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(46,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(sacceplo)
        dbUseArea( .T., "DBFCDX","sacceplo", "ORIG" )
        DEVPOS(47,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacceplo", "DEST", .F. )
        Append from "sacceplo" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(47,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

IF ! EMPTY(sacmovcn)
        dbUseArea( .T., "DBFCDX","sacmovcn", "ORIG" )
        DEVPOS(49,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "sacmovcn", "DEST", .F. )
        Append from "sacmovcn" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(49,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF
IF ! EMPTY(texto)
        dbUseArea( .T., "DBFCDX","texto", "ORIG" )
        DEVPOS(50,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec()))))
        dbUseArea( .T., "SQLRDD", "texto", "DEST", .F. )
        Append from "texto" VIA "DBFCDX"
        sr_getconnection():exec("COMMIT",,.f.)
        DEVPOS(50,72);DEVOUT("Importanto: " + alltrim(str(ORIG->( lastrec())))+' OK')
        ORIG->( dbCloseArea() )
        DEST->( dbCloseArea() )
ENDIF

sr_getconnection():exec("COMMIT",,.f.)
atencao('Foi feito a Atualizacao com SUCESSO....')
SetMode(30,100)
WVW_SetFont(,'terminal',20,,, PROOF_QUALITY )  // 1024X768
wvw_lclosewindow()
apaga_hrb() //apaga o arquivo de controle "HRB.001"
QUIT
Return
****************************************  F I M ****************************************
FUNCTION imp_dbf
*****************
local aFiles:={}, aStruct, aFile, cdriver,marq := SPACE(50)
SETCOR(1)
op_tela(10,10,12,80,"Importar DBF's para BANCO DE DADOS em USO")
@ 01,01 SAY 'Nome do Arquivo com extensao:' GET marq PICT '@!'
READ
IF LASTKEY() = 27
        wvw_lclosewindow()
        Return
ENDIF
IF ! FILE(ALLTRIM(marq))
        atencao('Nao foi possivel encontrar este Arquivo...')
        wvw_lclosewindow()
        Return
ENDIF
cDriver := "DBFCDX"
RddSetDefault( cDriver )
DBCLOSEALL()
CLOSE ALL
MYRUN('DEL *.CDX')
setcor(1)
i:=0
cFile := lower(ALLTRIM(marq))
//cFile := lower( alltrim( cPrefix + aFile[ F_NAME ] ) )
cFile := strtran(cfile,".DBF")
cFile := strtran(cfile,"_DBF")
cFile := strtran(cfile,".dbf")
cFile := strtran(cfile,"_dbf")
/*
IF ! SR_EXISTTABLE(cfile)
        wvw_lclosewindow()
        Return
ENDIF
*/
dbUseArea( .T., cDriver,ALLTRIM(marq), "ORIG" )
IF LASTREC() = 0
        ORIG->( dbCloseArea() )
        wvw_lclosewindow()
        Return
ENDIF
DEVPOS(02,00);DEVOUT("  Importando: "+ strtran(cFile,".DBF","")+ "  (" + alltrim(str(ORIG->( lastrec() ) ) )+ "records)")
aStruct := ORIG->( dbStruct() )
ORIG->( dbCloseArea() )
IF ! SR_EXISTTABLE(cfile)
        dbCreate(cFile, aStruct, "SQLRDD" )
ENDIF
dbUseArea( .T., "SQLRDD", cFile, "DEST", .F. )
Append from (ALLTRIM(marq)) VIA cDriver

dbUseArea( .T., cDriver,ALLTRIM(marq), "ORIG" )

ORIG->( dbCloseArea() )
DEST->( dbCloseArea() )

sr_getconnection():exec("COMMIT",,.f.)
atencao('Foi feito a Atualizacao com SUCESSO....')
wvw_lclosewindow()
Return
/*------------------------------------------------------------------------*/
***************************  F I M ***********************************
* CONVERTE DBF para BANCO DE DADOS
**********************************
#include "directry.ch"
#include "sqlrdd.ch"       // SQLRDD Main include

Function dbf_sql()
******************
local  aStruct, aFile:=SPACE(20),mtabela:=SPACE(20)
local nCnn, nDrv, cDriver

//RddSetDefault( "DBFCDX" )

SET DELETED ON
op_tela(10,10,15,70,"Convertento DBF's para BANCO DE DADOS em USO")

WHILE .T.
        afile := mtabela := SPACE(20)

        setcor(1)
        DEVPOS(01,01);DEVOUT('Digite o Nome do Arquivo "DBF": ')
        DEVPOS(02,01);DEVOUT('Digite o Nome da Tabela "SQL" : ')
        @ 01,33 GET afile 
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        IF ! FILE(ALLTRIM(afile))
                atencao('Nao foi possivel encontrar este Arquivo...')
                LOOP
        ENDIF
        @ 02,33 GET mtabela
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        opcao := op_simnao('S','Confirma os Arquivos:')
        IF opcao = 'N'
                LOOP
        ENDIF
        mtabela := ALLTRIM(mtabela)

        afile := ALLTRIM(afile)

	IF afile = 'saccli.dbf'
                abriarq('saccli','cli')
	        dbUseArea( .T., "SQLRDD", mtabela, "cliente", .F. )
        	Append from saccli VIA "DBFCDX"
                sr_getconnection():exec("COMMIT",,.f.)
	        cliente->( dbCloseArea() )
	ELSEIF afile = 'sacdupr.dbf'
	        dbUseArea( .T., "SQLRDD", mtabela, "dupr", .F. )
        	Append from (aFile) VIA "DBFCDX"
	        dupr->( dbCloseArea() )
	ELSE
	        dbUseArea( .T., "SQLRDD", mtabela, "DEST", .F. )
        	Append from (aFile) VIA "DBFCDX"
	        DEST->( dbCloseArea() )
	ENDIF
        sr_getconnection():exec("COMMIT",,.f.)
        atencao('Foi feito a Atualizacao com SUCESSO....')
ENDDO
wvw_lclosewindow()
Return
/*------------------------------------------------------------------------*/
***************************  F I M ***********************************
* CONVERTE DBF para BANCO DE DADOS
**********************************
#include "directry.ch"
#include "sqlrdd.ch"       // SQLRDD Main include

Function expor_arq()
********************
local  aFile:=SPACE(20),mtabela:=SPACE(20)

//RddSetDefault( "DBFCDX" )

SET DELETED ON

op_tela(10,05,15,80,'Exportar Tabelas para "DBFs"')
WHILE .T.
        afile := mtabela := SPACE(30)
        limpa(00,00,24,79)
        mensagem('Digite o Nome da Tabela do Banco de Dados')
        setcor(1)
        DEVPOS(01,01);DEVOUT('Digite o Nome da Tabela "SQL" : ')
        DEVPOS(02,01);DEVOUT('Digite o Nome do Arquivo "DBF": ')
        @ 01,33 GET mtabela
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        IF ! SR_EXISTTABLE(ALLTRIM(mtabela))
                atencao('Nao existe esta Tabela no Banco de Dados....')
                LOOP
        ENDIF
        mensagem('Digite o Nome do Arquivo sem a Extensao')
        @ 02,33 GET afile
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        mtabela := ALLTRIM(mtabela)
        afile := ALLTRIM(afile)
        mensagem('Aguarde um momento fazendo a copia da TABELA p/ARQUIVO.DFB...')
        dbUseArea( .T., "SQLRDD", mtabela, "DEST", .F. )
        copy to (afile) via "DBFCDX"

        DEST->( dbCloseArea() )

        atencao('Foi feito a Atualizacao com SUCESSO....')
ENDDO
wvw_lclosewindow()
Return
/*------------------------------------------------------------------------*/
*************************** F I M *********************************
* VERIFICAR CODIGO BARRA EAN 13
*********************************
FUNCTION verif_ean13(mcodigo)
**********************
LOCAL mnum1,mnum2,mnum3,mnum4,mnum5,mnum6,mnum7,mnum8,mnum9,mnum10,mnum11,mnum12
LOCAL mtotal:=0
mnum1 := VAL(SUBSTR(mcodigo,1,1))
mnum2 := VAL(SUBSTR(mcodigo,2,1))
mnum3 := VAL(SUBSTR(mcodigo,3,1))
mnum4 := VAL(SUBSTR(mcodigo,4,1))
mnum5 := VAL(SUBSTR(mcodigo,5,1))
mnum6 := VAL(SUBSTR(mcodigo,6,1))
mnum7 := VAL(SUBSTR(mcodigo,7,1))
mnum8 := VAL(SUBSTR(mcodigo,8,1))
mnum9 := VAL(SUBSTR(mcodigo,9,1))
mnum10:= VAL(SUBSTR(mcodigo,10,1))
mnum11:= VAL(SUBSTR(mcodigo,11,1))
mnum12:= VAL(SUBSTR(mcodigo,12,1))

mtotal:= mnum1  * 1
mtotal:= mtotal + (mnum2  * 3)
mtotal:= mtotal + (mnum3  * 1)
mtotal:= mtotal + (mnum4  * 3)
mtotal:= mtotal + (mnum5  * 1)
mtotal:= mtotal + (mnum6  * 3)
mtotal:= mtotal + (mnum7  * 1)
mtotal:= mtotal + (mnum8  * 3)
mtotal:= mtotal + (mnum9  * 1)
mtotal:= mtotal + (mnum10 * 3)
mtotal:= mtotal + (mnum11 * 1)
mtotal:= mtotal + (mnum12 * 3)

mresto := VAL(SUBSTR(STRZERO(mtotal,5),5))
mdigito := 10 - mresto
IF mdigito = 10
        RETURN '0'
ELSE
        RETURN STRZERO(mdigito,1)
ENDIF
************************** F I M *************************************
********************************
* FUNCAO P/CONSULTAR ALBUM DE CLIENTE
********************************
FUNCTION smedalbum(mletra,mcodfoto,mnomefoto,mcam,mcam1)
*****************
LOCAL alb_tela,alb_tela1,alb_lci,alb_cci,alb_lba,alb_cba,alb_msele,alb_morde,alb_men,;
      ocprod,colprod[1],alb_i,alb_nkey,alb_opcao,mcodcli,mponto,stop:=' ' 

alb_lci := alb_cci := 0
alb_lba := 22
alb_cba := 15

alb_msele := SELE()
alb_morde := INDEXORD()
USE 'menufoto' ALIAS 'smenu' EXCLUSIVE NEW VIA 'DBFCDX'
*************
SELE('smenu')
BLOQREG()
ZAP
DBUNLOCK()
*************
m_aux1 := DIRECTORY(mcam+mletra+mcodfoto+'*.jpg','D')
m_aux2 := DIRECTORY(mcam+mletra+mcodfoto+'*.bmp','D')
IF LEN(m_aux1)+LEN(m_aux2) = 0 
	m_aux1 := DIRECTORY(mcam1+mletra+mcodfoto+'*.jpg','D')
	m_aux2 := DIRECTORY(mcam1+mletra+mcodfoto+'*.bmp','D')
	i := 0
	FOR i = 1 TO LEN(m_aux1)
	        ADIREG()
	        smenu->smenu := mcam1+m_aux1[i,1]
	        smenu->snome := m_aux1[i,1]
	NEXT
	i := 0
	FOR i = 1 TO LEN(m_aux2)
	        ADIREG()
	        smenu->smenu := mcam1+m_aux1[i,2]
	        smenu->snome := m_aux1[i,2]
	NEXT
ELSE
	i := 0
	FOR i = 1 TO LEN(m_aux1)
	        ADIREG()
	        smenu->smenu := mcam+m_aux1[i,1]
	        smenu->snome := m_aux1[i,1]
	NEXT
	i := 0
	FOR i = 1 TO LEN(m_aux2)
	        ADIREG()
	        smenu->smenu := mcam+m_aux1[i,2]
	        smenu->snome := m_aux1[i,2]
	NEXT
ENDIF
//atencao(m_aux1)
DBCOMMIT()
DBUNLOCK()
*************
SELE('smenu')
GO TOP
*************
op_tela(00,00,22,15,'ARQUIVOS')
ocprod := TBROWSEDB(alb_lci,alb_cci,alb_lba-1,alb_cba)
colprod[1] := TBCOLUMNNEW('',{||smenu->snome})
alb_i:=0
FOR alb_i=1 TO LEN(colprod)
        ocprod:ADDCOLUMN(colprod[alb_i])
NEXT
WVW_SetMousePos(,00,00)
WVW_SetMouseMove(,.F.)
WHILE .T.
        exibi_prg('SMEDALBUM')
        mensagem('<ESC>Retornar')
        alb_nkey := 0
        WHILE alb_nkey == 0         //.AND. ! ocprod:STABLE
                ocprod:FORCESTABLE()
                IF mletra = 'C'
                        op_tela(00,17,40,100,'ALBUM DO CLIENTE: '+mcodfoto+'-'+mnomefoto+' - Arquivo: '+smenu->smenu,'1')
                ELSEIF mletra = 'P'
                        op_tela(00,17,40,100,'ALBUM DO PRODUTOS: '+mcodfoto+'-'+mnomefoto+' - Arquivo: '+smenu->smenu,'1')
                ELSEIF mletra = 'R'
                        op_tela(00,17,40,100,'ALBUM DA RACA: '+mcodfoto+'-'+mnomefoto+' - Arquivo: '+smenu->smenu,'1')
                ELSE
                        op_tela(00,17,40,100,'ALBUM: '+mcodfoto+'-'+mnomefoto+' - Arquivo: '+smenu->smenu,'1')
                ENDIF
                WVW_DrawImage( ,00,00,41,83,smenu->smenu,.T.,.F.)
                setcor(1)
                alb_nkey := INKEY(0)
                wvw_lclosewindow()
                
        ENDDO
        IF alb_nkey == K_ESC
                EXIT
        ELSE
                IF genkey(ocprod,alb_nkey,'smenu')
                        ocprod := TBROWSEDB(alb_lci,alb_cci,alb_lba-1,alb_cba)
                        colprod[1] := TBCOLUMNNEW('Arquivo',{||smenu->snome})
                        alb_i:=0
                        FOR alb_i=1 TO LEN(ocolprod)
                                ocprod:ADDCOLUMN(colprod[alb_i])
                        NEXT
                        ocprod:FORCESTABLE()
                ENDIF
        ENDIF
END
smenu->(DBCLOSEAREA())
SELE(alb_msele);IF(alb_morde>0,ORDSETFOCUS(alb_morde),)
wvw_lclosewindow()
WVW_SetMouseMove(,.T.)
IF alb_nkey == K_ESC
        RELEASE alb_tela,alb_tela1,alb_lci,alb_cci,alb_lba,alb_cba,alb_msele,alb_morde,alb_men,ocprod,ocolprod[8],alb_i,alb_nkey,alb_opcao
        RETURN NIL
ELSE
        RELEASE alb_tela,alb_tela1,alb_lci,alb_cci,alb_lba,alb_cba,alb_msele,alb_morde,alb_men,ocprod,ocolprod[8],alb_i,alb_nkey,alb_opcao
        CLEAR GETS
        RETURN NIL
ENDIF
RETURN NIL
******************************* f i m *********************************************
************************
* VERIFICA SE A MENSAGEM
************************
FUNCTION ver_mensa(mcod,tp,rapida)
**********************************
LOCAL msele,morde,mcor,mpesq,cons_mensa:={},mmensagem,opcao
MEMVAR mdata_sis
//msele := SELE()
//morde := INDEXORD()
//mcor := SETCOLOR()

cons_mensa:={}
cComm  := "SELECT * FROM sacmensa WHERE cod_rec = "+sr_cdbvalue(mcod)+" AND ler = 'R'"
sr_getconnection():exec(ccomm,,.t.,@cons_mensa)
IF LEN(cons_mensa) > 0
	//atencao( 'REMETENTE....: '+cons_mensa[1,3]+'  -  Emissao: '+DTOC(cons_mensa[1,1])+' - Hora: '+cons_mensa[1,2]+SPACE(90);
        WHILE .T.
	       opcao := op_simnao('N','REMETENTE....: '+cons_mensa[1,3]+'  -  Emissao: '+DTOC(cons_mensa[1,1])+' - Hora: '+cons_mensa[1,2]+SPACE(165);
	                +'ASSUNTO......: '+cons_mensa[1,5]+SPACE(97)+cons_mensa[1,6]+cons_mensa[1,7]+cons_mensa[1,8]+cons_mensa[1,9];
                        +cons_mensa[1,10]+cons_mensa[1,11]+cons_mensa[1,12]+cons_mensa[1,13]+cons_mensa[1,14]+cons_mensa[1,15];
                        +cons_mensa[1,16]+cons_mensa[1,17]+cons_mensa[1,18]+cons_mensa[1,19]+cons_mensa[1,20]+cons_mensa[1,21];
                        +cons_mensa[1,22]+cons_mensa[1,23]+cons_mensa[1,24]+cons_mensa[1,25])
                IF opcao = 'S'
                        EXIT
                ENDIF
        ENDDO
        cComm  := "UPDATE sacmensa SET ler = '*',data_ler = "+sr_cdbvalue(mdata_sis)+" WHERE cod_rec = "+sr_cdbvalue(mcod)+" AND ler = 'R'"
        sr_getconnection():exec(ccomm,,.f.)
        sr_getconnection():exec('COMMIT',,.f.)
ENDIF
IF rapida <> NIL
        RETURN .T.
ENDIF
cons_mensa:={}
cComm  := "SELECT * FROM sacmensa WHERE cod_rec = "+sr_cdbvalue(mcod)+" AND (ler IS NULL OR ler = ' ') AND data_men <= "+sr_cdbvalue(mdata_sis)
sr_getconnection():exec(ccomm,,.t.,@cons_mensa)
IF LEN(cons_mensa) > 0
        IF tp = NIL 
		atencao('Existe Mensagens para este Operador')
        ENDIF
        RETURN .T.
ELSE
        RETURN .F.
ENDIF
RETURN NIL
/*
IF ! AbriArq('sacmensa','mensa');RETURN NIL;ENDIF
***************
SELE('mensa');ORDSETFOCUS(1)
GO TOP
***************
mpesq := mcod+' '
IF mensa->(DBSEEK(mpesq))
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF tp = NIL .AND. mensa->data_men <= mdata_sis
                atencao('Existe Mensagens para este Operador',1)
        ENDIF
        IF mensa->data_men <= mdata_sis
                DEVPOS(03,70);DEVOUT('Mensagem')
        ENDIF
        RETURN .T.
ELSE
        IF msele > 0
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        ENDIF
        DEVPOS(03,70);DEVOUT('        ')
        RETURN .F.
ENDIF
RETURN NIL
*/
******************************* f i m *********************************************
**************************************
* VERIFICA SE O CAIXA ESTAR FECHADO
**************************************
FUNCTION cx_fechado()
**********************
LOCAL cons_fecha:={}
sr_getconnection():exec("SELECT * FROM saccaixa WHERE data = "+sr_cdbvalue(mdata_sis)+" AND fechado = 'GG'",,.t.,@cons_fecha)
IF LEN(cons_fecha) > 0
        atencao('Nao pode ser feito recebimento de PEDIDOS, o caixa ja foi FECHADO GERAL p/ todos USUARIOS')
        RETURN .F.
ELSE
        cons_fecha:={}
        sr_getconnection():exec("SELECT * FROM saccaixa WHERE data = "+sr_cdbvalue(mdata_sis)+" AND fechado LIKE 'G%' AND cod_opera = "+sr_cdbvalue(cod_operado),,.t.,@cons_fecha)
        IF LEN(cons_fecha) > 0
                atencao('Nao pode ser feito este Procedimento, o caixa ja foi FECHADO GERAL p/este Operador:'+cod_operado)
                RETURN .F.
        ENDIF

ENDIF
RETURN .T.
********************************** F I M ******************************************
********************************
* FUNCAO P/CONSULTAR CHEQUES S/FUNDOS
********************************
FUNCTION cons_che(mop)
*****************
LOCAL tela,tela1,lci,cci,lba,cba,msele,morde,men,;
      oconsprod,ocolprod[13],i,nkey,opcao
MEMVAR mduplicata,mnum_ban,mvalor
lci := cci := 00
lba := 23
cba := 79

msele := SELE()
morde := INDEXORD()
*************
SELE('cheq');ORDSETFOCUS(5)
*************
op_tela(lci,cci,lba+2,cba,' Consulta de CHEQUES S/FUNDOS ','*')
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('OK',{||cheq->ok})
ocolprod[2] := TBCOLUMNNEW('No.Documento',{||cheq->num_cheq+cheq->conta})
ocolprod[3] := TBCOLUMNNEW('No.Banco',{||cheq->num_ban})
ocolprod[4] := TBCOLUMNNEW('Valor Doc.',{||TRANSFORM(cheq->cheq_vlr,'999,999.99')})
ocolprod[5] := TBCOLUMNNEW('Vlr Restante',{||TRANSFORM(cheq->valor_cheq,'999,999.99')})
ocolprod[6] := TBCOLUMNNEW('Emissao',{||DTOC(cheq->data_cheq)})
ocolprod[7] := TBCOLUMNNEW('Inclusao',{||DTOC(cheq->data_fund)})
ocolprod[8] := TBCOLUMNNEW('Cliente',{||cheq->cod_cli})
ocolprod[9] := TBCOLUMNNEW('Correntista',{||cheq->correntist})
ocolprod[10] := TBCOLUMNNEW('Motivo',{||cheq->motivo})
ocolprod[11] := TBCOLUMNNEW('Data OK',{||cheq->data_ok})
ocolprod[12] := TBCOLUMNNEW('Valor Pago',{||TRANSFORM(cheq->vlr_pago,'999,999.99')})
ocolprod[13] := TBCOLUMNNEW('Cod.Incl.',{||cheq->cod_incl})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        mensagem('<> <PGUP> <PGDN> <P>esquisa <ENTER> Conf. <ESC>Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        ENDDO
        IF nkey == K_ESC
                CLEAR GETS
                EXIT
        ELSEIF nkey == K_ENTER
                mduplicata := cheq->num_cheq
                mnum_ban   := cheq->num_ban
                mvalor     := cheq->valor_cheq
                CLEAR GETS
                EXIT
        ELSE
                IF genkey(oconsprod,nkey,'cheq')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('OK',{||cheq->ok})
                        ocolprod[2] := TBCOLUMNNEW('No.Documento',{||cheq->num_cheq+cheq->conta})
                        ocolprod[3] := TBCOLUMNNEW('No.Banco',{||cheq->num_ban})
                        ocolprod[4] := TBCOLUMNNEW('Valor Doc.',{||TRANSFORM(cheq->cheq_vlr,'999,999.99')})
                        ocolprod[5] := TBCOLUMNNEW('Vlr Restante',{||TRANSFORM(cheq->valor_cheq,'999,999.99')})
                        ocolprod[6] := TBCOLUMNNEW('Emissao',{||DTOC(cheq->data_cheq)})
                        ocolprod[7] := TBCOLUMNNEW('Inclusao',{||DTOC(cheq->data_fund)})
                        ocolprod[8] := TBCOLUMNNEW('Cliente',{||cheq->cod_cli})
                        ocolprod[9] := TBCOLUMNNEW('Correntista',{||cheq->correntist})
                        ocolprod[10] := TBCOLUMNNEW('Motivo',{||cheq->motivo})
                        ocolprod[11] := TBCOLUMNNEW('Data OK',{||cheq->data_ok})
                        ocolprod[12] := TBCOLUMNNEW('Valor Pago',{||TRANSFORM(cheq->vlr_pago,'999,999.99')})
                        ocolprod[13] := TBCOLUMNNEW('Cod.Incl.',{||cheq->cod_incl})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
wvw_lclosewindow()
IF nkey = K_ESC
        CLEAR GETS
        RETURN NIL
ELSE
        CLEAR GETS
        RETURN NIL
ENDIF
RETURN NIL
******************************* f i m *********************************************
******************************
* VERIFICA O CNPJ E CPF
******************************
FUNCTION v_cnpjcpf(ncgc)
********************
LOCAL men,msele,morde,opcao := 'S',mc_cli
MEMVAR mcgc,mcpf,mcod_cli,mcliente

IF EMPTY(ncgc)
        RETURN .T.
ENDIF
mc_cli := {}
IF LEN(ALLTRIM(ncgc)) = 14
        sr_getconnection():exec("SELECT * FROM saccli WHERE cgc = "+sr_cdbvalue(ncgc) ,,.t.,@mc_cli)
        IF LEN(mc_cli) = 0 
                CLEAR GETS
                atencao('CNPJ nao cadastrado...')
                RETURN .F.
        ELSE
                mcod_cli := VAL(mc_cli[1,2])
                RETURN .T.
        ENDIF
ELSE
        sr_getconnection():exec("SELECT * FROM saccli WHERE cpf = "+sr_cdbvalue(ncgc) ,,.t.,@mc_cli)
        IF LEN(mc_cli) = 0 
                CLEAR GETS
                atencao('CPF nao cadastrado...')
                RETURN .F.
        ELSE
                mcod_cli := VAL(mc_cli[1,2])
                RETURN .T.
        ENDIF
ENDIF
/*
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
IF EMPTY(ncgc)
        RETURN .T.
ENDIF
IF LEN(ALLTRIM(ncgc)) = 14
        *****************
        SELE('cli');ORDSETFOCUS(3)
        GO TOP
        *****************
        IF ! cli->(DBSEEK(ALLTRIM(ncgc)))
                CLEAR GETS
                atencao('CNPJ nao cadastrado...')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RESTSCREEN(24,00,24,79,men)
                RETURN .F.
        ENDIF
ELSE
        *****************
        SELE('cli');ORDSETFOCUS(4)
        GO TOP
        *****************
        IF ! cli->(DBSEEK(ALLTRIM(ncgc)))
                CLEAR GETS
                atencao('CPF nao cadastrado...')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RESTSCREEN(24,00,24,79,men)
                RETURN .F.
        ENDIF
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
mcod_cli := VAL(cli->cod_cli)
*/
RETURN .T.
********************************** F I M ***********************************
***********************
FUNCTION ver_aniv(vcod,mpt)
***********************
LOCAL msele,morde,mtela_aniv,ml1:=10,mc1:=05,ml2:=12,mc2:=75,m_aniv:={},i:=0,mc_cli:={},opc := ' '

mtela := SAVESCREEN(00,00,24,79)
IF EMPTY(vcod)
        RETURN .T.
ENDIF
mc_cli := {}
cComm  := "SELECT * FROM saccli WHERE cod_cli = "+sr_cdbvalue(STRZERO(vcod,5))
sr_getconnection():exec(ccomm,,.t.,@mc_cli)
ASIZE(m_aniv,0)
//IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
	*************
//	SELE('cli');ORDSETFOCUS(1)
//	GO TOP
	*************
//IF cli->(DBSEEK(STRZERO(vcod,5)))
IF LEN(mc_cli) > 0
        IF SUBSTR(DTOC(mc_cli[1,9]),1,5) = SUBSTR(DTOC(mdata_sis),1,5)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,9]),1,5),mc_cli[1,3],'HOJE'})
        ELSEIF SUBSTR(DTOC(mc_cli[1,9]),4,2) = SUBSTR(DTOC(mdata_sis),4,2)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,9]),1,5),mc_cli[1,3],'NO MES'})
        ENDIF
        IF SUBSTR(DTOC(mc_cli[1,50]),1,5) = SUBSTR(DTOC(mdata_sis),1,5)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,50]),1,5),mc_cli[1,49],'HOJE'})
        ELSEIF SUBSTR(DTOC(mc_cli[1,50]),4,2) = SUBSTR(DTOC(mdata_sis),4,2)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,50]),1,5),mc_cli[1,49],'NO MES'})
        ENDIF
        IF SUBSTR(DTOC(mc_cli[1,52]),1,5) = SUBSTR(DTOC(mdata_sis),1,5)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,52]),1,5),mc_cli[1,51],'HOJE'})
        ELSEIF SUBSTR(DTOC(mc_cli[1,52]),4,2) = SUBSTR(DTOC(mdata_sis),4,2)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,52]),1,5),mc_cli[1,51],'NO MES'})
        ENDIF
        IF SUBSTR(DTOC(mc_cli[1,54]),1,5) = SUBSTR(DTOC(mdata_sis),1,5)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,54]),1,5),mc_cli[1,53],'HOJE'})
        ELSEIF SUBSTR(DTOC(mc_cli[1,54]),4,2) = SUBSTR(DTOC(mdata_sis),4,2)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,54]),1,5),mc_cli[1,53],'NO MES'})
        ENDIF
        IF SUBSTR(DTOC(mc_cli[1,56]),1,5) = SUBSTR(DTOC(mdata_sis),1,5)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,56]),1,5),mc_cli[1,55],'HOJE'})
        ELSEIF SUBSTR(DTOC(mc_cli[1,56]),4,2) = SUBSTR(DTOC(mdata_sis),4,2)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,56]),1,5),mc_cli[1,55],'NO MES'})
        ENDIF
        IF SUBSTR(DTOC(mc_cli[1,58]),1,5) = SUBSTR(DTOC(mdata_sis),1,5)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,58]),1,5),mc_cli[1,57],'HOJE'})
        ELSEIF SUBSTR(DTOC(mc_cli[1,58]),4,2) = SUBSTR(DTOC(mdata_sis),4,2)
                AADD(m_aniv,{SUBSTR(DTOC(mc_cli[1,58]),1,5),mc_cli[1,57],'NO MES'})
        ENDIF
        IF LEN(m_aniv) > 0
                IF mpt = NIL
                        //botao(10,05,12+LEN(m_aniv),75,,' ANIVERSARIANTE DO MES ')
                        op_tela(10,05,12+LEN(m_aniv),75,' ANIVERSARIANTE DO MES ')
                        i := 0
                        FOR i = 1 TO LEN(m_aniv)
                                setcor(1)
                                DEVPOS(ml1+i,mc1+1);DEVOUT('Nome: ')
                                DEVPOS(ml1+i,mc1+49);DEVOUT('Data: ')
                                setcor(3)
                                DEVPOS(ml1+i,mc1+7);DEVOUT(m_aniv[i,2])
                                DEVPOS(ml1+i,mc1+55);DEVOUT(m_aniv[i,1])
                                setcor(3,'*')
                                DEVPOS(ml1+i,COL()+1);DEVOUT(m_aniv[i,3])
                                setcor(1)
                        NEXT
                        mensagem('Pressione qualquer tecla para continuar...')
			opc := ' '
			@ 50,00 GET opc
			READ
                        //INKEY(0)
                        //RESTSCREEN(00,00,24,79,mtela)
                        wvw_lclosewindow()
                ENDIF
                RETURN .T.
        ELSEIF mpt <> NIL
                RETURN .F.
        ENDIF
ENDIF
RETURN .F.
******************************** f i m **********************************
*************************************
* IMPRESSAO DA DUPLICATA DO SISTEMA
*************************************
FUNCTION dup_sis(mcod,mnome,mend,mbairro,mcidade,muf,mcep,mtel,;
                 mcgc,minsc,mcpf,mend_cob,mbairro_cob,mcidade_cob,muf_cob,;
                 mcep_cob,mfone_cob,mtipo,mduplicata,memi_dup,mvenc_dup,mcod_ven,;
                 mvlr_dup,mfantasia,mn_fat,mv_fat,mdup_prom)
*****************
LOCAL mextenso:='',mlinha,mlin,lin,mtraco:=REPLI('-',80)
MEMVAR mtipo_imp
IF ! AbriArq('sacemp','emp');RETURN NIL;ENDIF
mensagem('Aguarde a impressao da(s) Duplicata(s)....')
IF m_cfg[24] = 'B'
        mtraco:=REPLI('-',60)
        imprt(mtipo_imp,'N')
        DEVPOS(PROW()+1,00);DEVOUT(memp_resa)
        imprt(mtipo_imp,'C')
        DEVPOS(PROW()+1,00);DEVOUT(mend_firm)
        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   CNPJ: '+mcgc_firm)
        @ PROW()+1,00 SAY mtraco
        @ PROW()+1,00 SAY 'Cliente:'
        @ PROW(),09 SAY mcod
        @ PROW(),15 SAY mnome
        IF m_set[1,40] = 'S' .AND. ! EMPTY(mfantasia)
                @ PROW()+1,00 SAY 'Nome Fantasia: '+mfantasia
        ENDIF
        IF ver_serie() = '141265' .OR. ver_serie() = '141365' .OR.;
           ver_serie() = '141337' .AND. ! EMPTY(mend_cob)
                @ PROW()+1,00 SAY 'End. COBRANCA: '+mend_cob
                @ PROW()+1,00 SAY 'Bairro: '+RTRIM(mbairro_cob)+'-Cidade: '+RTRIM(mcidade_cob)+'-'+muf_cob+'- CEP:'+mcep_cob
                @ PROW()+1,00 SAY 'Fone:'+mfone_cob
        ELSE
                @ PROW()+1,00 SAY 'End.: '+mend
                @ PROW()+1,00 SAY 'Bairro: '+RTRIM(mbairro)+'-Cidade: '+RTRIM(mcidade)+'-'+muf+'- CEP:'+mcep
                @ PROW()+1,00 SAY 'Fone: '+mtel
        ENDIF
        IF cli->cgc <> SPACE(14)
                @ PROW()+1,00 SAY 'CNPJ:'
                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(mcgc,'@@R 99.999.999/9999-99')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' - Insc.: '+minsc)
        ELSEIF cli->cpf <> SPACE(11)
                @ PROW()+1,00 SAY 'CPF:'
                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(mcpf,'@@R 999.999.999-99')
        ENDIF
        IF ver_serie() = '141265' .OR. ver_serie() = '141365' .OR. ver_serie() = '141337'
                @ PROW()+1,00 SAY mtraco
        ELSE
                IF ! EMPTY(mend_cob)
                        @ PROW()+1,00 SAY 'End. COBRANCA: '+mend_cob
                        @ PROW()+1,00 SAY 'Bairro: '+RTRIM(mbairro_cob)+'-Cidade: '+RTRIM(mcidade_cob)+'-'+muf_cob+'- CEP:'+mcep_cob
                        @ PROW()+1,00 SAY 'Fone:'+mfone_cob
                ENDIF
                @ PROW()+1,00 SAY mtraco
        ENDIF
        imprt(mtipo_imp,'N')
        IF mdup_prom = NIL
                @ PROW()+1,00 SAY IF(ver_serie()='141447','NOTA PROMISSORIA:','DUPLICATA No.: ')+mtipo+mduplicata
        ELSE
                @ PROW()+1,00 SAY 'NOTA PROMISSORIA No.: '+mtipo+mduplicata
        ENDIF
        imprt(mtipo_imp,'C')
        @ PROW()+1,00 SAY 'Emissao:'
        @ PROW(),10 SAY memi_dup
        @ PROW(),25 SAY 'Vencimento:'
        @ PROW(),37 SAY mvenc_dup
        @ PROW(),49 SAY 'Cod.:'
        @ PROW(),55 SAY STRZERO(mcod_ven,3)
        @ PROW()+1,00 SAY mtraco
        IF mdup_prom = NIL
                IF mv_fat <> NIL .AND. ! EMPTY(mn_fat)
                        @ PROW()+1,00 SAY 'Fatura No.: '+mn_fat+'  Valor:'+TRANSFORM(mv_fat,'9,999,999.99')
                ELSE
                        @ PROW()+1,00 SAY 'Fatura No.:...............  Valor:..............'
                ENDIF
        ENDIF
        @ PROW()+1,00 SAY mtraco
        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(ROUND(mvlr_dup,2),'99,999,999.99'))+')',60))
        mextenso:= '('+RTRIM(EXT(ROUND(mvlr_dup,2),10))+')'
        mlinha := MLCOUNT(mextenso,60)
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,60,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),60))
        NEXT
        @ PROW()+1,00 SAY mtraco
        IF mdup_prom <> NIL
                mextenso:= 'Reconheco(cemos) a exatidao desta NOTA PROMISSORIA em unica via, na importancia acima que pagarei(emos) a '+m_set[1,129]+', ou a sua ordem na praca e vencimento indicados.'
        ELSE
                mextenso:= 'Reconheco(cemos) a exatidao desta '+IF(ver_serie()='141447','NOTA PROMISSORIA','DUPLICATA DE VENDA MERCANTIL')+', na importancia acima que pagarei(emos) a '+m_set[1,129]+', ou a sua ordem na praca e vencimento indicados.'
        ENDIF
        mlinha := 0
        mlinha := MLCOUNT(mextenso,60)
        lin := 0
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,60,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(RTRIM(mlin))
        NEXT
        @ PROW()+1,00 SAY mtraco
        DEVPOS(PROW()+3,00);DEVOUT(PADC('---------------------------------------------',60))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('Assinatura do Emitente',60))
        DEVPOS(PROW()+2,00);DEVOUT(PADC('Em         /        /        ',60))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('Data do Aceite',60))
        DEVPOS(PROW()+3,00);DEVOUT(PADC('---------------------------------------------',60))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('Assinatura do Sacado',60))
        DEVPOS(PROW()+3,00);DEVOUT(PADC('---------------------------------------------',60))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('Assinatura do Avalista',60))
        @ PROW()+1,00 SAY mtraco
        IF ! EMPTY(m_set[1,52])
                @ PROW()+1,00 SAY PADC(RTRIM(m_set[1,52]),80)
                @ PROW()+1,00 SAY PADC(RTRIM(m_set[1,53]),80)
                @ PROW()+1,00 SAY mtraco
        ENDIF
        DEVPOS(PROW()+m_cfg[29],00);DEVOUT(CHR(18))
ELSE
        mtraco:=REPLI('-',80)
        imprt(mtipo_imp,'N')
        IF m_set[1,22] = 'S'
                imprt(mtipo_imp,'E')
                IF mmult_emp = 'N'
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,00);DEVOUT(RTRIM(mend_firm)+'-'+RTRIM(mcid_firm)+' - FONE: '+mfone_firm+' - INSCR.:'+minsc_firm+' - CNPJ:'+mcgc_firm)
                ELSE
                        DEVPOS(PROW(),00);DEVOUT(ALLTRIM(IF(emp->nome_cab = 'F',emp->fantasia,emp->razao)))
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,00);DEVOUT(RTRIM(emp->endereco)+'-'+RTRIM(emp->cidade)+' - FONE: '+emp->fone+' - INSCR.:'+emp->insc+' - CNPJ:'+emp->cnpj)
                ENDIF
                imprt(mtipo_imp,'N')
                @ PROW()+1,00 SAY mtraco
                @ PROW()+1,00 SAY ''
        ENDIF
        @ PROW(),00 SAY 'Cliente:'
        @ PROW(),PCOL()+1 SAY mcod
        @ PROW(),PCOL()+1 SAY mnome
        IF m_set[1,40] = 'S' .AND. ! EMPTY(mfantasia)
                @ PROW()+1,00 SAY 'Nome Fantasia: '+mfantasia
        ENDIF
        imprt(mtipo_imp,'C')
        IF ver_serie() = '141265' .AND. ! EMPTY(mend_cob)
                @ PROW()+1,00 SAY 'End. COBRANCA: '+mend_cob
                @ PROW()+1,00 SAY 'Bairro: '+RTRIM(mbairro_cob)+'-Cidade: '+RTRIM(mcidade_cob)+'-'+muf_cob+'- CEP:'+mcep_cob+'- Fone:'+mfone_cob
        ELSE
                @ PROW()+1,00 SAY 'End.: '+mend
                @ PROW()+1,00 SAY 'Bairro: '+RTRIM(mbairro)+'-Cidade: '+RTRIM(mcidade)+'-'+muf+'- CEP:'+mcep+'- Fone:'+mtel
        ENDIF
        IF mcgc <> SPACE(14)
                @ PROW(),PCOL()+3 SAY 'CNPJ:'
                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(mcgc,'@@R 99.999.999/9999-99')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' - Insc.: '+minsc)
        ELSEIF mcpf <> SPACE(11)
                @ PROW(),PCOL()+3 SAY 'CPF:'
                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(mcpf,'@@R 999.999.999-99')
        ENDIF
        IF ver_serie() = '141265'
                @ PROW()+1,00 SAY mtraco
        ELSE
                IF ! EMPTY(mend_cob)
                        imprt(mtipo_imp,'C')
                        @ PROW()+1,00 SAY 'End. COBRANCA: '+mend_cob+' - Bairro: '+RTRIM(mbairro_cob)+'-Cidade: '+RTRIM(mcidade_cob)+'-'+muf_cob+'- CEP:'+mcep_cob+'- Fone:'+mfone_cob
                        imprt(mtipo_imp,'N')
                ENDIF
                @ PROW()+1,00 SAY mtraco
        ENDIF
        imprt(mtipo_imp,'E',1)
        IF mdup_prom = NIL
                @ PROW(),00 SAY IF(ver_serie()='141447','NOTA PROMISSORIA:','DUPLICATA No.: ')+mtipo+mduplicata
        ELSE
                @ PROW(),00 SAY 'NOTA PROMISSORIA No.: '+mtipo+mduplicata
        ENDIF
        imprt(mtipo_imp,'N')
        @ PROW()+1,00 SAY 'Emissao:'+DTOC(memi_dup)
        @ PROW(),PCOL()+1 SAY 'Vencimento:'+DTOC(mvenc_dup)
        IF mdup_prom = NIL
                IF mv_fat <> NIL .AND. ! EMPTY(mn_fat)
                        @ PROW(),PCOL()+1 SAY 'Fatura:'+mn_fat+' Valor:'+TRANSFORM(mv_fat,'999,999.99')
                ELSE
                        @ PROW(),PCOL()+1 SAY 'Fatura No.:........ Valor:........'
                ENDIF
        ENDIF
        @ PROW(),PCOL()+1 SAY 'Cod.:'
        @ PROW(),PCOL() SAY STRZERO(mcod_ven,3)
*       @ PROW()+1,00 SAY mtraco
        DEVPOS(PROW()+1,00);DEVOUT('Valor R$: ('+LTRIM(TRANSFORM(mvlr_dup,'99,999,999.99'))+')')
        mextenso:= '('+RTRIM(EXT(ROUND(mvlr_dup,2),10))+')'
        mlinha := MLCOUNT(mextenso,80)
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,80,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
        NEXT
        @ PROW()+1,00 SAY mtraco
        IF mdup_prom <> NIL
                mextenso:= 'Reconheco(cemos) a exatidao desta NOTA PROMISSORIA em unica via, na importancia acima que pagarei(emos) a '+m_set[1,129]+', ou a sua ordem na praca e vencimento indicados.'
        ELSE
                mextenso:= 'Reconheco(cemos) a exatidao desta '+IF(ver_serie()='141447','NOTA PROMISSORIA','DUPLICATA DE VENDA MERCANTIL')+', na importancia acima que pagarei(emos) a '+m_set[1,129]+', ou a sua ordem na praca e vencimento indicados.'
        ENDIF
        mlinha := 0
        mlinha := MLCOUNT(mextenso,80)
        lin := 0
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,80,lin,,10)
                IF mlin # ' '
                        DEVPOS(PROW()+1,00);DEVOUT(RTRIM(mlin))
                ENDIF
        NEXT
*       @ PROW()+1,00 SAY mtraco
        DEVPOS(PROW()+2,00);DEVOUT(PADC('Data do Aceite em ...../...../.....',80))
        DEVPOS(PROW()+2,00);DEVOUT(PADC('...................       .....................      ...................',80))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('   Ass. Emitente               Ass. Sacado              Ass. Avalista   ',80))
        @ PROW()+1,00 SAY mtraco
        IF ! EMPTY(m_set[1,52])
                @ PROW()+1,00 SAY PADC(RTRIM(m_set[1,52]),80)
                @ PROW()+1,00 SAY PADC(RTRIM(m_set[1,53]),80)
                @ PROW()+1,00 SAY mtraco
        ENDIF
        SETPRC(00,00)
        EJECT
ENDIF
RETURN NIL
******************************** F I M ************************************88
************************************************
*FUNCAO P/IMPRIMIR RECIBO BAIXA DE DOC.RECEBER
************************************************
               //  1   2    3     4     5    6       7        8      9
FUNCTION rec_dupr(m_d,m_p,mqtd,mtot_m,mtot,mdat,mtipo_rel,mvlr_parc,mdev)
*************************************************************************
LOCAL mtraco := REPLI('=',60),i:=0,mextenso,mlinha,mlin,lin,mtot_acord:=0,Q_cons:={}
PRIVATE mcliente,mcpf,mcgc,;
        mtipo_imp,mimp_tipo:=0,marq:=SPACE(35)
mtipo_imp := m_cfg[36]
cComm  := "SELECT fornec,cliente,venc FROM sacdupr WHERE sr_recno = " + sr_cdbvalue(m_p)
Q_cons:={}
sr_getconnection():exec(ccomm,,.t.,@Q_cons)
IF LEN(Q_cons) = 0
        atencao('Nao existe nenhum Documento baixado')
        RETURN NIL
ENDIF
IF ! imp_arq('DEMO_DEB.REL','R')
        RETURN NIL
ENDIF
IF m_cfg[24] = 'B' .AND. mtipo_rel <> 'E'
        mtraco := REPLI('=',60)
        imprt(mtipo_imp,'N')
        DEVPOS(PROW()+1,00);DEVOUT(PADC(ALLTRIM(memp_resa),38))
        imprt(mtipo_imp,'C')
        DEVPOS(PROW()+1,00);DEVOUT(PADC(RTRIM(mend_firm),58))
        DEVPOS(PROW()+1,00);DEVOUT(PADC(RTRIM(mcid_firm),58))
        DEVPOS(PROW()+1,00);DEVOUT(PADC(RTRIM('Fone: '+mfone_firm),58))
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        imprt(mtipo_imp,'N')
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT(PADC('RECIBO PAGAMENTO',38))
        ELSE
                DEVPOS(PROW()+1,00);DEVOUT(PADC('DEMONSTRATIVO DE DEBITO',38))
        ENDIF
        imprt(mtipo_imp,'C')
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis)+'    Data do Pagamento: '+DTOC(mdat))
        ELSE
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis))
        ENDIF
        DEVPOS(PROW(),PCOL()+2);DEVOUT('- Oper.:'+cod_operado)
        DEVPOS(PROW()+1,00);DEVOUT('Cliente: '+Q_cons[1,1]+'-'+Q_cons[1,2])
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        DEVPOS(PROW()+1,00);DEVOUT('Documento')
        IF mtipo_rel = NIL
                DEVPOS(PROW(),15);DEVOUT('Vencimento')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('    Valor')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('   Jur+Mul')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Valor Pago')
        ELSE
                DEVPOS(PROW(),15);DEVOUT(' Emissao')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vencimen')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('    Valor')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Jur+Mul')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr.Total')
        ENDIF
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        i:=0
        FOR i = 1 TO LEN(m_d)
                IF EMPTY(m_d[i])
                        LOOP
                ENDIF
                DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7,60))
                //DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7))
        NEXT
        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',60))
        DEVPOS(PROW()+1,00);DEVOUT('TOTAL: '+TRANSFORM(mqtd,'99999'))
        DEVPOS(PROW(),25);DEVOUT(TRANSFORM(mvlr_parc,'999,999.99'))
        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot_m,'99,999.99'))
        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot,'999,9999.99'))
/*
        DEVPOS(PROW(),25);DEVOUT(TRANSFORM(mtot+mtot_m,'999,999.99'))
        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot-mtot_m,'99,999.99'))
        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot,'999,9999.99'))
*/
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
*        mextenso:= '('+RTRIM(extenso(ROUND(mtot,2),10))+')'
        mextenso:= '('+RTRIM(EXTENSO(ROUND(mtot,2),.T.,'real','reais'))+')'

        mlinha := MLCOUNT(mextenso,60)
        lin := 0
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,60,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),60))
        NEXT
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT('Recebemos o valor acima descrito, pelo qual damos quitacao.')
        ENDIF
        IF mdev > 0 //mdev # NIL .OR.
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Saldo Devedor: '+TRANSFORM(mdev,'999,999.99'))
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        ENDIF
        DEVPOS(PROW()+3,00);DEVOUT(PADC('----------------------------------------',58))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('                 Local e data           ',58))
        DEVPOS(PROW()+3,00);DEVOUT(PADC(REPLI('-',LEN(ALLTRIM(memp_resa))+4),58))
        DEVPOS(PROW()+1,00);DEVOUT(PADC(ALLTRIM(memp_resa),58))

        IF mtipo_rel = NIL .AND. m_cfg[50] = 'S'
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+4,00);DEVOUT(PADC(ALLTRIM(memp_resa),38))
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(PADC('COMPROVANTE RECIBO PAGAMENTO',38))
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis)+'        Data do Pagamento: '+DTOC(mdat))
                DEVPOS(PROW()+1,00);DEVOUT('Cliente: '+Q_cons[1,1]+'-'+Q_cons[1,2])
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Documento')
                DEVPOS(PROW(),15);DEVOUT('Vencimento')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('    Valor')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('   Jur+Mul')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Valor Pago')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                i:=0
                FOR i = 1 TO LEN(m_d)
                        IF EMPTY(m_d[i])
                                LOOP
                        ENDIF
                        DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7,60))
                NEXT
                DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',60))
                DEVPOS(PROW()+1,00);DEVOUT('Qtd.Doc.: '+TRANSFORM(mqtd,'99999'))
                DEVPOS(PROW(),25);DEVOUT(TRANSFORM(mvlr_parc,'999,999.99'))
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot_m,'99,999.99'))
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot,'999,9999.99'))
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+m_cfg[29],00);DEVOUT(CHR(18))
        ELSE
                DEVPOS(PROW()+m_cfg[29],00);DEVOUT(CHR(18))
        ENDIF
ELSEIF m_cfg[24] = 'F' .OR. m_cfg[24] = 'G' .AND. mtipo_rel <> 'E'
        mtraco := REPLI('=',80)
        imprt(mtipo_imp,'E')
        DEVPOS(PROW()+1,00);DEVOUT(memp_resa)
        imprt(mtipo_imp,'C')
        DEVPOS(PROW()+1,00);DEVOUT(RTRIM(m_set[1,132])+'-'+RTRIM(m_set[1,133])+'-'+RTRIM(m_set[1,134])+'-'+RTRIM(m_set[1,19])+' - Fone: '+m_set[1,136])
        imprt(mtipo_imp,'N')
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT(PADC('RECIBO PAGAMENTO',80))
        ELSE
                DEVPOS(PROW()+1,00);DEVOUT(PADC('DEMONSTRATIVO DE DEBITO',80))
        ENDIF
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis)+'        Data do Pagamento: '+DTOC(mdat))
        ELSE
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis))
        ENDIF
        DEVPOS(PROW(),PCOL()+2);DEVOUT(' - Oper.:'+cod_operado)
        DEVPOS(PROW()+1,00);DEVOUT('Cliente: '+Q_cons[1,1]+'-'+Q_cons[1,2])
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        DEVPOS(PROW()+1,00);DEVOUT('Documento')
        DEVPOS(PROW(),15);DEVOUT(' Emissao')
        DEVPOS(PROW(),PCOL()+1);DEVOUT('Vencimen')
        DEVPOS(PROW(),PCOL()+1);DEVOUT('    Valor')
        DEVPOS(PROW(),PCOL()+1);DEVOUT('Jur+Mul')
        DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr.Total')
        DEVPOS(PROW(),PCOL()+1);DEVOUT('LP')
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        i:=0
        FOR i = 1 TO LEN(m_d)
                IF EMPTY(m_d[i])
                        LOOP
                ENDIF
*               DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7,55))
                DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7))
        NEXT
        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',80))
        DEVPOS(PROW()+1,00);DEVOUT('Qtd.Doc.: '+TRANSFORM(mqtd,'99999'))
        DEVPOS(PROW(),32);DEVOUT(TRANSFORM(mtot-mtot_m,'999,999.99'))
        DEVPOS(PROW(),PCOL());DEVOUT(TRANSFORM(mtot_m,'99999.99'))
        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot,'999999.99'))
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
*        mextenso:= '('+RTRIM(extenso(ROUND(mtot,2),10))+')'
        mextenso:= '('+RTRIM(EXTenso(ROUND(mtot,2),.T.,'real','reais'))+')'

        mlinha := MLCOUNT(mextenso,60)
        lin := 0
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,60,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),60))
        NEXT
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT('Recebemos o valor acima descrito, pelo qual damos quitacao.')
        ENDIF
        IF mdev > 0 //mdev # NIL .OR.
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Saldo Devedor: '+TRANSFORM(mdev,'999,999.99'))
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        ENDIF
        DEVPOS(PROW()+3,00);DEVOUT(PADC('----------------------------------------',80))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('                Local e data            ',80))
        DEVPOS(PROW()+3,00);DEVOUT(PADC(REPLI('-',LEN(ALLTRIM(memp_resa))+4),80))
        DEVPOS(PROW()+1,00);DEVOUT(PADC(ALLTRIM(memp_resa),80))
        IF mtipo_rel = NIL .AND. m_cfg[50] = 'S'
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+3,00);DEVOUT(PADC(ALLTRIM(memp_resa),38))
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(PADC('COMPROVANTE RECIBO PAGAMENTO',38))
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis)+'        Data do Pagamento: '+DTOC(mdat))
                DEVPOS(PROW()+1,00);DEVOUT('Cliente: '+Q_cons[1,1]+'-'+Q_cons[1,2])
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Documento')
                DEVPOS(PROW(),15);DEVOUT(' Emissao')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vencimen')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('    Valor')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Jur+Mul')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr.Total')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('LP')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                i:=0
                FOR i = 1 TO LEN(m_d)
                        IF EMPTY(m_d[i])
                                LOOP
                        ENDIF
                        DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7))
                NEXT
                DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',60))
                DEVPOS(PROW()+1,00);DEVOUT('Qtd.Doc.: '+TRANSFORM(mqtd,'99999'))
                DEVPOS(PROW(),32);DEVOUT(TRANSFORM(mtot-mtot_m,'999,999.99'))
                DEVPOS(PROW(),PCOL());DEVOUT(TRANSFORM(mtot_m,'99999.99'))
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot,'999999.99'))
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+m_cfg[29],00);DEVOUT(CHR(18))
        ENDIF
        SETPRC(00,00)
        EJECT
ELSEIF mtipo_rel = 'E'
        mtraco := REPLI('=',80)
        mtot_acord := i := 0
        FOR i = 1 TO LEN(m_dupr)
                mbaixa := 'S'
                IF m_pos[i,2] <> 'X'
                        LOOP
                ENDIF
                IF m_set[1,22] = 'S'
                        imprt(m_cfg[36],'E')
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        imprt(m_cfg[36],'C')
                        DEVPOS(PROW()+1,00);DEVOUT(mend_firm+'-'+mcid_firm+  +'Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   CNPJ: '+mcgc_firm)
                        imprt(m_cfg[36],'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                ENDIF
                imprt(m_cfg[36],'N')
                ver_cli(VAL(aret[i,7]),,,'*')
                @ PROW(),00 SAY 'Cliente......:'
                @ PROW(),PCOL()+1 SAY aret[i,7]
                @ PROW(),PCOL()+1 SAY aret[i,8]
                @ PROW()+1,00 SAY 'Nome Fantasia:'
                @ PROW(),PCOL()+1 SAY cli->nome
                @ PROW()+1,00 SAY 'Responsavel..:'
                @ PROW(),PCOL()+1 SAY cli->comprado
                @ PROW()+1,00 SAY 'End.: '+cli->endereco+', '+RTRIM(cli->numero)+IF(! EMPTY(RTRIM(cli->complemento)),' - Compl.:'+RTRIM(cli->complemento),'')
                @ PROW()+1,00 SAY 'Bairro: '+RTRIM(cli->bairro)+'-Cidade: '+RTRIM(cli->cidade)+'-'+cli->uf
                @ PROW()+1,00 SAY 'CEP:'+cli->cep+'- Fone:'+cli->tel1
                imprt(m_cfg[36],'N')
                IF ! EMPTY(cli->cgc)
                        @ PROW()+1,00 SAY 'CNPJ:'
                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(cli->cgc,'@@R 99.999.999/9999-99')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(' - Insc.: '+cli->insc)
                ELSE
                        @ PROW()+1,00 SAY 'CPF:'
                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(cli->cpf,'@@R 999.999.999-99')
                ENDIF
                @ PROW()+1,00 SAY mtraco
                @ PROW()+1,00 SAY ''
                imprt(m_cfg[36],'E')
                @ PROW(),00 SAY IF(ver_serie()='141447','NOTA PROMISSORIA:','DUPLICATA No.:')+aret[i,4]
                imprt(m_cfg[36],'N')
                @ PROW()+1,00 SAY 'Emissao:'
                @ PROW(),09 SAY aret[i,10]
                @ PROW(),20 SAY 'Vencimento:'
                @ PROW(),32 SAY aret[i,11]
                @ PROW()+1,00 SAY mtraco
                DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(aret[i,19],'99,999,999.99'))+')',80))
*                mextenso:= '('+RTRIM(extenso(dupr->valor,10))+')'
                mextenso:= '('+RTRIM(EXTenso(ROUND(aret[i,19],2),.T.,'real','reais'))+')'

                mlinha := MLCOUNT(mextenso,80)
                FOR lin = 1 TO mlinha
                        mlin := MEMOLINE(mextenso,80,lin,,10)
                        DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                NEXT
                @ PROW()+1,00 SAY mtraco
                @ PROW()+1,00 SAY 'Descricao:'
                @ PROW(),00 SAY 'Descricao:'
                mextenso:= m_set[1,29]+m_set[1,30]+m_set[1,31]+m_set[1,32]
                mlinha := 0
                mlinha := MLCOUNT(mextenso,60)
                lin := 0
                FOR lin = 1 TO mlinha
                        mlin := MEMOLINE(mextenso,80,lin,,10)
                        IF mlin # ' '
                                DEVPOS(PROW()+1,00);DEVOUT(RTRIM(mlin))
                        ENDIF
                NEXT
                @ PROW()+1,00 SAY mtraco
                imprt(m_cfg[36],'N')
                DEVPOS(PROW()+1,00);DEVOUT('OBSERVACAO:')
                DEVPOS(PROW(),00);DEVOUT('OBSERVACAO:')
                DEVPOS(PROW()+1,00);DEVOUT('Maiores informacoes dirija-se ao '+memp_resa+'.')
                imprt(m_cfg[36],'C')
                DEVPOS(PROW()+1,00);DEVOUT('(Para quitacao da mesma, pois a nao quitacao implicara no bloqueio do seu credito e a inclusao no SPC e SERASA)')
                imprt(m_cfg[36],'N')
                @ PROW()+1,00 SAY mtraco
                @ PROW()+7,00 SAY ' '
                mtot_acord := mtot_acord + dupr->valor
        NEXT
        // COMPROVANTE DE RECEBIMENTOS
        imprt(m_cfg[36],'E')
        DEVPOS(PROW(),00);DEVOUT(memp_resa)
        imprt(m_cfg[36],'C')
        DEVPOS(PROW()+1,00);DEVOUT(mend_firm+'-'+mcid_firm+  +'Fone: '+mfone_firm)
        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   CNPJ: '+mcgc_firm)
        imprt(m_cfg[36],'N')
        @ PROW()+1,00 SAY mtraco
        @ PROW()+1,00 SAY PADC('COMPROVANTE DE RECEBIMENTO DOS BOLETOS',80)
        @ PROW()+1,00 SAY mtraco
        mextenso:= 'Eu,'+aret[1,7]+'-'+RTRIM(aret[1,8])+' portador do '
        IF ! EMPTY(cli->cgc)
                mextenso := mextenso + 'CNPJ:'+TRANSFORM(cli->cgc,'99.999.999/9999-99')
        ELSE
                mextenso := mextenso + 'CPF:'+TRANSFORM(cli->cpf,'999.999.999-99')
        ENDIF
        mextenso := mextenso + ', Estou ciente e de acordo que a nao quitacao do valor de R$:'+ALLTRIM(TRANSFORM(mtot_acord,'999,999.99'))+' no vencimento e valor determinado nos documentos abaixo citados, ocorrera a inclusao no SPC e SERASA.'
        mlinha := MLCOUNT(mextenso,80)
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,80,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
        NEXT
        @ PROW()+1,00 SAY mtraco
        @ PROW()+1,00 SAY 'Relacao dos Documentos'
        @ PROW()+1,00 SAY REPLI('-',80)
        i := 0
        FOR i = 1 TO LEN(m_dupr)
                mbaixa := 'S'
                IF m_pos[i,2] <> 'X'
                        LOOP
                ENDIF
                @ PROW()+1,00 SAY 'No.Doc.:'+m_pos[i,7]+' Venc.:'+DTOC(m_pos[i,8])+' Valor: '+TRANSFORM(m_pos[i,3],'999,999.99')
        NEXT
        @ PROW()+1,00 SAY REPLI('-',80)
        @ PROW()+3,00 SAY PADC(RTRIM(m_set[1,134])+', ....../ ....../ ........',80)
        @ PROW()+3,00 SAY PADC('..............................................',80)
        @ PROW()+1,00 SAY PADC('            Assinatura do Cliente             ',80)
        @ PROW()+7,00 SAY ' '
        EJECT
ENDIF
SET DEVICE TO SCREEN;SET PRINT TO;SET PRINT OFF
conf_impressao('DEMO_DEB.REL')
RETURN NIL
***************************  F I M ******************************************
********************************
* FUNCAO P/CONSULTAR CONTA DESPESA
********************************
FUNCTION f9_conta(mop)
*****************
LOCAL lci,cci,lba,cba,msele,morde,men,;
      oconsprod,ocolprod[3],i,nkey,opcao,;
      mdesc1 := SPACE(25),mtipo  := SPACE(1),tela1
MEMVAR mcodconta
lci := cci := 00
lba := 16
cba := 60
op_tela(00,00,21,60,memp_resa+SPACE(10)+"CADASTRO DE CONTA DESPESAS")

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacdesp','cdesp');RETURN NIL;ENDIF
*************
SELE('cdesp');ORDSETFOCUS(1)
*************
oconsprod := TBROWSEDB(lci,cci,lba,cba)
ocolprod[1] := TBCOLUMNNEW('Codigo',{||TRANSFORM(cdesp->codigo,'@@R 9.99.9')})
ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||cdesp->desc1})
ocolprod[3] := TBCOLUMNNEW('Tipo',{||cdesp->tipo})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('<P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        botao(lba+1,cci,lba+3,cba,,' Conta Despesas ')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                IF mop = '*'
                        opcao := mensagem1('Deseja <A>lterar <E>xcluir:','A','A,E')
                        IF LASTKEY() = 27
                                LOOP
                        ELSEIF opcao = 'A'
                                mensagem('Digite a descricao - <ESC> p/Retornar')
                                mcodconta := SPACE(4)
                                mdesc1 := SPACE(25)
                                mtipo  := SPACE(1)
                                botao(lba+1,cci,lba+3,cba,,' Inclusao Despesas ')
                                DEVPOS(lba+2,cci+2);DEVOUT('Cod.:')
                                DEVPOS(lba+2,cci+15);DEVOUT('Descricao:')
                                DEVPOS(lba+2,cci+53);DEVOUT('Tipo:')
                                setcor(3)
                                DEVPOS(lba+2,cci+8);DEVOUTPICT(cdesp->codigo,'@@R 9.99.9')
                                setcor(1)
                                IF LASTKEY() = 27
                                        EXIT
                                ENDIF
                                mdesc1 := cdesp->desc1
                                mtipo  := cdesp->tipo
                                @ lba+2,cci+26 GET mdesc1 PICT '@!'
                                @ lba+2,cci+58 GET mtipo PICT '@!' VALID mtipo $ 'V,F,I, ' .AND. lim_get() WHEN men_get(lba-3,cci+58,'<V>ariavel - <F>ixas - <I>nvestimento - < > em branco')
                                READ
                                IF LASTKEY() = 27 .OR. EMPTY(mdesc1)
                                        EXIT
                                ENDIF
                                opcao := op_simnao('S','Confirma Alteracao:')
                                IF opcao = 'N'
                                        LOOP
                                ENDIF
                                ccomm :="UPDATE sacdesp SET desc1 = "+sr_cdbvalue(mdesc1) +",tipo = "+sr_cdbvalue(mtipo) +" WHERE codigo = "+sr_cdbvalue(cdesp->codigo)
                                sr_getconnection():exec(ccomm,,.f.)
                                sr_getconnection():exec('COMMIT',,.f.)
                        ELSEIF opcao = 'E'
                                opcao := mensagem1('Confirma a Exclusao da Conta Despesa','N','S,N')
                                IF opcao = 'S'
                                        sr_getconnection():exec("DELETE FROM sacdesp WHERE codigo = "+sr_cdbvalue(cdesp->codigo),,.f.)
                                        sr_getconnection():exec("COMMIT",,.f.)
                                        sr_getconnection():exec("DELETE FROM sacdesp WHERE SR_DELETED = 'T'",,.f.)
                                        sr_getconnection():exec("COMMIT",,.f.)
                                ENDIF
                        ENDIF
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||TRANSFORM(cdesp->codigo,'@@R 9.99.9')})
                        ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||cdesp->desc1})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||cdesp->tipo})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ELSE
                        mcodconta := cdesp->codigo
                        EXIT
                ENDIF
        ELSEIF nkey = 105 .OR. nkey = 73
                WHILE .T.
                        mensagem('Digite o Codigo da despesa e faca a descricao - <ESC> p/Retornar')
                        mcodconta := SPACE(4)
                        mdesc1 := SPACE(25)
                        mtipo  := SPACE(1)
                        botao(lba+1,cci,lba+3,cba,,' Inclusao Despesas ')
                        DEVPOS(lba+2,cci+2);DEVOUT('Cod.:')
                        DEVPOS(lba+2,cci+15);DEVOUT('Descricao:')
                        DEVPOS(lba+2,cci+53);DEVOUT('Tipo:')
                        @ lba+2,cci+8 GET mcodconta PICT '@@R 9.99.9'
                        READ
                        IF LASTKEY() = 27
                                EXIT
                        ENDIF
                        IF EMPTY(mcodconta)
                                LOOP
                        ENDIF
                        *************
                        SELE('cdesp');ORDSETFOCUS(1)
                        GO TOP
                        *************
                        IF cdesp->(DBSEEK(mcodconta))
                                atencao('Conta Despesa ja Cadastrada')
                                LOOP
                        ENDIF
                        @ lba+2,cci+26 GET mdesc1 PICT '@!'
                        @ lba+2,cci+58 GET mtipo PICT '@!' VALID mtipo $ 'V,F,I, ' .AND. lim_get() WHEN men_get(lba-3,cci+58,'<V>ariavel - <F>ixas - <I>nvestimento - < > em branco')
                        READ
                        IF LASTKEY() = 27 .OR. EMPTY(mdesc1)
                                LOOP
                        ENDIF
                        opcao := op_simnao('S','Confirma Inclusao:')
                        IF opcao = 'N'
                                LOOP
                        ENDIF
                        IF ADIREG()
                                Cdesp-> codigo := mcodconta
                                Cdesp-> desc1 := mdesc1
                                Cdesp-> tipo  := mtipo
                                COMMIT
                                UNLOCK
                        ELSE
                                atencao('Nao foi possivel acessar o Arquivo !!!')
                                ORDSETFOCUS(3)
                                LOOP
                        ENDIF
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||TRANSFORM(cdesp->codigo,'@@R 9.99.9')})
                        ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||cdesp->desc1})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||cdesp->tipo})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDDO
        ELSE
                IF genkey(oconsprod,nkey,'cdesp')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||TRANSFORM(cdesp->codigo,'@@R 9.99.9')})
                        ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||cdesp->desc1})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||cdesp->tipo})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
CLEAR GETS
wvw_lclosewindow()
IF nkey == K_ESC
        RETURN NIL
ELSE
        RETURN mcodconta
ENDIF
RETURN NIL
******************************* f i m *********************************************
******************
* VERIFICA CODIGO
******************
FUNCTION ver_cod(vgru,li,ci,t,mzero,p)
**********************
LOCAL msele,morde,posicao:=0

IF ((mzero <> NIL .OR. mzero = 0) .AND. mzero <> 1) .AND. EMPTY(vgru)
        RETURN .T.
ENDIF

msele := SELE()
morde := INDEXORD()
IF RECNO() > 0 .AND. msele > 0
        posicao := RECNO()
ENDIF
IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF

**************
SELE('merc');ORDSETFOCUS(1)
GO TOP
**************

SEEK STRZERO(vgru,5)

IF t = .T. .AND. FOUND()
        vgru := 0
        atencao('Este Codigo: '+STRZERO(vgru,5)+' ja Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF posicao > 0 .AND. msele > 0 .AND. morde > 0 .AND. msele <> SELE('merc')
                GO posicao
        ENDIF
        RETURN .F.
ENDIF
IF ! FOUND()
        vgru := 0
        IF p = NIL
                atencao('Codigo: '+STRZERO(vgru,5)+' nao Cadastrado !!!')
        ENDIF
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF posicao > 0 .AND. msele > 0 .AND. morde > 0 .AND. msele <> SELE('merc')
                GO posicao
        ENDIF
        RETURN .F.
ENDIF
IF li = NIL
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF posicao > 0 .AND. msele > 0 .AND. morde > 0 .AND. msele <> SELE('merc')
                GO posicao
        ENDIF
        RETURN .T.
ENDIF
setcor(3)
DEVPOS(li,ci);DEVOUT(merc->merc)
setcor(1)
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
IF posicao > 0 .AND. msele > 0 .AND. morde > 0 .AND. msele <> SELE('merc')
        GO posicao
ENDIF
RETURN .T.
********************** F I M ********************************
********************************
* FUNCAO P/CONSULTAR DOCUMENTOS A APAGAR
********************************
FUNCTION cons_apag(mop)
*****************
LOCAL tela,tela1,lci,cci,lba,cba,msele,morde,men,;
      mdias_atras:=0,mmulta:=0,mjuros:=0,mvlpago:=0,;
      oconsprod,ocolprod[9],i,nkey,opcao
MEMVAR mduplicata,mcod_cli,mtipo,mdata_sis
lci := cci := 0
lba := 23
cba := 78

msele := SELE()
morde := INDEXORD()
*************
SELE('dupp');ORDSETFOCUS(2)
*************
op_tela(lci,cci,lba,cba,' Consulta de DOCUMENTOS CONTAS APAGAR ','*')
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Tipo',{||dupp->tipo})
ocolprod[2] := TBCOLUMNNEW('No.Docuemnto',{||dupp->duplicata})
ocolprod[3] := TBCOLUMNNEW('Valor Doc.',{||TRANSFORM(dupp->valor,'999,999.99')})
ocolprod[4] := TBCOLUMNNEW('Vencimento',{||DTOC(dupp->venc)})
ocolprod[5] := TBCOLUMNNEW('Emissao',{||DTOC(dupp->emissao)})
ocolprod[6] := TBCOLUMNNEW('Data Pag.',{||dupp->datpag})
ocolprod[7] := TBCOLUMNNEW('Cod.',{||dupp->fornec})
ocolprod[8] := TBCOLUMNNEW('Forncedor/Despesas',{||dupp->cliente})
ocolprod[9] := TBCOLUMNNEW('Tipo Conta',{||dupp->tip_for})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('< > <P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<> <PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                CLEAR GETS
                EXIT
        ELSEIF nkey == K_ENTER
                mduplicata := dupp->duplicata
                mcod_cli   := VAL(dupp->fornec)
                mtipo      := dupp->tipo
                IF mop = '*'
                        mdias_atras := mmulta := mjuros := mvlpago := 0
                        mdias_atras := mdata_sis-dupp->venc
                        mvlpago=dupp->valor+mjuros+mmulta
                        tela1 := SAVESCREEN(00,00,24,79)
                        botao(05,00,22,79,,' Codigo da Empresa: '+dupp->empresa+'  ')
                        DEVPOS(06,01);DEVOUT('Cliente.............:')
                        DEVPOS(07,01);DEVOUT('No.da Documento ....:')
                        DEVPOS(08,01);DEVOUT('Data Emissao........:')
                        DEVPOS(09,01);DEVOUT('Data Vencimento.....:')
                        DEVPOS(10,01);DEVOUT('Vlr. Documento ...R$:')

                        DEVPOS(11,01);DEVOUT('Operador............:')
                        DEVPOS(12,01);DEVOUT('OBS.:')

                        setcor(3)
                        DEVPOS(06,23);DEVOUT(dupp->fornec+'-'+dupp->cliente)
                        DEVPOS(07,23);DEVOUT(dupp->tipo+dupp->duplicata)
                        DEVPOS(08,23);DEVOUT(DTOC(dupp->emissao))
                        DEVPOS(09,23);DEVOUT(DTOC(dupp->venc))
                        DEVPOS(10,23);DEVOUT(TRANSFORM(dupp->valor,'9,999,999.99'))
                        DEVPOS(11,23);DEVOUT(dupp->operador)
                        DEVPOS(12,07);DEVOUT(dupp->obs)

                        IF ! EMPTY(dupp->datpag) .OR. dupp->pago <> ' '
                                setcor(1)
                                DEVPOS(13,01);DEVOUT('Data Pagamento .....:')
                                DEVPOS(14,01);DEVOUT('Pago efetuado Com...:')
                                DEVPOS(15,01);DEVOUT('Juros Pago .......R$:')
                                DEVPOS(16,01);DEVOUT('Desconto .........R$:')
                                DEVPOS(17,01);DEVOUT('Valor Pago .......R$:')
                                setcor(3)
                                DEVPOS(13,23);DEVOUT(DTOC(dupp->datpag))
                                DEVPOS(14,23);DEVOUT(STRZERO(dupp->datpag-dupp->venc,3)+' Dias.')
                                DEVPOS(15,23);DEVOUT(TRANSFORM(dupp->juros,'9,999,999.99'))
                                DEVPOS(16,23);DEVOUT(TRANSFORM(dupp->desconto,'9,999,999.99'))
                                DEVPOS(17,23);DEVOUT(TRANSFORM(dupp->vlpago,'9,999,999.99'))
                        ELSE
                                setcor(1)
                                DEVPOS(13,01);DEVOUT('Prazo estipulado....:')
                                DEVPOS(15,01);DEVOUT('Vlr. Multa+Juros..R$:')
                                DEVPOS(16,01);DEVOUT('Vlr. a Pagar......R$:')
                                IF mdata_sis<dupp->venc
                                        setcor(1)
                                        DEVPOS(14,01);DEVOUT('Faltam p/ Vencimento:')
                                        setcor(3)
                                        DEVPOS(14,23);DEVOUT(STRZERO(dupp->venc-mdata_sis,3)+' Dias.')
                                ELSE
                                        setcor(1)
                                        DEVPOS(14,01);DEVOUT('Atrazo do vencimento:')
                                        setcor(3)
                                        DEVPOS(14,23);DEVOUT(STRZERO(mdata_sis-dupp->venc,3)+' Dias.')
                                ENDIF
                                setcor(3)
                                DEVPOS(13,23);DEVOUT(STRZERO(dupp->venc-dupp->emissao,3)+' Dias.')
                                DEVPOS(15,23);DEVOUT(TRANSFORM(mmulta+mjuros,'9,999,999.99'))
                                DEVPOS(16,23);DEVOUT(TRANSFORM(mvlpago,'9,999,999.99'))
                        ENDIF
                        setcor(1)
                        mensagem('Pressione qualquer tecla p/retornar')
                        INKEY(0)
                        RESTSCREEN(00,00,24,79,tela1)
                        LOOP
                ELSE
                        CLEAR GETS
                        EXIT
                ENDIF
                GO TOP
                oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                ocolprod[1] := TBCOLUMNNEW('Tipo',{||dupp->tipo})
                ocolprod[2] := TBCOLUMNNEW('No.Docuemnto',{||dupp->duplicata})
                ocolprod[3] := TBCOLUMNNEW('Valor Doc.',{||TRANSFORM(dupp->valor,'999,999.99')})
                ocolprod[4] := TBCOLUMNNEW('Vencimento',{||DTOC(dupp->venc)})
                ocolprod[5] := TBCOLUMNNEW('Emissao',{||DTOC(dupp->emissao)})
                ocolprod[6] := TBCOLUMNNEW('Data Pag.',{||dupp->datpag})
                ocolprod[7] := TBCOLUMNNEW('Cod.',{||dupp->fornec})
                ocolprod[8] := TBCOLUMNNEW('Forncedor/Despesas',{||dupp->cliente})
                ocolprod[9] := TBCOLUMNNEW('Tipo Conta',{||dupp->tip_for})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,nkey,'dupp')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Tipo',{||dupp->tipo})
                        ocolprod[2] := TBCOLUMNNEW('No.Docuemnto',{||dupp->duplicata})
                        ocolprod[3] := TBCOLUMNNEW('Valor Doc.',{||TRANSFORM(dupp->valor,'999,999.99')})
                        ocolprod[4] := TBCOLUMNNEW('Vencimento',{||DTOC(dupp->venc)})
                        ocolprod[5] := TBCOLUMNNEW('Emissao',{||DTOC(dupp->emissao)})
                        ocolprod[6] := TBCOLUMNNEW('Data Pag.',{||dupp->datpag})
                        ocolprod[7] := TBCOLUMNNEW('Cod.',{||dupp->fornec})
                        ocolprod[8] := TBCOLUMNNEW('Forncedor/Despesas',{||dupp->cliente})
                        ocolprod[9] := TBCOLUMNNEW('Tipo Conta',{||dupp->tip_for})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
wvw_lclosewindow()
CLEAR GETS
RETURN NIL
******************************* f i m *********************************************
********************************
* FIM DA TECLA DE ATALHO
********************************
FUNCTION fimset()
*****************
SET KEY -2 TO
SET KEY -4 TO
SET KEY -5 TO
SET KEY -6 TO
SET KEY -7 TO
SET KEY -8 TO
SET KEY -40 TO
RETURN NIL
****************************** F I M **************************************
********************
* VALOR DO PEDIDO
***********************
FUNCTION juros_ped(mnum)
************************
LOCAL msele,morde,mvalor_p,malor_v,mvlr

msele := SELE()
morde := INDEXORD()

IF ! AbriArq('sacped_s','ped_s');RETURN NIL;ENDIF
***************
SELE('ped_s');ORDSETFOCUS(1)
GO TOP
***************
mvalor_p:=mvalor_v := mvlr := 0
IF ped_s->(DBSEEK(mnum))
        WHILE mnum = ped_s->pnum_ped .AND. ! EOF()
                mvalor_p := mvalor_p + (ped_s->pquantd*ped_s->ppre_venda)
                mvalor_v := mvalor_v + (ped_s->pquantd*ped_s->pvlr_fat)
                SKIP
        ENDDO
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
mvlr := mvalor_v - mvalor_p
RETURN mvlr
***************************** F I M ****************************************
*************************
* VER TOTAL DE COMPRAS
*************************
FUNCTION ver_compras(mcod)
*********************
LOCAL ver_compras:={}

sr_getconnection():exec("SELECT SUM(valor) FROM sacdupr WHERE fornec = "+sr_cdbvalue(STRZERO(mcod,5))+" AND datpag IS NULL",,.t.,@ver_compras)

RETURN ver_compras[1,1]
******************************** F I M ******************************
********************
* VERIFICA O PEDIDO
***********************
FUNCTION ver_ped(mnum,mcodprod,mmen,mtpo,mver)
**********************************************
LOCAL msele,morde

msele := SELE()
morde := INDEXORD()

IF ! AbriArq('sacped_s','ped_s');RETURN NIL;ENDIF
***************
SELE('ped_s');ORDSETFOCUS(1)
GO TOP
***************
IF mver <> NIL
        IF ped_s->(DBSEEK(mnum))
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ELSE
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF
ENDIF

IF mcodprod = NIL
        IF ped_s->(DBSEEK(mnum))
                WHILE mnum = ped_s->pnum_ped .AND. mtpo <> '*'
                        DEVPOS(PROW()+1,00);DEVOUT('Produto: '+ped_s->pcod_merc+'-'+ped_s->pmerc+'  Quantd.: '+TRANSFORM(ped_s->pquantd,'99,999.99')+' Pr.Unit.: '+TRANSFORM(ped_s->pvlr_fat,'99,999.99')+' Total: '+TRANSFORM(ped_s->pquantd*ped_s->pvlr_fat,'999,999.99') )
                        SKIP
                ENDDO
        ELSE
                IF mmen <> NIL
                        atencao('Nao existe este PEDIDO em nossos arquivos')
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RETURN .F.
                ENDIF
        ENDIF
ELSE
        IF ! ped_s->(DBSEEK(mnum+mcodprod))
                atencao('Este Produto nao existe neste PEDIDO')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
******************************** f i m **********************************
********************************
* FUNCAO P/CONSULTAR CLIENTES
********************************
#include "inkey.ch"              // constantes de codigos das teclas
FUNCTION f7_cli(mop)
*****************
LOCAL f7lci,f7cci,f7lba,f7cba,f7msele,f7morde,mprg:='F7_CLI',;
      oconsprod,ocolprod[6],f7i,f7nkey,f7opcao,mcodcli,mponto,mmens:='',c_cli:={},m_cli:={},;
      mcidade:=SPACE(20),point:=0,mcpfcnpj,mtelefone,mcolor,f7_contrato
MEMVAR mcod_cli
PRIVATE mcompras:=0

IF ! ver_nivel(mprg,'CONSULTA DE CLIENTES','12345',nivel_acess,,'AMBIE')
        RELEASE ALL
        wvw_lclosewindow()
        RETURN NIL
ENDIF

f7lci := f7cci := 0
f7lba := 37
f7cba := 119

f7msele := SELE()
f7morde := INDEXORD()
IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
IF ! AbriArq('sachist','hist');RETURN NIL;ENDIF
IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF

*************
SELE('cli');ORDSETFOCUS(2)
*************
mponto := RECNO()
*************
SELE('cli');ORDSETFOCUS(1)
GO BOTT
mcodcli:=cli->cod_cli
*************
*************
SELE('cli');ORDSETFOCUS(2)
GO mponto
*************
*/
/*
ccomm := 'SELECT * FROM saccli ORDER BY razao'
dbUseArea( .F.,"SQLRDD",cComm,"cli")
mcodcli:=cli->cod_cli
*/
setcor(1)
op_tela(00,01,48,119,memp_resa+SPACE(10)+' CLIENTES            Ult.Cliente:'+mcodcli+'  -  Quantidades: '+TRANSFORM(LASTREC(),'999,999'),,1)
oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba,'cli')
//oconsprod:colorspec := 'B/W,W/B,,,N/W'
//oconsprod:colorspec :="N*/W , W+/BG , W+/B , R+*/W , W*/W+ , RJ/W , W/B , R/N , B+*/W , RW*/W , N+*/W, BG+*/W, RG+*/W"
//          1       2      3      4       5       6     7     8      9       10      11     12      13
mcolor := "B/W*+ , W+/R+ , W*/B , R+/W+ , W*/W+ , RJ/W , W/B , R/N , B+*/W , RW*/W , N+*/W, BG+*/W, RG+*/W"
oconsprod:colorspec := mcolor

oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP  := CHR(179)
oconsprod:gotopblock({|| dbGoTop()})
oconsprod:gobottomblock({|| dbGoBottom()})
***brw:skipblock({|_1| MOV_PTR(_1)})
oconsprod:skipBlock:= {|nSkip| DbSkipper(nSkip) }

ocolprod[1] := TBCOLUMNNEW('Razao Social',{||cli->razao})
ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||cli->nome})
ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
ocolprod[4] := TBCOLUMNNEW('Tipo',{||cli->tipo})
ocolprod[5] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(cli->cgc),'CNPJ: '+TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99'),'CPF: '+TRANSFORM(cli->cpf,'@@R 999.999.999-99     '))})
ocolprod[6] := TBCOLUMNNEW('Ult.Atua.',{||DTOC(cli->data_atu)})
f7i:=0
FOR f7i=1 TO LEN(ocolprod)
        //oconsprod:ColorBlock := { || iif( oconsprod:RowPos % 2 > 0, {1,2},{3,4} ) }
        //oconsprod:ColorBlock := { || if ( mod(recno())>0, {1,2},{3,4} ) }
        oconsprod:ADDCOLUMN(ocolprod[f7i])
        //oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S','r/W,W/r,,,r/W*',{2,4})}")
        //oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")
        oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")

NEXT
WVW_SetMousePos(,00,00)
WVW_SetMouseMove(,.F.)

WvW_PBSetFont( NIL, "Courier New", 15, 0,)
nPBid := wvw_pbCreate(NIL,39,100,40,110, 'CONTRATOS',NIL,{||contratos(cli->cod_cli)})
//WVW_PBEnable( NIL, nPBId, .T. )

WHILE .T.
        exibi_prg('F7_CLI')
        IF mop = '*'
                mensagem('<P>esquisa - <I>nclusao - <ENTER>p/Alterar e Excluir - <C>Pesquisa por Cidade - <ESC>Retornar')
        ELSE
                mensagem('<P>esquisa - <I>nclusao - <C>Pesquisa por Cidade - <E>Pesq.p/Endereco - <ENTER> Confirma - <ESC>Retornar')
        ENDIF
        f7nkey := 0
        WHILE f7nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                mcompras := 0
                mcompras := ver_compras(VAL(cli->cod_cli))
                //mmens := ver_debito(VAL(cli->cod_cli))
                //botao(f7lba+1,f7cci,f7lba+7,f7cba,,' Detalhe '+IF(cli->bloqueio='S',' *** CREDITO BLOQUEADO *** ',IF(! EMPTY(mmens),mmens,'')))
                botao(f7lba+1,f7cci,48,f7cba)
                setcor(3)
                IF cli->bloqueio='S'
                        DEVPOS(ROW(),COL()+30);DEVOUT(' *** CREDITO BLOQUEADO EM '+DTOC(cli->data_bloq)+' *** ')
                ELSE
                        DEVPOS(ROW(),COL()+30);DEVOUT('                                                       ')
                ENDIF
                DEVPOS(f7lba+2,f7cci+1);DEVOUT('End.:')
                DEVPOS(f7lba+2,f7cci+50);DEVOUT('Bairro:')
                DEVPOS(f7lba+3,f7cci+1);DEVOUT('Cidade:')
                DEVPOS(f7lba+3,f7cci+30);DEVOUT('UF:')
                DEVPOS(f7lba+3,f7cci+37);DEVOUT('Tel.:')
                DEVPOS(f7lba+3,f7cci+57);DEVOUT('Tel.:')
                DEVPOS(f7lba+4,f7cci+1);DEVOUT('Limite:')
                DEVPOS(f7lba+4,f7cci+21);DEVOUT('Saldo Devedor:')
                DEVPOS(f7lba+4,f7cci+48);DEVOUT('Saldo:')
                DEVPOS(f7lba+5,f7cci+1);DEVOUT('Tabela de Cond.Pagamento:')
                DEVPOS(f7lba+6,f7cci+1);DEVOUT('Observacao:')
                setcor(1)
                DEVPOS(f7lba+2,f7cci+6);DEVOUT(cli->endereco+', '+RTRIM(cli->numero)+IF(! EMPTY(RTRIM(cli->complemento)),' - Compl.:'+RTRIM(cli->complemento),''))
                DEVPOS(f7lba+2,f7cci+57);DEVOUT(cli->bairro)
                DEVPOS(f7lba+3,f7cci+8);DEVOUT(cli->cidade)
                DEVPOS(f7lba+3,f7cci+33);DEVOUT(cli->uf)
                DEVPOS(f7lba+3,f7cci+42);DEVOUT(cli->tel1)
                DEVPOS(f7lba+3,f7cci+62);DEVOUT(cli->tel2)
                DEVPOS(f7lba+4,f7cci+9);DEVOUTPICT(cli->limite,'999,999.99')
                DEVPOS(f7lba+4,f7cci+36);DEVOUTPICT(mcompras,'999,999.99')
                DEVPOS(f7lba+4,f7cci+55);DEVOUTPICT(cli->limite-mcompras,'999,999.99')
                DEVPOS(f7lba+5,f7cci+27);DEVOUT(cli->cod_cond)
                ver_cond(VAL(cli->cod_cond),f7lba+5,f7cci+31,'*')
                DEVPOS(f7lba+6,f7cci+13);DEVOUT(cli->obs)
                DEVPOS(f7lba+7,f7cci+1);DEVOUT(cli->l_obs1)
                DEVPOS(f7lba+8,f7cci+1);DEVOUT(cli->l_obs2)
                IF ver_aniv(VAL(cli->cod_cli),1)
                        setcor(7,'*')
                        DEVPOS(f7lba+9,f7cci+33);DEVOUT(' ANIVERSARIANTE DO MES ')
                ENDIF
                IF ver_serie() = '141488'
                        IF cli->tipo = 'B'
                                WVW_DrawLabel(,f7lba+10,f7cci+33,'CLIENTE BRILHANTE',,,210,, 'Arial Black',35,20,,,,,)
                        ELSEIF cli->tipo = 'C'
                                WVW_DrawLabel(,f7lba+10,f7cci+33,'CLIENTE          ',,,210,, 'Arial Black',35,20,,,,,)
                        ELSEIF cli->tipo = 'D'
                                WVW_DrawLabel(,f7lba+10,f7cci+33,'CLIENTE DIAMANTE ',,,210,, 'Arial Black',35,20,,,,,)
                        ELSEIF cli->tipo = 'E'
                                WVW_DrawLabel(,f7lba+10,f7cci+33,'CLIENTE EXCLUIDO ',,,210,, 'Arial Black',35,20,,,,,)
                        ELSEIF cli->tipo = 'O'
                                WVW_DrawLabel(,f7lba+10,f7cci+33,'OUTROS           ',,,210,, 'Arial Black',35,20,,,,,)
                        ELSEIF cli->tipo = 'P'
                                WVW_DrawLabel(,f7lba+10,f7cci+33,'CLIENTE PEROLA   ',,,210,, 'Arial Black',35,20,,,,,)
                        ELSEIF cli->tipo = 'R'
                                WVW_DrawLabel(,f7lba+10,f7cci+33,'CLIENTE RUBI     ',,,210,, 'Arial Black',35,20,,,,,)
                        ELSE
                                limpa(47,11,48,50)
                        ENDIF
                ENDIF
                WVW_DrawLabel(,38,85,'C'+cli->cod_cli+'.jpg',,,,, 'terminal',13,4,,,,,)
                botao(39,80,47,97)
                IF FILE(ALLTRIM(m_cfg[60])+'C'+cli->cod_cli+'.jpg')
                        WVW_DrawImage( ,39,80,47,97,m_cfg[60]+'C'+cli->cod_cli+'.jpg',.T.,.F.)
                ELSE
                        WVW_DrawImage( ,39,80,47,97,m_cfg[60]+'C'+cli->cod_cli+'.bmp',.T.,.F.)
                ENDIF
                WVW_DrawLabel(,48,85,'<ALT+F>p/Ampliar',,,,, 'terminal',13,4,,,,,)
                setcor(1)

                f7_contrato := {}
                sr_getconnection():exec("SELECT * FROM contrato WHERE codcli = "+sr_cdbvalue(cli->cod_cli),,.t.,@f7_contrato)
                IF LEN(f7_contrato) = 0
                        WVW_PBEnable( NIL, nPBId, .F. )
                ELSE
                        WVW_PBEnable( NIL, nPBId, .T. )
                ENDIF
                f7nkey := INKEY(0)
        ENDDO
        IF f7nkey == K_ESC
                EXIT
        ELSEIF f7nkey = 112 .OR. f7nkey = 80
                op_tela(00,00,33,100,memp_resa+SPACE(40)+' CONSULTA DE CLIENTES ')
                CLEAR GETS
                WHILE .T.
                        mcod_cl         := 0
                        mrazao          := mfantasia := mcidade := mendereco := SPACE(40)
                        mcpfcnpj        := mtelefone := minsc := SPACE(14)
                        limpa(0,0,31,99)
                        mensagem('Digite a descricao ou *descricao p/Pesquisa qualquer lugar da descricao')
                        setcor(1)
                        DEVPOS(00,01);DEVOUT('Codigo Cliente:')
                        DEVPOS(01,01);DEVOUT('Razao Social..:')
                        DEVPOS(02,01);DEVOUT('Nome Fantasia.:')
                        DEVPOS(03,01);DEVOUT('Cidade........:')
                        DEVPOS(04,01);DEVOUT('Endereco......:')
                        DEVPOS(05,01);DEVOUT('CPF/CNPJ......:')
                        DEVPOS(05,32);DEVOUT('Inscricao Est.:')
                        DEVPOS(06,01);DEVOUT('Telefone......:')
                        setcor(3)
                        @ 07,00 TO 07,100
                        DEVPOS(08,01);DEVOUT('Razao Social                             Fantasia                                  Codigo  Cidade                 CPF/CNPJ')
                        @ 09,00 TO 09,100
                        @ 32,00 TO 32,100
                        DEVPOS(33,01);DEVOUT('Total de Clientes:')
                        DEVPOS(33,27);DEVOUT('Tempo da Pesquisa:')
                        setcor(1)
                        @ 00,17 GET mcod_cl PICT '99999'
                        @ 01,17 GET mrazao PICT '@!' WHEN EMPTY(mcod_cl)
                        @ 02,17 GET mfantasia PICT '@!' WHEN EMPTY(mcod_cl)
                        @ 03,17 GET mcidade PICT '@!' WHEN EMPTY(mcod_cl)
                        @ 04,17 GET mendereco PICT '@!' WHEN EMPTY(mcod_cl)
                        @ 05,17 GET mcpfcnpj PICT '@!' WHEN EMPTY(mcod_cl) .AND. EMPTY(mrazao) .AND. EMPTY(mfantasia) .AND. EMPTY(mcidade) .AND. EMPTY(mendereco)  .AND. men_get(0,0,'Digite o CNPJ ou CPF sem pontos e Hifens') VALID  lim_get()
                        @ 05,48 GET minsc PICT '@!' WHEN EMPTY(mcod_cl) .AND. EMPTY(mrazao) .AND. EMPTY(mfantasia) .AND. EMPTY(mcidade) .AND. EMPTY(mendereco)  .AND. men_get(0,0,'Digite a INSCRICAO sem pontos e Hifens') VALID  lim_get()
                        @ 06,17 GET mtelefone PICT '@!' WHEN EMPTY(mcod_cl) .AND. EMPTY(mcpfcnpj) .AND. EMPTY(minsc)
                        READ
                        IF LASTKEY() = 27
                                CLEAR GETS
                                EXIT
                        ENDIF
                        IF EMPTY(mcod_cl) .AND. EMPTY(mrazao) .AND. EMPTY(mfantasia) .AND. EMPTY(mcidade) .AND. EMPTY(mendereco) .AND. EMPTY(mcpfcnpj) .AND. EMPTY(mtelefone) .AND. EMPTY(minsc)
                                LOOP
                        ENDIF
                        mhoras := TIME()
                        cComm  := "SELECT * FROM saccli WHERE cod_cli IS NOT NULL"
                        IF ! EMPTY(mcod_cl)
                                ccomm := ccomm + " AND cod_cli = "+sr_cdbvalue(STRZERO(mcod_cl,5))
                        ELSE
                                IF ! EMPTY(mcpfcnpj)
                                        mcpfcnpj := STRTRAN(mcpfcnpj,'.','')
                                        mcpfcnpj := STRTRAN(mcpfcnpj,'-','')
                                        mcpfcnpj := STRTRAN(mcpfcnpj,'/','')
                                        IF LEN(ALLTRIM(mcpfcnpj)) < 14
                                                ccomm := ccomm + " AND cpf LIKE "+sr_cdbvalue('%'+ALLTRIM(mcpfcnpj)+'%')
                                        ELSE
                                                ccomm := ccomm + " AND cgc LIKE "+sr_cdbvalue('%'+ALLTRIM(mcpfcnpj)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(minsc)
                                        minsc := STRTRAN(minsc,'.','')
                                        minsc := STRTRAN(minsc,'-','')
                                        minsc := STRTRAN(minsc,'/','')
                                        ccomm := ccomm + " AND insc LIKE "+sr_cdbvalue('%'+ALLTRIM(minsc)+'%')
                                ENDIF
                                IF ! EMPTY(mtelefone)
                                        ccomm := ccomm + " AND (tel1 LIKE "+sr_cdbvalue('%'+ALLTRIM(mtelefone)+'%')+" OR tel2 LIKE "+sr_cdbvalue('%'+ALLTRIM(mtelefone)+'%')+")"
                                ENDIF
                                IF ! EMPTY(mrazao)
                                        IF SUBSTR(mrazao,1,1) = '*'
                                                ccomm := ccomm + " AND razao LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mrazao,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND razao LIKE "+sr_cdbvalue(ALLTRIM(mrazao)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(mfantasia)
                                        IF SUBSTR(mfantasia,1,1) = '*'
                                                ccomm := ccomm + " AND nome LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mfantasia,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND nome LIKE "+sr_cdbvalue(ALLTRIM(mfantasia)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(mcidade)
                                        IF SUBSTR(mcidade,1,1) = '*'
                                                ccomm := ccomm + " AND cidade LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mcidade,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND cidade LIKE "+sr_cdbvalue(ALLTRIM(mcidade)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(mendereco)
                                        IF SUBSTR(mendereco,1,1) = '*'
                                                ccomm := ccomm + " AND endereco LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mendereco,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND endereco LIKE "+sr_cdbvalue(ALLTRIM(mendereco)+'%')
                                        ENDIF
                                ENDIF
                        ENDIF
                        ccomm := ccomm + " ORDER BY razao"
                        cons_m := {}
                        sr_getconnection():exec(ccomm,,.t.,@cons_m)
                        IF LEN(cons_m) = 0
                                atencao('Nao foi encontrado nenhum CLIENTE ...')
                                LOOP
                        ENDIF
                        m_prod := {}
                        m_pos  := {}
                        point  := i := 0
                        DEVPOS(33,20);DEVOUT(STRZERO(LEN(cons_m),5))
                        DEVPOS(33,46);DEVOUT(ELAPTIME(mhoras,TIME()))
                        FOR i = 1 TO LEN(cons_m)
                                AADD(m_prod,' '+cons_m[i,3];
                                           +' '+cons_m[i,4];
                                           +'  '+cons_m[i,2];
                                           +'  '+cons_m[i,24];
                                           +'  '+IF(! EMPTY(cons_m[i,32]),cons_m[i,32],cons_m[i,34]))
                                AADD(m_pos,cons_m[i,141])
                        NEXT
                        point := ACHOICE(10,0,30,100,m_prod,,,point)
                        DO CASE
                                CASE LASTKEY()=27
                                        LOOP
                                CASE LASTKEY() = 13
                                        *************
                                        SELE('cli');ORDSETFOCUS(2)
                                        *************
                                        GO m_pos[point]
                                        EXIT
                        ENDCASE
                ENDDO
                wvw_lclosewindow()
                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba,'cli')
                oconsprod:colorspec :=mcolor
                ocolprod[1] := TBCOLUMNNEW('Razao Social',{||cli->razao})
                ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||cli->nome})
                ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
                ocolprod[4] := TBCOLUMNNEW('Tipo',{||cli->tipo})
                ocolprod[5] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(cli->cgc),'CNPJ: '+TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99'),'CPF: '+TRANSFORM(cli->cpf,'@@R 999.999.999-99     '))})
                ocolprod[6] := TBCOLUMNNEW('Ult.Atua.',{||DTOC(cli->data_atu)})
                f7i:=0
                FOR f7i=1 TO LEN(ocolprod)
                        //oconsprod:ColorBlock := { || iif( oconsprod:RowPos % 2 > 0, {1,2},{3,4} ) }
                        //oconsprod:ColorBlock := { || if ( mod(recno())>0, {1,2},{3,4} ) }
                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                        //oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S','r/W,W/r,,,r/W*',{2,4})}")
                        //oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")
                        oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF f7nkey = 73 .OR. f7nkey = 105     // I
                sac130()
                c_cli:={}
                sr_getconnection():exec("SELECT COUNT(*) FROM saccli",,.t.,@c_cli)
                GO c_cli[1,1]
                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba,'cli')
                oconsprod:colorspec :=mcolor
                ocolprod[1] := TBCOLUMNNEW('Razao Social',{||cli->razao})
                ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||cli->nome})
                ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
                ocolprod[4] := TBCOLUMNNEW('Tipo',{||cli->tipo})
                ocolprod[5] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(cli->cgc),'CNPJ: '+TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99'),'CPF: '+TRANSFORM(cli->cpf,'@@R 999.999.999-99     '))})
                ocolprod[6] := TBCOLUMNNEW('Ult.Atua.',{||DTOC(cli->data_atu)})
                f7i:=0
                FOR f7i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                        oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF f7nkey = 289
                smedalbum('C',cli->cod_cli,cli->razao,m_cfg[60],m_cfg[5]+'\CLIENTE\')
                WVW_SetMousePos(,00,00)
                WVW_SetMouseMove(,.F.)
        ELSEIF f7nkey == K_ENTER
                *************
                SELE('cli');ORDSETFOCUS(2)
                *************
                mcod_cli := VAL(cli->cod_cli)
                IF mop = '*'
                        f7opcao := mensagem1('Deseja <A>lterar <E>xcluir:','A','A,E')
                        IF LASTKEY() = 27
                                LOOP
                        ELSEIF f7opcao = 'A'
                                sac131()
                        ELSEIF f7opcao = 'E'
                                sac132()
                        ENDIF
                ELSE
                        CLEAR GETS
                        EXIT
                ENDIF
                setcor(1)
                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba,'cli')
                oconsprod:colorspec :=mcolor
                ocolprod[1] := TBCOLUMNNEW('Razao Social',{||cli->razao})
                ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||cli->nome})
                ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
                ocolprod[4] := TBCOLUMNNEW('Tipo',{||cli->tipo})
                ocolprod[5] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(cli->cgc),'CNPJ: '+TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99'),'CPF: '+TRANSFORM(cli->cpf,'@@R 999.999.999-99     '))})
                ocolprod[6] := TBCOLUMNNEW('Ult.Atua.',{||DTOC(cli->data_atu)})
                f7i:=0
                FOR f7i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                        oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,f7nkey,'cli')
                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba,'cli')
                        oconsprod:colorspec :=mcolor
                        ocolprod[1] := TBCOLUMNNEW('Razao Social',{||cli->razao})
                        ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||cli->nome})
                        ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
                        ocolprod[4] := TBCOLUMNNEW('Tipo',{||cli->tipo})
                        ocolprod[5] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(cli->cgc),'CNPJ: '+TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99'),'CPF: '+TRANSFORM(cli->cpf,'@@R 999.999.999-99     '))})
                        ocolprod[6] := TBCOLUMNNEW('Ult.Atua.',{||DTOC(cli->data_atu)})
                        f7i:=0
                        FOR f7i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                                oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f7msele);IF(f7morde>0,ORDSETFOCUS(f7morde),)
RELEASE f7tela,f7tela1,f7lci,f7cci,f7lba,f7cba,f7msele,f7morde,f7men,oconsprod,ocolprod[8],f7i,f7nkey,f7opcao,;
        mcompras:=0
WVW_PBDestroy( NIL, nPBId )
WVW_SetMouseMove(,.T.)
wvw_lclosewindow()
IF f7nkey == K_ESC
        RETURN NIL
ELSE
        CLEAR GETS
        RETURN mcod_cli
ENDIF
RETURN NIL
******************************* f i m *********************************************
********************************************
* CONSULTA DE CLIENTES E PRODUTOS
********************************************
FUNCTION cliprod
****************
LOCAL li,ci,lb,cb,opcao,marq,;
      m_movimento:={},point,msele,morde
MEMVAR mcod_cli

li := ci := 0
lb := 17
cb := 61

msele := SELE()
morde := INDEXORD()
****************
SELE('tabme');ORDSETFOCUS(2)
GO TOP
****************
op_tela(0,0,19,61)

WHILE .T.
        IF ! tabme->(DBSEEK(STRZERO(mcod_cli,5)))
                atencao('Nao existe nenhum PRODUTO cadastrado neste cliente')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                EXIT
        ENDIF

        WHILE STRZERO(mcod_cli,5) = tabme->cod_cli .AND. ! EOF()
                ver_cod(VAL(tabme->codigo))
                AADD(m_movimento,' '+tabme->codigo+' '+merc->merc+' '+CHR(179)+'     '+TRANSFORM(tabme->desconto,'999.99'))
                SKIP
        ENDDO
        IF LEN(m_movimento) = 0
                atencao('Nao existe PRODUTO cadastrado netse CLIENTES !!!')
                EXIT
        ENDIF
        @ li+1,ci TO li+1,cb
        DEVPOS(li,ci+1);DEVOUT('Produto')
        DEVPOS(li,ci+53);DEVOUT('Desconto')
        setcor(1)
        WHILE .T.
                CLEAR TYPEAHEAD
                mensagem("<ESC> Retorna" )
                point := ACHOICE(li+3,ci+1,lb-1,cb-1,m_movimento)

                DO CASE
                        CASE LASTKEY()=27
                                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                                wvw_lclosewindow()
                                RETURN NIL
                ENDCASE
        ENDDO
ENDDO
wvw_lclosewindow()
RETURN NIL
******************************* F I M ***********************************
**********************************
* VER PROFISSAO
**********************************
FUNCTION ver_profi(mcod_p,li,ci)
********************************
LOCAL msele,morde

IF EMPTY(mcod_p); RETURN .T.;END

msele := SELE()
morde := INDEXORD()

***********************************************
IF ! AbriArq('sacprofi','profi');RETURN NIL;ENDIF
SELE('profi');ORDSETFOCUS(2)
GO TOP
***********************************************
IF ! profi->(DBSEEK(STRZERO(mcod_p,5)))
        atencao('Despesa nao Cadastrada !!!')
        mcod_p = 0
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ELSE
        IF li = NIL
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ELSE
                setcor(3)
                DEVPOS(li,ci);DEVOUT(profi->profi)
                setcor(1)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
ENDIF
RETURN NIL
************************************ F I M ************************************
********************
* VERIFICA SUB-GRUPO
********************
FUNCTION ver_sgru(vgru,vsgru,ld,cd,t)
**********************
LOCAL mcons_grupo:={},ccomm

IF EMPTY(vsgru)
        RETURN .T.
ENDIF
mcons_grupo:={}
cComm  := "SELECT * FROM sacgrupo WHERE gru_sub = "+sr_cdbvalue(STRZERO(vgru,3)+STRZERO(vsgru,2))
sr_getconnection():exec( cComm,,.t.,@mcons_grupo)

IF t = .T. .AND. LEN(mcons_grupo) > 0
        vsgru := 0
        atencao('Sub-Grupo ja Cadastrado !!!')
        RETURN .F.
ENDIF
IF LEN(mcons_grupo) = 0
        vsgru := 0
        IF t = .T.
                atencao('Sub-Grupo nao Cadastrado !!!')
        ENDIF
        RETURN .F.
ENDIF
setcor(3)
DEVPOS(ld,cd);DEVOUT(mcons_grupo[1,2])
setcor(1)
RETURN .T.
**************** f i m **********************************
********************************
* FUNCAO P/CONSULTAR MERCADORIAS
********************************
#include "inkey.ch"              // constantes de codigos das teclas

FUNCTION f4_merc(cons,mdcri,mvar_atac,mpercentual,prod)
******************************************************
LOCAL f4tela,f4tela1,f4lci,f4cci,f4lba,f4cba,f4msele,f4morde,f4men,y,mcod,;
      oconsprod,ocolprod[9],i,nkey,mteste,f4,lin_br,mopcao:=' ',mprec:=0,mcodmerc,mreg,;
      local4,mtela_help,mtela_lin,mcor_ant,mvlr_dolar:=1,stop:=' ',;
      nErr, nPos,cComm,owindows,cons_m:={},m_prod:={},mcondicao:='  ',;
      mhoras:='',menuid,mvalor_fatura:=0,cons_mov,f4_botao,mindice:=' '

STATIC mdescri:='              ',mdescri1:='              '

MEMVAR mdata_sis,nivel_acess,mcod_merc,mcod_bc
PRIVATE mcod_forn := 0,point:=0,m_pos:={}
***********************************************
//IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF
***********************************************
Local4:= Space(0)
f4 := '*'
f4lci := 6
f4cci := 0
f4lba := 22
f4cba := 100 //79
f4msele := SELE()
f4morde := INDEXORD()
mcor_ant := SETCOLOR()
mvlr_dolar := IF(ver_dolar(mdata_sis)=0,1,ver_dolar(mdata_sis))
setcor(1)
exibi_prg('F4_MERC')
op_tela(03,00,48,120,memp_resa+SPACE(10)+' PRODUTOS '+IF(mvar_atac='2','Venda ATACADO','Venda VAREJO')+'  -  Quantidades Produtos: '+TRANSFORM(LASTREC(),'999,999'),,1)
WVW_TBCreate( , .T.,TBSTYLE_LIST            , 0,3,3)
WVW_TBAddButton( ,1900,' ','INCLUSAO DE PRODUTOS',1)
//WVW_TBAddButton( ,1901,' ','Resumo Produto',1)
MenuId:=WVW_GETLASTMENUEVENT()
f4msele := SELE()
f4morde := INDEXORD()
//mflag := 0
CLEAR GETS

//WvW_PBSetFont( NIL, "Courier New", 15, 0,)
//f4_botao := wvw_pbCreate(NIL,39,100,40,110, 'FOTOS',NIL,{||teste()})

WHILE .T.
        mcod_bc := SPACE(14)
        IF mdcri <> NIL
                mdescri := mdcri
        ENDIF
        mcondicao := 'E '
        mcod_forn := mvalor_fatura := 0
        limpa(0,0,50,120)
        mensagem('Digite: *descricao - #descricao p/(Aplicacao) - R=Descricao p/(Ref.) - [III] Inclusao Prod. - [CTRL+Y]Apagar Descricao')
        setcor(1)
        DEVPOS(00,01);DEVOUT('Descricao.....:')
        DEVPOS(00,38);DEVOUT('Condicao:')
        DEVPOS(01,01);DEVOUT('Cod.Fabricante:')
        DEVPOS(02,01);DEVOUT('Codigo Produto:')
        setcor(3)
        @ 03,00 TO 03,120
        DEVPOS(04,01);DEVOUT('Descricao                               Codigo         Saldo       Preco  Prc.Aprazo     Referencia  Disp IAT IPPT Aliq.')
        @ 05,00 TO 05,120
        @ 43,00 TO 43,120
        DEVPOS(44,01);DEVOUT('Total de Produtos:')
        DEVPOS(44,27);DEVOUT('Tempo da Pesquisa:')
        setcor(1)

        WVW_PBEnable( NIL, f4_botao, .F. )

        //DEVPOS(04,00);DEVOUT('Cod.Especie...:')
        @ 00,17 GET mdescri PICT '@!KS14' WHEN mdcri = NIL
        @ 00,47 GET mcondicao PICT '@!' VALID mcondicao $ 'OU,E ,  ' WHEN SUBSTR(mdescri,1,1) = '*' .AND. men_get(0,0,'Digite: [E] ou [OU]') .AND. mdcri = NIL
        @ 00,50 GET mdescri1 PICT '@!KS14' WHEN SUBSTR(mdescri,1,1) = '*' .AND. ! EMPTY(mcondicao) .AND. mdcri = NIL //VALID IF(EMPTY(mdescri1),.F.,.T.)
        @ 01,17 GET mcod_forn PICT '9999' VALID v_fornece(mcod_forn,01,22) WHEN mdcri = NIL
        @ 02,17 GET mcod_bc PICT '@!' WHEN EMPTY(mdescri) .AND. EMPTY(mcod_forn) .AND. mdcri = NIL
        READ
        IF MenuId=1900 .OR. mdescri = 'III'       // BOTAO INCLUSAO
                sac110()
                Menuid := 0
                LOOP
        ENDIF
        IF LASTKEY() = 27
                wvw_lclosewindow()
                CLEAR GETS
                RETURN ' '
        ENDIF
        IF EMPTY(mcod_bc) .AND. EMPTY(mdescri) .AND. EMPTY(mcod_forn)
                LOOP
        ENDIF
        mhoras := TIME()
        mensagem('Escolha o produto e tecle <ENTER> ou <ESC> p/Abandonar')
        cComm  := "SELECT * FROM sacmerc WHERE "
        IF ! EMPTY(mcod_bc)
                IF LEN(RTRIM(mcod_bc)) > 5 .OR. VAL(mcod_bc) = 0
                        ccomm := ccomm + " cod_barr = "+sr_cdbvalue(mcod_bc)
                ELSE
                        ccomm := ccomm + " cod_merc = "+sr_cdbvalue(STRZERO(VAL(mcod_bc),5))
                ENDIF
        ELSE

                IF SUBSTR(mdescri,1,1) = '*'
                        IF ! EMPTY(mcondicao) .AND. ! EMPTY(mdescri1)
                                IF mcondicao = 'E '
                                        ccomm := ccomm + " (merc LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mdescri,2))+'%')+" AND merc LIKE "+sr_cdbvalue('%'+ALLTRIM(mdescri1)+'%')+")"
                                ELSE
                                        ccomm := ccomm + " (merc LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mdescri,2))+'%')+" OR merc LIKE "+sr_cdbvalue('%'+ALLTRIM(mdescri1)+'%')+")"
                                ENDIF
                        ELSE
                                ccomm := ccomm + " merc LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mdescri,2))+'%')
                        ENDIF
                ELSEIF SUBSTR(mdescri,1,1) = '#'
                        ccomm := ccomm + " aplic0 LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mdescri,2))+'%')
                ELSEIF SUBSTR(mdescri,1,2) = 'R='
                        ccomm := ccomm + " ref LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mdescri,3))+'%')
                ELSEIF ! EMPTY(mdescri)
                        ccomm := ccomm + " merc LIKE "+sr_cdbvalue(ALLTRIM(mdescri)+'%')
                ENDIF
                IF ! EMPTY(mcod_forn)
                        ccomm := ccomm + IF(! EMPTY(mdescri)," AND ",'')+" cod_fab = "+sr_cdbvalue(STRZERO(mcod_forn,4))
                ENDIF
        ENDIF
        IF cons = NIL .AND. EMPTY(mcod_bc)
                ccomm := ccomm + " AND NOT disp = 'N'"
                ccomm := ccomm + " AND (descont = 'N' OR descont IS NULL OR descont = ' ')"
        ENDIF
        ccomm := ccomm + " ORDER BY merc"
        cons_m := {}
        sr_getconnection():exec(ccomm,,.t.,@cons_m)
        IF LEN(cons_m) = 0
                atencao('Nao foi encontrado nenhum PRODUTO..')
                LOOP
        ENDIF
        IF cons_m[1,24] = 'N' .AND. cons = NIL //! EMPTY(mcod_bc)
                atencao('Este PRODUTO Nao Disponivel para Venda..')
                LOOP
        ENDIF
        IF cons_m[1,104] = 'S' .AND. (LEN(RTRIM(mcod_bc)) > 5 .OR. VAL(mcod_bc) = 0) .AND. EMPTY(mdescri)
                atencao('PRODUTO: '+cons_m[1,8]+'-'+cons_m[1,9]+' *** D E S C O N T I N U A D O *** ....',3)
                LOOP
        ENDIF
        IF mpercentual = NIL
                mvar_atac := '1'
                mpercentual:=0
        ENDIF
        m_prod := {}
        m_pos  := {}
        point  := 0
        DEVPOS(44,20);DEVOUT(STRZERO(LEN(cons_m),5))
        DEVPOS(44,46);DEVOUT(ELAPTIME(mhoras,TIME()))
        FOR i = 1 TO LEN(cons_m)
                mvlr_prz := cons_m[i,46] * ((cons_m[i,47]/100) + 1)
                mvalor_fatura := IF(mvar_atac = '1',(cons_m[i,46]*IF(cons_m[i,84] = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),(mvlr_prz*IF(cons_m[i,84] = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1))
                IF ! EMPTY(cons_m[i,65])
                        mvalor_fatura := mvalor_fatura * ((cons_m[i,65]/100)+1)
                ENDIF

                mvalor_fatura := IAT(mvalor_fatura,cons_m[i,81])

                //IF m_set[1,47] > 0
                        mvlr_prz := mvalor_fatura * ((cons_m[i,47]/100) + 1)
                //ENDIF

                IF cons_m[i,61] = 'N'
                        IF ! EMPTY(cons_m[i,62])
                                mindice := TRANSFORM(cons_m[i,62],'99.99')
                        ELSE
                                mindice := TRANSFORM(17,'99.99')
                        ENDIF
                ELSEIF cons_m[i,61] = 'S'
                        mindice := '  I'
                ELSEIF cons_m[i,61] = 'T'
                        mindice := '  N'
                ELSEIF cons_m[i,61] = 'F'
                        mindice := '  F'
                ENDIF
                AADD(m_prod,' '+cons_m[i,9];
                           +' '+cons_m[i,8]+'   '+TRANSFORM(cons_m[i,56],'999,999.999');
                           +' '+TRANSFORM(mvalor_fatura,ALLTRIM(m_set[1,98])) + IF(cons_m[i,84] = 'S',' D','');
                           +' '+TRANSFORM(mvlr_prz,ALLTRIM(m_set[1,98]));
                           +' '+cons_m[i,14];
                           +' '+cons_m[i,6];
                           +' '+cons_m[i,24];
                           +'   '+cons_m[i,81];
                           +'    '+cons_m[i,91];
                           +' '+mindice)
                        AADD(m_pos,cons_m[i,8])
        NEXT

        //WVW_PBEnable( NIL, f4_botao, .T. )

        point := ACHOICE(6,0,42,120,m_prod,,,point)

        DO CASE
                CASE LASTKEY()=27
                        LOOP
                CASE LASTKEY() = 13
                        mcod_merc := VAL(m_pos[point])
                        mcod_bc := m_pos[point]
                        IF cons <> NIL
                                mopcao := mensagem1('Tecle [A] p/ Alteracao [E] p/ Exclusao:','A','A,E')
                                IF LASTKEY() = 27
                                        LOOP
                                ENDIF
                                IF mopcao = 'A'
                                        sac111(mcod_merc)
                                ELSEIF mopcao = 'E'
                                        cons_mov:={}
                                        sr_getconnection():exec("SELECT * FROM sacmov WHERE codigo = "+sr_cdbvalue(STRZERO(mcod_merc,5)),,.t.,@cons_mov)
                                        IF LEN(cons_mov) > 0
                                                IF op_simnao('N','Existe Movimento deste PRODUTO deseja EXCLUIR mesmo assim:') = 'S'
                                                        IF ! aut_sen('Autorizacao para EXCLUSAO DE PRODUTO com Movimento','EXCPRDMOV')
                                                                UNLOCK
                                                                LOOP
                                                        ENDIF
                                                ELSE
                                                        LOOP
                                                ENDIF
                                        ENDIF
                                        sac112(mcod_merc)
                                ENDIF
                        ELSEIF prod <> NIL
				f8_prod(mcod_merc,1)
			ELSE
                                wvw_lclosewindow()
                                CLEAR GETS
                                RETURN VAL(m_pos[point])
                        ENDIF
        ENDCASE
END
RELEASE f4tela,f4tela1,f4lci,f4cci,f4lba,f4cba,f4msele,f4morde,f4men,mcod,;
        oconsprod,ocolprod[8],i,nkey,mteste
wvw_lclosewindow()
CLEAR GETS
RETURN ' '
**************** f i m **********************************
/*
FUNCTION teste()

ATENCAO(strzero(point,5))
sac111(VAL(m_pos[point]))
RETURN NIL
*/

**************** f i m **********************************
#include "inkey.ch"              // constantes de codigos das teclas
********************************
* FUNCAO P/CONSULTAR MERCADORIAS
********************************
FUNCTION f4_merc1(cons,mfab,mvar_atac,mpercentual)
*****************
LOCAL f4tela,f4tela1,f4lci,f4cci,f4lba,f4cba,f4msele,f4morde,f4men,y,mcod,;
      oconsprod,ocolprod[9],i,nkey,mteste,f4,lin_br,mopcao:=' ',mprec:=0,mcodmerc,mreg,;
      local4,mtela_help,mtela_lin,mcor_ant,mvlr_dolar:=1,stop:=' ',;
      nErr, nPos,vEmp := {},nCnn,oSql,;
      cComm, apCode,owindows,mdescri:=SPACE(40)

MEMVAR mdata_sis,nivel_acess,mcod_merc,mcod_bc

Local4:= Space(0)
f4 := '*'
f4lci := f4cci := 0
f4lba := 22
f4cba := 100 //79
f4msele := SELE()
f4morde := INDEXORD()
mcor_ant := SETCOLOR()
mvlr_dolar := IF(ver_dolar(mdata_sis)=0,1,ver_dolar(mdata_sis))
IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF
*************
SELE('merc');ORDSETFOCUS(3)
ORDSETFOCUS(3)
*************
IF mfab <> NIL
        *************
        ORDSETFOCUS(4)
        *************
ENDIF
IF mpercentual = NIL
        mvar_atac := '1'
        mpercentual:=0
ENDIF
setcor(1)
exibi_prg('F4_MERC')
//op_tela(00,00,33,100,memp_resa+SPACE(40)+' PRODUTOS '+IF(mvar_atac='2','Venda ATACADO','Venda VAREJO')+' - Quantd.Reg.: '+TRANSFORM(LEN(aret),'999,999') )
op_tela(00,00,33,100,memp_resa+SPACE(10)+' PRODUTOS '+IF(mvar_atac='2','Venda ATACADO','Venda VAREJO')+' - Quantd.Reg.: '+TRANSFORM(LASTREC(),'999,999') )
setcor(3)

oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
//oconsprod := TBROWSENEW(f4lci,f4cci,f4lba-1,f4cba,'merc')
ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N','** NAO DISPONIVEL **'+LEFT(merc->merc,20),IF(merc->descont = 'S','**  DESCONTINUADO **'+LEFT(merc->merc,20),merc->merc))})
ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->cod_merc})
ocolprod[3] := TBCOLUMNNEW('    Saldo',{||TRANSFORM(merc->saldo_mer,'9,999,999.999')},,IF(merc->saldo_mer <= 0,setcor(3),setcor(1)))

ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||IF(mvar_atac = '1',TRANSFORM(ROUND((merc->pr_venda*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])),;
                                        TRANSFORM(ROUND((merc->pr_venda1*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))+IF(merc->dolar = 'S',' D','')})
ocolprod[5] := TBCOLUMNNEW('UN',{||merc->unidade})
ocolprod[6] := TBCOLUMNNEW('Referencia',{||merc->ref})

ocolprod[7] := TBCOLUMNNEW(' Preco R$',{||IF(mvar_atac='2',TRANSFORM(ROUND((merc->pr_venda*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])),;
                                          TRANSFORM(ROUND((merc->pr_venda1*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))})
ocolprod[8] := TBCOLUMNNEW('Producao',{||TRANSFORM(merc->saldo_est,'999999.999')})
ocolprod[9] := TBCOLUMNNEW('Estoque1',{||TRANSFORM(merc->saldo_fis,'999999.999')})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
//oconsprod:CARGO := '*****'
oconsprod:FORCESTABLE()
WHILE .T.
        mensagem('Pesquisa: <Alt+P>Codigo - <ALT+E>Especie - <ALT+A>Avancada - <Alt+I>Inclusao - <Alt+H>Ajuda - <F4>Descricao')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()

                setcor(3)
                DEVPOS(f4lba,f4cci+1);DEVOUT('Pesquisa:  ')
                setcor(1)
                WVW_DrawBoxGet(,f4lba,f4cci+12,38)
                botao(f4lba+1,f4cci,f4lba+11,f4cba-1)     //8

                DEVPOS(f4lba+1,f4cci+1);DEVOUT('Descricao Nota:')
                DEVPOS(f4lba+2,f4cci+1);DEVOUT('Grupo.........:      Sub-Grupo:')
                //DEVPOS(f4lba+3,f4cci+1);DEVOUT('Sub-Grupo.....:')
                DEVPOS(f4lba+4,f4cci+1);DEVOUT('Codigo Barra:')
                DEVPOS(f4lba+4,f4cci+32);DEVOUT('Un:')
                DEVPOS(f4lba+4,f4cci+45);DEVOUT('Fab.:')
                DEVPOS(f4lba+7,f4cci+1);DEVOUT('Aplicacao:')
                setcor(3)
                DEVPOS(f4lba+1,f4cci+16);DEVOUT(merc->descri)
                DEVPOS(f4lba+2,f4cci+16);DEVOUT(SUBSTR(merc->gru_sub,1,3))
                DEVPOS(f4lba+2,f4cci+32);DEVOUT(SUBSTR(merc->gru_sub,4,2))
                DEVPOS(f4lba+4,f4cci+16);DEVOUT(merc->cod_barr)
                DEVPOS(f4lba+4,f4cci+36);DEVOUT(merc->unidade)
                DEVPOS(f4lba+4,f4cci+50);DEVOUT(merc->cod_fab+'-'+LEFT(merc->fabrica,23))
                IF nivel_acess = '1'
                        setcor(1)
                        DEVPOS(f4lba+6,f4cci+1);DEVOUT('V.M.: ')
                        DEVPOS(f4lba+6,f4cci+25);DEVOUT('C.M.: ')
                        DEVPOS(f4lba+6,f4cci+50);DEVOUT('C.R.: ')
                        setcor(3)
                        DEVPOS(f4lba+6,f4cci+07);DEVOUT(TRANSFORM(merc->vlr_merc,ALLTRIM(m_set[1,98])))
                        DEVPOS(f4lba+6,f4cci+31);DEVOUT(TRANSFORM(merc->cust_merc,ALLTRIM(m_set[1,98])))
                        DEVPOS(f4lba+6,f4cci+56);DEVOUT(TRANSFORM(merc->cust_real,ALLTRIM(m_set[1,98])))
                ENDIF
                DEVPOS(f4lba+7,f4cci+11);DEVOUT(merc->aplic0)
                DEVPOS(f4lba+8,f4cci+11);DEVOUT(merc->aplic1)
                DEVPOS(f4lba+9,f4cci+11);DEVOUT(merc->aplic2)
                DEVPOS(f4lba+10,f4cci+11);DEVOUT(merc->aplic3)
                setcor(1)
                IF ! EMPTY(merc->promocao)
                        setcor(6)
                        DEVPOS(f4lba+11,f4cci+56);DEVOUT(' Promocao ')
                        setcor(1)
                ELSE
                        setcor(3)
                        DEVPOS(f4lba+11,f4cci+56);DEVOUT('          ')
                        setcor(1)
                ENDIF
                WVW_DrawLabel(,23,85,'P'+merc->cod_merc+'.jpg',,,,, 'terminal',13,4,,,,,)
                botao(24,82,32,98)
                IF FILE(ALLTRIM(m_cfg[61])+'P'+merc->cod_merc+'.jpg')
                        WVW_DrawImage( ,24,82,32,98,ALLTRIM(m_cfg[61])+'P'+merc->cod_merc+'.jpg',.T.,.F.)
                        WVW_DrawLabel(,33,85,'<ALT+F>p/Ampliar',,,,, 'terminal',13,4,,,,,)
                ELSEIF FILE(ALLTRIM(m_cfg[61])+'P'+merc->cod_merc+'.bmp')
                        WVW_DrawImage( ,24,82,32,98,ALLTRIM(m_cfg[61])+'P'+merc->cod_merc+'.bmp',.T.,.F.)
                        WVW_DrawLabel(,33,85,'<ALT+F>p/Ampliar',,,,, 'terminal',13,4,,,,,)
                ENDIF
                 nkey := INKEY(0)
        END
        IF nkey == K_ESC
                wvw_lclosewindow()
                RETURN ' '
        ELSEIF nkey == 289
                smedalbum('P',merc->cod_merc,merc->merc,m_cfg[61],m_cfg[5]+'\PRODUTO\')
        ELSEIF nkey == K_ENTER
                //mcod_merc := VAL(merc->cod_merc)
                mcod_merc := VAL(merc->cod_merc)
                mcod_bc := merc->cod_merc
                IF EMPTY(mcod_merc)
                        LOOP
                ENDIF
                IF cons <> NIL
                        mopcao := mensagem1('Tecle [A] p/ Alteracao [E] p/ Exclusao:','A','A,E')
                        IF LASTKEY() = 27
                                LOOP
                        ENDIF
                        IF mopcao = 'A'
                                sac111(mcod_merc)
                        ELSEIF mopcao = 'E'
                                sac112(mcod_merc)
                        ENDIF
			IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF
                        *************
                        //SELE('merc');ORDSETFOCUS(3)
                        ORDSETFOCUS(3)
                        *************
                        oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba,'merc')
                        ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N',LEFT(merc->merc,20)+'** NAO DISPONIVEL **',merc->merc)})
                        ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->cod_merc})
                        ocolprod[3] := TBCOLUMNNEW('    Saldo',{||TRANSFORM(merc->saldo_mer,'9,999,999.999')})
                        ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||IF(mvar_atac = '1',TRANSFORM(ROUND((merc->pr_venda*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])),;
                                       TRANSFORM(ROUND((merc->pr_venda1*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))+IF(merc->dolar = 'S',' D','')})
                        ocolprod[5] := TBCOLUMNNEW('UN',{||merc->unidade})
                        ocolprod[6] := TBCOLUMNNEW('Referencia',{||merc->ref})

                        ocolprod[7] := TBCOLUMNNEW(' Preco R$',{||IF(mvar_atac='2',TRANSFORM(ROUND((merc->pr_venda*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])),;
                                          TRANSFORM(ROUND((merc->pr_venda1*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))})
                        ocolprod[8] := TBCOLUMNNEW('Producao',{||TRANSFORM(merc->saldo_est,'999999.999')})
                        ocolprod[9] := TBCOLUMNNEW('Estoque1',{||TRANSFORM(merc->saldo_fis,'999999.999')})
                        //ocolprod[10] := TBCOLUMNNEW('Tipo Produto',{||IF(merc->tipo_merc = '1','MERCADORIA','MATERIA PRIMA')})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ELSE
                        wvw_lclosewindow()
                        RETURN mcod_merc
                ENDIF
        ELSEIF nkey = 279
                ORDSETFOCUS(1)
                sac110()
                oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba,'merc')
                ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N',LEFT(merc->merc,20)+'** NAO DISPONIVEL **',merc->merc)})
                ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->cod_merc})
                ocolprod[3] := TBCOLUMNNEW('    Saldo',{||TRANSFORM(merc->saldo_mer,'9,999,999.999')})
                ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||IF(mvar_atac = '1',TRANSFORM(ROUND((merc->pr_venda*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])),;
                               TRANSFORM(ROUND((merc->pr_venda1*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))+IF(merc->dolar = 'S',' D','')})
                ocolprod[5] := TBCOLUMNNEW('UN',{||merc->unidade})
                ocolprod[6] := TBCOLUMNNEW('Referencia',{||merc->ref})

                ocolprod[7] := TBCOLUMNNEW(' Preco R$',{||IF(mvar_atac='2',TRANSFORM(ROUND((merc->pr_venda*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])),;
                                          TRANSFORM(ROUND((merc->pr_venda1*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))})
                ocolprod[8] := TBCOLUMNNEW('Producao',{||TRANSFORM(merc->saldo_est,'999999.999')})
                ocolprod[9] := TBCOLUMNNEW('Estoque1',{||TRANSFORM(merc->saldo_fis,'999999.999')})
                //ocolprod[10] := TBCOLUMNNEW('Tipo Produto',{||IF(merc->tipo_merc = '1','MERCADORIA','MATERIA PRIMA')})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF nkey == -41
                calcu()
        ELSEIF nkey == 291
                mtela_help := SAVESCREEN(00,00,24,79)
                botao(10,30,17,75,,' Menu de Ajuda ')
                DEVPOS(11,31);DEVOUT('<Alt+B> = Pesquisa AVANCADA CODIGO BARRA    ')
                DEVPOS(12,31);DEVOUT('<Alt+R> = Pesquisa p/REFERENCIA AUXILIAR    ')
                DEVPOS(13,31);DEVOUT('<Alt+P> = Pesquisa p/CODIGO e CODIGO BARRA  ')
                DEVPOS(14,31);DEVOUT('<Alt+E> = Pesquisa p/ESPECIE DO PRODUTO     ')
                DEVPOS(15,31);DEVOUT('<Alt+A> = Pesquisa AVANCADA (Varias Formas) ')
                DEVPOS(16,31);DEVOUT('<CTRL+P> = Pesquisa PRODUTOS em PROMOCAO    ')
                INKEY(0)
                RESTSCREEN(00,00,24,79,mtela_help)
        ELSEIF nkey == 275
                mcod := cons_ref(merc->ref)
                IF ! EMPTY(mcod)
                        GO mcod
                        mcod_merc := VAL(merc->cod_merc)
                        mcod_bc := merc->cod_merc
                        IF EMPTY(merc->cod_merc)
                                LOOP
                        ENDIF
                        oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba,'merc')
                        ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N',LEFT(merc->merc,20)+'** NAO DISPONIVEL **',merc->merc)})
                        ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->cod_merc})
                        ocolprod[3] := TBCOLUMNNEW('    Saldo',{||TRANSFORM(merc->saldo_mer,'9,999,999.999')})
                        ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||IF(mvar_atac = '1',TRANSFORM(ROUND((merc->pr_venda*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])),;
                                       TRANSFORM(ROUND((merc->pr_venda1*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))+IF(merc->dolar = 'S',' D','')})
                        ocolprod[5] := TBCOLUMNNEW('UN',{||merc->unidade})
                        ocolprod[6] := TBCOLUMNNEW('Referencia',{||merc->ref})

                        ocolprod[7] := TBCOLUMNNEW(' Preco R$',{||IF(mvar_atac='2',TRANSFORM(ROUND((merc->pr_venda*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])),;
                                          TRANSFORM(ROUND((merc->pr_venda1*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))})
                        ocolprod[8] := TBCOLUMNNEW('Producao',{||TRANSFORM(merc->saldo_est,'999999.999')})
                        ocolprod[9] := TBCOLUMNNEW('Estoque1',{||TRANSFORM(merc->saldo_fis,'999999.999')})
                        //ocolprod[10] := TBCOLUMNNEW('Tipo Produto',{||IF(merc->tipo_merc = '1','MERCADORIA','MATERIA PRIMA')})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ELSEIF  nkey = -3
                mdescri := SPACE(40)
                op_tela(10,10,12,71,'Pesquisar por Decricao do Porduto')
                mensagem('Digite a Descricao ou Parte da Descricao para fazer a Pesquisa ou <ESC>p/Retornar')
                DEVPOS(01,00);DEVOUT(' Digite a Descricao:')
                WVW_DrawBoxGet(,01,21,40)
                @ 01,21 GET mdescri PICT '@!'
                READ
                wvw_lclosewindow()
                *************
                ORDSETFOCUS(3)
                //SELE('merc');ORDSETFOCUS(3)
                //DBGOTOP()
                *************
                merc->(DBSEEK(RTRIM(mdescri),.T.))
                oconsprod:refreshall()
        ELSEIF  nkey >= 32 .AND. nkey <= 255
                Local4:= Upper(Local4 + Chr(nkey))
                IF (Len(Local4) > Len(merc->merc))
                        Local4:= Upper(right(Local4, Len(Local4) - 1))
                ENDIF
                SETCOLOR(2)
                @ f4lba, f4cci + (f4cba - f4cci) / 2 - Len(merc->merc) / 2 - 17;
                SAY Local4      //color SubStr('g/w,gr+/g', rat(",", 'g/w,gr+/g') + 1)
                aret:={}
                cComm  := "select sr_recno from sacmerc where sacmerc.merc like "+sr_cdbvalue(local4+'%')+" ORDER BY sacmerc.merc"
                //apCode := SR_SQLParse( cComm, @nErr, @nPos )
                //cComm  := SR_SQLCodeGen( apCode,{local4+'%'})
                sr_getconnection():exec( cComm,,.t.,@aret)
                setcor(1)
                *************
                //IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF
                //SELE('merc');ORDSETFOCUS(3)
                ORDSETFOCUS(3)
                IF LEN(aret) > 0
                        GO ARET[1,1]
                ELSE
                        DBGOTOP()
                ENDIF
                oconsprod:refreshall()
        ELSEIF nkey == 8
                Local4:= Upper(Left(Local4, Len(Local4) - 1))
                SETCOLOR(2)
                @ f4lba, f4cci + (f4cba - f4cci) / 2 - Len(merc->merc) / 2 - 17;
                        SAY Local4 + " "
                aret:={}
                cComm  := "select sr_recno from sacmerc where sacmerc.merc like "+sr_cdbvalue(local4+'%')+" ORDER BY sacmerc.merc"
                sr_getconnection():exec( cComm,,.t.,@aret)
                *************
                //IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF
                SELE('merc');ORDSETFOCUS(3)
                IF LEN(aret) > 0
                        GO ARET[1,1]
                ELSE
                        DBGOTOP()
                ENDIF
                oconsprod:refreshall()
        ELSE
                IF genkey(oconsprod,nkey,'merc')
                        oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba,'merc')
                        ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N','** NAO DISPONIVEL **'+LEFT(merc->merc,20),merc->merc)})
                        ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->cod_merc})
                        ocolprod[3] := TBCOLUMNNEW('    Saldo',{||TRANSFORM(merc->saldo_mer,'9,999,999.999')})
                        ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||IF(mvar_atac = '1',TRANSFORM(ROUND((merc->pr_venda*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])),;
                                       TRANSFORM(ROUND((merc->pr_venda1*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))+IF(merc->dolar = 'S',' D','')})
                        ocolprod[5] := TBCOLUMNNEW('UN',{||merc->unidade})
                        ocolprod[6] := TBCOLUMNNEW('Referencia',{||merc->ref})

                        ocolprod[7] := TBCOLUMNNEW(' Preco R$',{||IF(mvar_atac='2',TRANSFORM(ROUND((merc->pr_venda*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])),;
                                          TRANSFORM(ROUND((merc->pr_venda1*IF(merc->dolar = 'S',ver_dolar(mdata_sis),1))*((mpercentual/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))})
                        ocolprod[8] := TBCOLUMNNEW('Producao',{||TRANSFORM(merc->saldo_est,'999999.999')})
                        ocolprod[9] := TBCOLUMNNEW('Estoque1',{||TRANSFORM(merc->saldo_fis,'999999.999')})
                        //ocolprod[10] := TBCOLUMNNEW('Tipo Produto',{||IF(merc->tipo_merc = '1','MERCADORIA','MATERIA PRIMA')})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:CARGO := '*****'
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SETCOLOR(mcor_ant)
SELE(f4msele);IF(f4morde>0,ORDSETFOCUS(f4morde),)
RELEASE f4tela,f4tela1,f4lci,f4cci,f4lba,f4cba,f4msele,f4morde,f4men,mcod,;
        oconsprod,ocolprod[8],i,nkey,mteste
wvw_lclosewindow()
RETURN .F.
*************************** f i m *******************************************
***********************
FUNCTION ver_dolar(mdata,mtipo)
***********************
LOCAL msele,morde,mdata_dolar := mdata_sis,mhora_dolar := TIME(),mvlr_dolar,;
      mvlr_dola1,mvlr_dola2,mvlr_dola3,mvlr_dola4,;
      lci := 0,cci := 0,lba := 09,cba := 45,opcao

MEMVAR mdata_sis,cod_operado
IF m_line = 'OFF'
        RETURN 1
ENDIF
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacdolar','dolar');RETURN NIL;ENDIF
*************
SELE('dolar');ORDSETFOCUS(1)
GO TOP
*************

IF ! dolar->(DBSEEK(mdata))
        IF ! EMPTY(mtipo)
                op_tela(lci,cci,lba,cba,' Inclusao Cotacao do dolar ')
                WHILE .T.
                        mensagem('Preencha os campos abaixo - <ESC> p/Retornar')
                        mdata_dolar := mdata_sis
                        mhora_dolar := TIME()
                        mvlr_dolar := mvlr_dola1 := mvlr_dola2 := mvlr_dola3 :=;
                        mvlr_dola4 := 0
                        DEVPOS(lci+1,cci+1);DEVOUT('Data:')
                        DEVPOS(lci+2,cci+1);DEVOUT('Hora:')
                        DEVPOS(lci+3,cci+1);DEVOUT('Valor (1):')
                        DEVPOS(lci+4,cci+1);DEVOUT('Valor (2):')
                        DEVPOS(lci+5,cci+1);DEVOUT('Valor (3):')
                        DEVPOS(lci+6,cci+1);DEVOUT('Valor (4):')
                        DEVPOS(lci+7,cci+1);DEVOUT('Valor (5):')
                        setcor(3)
                        DEVPOS(lci+8,cci+1);DEVOUT('A cotacao do dolar do dia nao foi informada')
                        setcor(1)
                        WVW_DrawBoxGet(,lci+1,cci+7,8)
                        @ lci+1,cci+7 GET mdata_dolar
                        READ
                        IF LASTKEY() = 27 .OR. EMPTY(mdata_dolar)
                                EXIT
                        ENDIF
                        WVW_DrawBoxGet(,lci+2,cci+7,LEN(mhora_dolar))
                        WVW_DrawBoxGet(,lci+3,cci+7,10)
                        WVW_DrawBoxGet(,lci+4,cci+7,10)
                        WVW_DrawBoxGet(,lci+5,cci+7,10)
                        WVW_DrawBoxGet(,lci+6,cci+7,10)
                        WVW_DrawBoxGet(,lci+7,cci+7,10)
                        @ lci+2,cci+7 GET mhora_dolar
                        @ lci+3,cci+7 GET mvlr_dolar PICT '9,999.9999'
                        @ lci+4,cci+7 GET mvlr_dola1 PICT '9,999.9999'
                        @ lci+5,cci+7 GET mvlr_dola2 PICT '9,999.9999'
                        @ lci+6,cci+7 GET mvlr_dola3 PICT '9,999.9999'
                        @ lci+7,cci+7 GET mvlr_dola4 PICT '9,999.9999'
                        READ
                        IF LASTKEY() = 27
                                LOOP
                        ENDIF
                        opcao := op_simnao('S','Confirma Inclusao:')
                        IF opcao = 'S'
                                IF ADIREG()
                                        dolar->data_dolar := mdata_dolar
                                        dolar->hora_dolar := mhora_dolar
                                        dolar->vlr_dolar := mvlr_dolar
                                        dolar->vlr_dola1 := mvlr_dola1
                                        dolar->vlr_dola2 := mvlr_dola2
                                        dolar->vlr_dola3 := mvlr_dola3
                                        dolar->vlr_dola4 := mvlr_dola4
                                        dolar->ope_dolar := cod_operado
                                        DBCOMMIT()
                                        DBUNLOCK()
                                        EXIT
                                ELSE
                                        atencao('Nao foi possivel acessar o Arquivo !!!')
                                        LOOP
                                ENDIF
                        ENDIF
                ENDDO
                wvw_lclosewindow()
                RETURN NIL
        ENDIF
        GO BOTT
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN dolar->vlr_dolar
        atencao('O valor do DOLAR e do dia '+DTOC(dolar->data_dolar)+' no valor de R$: '+TRANSFORM(dolar->vlr_dolar,'9,999.9999'))
ELSE
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
*       atencao('O valor do DOLAR do dia R$: '+TRANSFORM(dolar->vlr_dolar,'9,999.9999'),2)
        IF dolar->vlr_dolar = 0
                RETURN 1
        ELSE
                RETURN dolar->vlr_dolar
        ENDIF
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN dolar->vlr_dolar
******************************** f i m **********************************
********************************
* FUNCAO P/CONSULTAR MERCADORIAS P/REFERENCIA
********************************
FUNCTION cons_ref(mref,mfab)
*****************
LOCAL tela1,lci,cci,lba,cba,msele,morde,men,y,mponto,mcod_m,mcon:=SPACE(10),;
      oconsprod,ocolprod[8],i,nkey,mteste,msel_ref,mord_ref,f4,mpoint
MEMVAR nivel_acess,mdata_sis,lin_br

f4 := '*'
lci := cci := 00
lba := 14
cba := 79
msel_ref := SELE()
mord_ref := INDEXORD()
mponto := RECNO()
IF ! AbriArq('sacsetup','set');RETURN NIL;ENDIF
IF ! AbriArq('sacdolar','dolar');RETURN NIL;ENDIF
IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF
*************
SELE('merc');ORDSETFOCUS(8)
GO TOP
IF ! merc->(DBSEEK(mref)) .AND. ! EMPTY(mref)
        atencao('Nao existe produtos com esta REFERENCIA')
ENDIF
*************
op_tela(0,10,22,90,' CONSULTA P/REFERENCIAS DO PRODUTOS ')
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Ref.Aux.',{||merc->ref})
ocolprod[2] := TBCOLUMNNEW('Mercadoria',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N',REPLI('*',45),merc->merc)})
ocolprod[3] := TBCOLUMNNEW('Cod.',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N','*****',merc->cod_merc)})
ocolprod[4] := TBCOLUMNNEW('    Saldo',{||TRANSFORM(merc->saldo_mer,'999999.999')})
ocolprod[5] := TBCOLUMNNEW(' Preco R$',{||IF(merc->dolar = 'S',TRANSFORM(ROUND(merc->pr_venda*ver_dolar(mdata_sis),m_set[1,103]),ALLTRIM(m_set[1,98])),TRANSFORM(ROUND(merc->pr_venda,m_set[1,103]),ALLTRIM(m_set[1,98])))})
ocolprod[6] := TBCOLUMNNEW('UN',{||merc->unidade})
ocolprod[7] := TBCOLUMNNEW('Estoque',{||TRANSFORM(merc->saldo_est,'999999.999')})
ocolprod[8] := TBCOLUMNNEW('Estoque1',{||TRANSFORM(merc->saldo_fis,'999999.999')})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
oconsprod:CARGO := '*****'
WHILE .T.
mensagem('<P>Pesquisa p/Referencias - <ENTER>Confirma')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                botao(lba,cci,lba+8,cba,,' Detalhe do Produto ')
                setcor(3)
                DEVPOS(lba+1,cci+1);DEVOUT('Cod.Barra/Ref.:')
                DEVPOS(lba+1,cci+34);DEVOUT('Cod.Fab.:')
                DEVPOS(lba+2,cci+1);DEVOUT('Prc1: ')
                DEVPOS(lba+2,cci+20);DEVOUT('Prc2: ')
                DEVPOS(lba+2,cci+39);DEVOUT('Prc3: ')
                DEVPOS(lba+2,cci+58);DEVOUT('Prc4: ')
                DEVPOS(lba+4,cci+1);DEVOUT('Aplicacao:')
                setcor(1)
                DEVPOS(lba+1,cci+16);DEVOUT(merc->cod_barr)
                DEVPOS(lba+1,cci+43);DEVOUT(merc->cod_fab+'-'+LEFT(merc->fabrica,25))
                IF ! EMPTY(m_set[1,72])
                        DEVPOS(lba+2,cci+7);DEVOUT(TRANSFORM(ROUND(merc->pr_venda*((m_set[1,72]/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))
                ENDIF
                IF ! EMPTY(m_set[1,74])
                        DEVPOS(lba+2,cci+26);DEVOUT(TRANSFORM(ROUND(merc->pr_venda*((m_set[1,74]/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))
                ENDIF
                IF ! EMPTY(m_set[1,76])
                        DEVPOS(lba+2,cci+45);DEVOUT(TRANSFORM(ROUND(merc->pr_venda*((m_set[1,76]/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))
                ENDIF
                IF ! EMPTY(m_set[1,78])
                        DEVPOS(lba+2,cci+64);DEVOUT(TRANSFORM(ROUND(merc->pr_venda*((m_set[1,78]/100)+1),m_set[1,103]),ALLTRIM(m_set[1,98])))
                ENDIF
                IF nivel_acess = '1'
                        setcor(3)
                        DEVPOS(lba+3,cci+1);DEVOUT('V.M.: ')
                        DEVPOS(lba+3,cci+25);DEVOUT('C.M.: ')
                        DEVPOS(lba+3,cci+50);DEVOUT('C.R.: ')
                        setcor(1)
                        DEVPOS(lba+3,cci+07);DEVOUT(TRANSFORM(merc->vlr_merc,ALLTRIM(m_set[1,98])))
                        DEVPOS(lba+3,cci+31);DEVOUT(TRANSFORM(merc->pr_medio,ALLTRIM(m_set[1,98])))
                        DEVPOS(lba+3,cci+56);DEVOUT(TRANSFORM(merc->vlr_merc,ALLTRIM(m_set[1,98])))
                ENDIF
                DEVPOS(lba+4,cci+11);DEVOUT(merc->aplic0)
                DEVPOS(lba+5,cci+11);DEVOUT(merc->aplic1)
                DEVPOS(lba+6,cci+11);DEVOUT(merc->aplic2)
                DEVPOS(lba+7,cci+11);DEVOUT(merc->aplic3)
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                SELE(msel_ref);IF(mord_ref>0,ORDSETFOCUS(mord_ref),)
                GO mponto
                EXIT
        ELSEIF nkey == K_ENTER
                mcod_m := RECNO()
                mcod_merc := merc->cod_merc
                IF EMPTY(mcod_m)
                        LOOP
                ENDIF
                EXIT
        ELSEIF nkey == 112 .OR. nkey == 80
                mcon := SPACE(10)
                tela1 := SAVESCREEN(00,00,24,79)
                setcor(3)
                botao(10,10,12,25,,' PESQUISAR ')
                setcor(1)
                WVW_DrawBoxGet(,11,11,LEN(ALLTRIM(mcon)))
                @ 11,11 GET mcon PICT '@!'
                READ
                RESTSCREEN(00,00,24,79,tela1)
                IF LASTKEY() = 27
                        CLEAR GETS
                        LOOP
                ENDIF
                mpoint := RECNO()
                IF ! merc->(DBSEEK(RTRIM(mcon),.T.))
                        atencao('A Pesquisa nao foi realizada com sucesso')
                        GO mpoint
                        CLEAR GETS
                        LOOP
                ENDIF
                IF merc->disp = 'N'
                        atencao('Produto nao estar disponivel para VENDA')
                        GO mpoint
                        CLEAR GETS
                        LOOP
                ENDIF
                CLEAR GETS
                oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                ocolprod[1] := TBCOLUMNNEW('Ref.Aux.',{||merc->ref})
                ocolprod[2] := TBCOLUMNNEW('Mercadoria',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N',REPLI('*',45),merc->merc)})
                ocolprod[3] := TBCOLUMNNEW('Cod.',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N','*****',merc->cod_merc)})
                ocolprod[4] := TBCOLUMNNEW('    Saldo',{||TRANSFORM(merc->saldo_mer,'999999.999')})
                ocolprod[5] := TBCOLUMNNEW(' Preco R$',{||IF(merc->dolar = 'S',TRANSFORM(ROUND(merc->pr_venda*ver_dolar(mdata_sis),m_set[1,103]),ALLTRIM(m_set[1,98])),TRANSFORM(ROUND(merc->pr_venda,m_set[1,103]),ALLTRIM(m_set[1,98])))})
                ocolprod[6] := TBCOLUMNNEW('UN',{||merc->unidade})
                ocolprod[7] := TBCOLUMNNEW('Estoque',{||TRANSFORM(merc->saldo_est,'999999.999')})
                ocolprod[8] := TBCOLUMNNEW('Estoque1',{||TRANSFORM(merc->saldo_fis,'999999.999')})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF nkey == -41
                calcu()
        ELSEIF nkey == 67 .OR. nkey == 99
                IF oconsprod:freeze=0
                        oconsprod:freeze := oconsprod:colpos -1
                        lin_br=21
                ELSE
                        oconsprod:freeze = 0
                        lin_br= 30
                        oconsprod:panhome()
                        oconsprod:refreshall()
                ENDIF
                oconsprod:colorRect({1,1,lin_br,oconsprod:freeze},{2,5})
        ELSE
                IF genkey(oconsprod,nkey,'merc')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Ref.Aux.',{||merc->ref})
                        ocolprod[2] := TBCOLUMNNEW('Mercadoria',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N',REPLI('*',45),merc->merc)})
                        ocolprod[3] := TBCOLUMNNEW('Cod.',{||IF(EMPTY(merc->cod_merc) .OR. merc->disp = 'N','*****',merc->cod_merc)})
                        ocolprod[4] := TBCOLUMNNEW('    Saldo',{||TRANSFORM(merc->saldo_mer,'999999.999')})
                        ocolprod[5] := TBCOLUMNNEW(' Preco R$',{||IF(merc->dolar = 'S',TRANSFORM(ROUND(merc->pr_venda*ver_dolar(mdata_sis),m_set[1,103]),ALLTRIM(m_set[1,98])),TRANSFORM(ROUND(merc->pr_venda,m_set[1,103]),ALLTRIM(m_set[1,98])))})
                        ocolprod[6] := TBCOLUMNNEW('UN',{||merc->unidade})
                        ocolprod[7] := TBCOLUMNNEW('Estoque',{||TRANSFORM(merc->saldo_est,'999999.999')})
                        ocolprod[8] := TBCOLUMNNEW('Estoque1',{||TRANSFORM(merc->saldo_fis,'999999.999')})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msel_ref);IF(mord_ref>0,ORDSETFOCUS(mord_ref),)
wvw_lclosewindow()
IF ! EMPTY(mcod_m)
        RETURN mcod_m
ELSE
        RETURN .F.
ENDIF
RETURN NIL
*************************** f i m *******************************************
FUNCTION ver_gru(vgru,ld,cd,t)
**********************
LOCAL mcons_grupo,ccomm

IF EMPTY(vgru)
        RETURN .T.
ENDIF
mcons_grupo:={}
cComm  := "SELECT * FROM sacgrupo WHERE gru_sub = "+sr_cdbvalue(STRZERO(vgru,3)+'  ')
sr_getconnection():exec( cComm,,.t.,@mcons_grupo)

IF t = .T. .AND. LEN(mcons_grupo) > 0
        vgru := 0
        atencao('Codigo ja Cadastrado !!!')
        RETURN .F.
ENDIF
IF LEN(mcons_grupo) = 0
        vgru := 0
        IF t = .T.
                atencao('Grupo nao Cadastrado !!!')
        ENDIF
        RETURN .F.
ENDIF

setcor(3)
DEVPOS(ld,cd);DEVOUT(mcons_grupo[1,2])
setcor(1)
RETURN .T.
********************** F I M ********************************
**************************
* VERIFICA CODIGO DE BARRA
**************************
FUNCTION vercodbarra(vgru,li,ci,t)
**********************
LOCAL mcons_barr:={}
IF EMPTY(vgru)
        RETURN .T.
ENDIF
mcons_barr:={}
sr_getconnection():exec( "SELECT * FROM sacmerc WHERE cod_barr = "+sr_cdbvalue(vgru),,.t.,@mcons_barr)
IF t = '*'
        IF LEN(mcons_barr) > 0
                atencao('Codigo Barra ja Cadastrado Produto: '+mcons_barr[1,8]+' - '+mcons_barr[1,9]+m_qp+'Codigo Barra do Produto: '+mcons_barr[1,2]+m_qp+'Codigo Barra Solicitado: '+vgru)
                vgru := SPACE(14)
                RETURN .F.
        ELSE
                IF li <> NIL
                        setcor(3)
                        DEVPOS(li,ci);DEVOUT(mcons_barr[1,9])
                        setcor(1)
                        RETURN .T.
                ELSE
                        RETURN .T.
                ENDIF
        ENDIF
ENDIF
IF LEN(mcons_barr) = 0
        vgru := SPACE(14)
        atencao('Codigo Barra nao Cadastrado !!!')
        RETURN .F.
ENDIF
IF li <> NIL
        setcor(3)
        DEVPOS(li,ci);DEVOUT(mcons_barr[1,9])
        setcor(1)
        RETURN .T.
ENDIF
RETURN .T.
************************** F I M **********************
********************************
* TABELA DE DESCONTO DE MERCADORIA P/PRODUTO
*******************************
FUNCTION tabcliprod
***************
LOCAL MPRG:='SAC131'

LOCAL m_matriz:={},m_codigo:={},m_cbarra:={},i,opcao,mcod_merc,mcod_bc,mmerc,mdesconto,;
      mvlr_fat,li,ci,lb,cb,lci,cci,lba,cba,tela,machou,mgrupo,tela_ant,;
      f
MEMVAR cod_operado,nivel_acess,mdata_sis,mcod_cli
IF ! ver_nivel(mprg,'TABELA DESCONTO DE PRODUTO P/CLIENTE','15',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF

tela = SAVESCREEN(01,00,24,79)
lci = 01
cci = 00
lba = 25-2
*lba = 17
cba = 79
WHILE .T.
        botao(lci,cci,lba,cba,,' Operador:'+cod_operado,'*')
        DEVPOS(lci,cci+2);DEVOUT(' Tabela de Produto ')
        @ lci+2,cci+1 TO lci+2,cba-1
        DEVPOS(lci+1,cci+1);DEVOUT('Cod.')
        DEVPOS(lci+1,cci+7);DEVOUT('Descricao')
        DEVPOS(lci+1,cci+53);DEVOUT('Sub-Grupo')
        DEVPOS(lci+1,cci+64);DEVOUT('Desconto')
        setcor(3)
        @ lba-4,cci+1 TO lba-4,cba-1
        @ lba-2,cci+1 TO lba-2,cba-1
        setcor(1)
        DEVPOS(lba-4,cci+1);DEVOUT('Cod.')
        DEVPOS(lba-4,cci+7);DEVOUT('Descricao')
        DEVPOS(lba-4,cci+53);DEVOUT('Sub-Grupo')
        DEVPOS(lba-4,cci+64);DEVOUT('Desconto')
        tela_ant := SAVESCREEN(00,00,24,79)
        mcod_cli := cli->cod_cli
        WHILE .T.
                ASIZE(m_matriz,0)
                ****************************
                SELE('tabme');ORDSETFOCUS(2)
                GO TOP
                ****************************
                IF tabme->(DBSEEK(cli->cod_cli))
                        WHILE cli->cod_cli = tabme->cod_cli
                                IF ! EMPTY(tabme->grupo)
                                        ver_sgru(VAL(SUBSTR(tabme->grupo,1,3)),VAL(SUBSTR(tabme->grupo,4)))
                                        AADD(m_matriz,{tabme->codigo,grup->merc,tabme->desconto,tabme->grupo})
                                ELSE
                                        ver_cod(VAL(tabme->codigo))
                                        AADD(m_matriz,{tabme->codigo,merc->merc,tabme->desconto,tabme->grupo})
                                ENDIF
                                SKIP
                        ENDDO
                ENDIF
                machou := ' '
                limpa(lci+3,cci+1,lba-5,cba-1)
                f = 0
                i = 1
                WHILE  i <= LEN(m_matriz)
                        setcor(3)
                        @ lci+3+f,cci+1 SAY m_matriz[i,1]
                        @ lci+3+f,cci+07 SAY m_matriz[i,2]
                        @ lci+3+f,cci+53 SAY m_matriz[i,4] PICT '@R 999.99'
                        @ lci+3+f,cci+64 SAY m_matriz[i,3] PICT '999999.99'
                        setcor(1)
                        IF f > 11
                                SCROLL(lci+3,cci+1,lba-5,cba-1,1)
                                setcor(1)
                                i++
                        ELSE
                                i++
                                f++
                        ENDIF
                ENDDO
                mcod_merc := mdesconto := 0
                mcod_bc := SPACE(13)
                mmerc := SPACE(40)
                mgrupo := SPACE(5)
                limpa(lba-3,cci+1,lba-3,cba-1)
                mensagem('Digite codigo ou nome mercadoria - <ALT+P>Cons.Produtos - <ESC>Abandonar')
                @ lba-3,cci+1 GET mcod_bc PICT '@!'  VALID lim_get() WHEN men_get(lba-09,cci+10,'Informe o Cod.do produto - <ENTER>p/descricao ou  <F4>p/pesquisar')
                READ
                IF LASTKEY() = 27
                        ASIZE(m_codigo,0)
                        ASIZE(m_matriz,0)
                        RESTSCREEN(01,00,24,79,tela)
                        ****************
                        SELE('cli');ORDSETFOCUS(2)
                        ****************
                        RETURN NIL
                ENDIF
                IF EMPTY(mcod_bc)
                        @ lba-3,cci+7 GET mmerc PICT '@!' VALID lim_get() WHEN men_get(lba-09,cci+28,'<Digite descricao mercadoria>  <ENTER>p/retornar  <F4>p/pesquisar')
                        READ
                        IF LASTKEY() = 27;LOOP;ENDIF
                ENDIF
                IF EMPTY(mcod_bc) .AND. EMPTY(mmerc)
                        @ lba-3,cci+53 GET mgrupo PICT '@R 999.99' VALID lim_get() WHEN men_get(lba-09,cci+53,'<Digite Cod. do Sub-Grupo  <ENTER>p/retornar')
                        READ
                        IF LASTKEY() = 27;LOOP;ENDIF
                ENDIF
                IF EMPTY(mcod_bc) .AND. EMPTY(mmerc) .AND. EMPTY(mgrupo)
                        LOOP
                ENDIF
                IF ! EMPTY(mcod_bc)
                        IF LEN(RTRIM(mcod_bc)) > 5
                                *************
                                SELE('merc');ORDSETFOCUS(6)
                                *************

                                SEEK mcod_bc

                                IF ! FOUND()
                                        atencao('Codigo de BARRA nao cadastrado')
                                        LOOP
                                ENDIF
                        ELSE
                                mcod_merc := VAL(mcod_bc)
                                *************
                                SELE('merc');ORDSETFOCUS(1)
                                *************
                                SEEK STRZERO(mcod_merc,5)

                                IF ! FOUND()
                                        atencao('Codigo da mercadoria nao cadastrado')
                                        LOOP
                                ENDIF
                        ENDIF
                ELSEIF ! EMPTY(mgrupo)
                        *************
                        SELE('grup');ORDSETFOCUS(1)
                        *************
                        SEEK mgrupo
                        IF ! FOUND()
                                atencao('Codigo do SUB-GRUPO nao cadastrado')
                                LOOP
                        ENDIF
                ELSEIF ! EMPTY(mmerc)
                        *************
                        SELE('merc');ORDSETFOCUS(3)
                        *************

                        SEEK RTRIM(mmerc)

                        IF ! FOUND()
                                atencao('Esta mercadoria nao cadastrada')
                                LOOP
                        ENDIF
                        IF merc->cod_merc = SPACE(5)
                                WHILE ! EOF() .AND. merc->cod_merc = SPACE(5)
                                        SKIP
                                ENDDO
                        ENDIF
                        IF EOF() .OR. merc->cod_merc = SPACE(5)
                                atencao('Mercadoria nao cadastrada')
                                LOOP
                        ENDIF
                        IF(m_set[1,93] <> 'A',f4_merc(),f4_merc1())
                        IF LASTKEY() = 27
                                LOOP
                        ENDIF
                ENDIF
                IF ! EMPTY(mgrupo)
                        mcod_merc := VAL(merc->cod_merc)
                        ****************************
                        SELE('tabme');ORDSETFOCUS(3)
                        GO TOP
                        ****************************
                        IF tabme->(DBSEEK(mgrupo+cli->cod_cli))
                                atencao('Este SUB-GRUPO ja esta cadastrada p/este cliente !!!')
                                mdesconto := tabme->desconto
                                machou := '*'
                        ENDIF
                        mmerc := grup->merc
                ELSE
                        mcod_merc := VAL(merc->cod_merc)
                        ****************************
                        SELE('tabme');ORDSETFOCUS(1)
                        GO TOP
                        ****************************
                        IF tabme->(DBSEEK(STRZERO(mcod_merc,5)+cli->cod_cli))
                                atencao('Esta mercadoria ja esta cadastrada p/este cliente !!!')
                                mdesconto := tabme->desconto
                                machou := '*'
                        ENDIF
                        mmerc := merc->merc
                ENDIF
                setcor(3)
                @ lba-3,cci+6 SAY '³'
                @ lba-3,cci+01 SAY STRZERO(mcod_merc,5)
                @ lba-3,cci+07 SAY mmerc
                @ lba-3,cci+53 SAY mgrupo PICT '@R 999.99'
                setcor(1)
                @ lba-3,cci+64 GET mdesconto PICT '999.99'       // WHEN men_get(12,cci+42,'Informe a quantidade que deseja, so nao pode ultrapassar o saldo da mercadoria') VALID lim_get()
                READ
                IF LASTKEY() = 27
                        LOOP
                ENDIF
                setcor(1)
                opcao := op_simnao('S','Confirma Inclusao/alteracao da Mercadoria [S/n]:')
                IF opcao = 'S'
                        IF machou = '*'
                                BLOQREG()
                                IF mdesconto = 0
                                        DELE
                                ELSE
                                        tabme->desconto := mdesconto
                                ENDIF
                                DBUNLOCK()
                                DBCOMMIT()
                                sr_getconnection():exec("DELETE FROM sactabme WHERE SR_DELETED = 'T'",,.f.)
                                sr_getconnection():exec("COMMIT",,.f.)
                        ELSE
                                ADIREG()
                                IF ! EMPTY(mgrupo)
                                        tabme->data     := mdata_sis
                                        tabme->grupo    := mgrupo
                                        tabme->cod_cli  := cli->cod_cli
                                        tabme->desconto := mdesconto
                                ELSE
                                        tabme->data     := mdata_sis
                                        tabme->codigo   := STRZERO(mcod_merc,5)
                                        tabme->cod_cli  := cli->cod_cli
                                        tabme->desconto := mdesconto
                                ENDIF
                                DBUNLOCK()
                                DBCOMMIT()
                        ENDIF
                        **********
                        SELE('merc');ORDSETFOCUS(1)
                        **********
                ELSE
                        DBUNLOCKALL()
                ENDIF
        ENDDO
ENDDO
RETURN NIL
***************************  F I M  **********************************
****************************************************
* VERIFICA SE O PEDIDO JA FOI EMITIDO A NOTA FISCAL
****************************************************
FUNCTION v_ped_nt(num_pedido,p,mum)
*******************
LOCAL msele,morde,mdocumento:='        ',cons_nota:={},cont_nota:=0
IF EMPTY(num_pedido)
        RETURN .T.
ENDIF
cons_nota := {}
sr_getconnection():exec("SELECT * FROM sactotnt WHERE num_ped = "+sr_cdbvalue(STRZERO(num_pedido,6))+" AND ent_sai = 'S'",,.t.,@cons_nota)
IF LEN(cons_nota) > 0
        mdocumento := cons_nota[LEN(cons_nota),5]
        IF mum <> NIL
                RETURN mdocumento
        ENDIF
        cont_nota:=0
        FOR cont_nota = 1 TO LEN(cons_nota)
                mdocumento := mdocumento +'-'+ cons_nota[cont_nota,5]
        NEXT
        IF p = NIL
                atencao('Este pedido ja foi emitido NOTA FISCAL de No.: '+mdocumento)
                RETURN .T.
        ENDIF
        RETURN mdocumento
ENDIF
cons_nota := {}
sr_getconnection():exec("SELECT * FROM sacmov WHERE num_ped = "+sr_cdbvalue(STRZERO(num_pedido,6))+" AND ent_sai = 'S' AND documento LIKE 'C%'",,.t.,@cons_nota)
IF LEN(cons_nota) > 0
        mdocumento := cons_nota[LEN(cons_nota),2]
        IF mum <> NIL
                RETURN mdocumento
        ENDIF
        cont_nota:=0
        FOR cont_nota = 1 TO LEN(cons_nota)
                mdocumento := mdocumento +'-'+ cons_nota[cont_nota,2]
        NEXT
        IF p = NIL
                atencao('Este pedido ja foi emitido CUPOM FISCAL de No.: '+mdocumento)
                RETURN .T.
        ENDIF
        RETURN mdocumento
ENDIF
IF p = NIL
        RETURN .T.
ELSE
        RETURN mdocumento
ENDIF
RETURN .T.
/*
msele := SELE()
morde := INDEXORD()
****************************
SELE('totnt');ORDSETFOCUS(5)
****************************
IF totnt->(DBSEEK(STRZERO(num_pedido,6)+'S'))
        mdocumento := totnt->documento
        IF mum <> NIL
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN mdocumento
        ENDIF
        SKIP
        WHILE STRZERO(num_pedido,6) = totnt->num_ped .AND. ! EOF()
                mdocumento := mdocumento +'-'+ totnt->documento
                SKIP
        ENDDO
        IF p = NIL
                atencao('Este pedido ja foi emitido NOTA FISCAL de No.: '+mdocumento)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN mdocumento
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
IF p = NIL
        RETURN .T.
ELSE
        RETURN mdocumento
ENDIF
RETURN NIL
*/
********************** F I M ****************************
****************************** F I M **************************************
* VER UNIDADE DE MEDIDAS
************************
FUNCTION unidade(munid,vimp)

IF ver_serie() = '141237'
        mmasc := '9'+ALLTRIM(m_set[1,99])
ELSEIF m_cfg[26] = 'S'
        mmasc := '9'+ALLTRIM(m_set[1,99])
ELSE
        IF munid = 'KG ' .OR. munid = 'L  '
                mmasc := '999,999.999'
        ELSEIF munid = 'M  ' .OR. munid = 'MT '
                mmasc := '9999,999.99'
        ELSEIF munid = 'UN ' .OR. munid = 'PC ' .OR. munid = 'CX ' .OR. munid = 'FD '
                mmasc := '999,999,999'
        ELSE
                mmasc := '9'+ALLTRIM(m_set[1,99])
        ENDIF
ENDIF
RETURN mmasc
****************************** F I M *************************************
* VER UNIDADE DE MEDIDAS
************************
FUNCTION unidade1(munid)

IF munid = 'UN ' .OR. munid = 'UND'
        mmasc := '1'
ELSEIF munid = 'M  ' .OR. munid = 'MT '
        mmasc := '2'
ELSEIF munid = 'PC '
        mmasc := '3'
ELSEIF munid = 'CX '
        mmasc := '4'
ELSEIF munid = 'KG '
        mmasc := '5'
ELSEIF munid = 'FD '
        mmasc := '6'
ELSE
        mmasc := '1'
ENDIF
RETURN mmasc
*******************************  F I M ************************************
FUNCTION cons_luc()
************************************
MEMVAR mnum_ped
LOCAL mlucro_ped
mlucro_ped := {}
sr_getconnection():exec("SELECT sum(pquantd * pcust_real),SUM(pquantd * ppre_venda) FROM sacped_s WHERE pnum_ped = "+sr_cdbvalue(STRZERO(mnum_ped,6)),,.t.,@mlucro_ped)
IF LEN(mlucro_ped) = 0
        atencao('Nao existe este PEDIDO...')
	RETURN NIL
ENDIF
op_tela(10,10,16,60,' Consulta de Lucro')
DEVPOS(00,1);DEVOUT('Total a Preco de Venda R$:')
DEVPOS(01,1);DEVOUT('Total a Preco de Custo R$:')
DEVPOS(02,1);DEVOUT('                           ----------')
DEVPOS(03,1);DEVOUT('Lucro................. R$:')
DEVPOS(04,1);DEVOUT('Lucro.................(%):')
setcor(3)
DEVPOS(00,28);DEVOUT(TRANSFORM(mlucro_ped[1,2],'999,999.99'))
DEVPOS(01,28);DEVOUT(TRANSFORM(mlucro_ped[1,1],'999,999.99'))
DEVPOS(03,28);DEVOUT(TRANSFORM(mlucro_ped[1,2] - mlucro_ped[1,1],'999,999.99'))
DEVPOS(04,28);DEVOUT(TRANSFORM((((mlucro_ped[1,2] - mlucro_ped[1,1])/mlucro_ped[1,1]))*100,'9,999.99'))
setcor(1)
mensagem('Pressione qualquer tecla p/continuar')
INKEY(0)
wvw_lclosewindow()
RETURN NIL
********************************** F I M ***************************************
FUNCTION ped_rom(mnum,tip)
*********************

LOCAL cid_sele,cid_orde

cid_sele := SELE()
cid_orde := INDEXORD()
IF ! AbriArq('sacroma','roma');RETURN NIL;ENDIF
********************
SELE('roma');ORDSETFOCUS(2)
GO TOP
********************
IF roma->(DBSEEK(STRZERO(mnum,6)+' '+'P'))
        SELE(cid_sele);ORDSETFOCUS(cid_orde)
        RELEASE cid_sele,cid_orde
        RETURN roma->num_roma
ELSE
        SELE(cid_sele);ORDSETFOCUS(cid_orde)
        RELEASE cid_sele,cid_orde
        RETURN SPACE(6)
ENDIF
SELE(cid_sele);ORDSETFOCUS(cid_orde)
RELEASE cid_sele,cid_orde
RETURN .T.
***************************** F I M ****************************************
***************
FUNCTION ver_dia(mv)
***************
LOCAL mdia
IF dow(mv)=1
        mdia := 'DOMINGO'
ELSEIF dow(mv)=2
        mdia := 'SEGUNDA FEIRA'
ELSEIF dow(mv)=3
        mdia := 'TERCA FEIRA'
ELSEIF dow(mv)=4
        mdia := 'QUARTA FEIRA'
ELSEIF dow(mv)=5
        mdia := 'QUINTA FEIRA'
ELSEIF dow(mv)=6
        mdia := 'SEXTA FEIRA'
ELSEIF dow(mv)=7
        mdia := 'SABADO'
ENDIF
RETURN mdia

************************** F I M ***************************************
******************************
* PESQUISA O CPF SE EXISTE
******************************
FUNCTION pesq_cpf(ncpf,narq,condicao)
********************
LOCAL cons_cpf:={},ccomm:=''
IF EMPTY(ncpf)
        RETURN .T.
ENDIF
IF SUBSTR(ncpf,10,2) <> GDV2(SUBSTR(ncpf,1,9))
        atencao('C.P.F. nao confere OK !!!')
        RETURN .F.
ENDIF
cons_cpf := {}
IF narq = 'cli'
        cComm  := "SELECT * FROM saccli WHERE cpf = "+sr_cdbvalue(ncpf)
ELSE
        cComm  := "SELECT * FROM sactran WHERE cpf = "+sr_cdbvalue(ncpf)
ENDIF
sr_getconnection():exec(ccomm,,.t.,@cons_cpf)
IF condicao <> NIL .AND. LEN(cons_cpf) > 0
        atencao('C.P.F. ja cadastrado...')
        RETURN .F.
ENDIF
RETURN .T.
******************************* f i m *********************************************
*********************
* VERIFICA O CONDICAO PAGTO.
***********************

FUNCTION ver_cond(mcod,ld,cd,p,valerta)
****************************************
LOCAL aret:={}

IF mcod = 0 .AND. ld <> NIL
        setcor(3)
        DEVPOS(ld,cd);DEVOUT(SPACE(20))
        setcor(1)
        RETURN .T.
ENDIF
IF mcod = 0 .AND. p = NIL
        RETURN .T.
ENDIF
cComm  := "SELECT descri FROM sactabpg WHERE codigo = "+sr_cdbvalue(STRZERO(mcod,3))
sr_getconnection():exec(ccomm,,.t.,@aret)
IF LEN(aret) = 0
        mcod := 0
        IF p = NIL
                setcor(3)
                DEVPOS(ld,cd);DEVOUT(SPACE(20))
                setcor(1)
                atencao('Condicao de Pagamento: '+STRZERO(mcod,3)+' nao Cadastrado !!!')
                RETURN .F.
        ENDIF
        RETURN .T.
ENDIF
IF valerta <> NIL
        atencao('Descricao: '+aret[1,1]+' ')
ENDIF
IF ld <> NIL
        setcor(3)
        DEVPOS(ld,cd);DEVOUT(aret[1,1])
        setcor(1)
ENDIF
RETURN .T.

********************************** F I M ***********************************
******************
* VERIFICA REGIOES
******************

FUNCTION ver_regi(vreg,li,ci,t,mzero)
**********************

LOCAL msele,morde

IF (mzero <> NIL .OR. mzero = 0) .AND. mzero <> 1
        IF EMPTY(vreg)
                IF li <> NIL
                        setcor(3)
                        DEVPOS(li,ci);DEVOUT(SPACE(20))
                        setcor(1)
                ENDIF
                RETURN .T.
        ENDIF
ENDIF

msele := SELE()
morde := INDEXORD()

IF ! AbriArq('regiao','reg');RETURN NIL;ENDIF

**************
SELE('reg');ORDSETFOCUS(1)
GO TOP
**************

SEEK vreg

IF t = .T. .AND. FOUND()
        vreg := SPACE(2)
        atencao('Codigo ja Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
IF ! FOUND()
        vreg := SPACE(2)
        atencao('Codigo nao Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
IF li = NIL
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
setcor(3)
DEVPOS(li,ci);DEVOUT(reg->regiao)
setcor(1)
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
******************************** F I M ************************************88
**************************************
* FUNCAO PARA CHECAR O LIMITE
**************************************

FUNCTION limite(mcod,mvalor,mtipo,mped)
*************************
LOCAL liberado:='*',rodape,ponto,msel_lim,mord_lim,mcont_ch,mcam_arq:=' ',i:=0,;
      mcpfcnpj := ' ',mcli_spc,mcam_cli:=' ',;
      nErr, nPos,vEmp := {},nCnn,oSql,cComm, apCode,aret:={}

MEMVAR mlim_venc,mlim_avenc,mtot_limite,mdata_sis

mlim_venc := mlim_avenc := mtot_limite := 0
msel_lim := SELE()
mord_lim := INDEXORD()
IF STRZERO(mcod,5) = m_set[1,84] .OR. cli->spc = 'N'
        SELE(msel_lim);IF(mord_lim>0,ORDSETFOCUS(mord_lim),)
        RETURN .T.
ENDIF
aret:={}
cComm  := "SELECT SUM(valor) FROM sacdupr WHERE sacdupr.fornec = "+sr_cdbvalue(STRZERO(mcod,5))+" AND sacdupr.venc < "+sr_cdbvalue(mdata_sis)+" AND (sacdupr.pago = ' ' OR sacdupr.pago IS NULL)"
sr_getconnection():exec(ccomm,,.t.,@aret)
mlim_venc := aret[1,1]

aret:={}
cComm  := "SELECT SUM(valor) FROM sacdupr WHERE sacdupr.fornec = "+sr_cdbvalue(STRZERO(mcod,5))+" AND sacdupr.venc > "+sr_cdbvalue(mdata_sis)+" AND (sacdupr.pago = ' ' OR sacdupr.pago IS NULL)"
sr_getconnection():exec(ccomm,,.t.,@aret)
mlim_avenc := aret[1,1]

mtot_limite := mlim_avenc + mlim_venc

aret:={}
cComm  := "SELECT limite FROM saccli WHERE cod_cli = "+sr_cdbvalue(STRZERO(mcod,5))
sr_getconnection():exec(ccomm,,.t.,@aret)

//IF cli->limite > 0 .AND. mtot_limite+mvalor > cli->limite
IF aret[1,1] > 0 .AND. mtot_limite+mvalor > aret[1,1]
        	IF mtipo = NIL
/*
			IF mtot_limite+mvalor > (aret[1,1] * 1.5)
		                atencao('Cliente estar BLOQUEADO por ultrapassar o Limite + 50%: Valor do Limite: '+TRANSFORM(aret[1,1],'999,999.99')+' e o Total de Compras mais a compra em andamento: '+TRANSFORM(mtot_limite+mvalor,'999,999.99'))
		                RETURN .F.
			ENDIF		
*/
                        liberado := ' '
                        IF ! aut_sen('Cliente LIMITE R$: '+TRANSFORM(cli->limite,'999999.99')+' ESTORADO em '+TRANSFORM((mtot_limite+mvalor) - aret[1,1],'999999.99')+'Senha de autorizacao:','LIMIT_EST',,STRZERO(mcod,5))
                                SELE(msel_lim);IF(mord_lim>0,ORDSETFOCUS(mord_lim),)
                                RETURN .F.
                        ENDIF
                        liberado := '*'
                ELSE
                        atencao('Cliente com LIMITE R$: '+TRANSFORM(aret[1,1],'999999.99')+' ESTORADO em '+TRANSFORM((mtot_limite+mvalor) - aret[1,1],'999999.99')+' !!!')
                ENDIF

ENDIF
IF liberado = '*' .OR. mtipo <> NIL
        SELE(msel_lim);IF(mord_lim>0,ORDSETFOCUS(mord_lim),)
        RETURN .T.
ELSE
        SELE(msel_lim);IF(mord_lim>0,ORDSETFOCUS(mord_lim),)
        RETURN .F.
ENDIF
SELE(msel_lim);IF(mord_lim>0,ORDSETFOCUS(mord_lim),)
RETURN .F.
******************************** F I M ************************************88
#include "inkey.ch"              // constantes de codigos das teclas
MEMVAR getlist
***********************
* VERIFICA O ENVELOPE
***********************

FUNCTION ver_envelope(menv,t,ali)

LOCAL msele,morde,malias
*IF VAL(SUBSTR(menv,1,2))=0;RETURN .T.;ENDIF
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacped_s','ped_s');RETURN NIL;ENDIF
IF ! AbriArq('sacorcam','orcam');RETURN NIL;ENDIF
IF ali = '*'
        malias := 'orcam'
ELSE
        malias := 'ped_s'
ENDIF
***************
SELE(malias);ORDSETFOCUS(10)
GO TOP
***************
IF (malias)->(DBSEEK(menv))
        IF t = NIL
                atencao('Este envelope ja foi solicitado no PEDIDO No.: '+(malias)->pnum_ped)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ELSE
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
ELSE
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
RETURN NIL
***************************** F I M ****************************************

***************************
* VER ALIQUOTA DO FINANCIAMENTO
***************************

FUNCTION ver_aliq(mcod,mtip)
************************

LOCAL msele,morder
MEMVAR maliq_fin

msele := SELE()
morder := INDEXORD()

***************
SELE('fin');ORDSETFOCUS(1)
GO TOP
***************

IF ! fin->(DBSEEK(STRZERO(mcod,3)+mtip))
        atencao('Esta Tipo de financiamento nao esta cadastrado !!!')
        SELE(msele);IF(morder>0,ORDSETFOCUS(morder),)
        RETURN .F.
ENDIF
maliq_fin := fin->aliq_fin
SELE(msele);IF(morder>0,ORDSETFOCUS(morder),)
RETURN .T.
**************************** F I M ****************************************
**************************************
* FUNCAO PARA DUPLICATAS POR CLIENTE
**************************************

FUNCTION cli_dup(mcod,mcred,mdocu)
**********************************

LOCAL mduplicata:=' ',msele,morde,mali_dup:='    ',mvd:=0,cons_cred:={},mcomando,mcom,cons_c:={}

mcom := "SELECT * FROM saccli WHERE cod_cli = "+sr_cdbvalue(STRZERO(mcod,5))
sr_getconnection():exec(mcom,,.t.,@cons_c)
IF LEN(cons_c) = 0 
	atencao('Nao foi possivel encontrar este CLIENTE...')
        RETURN mduplicata
ENDIF	
IF (STRZERO(mcod,5) = m_set[1,84] .OR. cons_c[1,42] = 'N') .AND. mcred = NIL
        RETURN mduplicata
ENDIF
cons_cred := {}
IF mcred = NIL
        mcomando := "SELECT * FROM sacdupr WHERE fornec = "+sr_cdbvalue(STRZERO(mcod,5))+" AND (pago IS NULL OR pago = ' ')"
        IF mdocu <> NIL
                mcomando := mcomando + " AND duplicata = "+sr_cdbvalue(mdocu)
        ENDIF
ELSE
        mcomando := "SELECT * FROM saccred WHERE fornec = "+sr_cdbvalue(STRZERO(mcod,5))+" AND (pago IS NULL OR pago = ' ')"
        IF mdocu <> NIL
                mcomando := mcomando + " AND duplicata = "+sr_cdbvalue(mdocu)
        ENDIF
ENDIF
sr_getconnection():exec(mcomando,,.t.,@cons_cred)
IF LEN(cons_cred) > 0
        FOR c = 1 TO LEN(cons_cred)
                mduplicata := mduplicata + ' Doc.:'+cons_cred[c,2]+RTRIM(cons_cred[c,4])
                IF mcred <> NIL
                        mvd := mvd + cons_cred[c,19]
                ENDIF
        NEXT
ENDIF
IF mcred = NIL
        RETURN mduplicata
ELSE
        RETURN mvd
ENDIF
******************************** F I M ************************************88
*********************************
 * CONSULTAR CREDITO DO CLIENTE
 *********************************
 FUNCTION c_credito()
 ********************
LOCAL conscred:={},i:=0,point:=0,li:=0,ci:=0,la:=21,ca:=63,mconsdupr:={},;
      mcont_doc:=0,mtotal_doc:=0

mcomando := "SELECT * FROM saccred WHERE fornec = "+sr_cdbvalue(STRZERO(mcod_cli,5))+" AND (pago IS NULL OR pago = ' ')"
sr_getconnection():exec(mcomando,,.t.,@conscred)
FOR i = 1 TO LEN(conscred)
        AADD(mconsdupr,' '+conscred[i,2]+' '+conscred[i,4]+' '+conscred[i,26]+'  '+conscred[i,3]+'   '+DTOC(conscred[i,11])+'   '+TRANSFORM(conscred[i,19],'999,999.99')+' '+conscred[i,28]+' '+IF(! EMPTY(conscred[i,43]),'S/F','   ')+' '+conscred[i,1])
        mcont_doc ++
        mtotal_doc := mtotal_doc + conscred[i,19]
NEXT
op_tela(li,ci,la+2,ca,'CONSULTA DE CREDITO DO CLIENTES')
mensagem('<ESC> Retorna  -  <ENTER> p/Confirmar')
setcor(3)
DEVPOS(li+1,ci+01);DEVOUT('Documento')
DEVPOS(li+1,ci+18);DEVOUT('Op')
DEVPOS(li+1,ci+21);DEVOUT(' No.')
DEVPOS(li+1,ci+27);DEVOUT('Vencimento')
DEVPOS(li+1,ci+44);DEVOUT('Valor')
DEVPOS(li+1,ci+56);DEVOUT('Emp')
@ li+2,ci+1 TO li+2,ca-1
@ la-2,ci+1 TO la-2,ca-1
DEVPOS(la-1,ci+1);DEVOUT('Quantidade:')
DEVPOS(la-1,ci+24);DEVOUT('Total:')
setcor(1)
DEVPOS(la-1,ci+13);DEVOUT(STRZERO(mcont_doc,4))
DEVPOS(la-1,ci+31);DEVOUT(TRANSFORM(mtotal_doc,'9,999,999.99'))
point := ACHOICE(li+3,ci+1,la-3,ca-1,mconsdupr,,,point)
wvw_lclosewindow()
DO CASE
        CASE LASTKEY()=27
                RETURN 0
                mn_cred := SPACE(8)
        CASE LASTKEY() = 13
                mn_cred := conscred[point,4]
                RETURN conscred[point,4]
ENDCASE
RETURN 0
******************************** F I M ************************************88
* FUNCAO P/EMISSAO DE CARNES
*****************************
FUNCTION emi_carne(mn)

LOCAL lci,cci,lba,cba,opcao,tela_emi,mnum_p,i,mtp_carne:='F',mdocumento := SPACE(12),mcliente,cons_c:={}

PRIVATE mtipo_imp,mimp_tipo:=0,marq:=SPACE(35)

lci := cci := 0
lba := 03
cba := 45
tela_emi := SAVESCREEN(00,00,24,79)
IF mn = NIL
        mnum_p := 0
ELSE
        mnum_p := mn
ENDIF
IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
op_tela(10,10,15,65,' Emissao de Carnes ')
WHILE .T.
        exibi_prg('F:EMI_CARNE')
        mtipo_imp := m_cfg[36]
        mtp_carne := 'F'
        mdocumento := SPACE(12)
        ****************************
        SELE('dupr');ORDSETFOCUS(7)
        //GO TOP
        ****************************
        DEVPOS(lci+1,cci+1);DEVOUT('Digite No.do Pedido.............:')
        DEVPOS(lci+2,cci+1);DEVOUT('Digite No.Documento(Parcela)....:')
        DEVPOS(lci+3,cci+1);DEVOUT('Tipo Carne [F]ormulario [B]obina:')
        @ lci+1,cci+35 GET mnum_p PICT '999999' WHEN mn = NIL
        @ lci+2,cci+35 GET mdocumento PICT '@!' VALID lim_get() WHEN men_get(7,7,'Digite o Documento (Parcela) que deseja ou deixe em branco para todas as Parcelas')
        @ lci+3,cci+35 GET mtp_carne PICT '@!' VALID mtp_carne $ 'F,B'
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        IF ! dupr->(DBSEEK(STRZERO(mnum_p,6)))
                atencao('Nao foi possivel encontrar este PEDIDO')
                LOOP
        ENDIF
        /*
        opcao := op_simnao('S','Confirma a emissao dos carnes:')
        IF opcao = 'N'
                EXIT
        ENDIF
        */
        IF ! imp_arq('EMI_CARNE.REL','D')
                LOOP
        ENDIF
        i := 0
        WHILE STRZERO(mnum_p,6) = dupr->num_ped .AND. ! EOF()
                IF ! EMPTY(dupr->datpag) .OR. (! EMPTY(mdocumento) .AND. mdocumento <> dupr->duplicata)
                        SKIP
                        LOOP
                ENDIF
		cons_c := {}		
		sr_getconnection():exec("SELECT * FROM saccli WHERE cod_cli = "+sr_cdbvalue(dupr->fornec),,.t.,@cons_c)
		IF LEN(cons_c) = 0 
			mcliente := SPACE(40)
		ELSE
			mcliente := cons_c[1,3]
		ENDIF
                IF mtp_carne = 'F'
                        imprt(mtipo_imp,'N')
                        imprt(mtipo_imp,'W1')
                        imprt(mtipo_imp,'N+')
                        IF mmult_emp = 'N'
                                DEVPOS(PROW()+1,04);DEVOUT(memp_resa)
                                DEVPOS(PROW(),19);DEVOUT(memp_resa)
                        ELSE
                                ver_emp(dupr->empresa)
                                DEVPOS(PROW()+1,04);DEVOUT(ALLTRIM(IF(emp->nome_cab = 'F',emp->fantasia,emp->razao)))
                                DEVPOS(PROW(),19);DEVOUT(ALLTRIM(IF(emp->nome_cab = 'F',emp->fantasia,emp->razao)))
                        ENDIF
                        imprt(mtipo_imp,'N-')
                        imprt(mtipo_imp,'W0')
                        imprt(mtipo_imp,'N')
                        DEVPOS(PROW()+1,05);DEVOUT(REPLI('-',28))
                        DEVPOS(PROW(),36);DEVOUT(REPLI('-',28))
                        imprt(mtipo_imp,'C')
                        //DEVPOS(PROW()+1,08);DEVOUT(dupr->fornec+'-'+dupr->cliente)

                        DEVPOS(PROW()+1,08);DEVOUT(dupr->fornec+'-'+mcliente)
                        DEVPOS(PROW(),62);DEVOUT(dupr->fornec+'-'+mcliente)
                        imprt(mtipo_imp,'N')
                        DEVPOS(PROW()+1,05);DEVOUT('No.Documento.: '+dupr->tipo+dupr->duplicata)
                        DEVPOS(PROW(),33);DEVOUT('|')
                        DEVPOS(PROW(),36);DEVOUT('No.Documento.: '+dupr->tipo+dupr->duplicata)
                        DEVPOS(PROW()+1,05);DEVOUT('Data Emissao.: '+DTOC(dupr->emissao))
                        DEVPOS(PROW(),33);DEVOUT('|')
                        DEVPOS(PROW(),36);DEVOUT('Data Emissao.: '+DTOC(dupr->emissao))
                        DEVPOS(PROW()+1,05);DEVOUT('Vencimento...: '+DTOC(dupr->venc))
                        DEVPOS(PROW(),33);DEVOUT('|')
                        DEVPOS(PROW(),36);DEVOUT('Vencimento...: '+DTOC(dupr->venc))
                        DEVPOS(PROW()+1,05);DEVOUT('Valor R$.....: '+TRANSFORM(dupr->valor,'999,999.99'))
                        DEVPOS(PROW(),33);DEVOUT('|')
                        DEVPOS(PROW(),36);DEVOUT('Valor R$.....: '+TRANSFORM(dupr->valor,'999,999.99'))
                        DEVPOS(PROW()+1,33);DEVOUT('|')
                        DEVPOS(PROW()+1,05);DEVOUT('Multa R$.....: -----------')
                        DEVPOS(PROW(),33);DEVOUT('|')
                        DEVPOS(PROW(),36);DEVOUT('Multa R$.....: -----------')
                        DEVPOS(PROW()+1,05);DEVOUT('Juros R$.....: -----------')
                        DEVPOS(PROW(),33);DEVOUT('|')
                        DEVPOS(PROW(),36);DEVOUT('Juros R$.....: -----------')
                        DEVPOS(PROW()+1,05);DEVOUT('Total Pago R$: -----------')
                        DEVPOS(PROW(),33);DEVOUT('|')
                        DEVPOS(PROW(),36);DEVOUT('Total Pago R$: -----------')
                        DEVPOS(PROW()+1,05);DEVOUT('No.Pedido...: '+dupr->num_ped)
                        DEVPOS(PROW(),33);DEVOUT('|')
                        DEVPOS(PROW(),36);DEVOUT('No.Pedido...: '+dupr->num_ped)
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,10);DEVOUT('OBS.: Multa de '+ALLTRIM(TRANSFORM(m_set[1,50],'999.99'))+'% e Juros de '+ALLTRIM(TRANSFORM(m_set[1,51],'999.99'))+'% ao dia')
                        DEVPOS(PROW(),62);DEVOUT('OBS.: Multa de '+ALLTRIM(TRANSFORM(m_set[1,50],'999.99'))+'% e Juros de '+ALLTRIM(TRANSFORM(m_set[1,51],'999.99'))+'% ao dia')
                        imprt(mtipo_imp,'N')
                        DEVPOS(PROW()+2,05);DEVOUT(REPLI('-',60))
                        DEVPOS(PROW()+2,00);DEVOUT(' ')
                        i ++
                        IF i = 3
                                EJECT
                                i := 0
                        ENDIF
                ELSE
                        imprt(mtipo_imp,'N')
                        IF mmult_emp = 'N'
                                DEVPOS(PROW()+5,00);DEVOUT(memp_resa)
                        ELSE
                                ver_emp(dupr->empresa)
                                DEVPOS(PROW()+5,00);DEVOUT(ALLTRIM(IF(emp->nome_cab = 'F',emp->fantasia,emp->razao)))
                        ENDIF
                        //DEVPOS(PROW()+5,00);DEVOUT(LEFT(ALLTRIM(m_set[1,125])+' '+ALLTRIM(m_set[1,126]),15))
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',50))
                        DEVPOS(PROW()+1,00);DEVOUT('Cliente: '+dupr->fornec+'-'+mcliente)
                        imprt(mtipo_imp,'N')
                        DEVPOS(PROW()+1,02);DEVOUT('No.Documento.: '+dupr->tipo+dupr->duplicata)
                        DEVPOS(PROW()+1,02);DEVOUT('Data Emissao.: '+DTOC(dupr->emissao))
                        DEVPOS(PROW()+1,02);DEVOUT('Vencimento...: '+DTOC(dupr->venc))
                        DEVPOS(PROW()+1,02);DEVOUT('Valor R$.....: '+TRANSFORM(dupr->valor,'999,999.99'))
                        DEVPOS(PROW()+1,02);DEVOUT('Multa R$.....: -----------')
                        DEVPOS(PROW()+1,02);DEVOUT('Juros R$.....: -----------')
                        DEVPOS(PROW()+1,02);DEVOUT('Total Pago R$: -----------')
                        DEVPOS(PROW()+1,02);DEVOUT('No.Pedido...: '+dupr->num_ped)
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',50))
                        DEVPOS(PROW()+1,00);DEVOUT('OBS.: Multa de '+ALLTRIM(TRANSFORM(m_set[1,50],'999.99'))+'% e Juros de '+ALLTRIM(TRANSFORM(m_set[1,51],'999.99'))+'% ao dia')
                        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',50))
                        DEVPOS(PROW()+3,00);DEVOUT('------------------- Corte aqui -------------------')
                        // 2a. parte
                        imprt(mtipo_imp,'N')
                        IF mmult_emp = 'N'
                                DEVPOS(PROW()+5,00);DEVOUT(memp_resa)
                        ELSE
                                ver_emp(dupr->empresa)
                                DEVPOS(PROW()+5,00);DEVOUT(ALLTRIM(IF(emp->nome_cab = 'F',emp->fantasia,emp->razao)))
                        ENDIF
                        //DEVPOS(PROW()+5,00);DEVOUT(LEFT(ALLTRIM(m_set[1,125])+' '+ALLTRIM(m_set[1,126]),15))
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',50))
                        DEVPOS(PROW()+1,00);DEVOUT('Cliente: '+dupr->fornec+'-'+mcliente)
                        imprt(mtipo_imp,'N')
                        DEVPOS(PROW()+1,02);DEVOUT('No.Documento.: '+dupr->tipo+dupr->duplicata)
                        DEVPOS(PROW()+1,02);DEVOUT('Data Emissao.: '+DTOC(dupr->emissao))
                        DEVPOS(PROW()+1,02);DEVOUT('Vencimento...: '+DTOC(dupr->venc))
                        DEVPOS(PROW()+1,02);DEVOUT('Valor R$.....: '+TRANSFORM(dupr->valor,'999,999.99'))
                        DEVPOS(PROW()+1,02);DEVOUT('Multa R$.....: -----------')
                        DEVPOS(PROW()+1,02);DEVOUT('Juros R$.....: -----------')
                        DEVPOS(PROW()+1,02);DEVOUT('Total Pago R$: -----------')
                        DEVPOS(PROW()+1,02);DEVOUT('No.Pedido...: '+dupr->num_ped)
                        imprt(mtipo_imp,'C')
                        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',50))
                        DEVPOS(PROW()+1,00);DEVOUT('OBS.: Multa de '+ALLTRIM(TRANSFORM(m_set[1,50],'999.99'))+'% e Juros de '+ALLTRIM(TRANSFORM(m_set[1,51],'999.99'))+'% ao dia')
                        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',50))
                        DEVPOS(PROW()+3,00);DEVOUT('------------------- Corte aqui -------------------')
                ENDIF
                SKIP
        ENDDO
        IF mtp_carne = 'F'
                IF PROW() > 0;EJECT;ENDIF
        ELSE
                DEVPOS(PROW()+11,00);DEVOUT('')
        ENDIF
        SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
        conf_impressao('EMI_CARNE.REL')
        IF mn <> NIL
                EXIT
        ENDIF
ENDDO
wvw_lclosewindow()
RETURN NIL
******************************** F I M ************************************88
********************************
* FUNCAO P/CONSULTAR TRANSPORTADORA
********************************

FUNCTION f5_trans(mnome,mcgc,mend,mmun,muf,minsc,mplaca,mcod)
*******************************************************

LOCAL lci,cci,lba,cba,point,msele,morde,m_transp:={},m_point:={},opcao
MEMVAR mcgccpf,mcpf,mcod_tran
msele := SELE()
morde := INDEXORD()
lci := cci := 0
lba := 22
cba := 40
setcor(1)
************
SELE('tran');ORDSETFOCUS(2)
GO TOP
*************
IF ! EMPTY(mcod)
        ************
        SELE('tran');ORDSETFOCUS(1)
        GO TOP
        *************
        IF tran->(DBSEEK(mcod))
                mnome := tran->razao
                IF ! EMPTY(tran->cgc)
                        mcgc := tran->cgc
                        mcgccpf := 'tran->CGC'
                ELSEIF ! EMPTY(tran->cpf)
                        mcgc := tran->cpf
                        mcgccpf := 'CPF'
                ENDIF
                mcod := tran->cod_tran
                mend := tran->endereco
                mmun := tran->cidade
                muf := tran->uf
                minsc := tran->insc
                mplaca := tran->placa
                mensagem('Preencha os Campos - <ESC> p/Retornar ')
                ******************
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                ******************
                RETURN NIL
        ENDIF
ENDIF
ASIZE(m_transp,0)
ASIZE(m_point,0)
WHILE ! EOF()
        AADD(m_transp,tran->razao+' - '+tran->cod_tran)
        AADD(m_point,RECNO())
        SKIP
ENDDO
op_tela(lci,cci,lba+2,cba,' Consulta de Transportadoras ','*')
WHILE .T.
        setcor(3)
        point := ACHOICE(lci,cci+1,lba,cba-1,m_transp)
        IF point = 0
                ******************
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                ******************
                EXIT
        ELSE
                GO m_point[point]
                mnome := tran->razao
                IF ! EMPTY(tran->cgc)
                        mcgc := tran->cgc
                        mcgccpf := 'CGC'
                ELSEIF ! EMPTY(tran->cpf)
                        mcgc := tran->cpf
                        mcgccpf := 'CPF'
                ENDIF
                mcod_tran := tran->cod_tran
                mend := tran->endereco
                mmun := tran->cidade
                muf := tran->uf
                minsc := tran->insc
                mplaca := tran->placa
                mensagem('Preencha os Campos - <ESC> p/Retornar ')
                ******************
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                ******************
                EXIT
        ENDIF
ENDDO
setcor(1)
wvw_lclosewindow()
RETURN NIL
*********************** F I M ************************************************
*******************************************
* FUNCAO PARA VERIFICAR COD.NAT.OPERACAO
*******************************************
FUNCTION ver_nat(cod,mt_p,li,co)
*********************
LOCAL msele,morde,cons_nat
MEMVAR mnatureza,mcredito,msai_ent
IF EMPTY(cod)
        RETURN .T.
ENDIF
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacop','op');RETURN NIL;ENDIF
*****************
SELE('op');ORDSETFOCUS(1)
GO TOP
*****************
IF ! op->(DBSEEK(cod))
        atencao('Este CFOP: '+cod+'  nao esta cadastrado em nossos arquivos !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ELSE
        IF op->sai_ent = 'S' .AND. mt_p = 'E'
                atencao('Este CFOP e de SAIDA por isso nao pode ser usado na ENTRADA DE MERCADORIA')
                RETURN .F.
        ENDIF
        mnatureza := op->descr_op
        mcredito  := op->credito
        msai_ent  := op->sai_ent
        IF li # NIL
                DEVPOS(li,co);DEVOUT(mnatureza)
        ENDIF
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
RETURN NIL
********************** F I M ********************************
*****************************
FUNCTION icm_merc(cod)
*****************************
LOCAL msele,morde
MEMVAR mdif_icm,micm_sub
msele := SELE()
morde := INDEXORD()
****************
SELE('merc');ORDSETFOCUS(1)
GO TOP
****************
IF ! merc->(DBSEEK(STRZERO(cod,5)))
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
mdif_icm := merc->bebida
micm_sub := merc->icm_sub
RETURN NIL

**************************** F I M ******************************************
*****************************************
* APAGA O ARQUIVOI DE CONTROLE "HRB.001"
*****************************************
FUNCTION apaga_hrb()
mensagem('Ajustando o ambiente do sistema HRB.001')
WHILE .T.
        MYRUN('DEL HRB.001')
        IF ! SR_PhFile('HRB.001')
                EXIT
        ENDIF
ENDDO
RETURN NIL
**************************** F I M ******************************************
*****************************************
* VERIFICA A ATUALIZACAO DO INVENTARIO
*****************************************
FUNCTION inventario
*******************
LOCAL mprg:='INVENTARIO',;
      mano:='  ',mmes:= '  ',mdata,m_inventario,m_merc,i:=0

IF ! ver_nivel(mprg,'FECHAMENTO DO MES','1',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF

op_tela(10,10,12,70,' FECHAMENTO DO MES ')
DEVPOS(00,01);DEVOUT('Digite o MES:')
DEVPOS(01,01);DEVOUT('Digite o ANO:')
@ 00,15 GET mmes PICT "99" VALID mmes $ '01,02,03,04,05,06,07,08,09,10,11,12'
@ 01,15 GET mano PICT "99" VALID IF(EMPTY(mano),.F.,.T.)
READ
IF LASTKEY() = 27
        wvw_lclosewindow()
        RETURN NIL
ENDIF
IF 'N' = op_simnao('N','Confirma a Operacao:')
        wvw_lclosewindow()
        RETURN NIL
ENDIF

mdata := mmes+'/'+mano
m_inventario := {}
sr_getconnection():exec("SELECT * FROM inventario WHERE mes_ano = "+sr_cdbvalue(mdata),,.t.,@m_inventario)
IF LEN(m_inventario) = 0
        m_merc := {}
        sr_getconnection():exec("SELECT * FROM sacmerc",,.t.,@m_merc)
        i:=0
        FOR i = 1 TO LEN(m_merc)
                mensagem('Aguarde um momento atualizando o INVENTARIO...'+STRZERO(1,5))
                sr_getconnection():exec('INSERT INTO inventario ('+;
                'mes_ano      '+;       //1
                ',data_atu    '+;       //2
                ',empresa     '+;       //3
                ',cod_barr    '+;       //4
                ',ref         '+;       //5
                ',gru_sub     '+;       //6
                ',cod_merc    '+;       //7
                ',merc        '+;       //8
                ',tipo_merc   '+;       //9
                ',data_cad    '+;       //10
                ',unidade     '+;       //11
                ',peso_liq    '+;       //12
                ',peso        '+;       //13
                ',est_min     '+;       //14
                ',est_max     '+;       //15
                ',cod_fab     '+;       //16
                ',pr_unit     '+;       //17
                ',vlr_merc    '+;       //18
                ',cust_merc   '+;       //19
                ',cust_real   '+;       //20
                ',pr_venda    '+;       //21
                ',saldo_fis   '+;       //22
                ',saldo_mer   '+;       //23
                ',saldo_est   '+;       //24
                ',icm         '+;       //25
                ',isento      '+;       //26
                ',bebida      '+;       //27
                ',icm_sub     '+;       //28
                ',icm_sub2    '+;       //29
                ',ipi         '+;       //30
                ',cod_clf     '+;       //31
                ',cod_fis     '+;       //32
                ',sittrib     '+;       //33
                ',prodepe     '+;       //34
                ',nbm         '+;       //35
                ',desc_icm    '+;       //36
                ',desc_icm1   '+;       //37
                ',local       '+;       //38
                ',gramatura   '+;       //39
                ',fatconv     '+;       //40
                ',dolar       '+;       //41
                ',aplic0      '+;       //42
                ',aplic1      '+;       //43
                ',aplic2      '+;       //44
                ',aplic3      '+;       //45
                ',aplic4      '+;       //46
                ',descri      '+;       //47
                ',SR_DELETED )'+;
                ' VALUES ('+;
                sr_cdbvalue(mdata)+','+;        //1
                sr_cdbvalue(mdata_sis)+','+;       //2
                sr_cdbvalue(m_merc[i,1])+','+;  //3
                sr_cdbvalue(m_merc[i,2])+','+;  //4
                sr_cdbvalue(m_merc[i,6])+','+;  //5
                sr_cdbvalue(m_merc[i,7])+','+;  //6
                sr_cdbvalue(m_merc[i,8])+','+;  //7
                sr_cdbvalue(m_merc[i,9])+','+;  //8
                sr_cdbvalue(m_merc[i,10])+','+;  //9
                sr_cdbvalue(m_merc[i,13])+','+;  //10
                sr_cdbvalue(m_merc[i,14])+','+;  //11
                sr_cdbvalue(m_merc[i,16])+','+;  //12
                sr_cdbvalue(m_merc[i,17])+','+;  //13
                sr_cdbvalue(m_merc[i,28])+','+;  //14
                sr_cdbvalue(m_merc[i,29])+','+;  //15
                sr_cdbvalue(m_merc[i,30])+','+;  //16
                sr_cdbvalue(m_merc[i,42])+','+;  //17
                sr_cdbvalue(m_merc[i,43])+','+;  //18
                sr_cdbvalue(m_merc[i,44])+','+;  //19
                sr_cdbvalue(m_merc[i,45])+','+;  //20
                sr_cdbvalue(m_merc[i,46])+','+;  //21
                sr_cdbvalue(m_merc[i,55])+','+;  //22
                sr_cdbvalue(m_merc[i,56])+','+;  //23
                sr_cdbvalue(m_merc[i,59])+','+;  //24
                sr_cdbvalue(m_merc[i,60])+','+;  //25
                sr_cdbvalue(m_merc[i,61])+','+;  //26
                sr_cdbvalue(m_merc[i,62])+','+;  //27
                sr_cdbvalue(m_merc[i,63])+','+;  //28
                sr_cdbvalue(m_merc[i,64])+','+;  //29
                sr_cdbvalue(m_merc[i,65])+','+;  //30
                sr_cdbvalue(m_merc[i,66])+','+;  //31
                sr_cdbvalue(m_merc[i,67])+','+;  //32
                sr_cdbvalue(m_merc[i,68])+','+;  //33
                sr_cdbvalue(m_merc[i,69])+','+;  //34
                sr_cdbvalue(m_merc[i,70])+','+;  //35
                sr_cdbvalue(m_merc[i,71])+','+;  //36
                sr_cdbvalue(m_merc[i,72])+','+;  //37
                sr_cdbvalue(m_merc[i,73])+','+;  //38
                sr_cdbvalue(m_merc[i,74])+','+;  //39
                sr_cdbvalue(m_merc[i,76])+','+;  //40
                sr_cdbvalue(m_merc[i,84])+','+;  //41
                sr_cdbvalue(m_merc[i,85])+','+;  //42
                sr_cdbvalue(m_merc[i,86])+','+;  //43
                sr_cdbvalue(m_merc[i,87])+','+;  //44
                sr_cdbvalue(m_merc[i,88])+','+;  //45
                sr_cdbvalue(m_merc[i,89])+','+;  //46
                sr_cdbvalue(m_merc[i,99])+','+;  //47
                sr_cdbvalue(' ')+')',,.f.)
        NEXT
        sr_getconnection():exec('COMMIT',,.f.)
	atencao('A Operacao foi realizada com sucesso...')
        wvw_lclosewindow()
        RETURN NIL
ELSE
	atencao('Ja foi Feito o Fechamento deste MES e ANO: '+mmes+'/'+mano)
ENDIF
wvw_lclosewindow()
RETURN NIL
**************************** F I M ******************************************
*****************************************
* VERIFICA DIGITO VERIFICADOR MODULO 11
*****************************************
FUNCTION dig_11(mnumero)
*******************
LOCAL m_numero:={},m_soma:={},i:=0,msoma,mdigito,mdig,mdivisao

mnumero :=  ALLTRIM(mnumero)
i:=0
FOR i = 1  TO LEN(mnumero)
        AADD(m_numero,VAL(SUBSTR(mnumero,i,1)))
        AADD(m_soma,0)
NEXT
i:=0


IF LEN(m_numero) = 12
        IF LEN(m_numero) >= 12 .AND. m_numero[12] > 0
                m_soma[12] := m_numero[12] * 2
        ENDIF
        IF LEN(m_numero) >= 11 .AND. m_numero[11] > 0
                m_soma[11] := m_numero[11] * 3
        ENDIF
        IF LEN(m_numero) >= 10 .AND. m_numero[10] > 0
                m_soma[10] := m_numero[10] * 4
        ENDIF
        IF LEN(m_numero) >= 9 .AND. m_numero[9] > 0
                m_soma[9] := m_numero[9] * 5
        ENDIF
        IF LEN(m_numero) >= 8 .AND. m_numero[8] > 0
                m_soma[8] := m_numero[8] * 6
        ENDIF
        IF LEN(m_numero) >= 7 .AND. m_numero[7] > 0
                m_soma[7] := m_numero[7] * 7
        ENDIF
        IF LEN(m_numero) >= 6 .AND. m_numero[6] > 0
                m_soma[6] := m_numero[6] * 8
        ENDIF
        IF LEN(m_numero) >= 5 .AND. m_numero[5] > 0
                m_soma[5] := m_numero[5] * 9
        ENDIF
        IF LEN(m_numero) >= 4 .AND. m_numero[4] > 0
                m_soma[4] := m_numero[4] * 2
        ENDIF
        IF LEN(m_numero) >= 3 .AND. m_numero[3] > 0
                m_soma[3] := m_numero[3] * 3
        ENDIF
        IF LEN(m_numero) >= 2 .AND. m_numero[2] > 0
                m_soma[2] := m_numero[2] * 4
        ENDIF
        IF LEN(m_numero) >= 1 .AND. m_numero[1] > 0
                m_soma[1] := m_numero[1] * 5
        ENDIF
ELSEIF LEN(m_numero) = 16
        IF LEN(m_numero) >= 16 .AND. m_numero[16] > 0
                m_soma[16] := m_numero[16] * 2
        ENDIF
        IF LEN(m_numero) >= 15 .AND. m_numero[15] > 0
                m_soma[15] := m_numero[15] * 3
        ENDIF
        IF LEN(m_numero) >= 14 .AND. m_numero[14] > 0
                m_soma[14] := m_numero[14] * 4
        ENDIF
        IF LEN(m_numero) >= 13 .AND. m_numero[13] > 0
                m_soma[13] := m_numero[13] * 5
        ENDIF
        IF LEN(m_numero) >= 12 .AND. m_numero[12] > 0
                m_soma[12] := m_numero[12] * 6
        ENDIF
        IF LEN(m_numero) >= 11 .AND. m_numero[11] > 0
                m_soma[11] := m_numero[11] * 7
        ENDIF
        IF LEN(m_numero) >= 10 .AND. m_numero[10] > 0
                m_soma[10] := m_numero[10] * 8
        ENDIF
        IF LEN(m_numero) >= 9 .AND. m_numero[9] > 0
                m_soma[9] := m_numero[9] * 9
        ENDIF
        IF LEN(m_numero) >= 8 .AND. m_numero[8] > 0
                m_soma[8] := m_numero[8] * 2
        ENDIF
        IF LEN(m_numero) >= 7 .AND. m_numero[7] > 0
                m_soma[7] := m_numero[7] * 3
        ENDIF
        IF LEN(m_numero) >= 6 .AND. m_numero[6] > 0
                m_soma[6] := m_numero[6] * 4
        ENDIF
        IF LEN(m_numero) >= 5 .AND. m_numero[5] > 0
                m_soma[5] := m_numero[5] * 5
        ENDIF
        IF LEN(m_numero) >= 4 .AND. m_numero[4] > 0
                m_soma[4] := m_numero[4] * 6
        ENDIF
        IF LEN(m_numero) >= 3 .AND. m_numero[3] > 0
                m_soma[3] := m_numero[3] * 7
        ENDIF
        IF LEN(m_numero) >= 2 .AND. m_numero[2] > 0
                m_soma[2] := m_numero[2] * 8
        ENDIF
        IF LEN(m_numero) >= 1 .AND. m_numero[1] > 0
                m_soma[1] := m_numero[1] * 9
        ENDIF
ELSEIF LEN(m_numero) = 10
        IF LEN(m_numero) >= 10 .AND. m_numero[10] > 0
                m_soma[10] := m_numero[10] * 2
        ENDIF
        IF LEN(m_numero) >= 9 .AND. m_numero[9] > 0
                m_soma[9] := m_numero[9] * 3 
        ENDIF
        IF LEN(m_numero) >= 8 .AND. m_numero[8] > 0
                m_soma[8] := m_numero[8] * 4
        ENDIF
        IF LEN(m_numero) >= 7 .AND. m_numero[7] > 0
                m_soma[7] := m_numero[7] * 5
        ENDIF
        IF LEN(m_numero) >= 6 .AND. m_numero[6] > 0
                m_soma[6] := m_numero[6] * 6
        ENDIF
        IF LEN(m_numero) >= 5 .AND. m_numero[5] > 0
                m_soma[5] := m_numero[5] * 7
        ENDIF
        IF LEN(m_numero) >= 4 .AND. m_numero[4] > 0
                m_soma[4] := m_numero[4] * 8
        ENDIF
        IF LEN(m_numero) >= 3 .AND. m_numero[3] > 0
                m_soma[3] := m_numero[3] * 9
        ENDIF
        IF LEN(m_numero) >= 2 .AND. m_numero[2] > 0
                m_soma[2] := m_numero[2] * 2
        ENDIF
        IF LEN(m_numero) >= 1 .AND. m_numero[1] > 0
                m_soma[1] := m_numero[1] * 3
        ENDIF
ELSE
	atencao('Nao e possivel calcular o digito verificador deste Numero...')
	RETURN NIL
ENDIF
i := msoma := mdivisao := mresto := mdigito := 0
mdig := ' '
FOR i = 1  TO LEN(m_soma)
        msoma := msoma + m_soma[i]
NEXT
//atencao('soma:'+transform(msoma,'99999.99'))
mdivisao   := msoma / 11
//atencao('divisao:'+transform(mdivisao,'99999.99'))
mresto     := VAL(SUBSTR(TRANSFORM(mdivisao,'99999.99'),7,2))
//atencao('resto 1:'+transform(VAL(SUBSTR(TRANSFORM(mdivisao,'99999.99'),7,2)),'99'))
IF VAL(SUBSTR(TRANSFORM(mresto,'99'),2,1)) > 1
        mresto := VAL(SUBSTR(TRANSFORM(mresto,'99'),1,1)) + 1
ENDIF
IF mresto = 0
        RETURN '0'
ENDIF
//atencao('resto 2:'+TRANSFORM(mresto,'99'))

mdigito := 11 - mresto
mdig := STRZERO(mdigito,1)
RETURN mdig
************************************* F I M ********************************************
FUNCTION fecha_tela
wvw_lclosewindow()
RETURN NIL
************************************* F I M ********************************************

Function Cont_users
Local aret := {}
Local vCONT:=0
/*
   IF eTIPO_SQL="POSTGRESQL"
      cSQL := "select count(*) from pg_stat_activity"
   ELSEIF eTIPO_SQL="MYSQL"
      cSQL := "SELECT * FROM information_schema.`PROCESSLIST`"
   ELSEIF eTIPO_SQL="FIREBIRD"
*/
      cSQL := "SELECT MON$USER, MON$REMOTE_ADDRESS, MON$REMOTE_PID, MON$TIMESTAMP FROM MON$ATTACHMENTS WHERE MON$ATTACHMENT_ID <> CURRENT_CONNECTION"
   //ENDIF
   oSql := SR_GetConnection()
   osql:exec(cSQL ,,.t.,@aret)
/*
   IF eTIPO_SQL="POSTGRESQL"
      vCONT=(aret[1,1]/2)
   ELSEIF eTIPO_SQL="MYSQL"
      vCONT=(len(aret)/2)
   ELSEIF eTIPO_SQL="FIREBIRD"
*/
      vCONT=(len(aret)-1)
      IF vCONT=0
         vCONT=1
      ENDIF
  // ENDIF
Return(vCONT)
********************************** F I M ***************************************
*********************************
* CONSULTA DO RESUMO DO PRODUTO
*********************************
FUNCTION f8_prod(mc_prod,mki)
*************************
LOCAL c_m:={},OOPP:=' ',m_tab,m_p,vpoint,cons_tb

IF LASTKEY() = 27
        RETURN NIL
ENDIF
IF ! EMPTY(mc_prod) .AND. mki = 1
        mcod_merc := mc_prod
ENDIF

c_m:={}
sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(STRZERO(mcod_merc,5)),,.t.,@c_m)
IF LEN(c_m) = 0
        atencao('Produto: '+STRZERO(mcod_merc,5)+' nao encontrado...')
        RETURN .F.
ENDIF
WVW_SetMousePos(,00,00)
//SET KEY 289 TO
//op_tela(20,00,31,100,' RESUMO DO PRODUTO: '+STRZERO(mcod_merc,5)+' - '+c_m[1,9],,'*')
op_tela(10,00,35,100,' RESUMO DO PRODUTO: '+STRZERO(mcod_merc,5)+' - '+c_m[1,9],,'*')
mensagem('Tecle <ALT+F> P/Ampliar a Foto - <T>abela Cond.Pagamento - Qualquer tecle para Voltar')
DEVPOS(0,1);DEVOUT('Descricao Nota:')
DEVPOS(1,1);DEVOUT('Grupo.........:      Sub-Grupo:')
DEVPOS(2,1);DEVOUT('Codigo Barra:')
DEVPOS(2,32);DEVOUT('Un:')
DEVPOS(3,1);DEVOUT('Fabricante..:')
DEVPOS(5,1 );DEVOUT('Pr1:')
DEVPOS(5,17);DEVOUT('Pr2:')
DEVPOS(5,33);DEVOUT('Pr3:')
DEVPOS(5,49);DEVOUT('Pr4:')
DEVPOS(5,65);DEVOUT('Pr5:')
DEVPOS(6,1);DEVOUT('Aplicacao:')
setcor(3)
DEVPOS(0,16);DEVOUT(c_m[1,99])
DEVPOS(1,16);DEVOUT(SUBSTR(c_m[1,7],1,3))
DEVPOS(1,32);DEVOUT(SUBSTR(c_m[1,7],4,2))
DEVPOS(2,16);DEVOUT(c_m[1,2])
DEVPOS(2,36);DEVOUT(c_m[1,14])
DEVPOS(3,16);DEVOUT(c_m[1,30]+'-'+c_m[1,31])
DEVPOS(5,05);DEVOUT(TRANSFORM(c_m[1,46],ALLTRIM(m_set[1,98])))
DEVPOS(5,21);DEVOUT(TRANSFORM(c_m[1,47],ALLTRIM(m_set[1,98])))
DEVPOS(5,37);DEVOUT(TRANSFORM(c_m[1,100],ALLTRIM(m_set[1,98])))
DEVPOS(5,53);DEVOUT(TRANSFORM(c_m[1,101],ALLTRIM(m_set[1,98])))
DEVPOS(5,69);DEVOUT(TRANSFORM(c_m[1,102],ALLTRIM(m_set[1,98])))
IF ver_nivel('F8_PROD','VISUALIZAR OS CUSTO NA CONSULTA DE PRODUTO <F8>','1',nivel_acess,'*')
        setcor(1)
        DEVPOS(4,1);DEVOUT('V.M.: ')
        DEVPOS(4,25);DEVOUT('C.M.: ')
        DEVPOS(4,50);DEVOUT('C.R.: ')
        setcor(3)
        DEVPOS(4,07);DEVOUT(TRANSFORM(c_m[1,43],ALLTRIM(m_set[1,98])))
        DEVPOS(4,31);DEVOUT(TRANSFORM(c_m[1,44],ALLTRIM(m_set[1,98])))
        DEVPOS(4,56);DEVOUT(TRANSFORM(c_m[1,45],ALLTRIM(m_set[1,98])))
ENDIF
DEVPOS(6,11);DEVOUT(c_m[1,85])
DEVPOS(7,11);DEVOUT(c_m[1,86])
DEVPOS(8,11);DEVOUT(c_m[1,87])
DEVPOS(9,11);DEVOUT(c_m[1,88])
DEVPOS(10,11);DEVOUT(c_m[1,89])

@ 11,00 TO 11,100
DEVPOS(12,01);DEVOUT('  Tabelas                   Cond.     Valor R$   Vl.Parc.R$        Prazos')
@ 13,00 TO 13,100
setcor(1)
IF ! EMPTY(c_m[1,23])
        setcor(6)
        DEVPOS(0,70);DEVOUT('PROMOCAO')
        setcor(1)
ELSE
        setcor(3)
        DEVPOS(0,70);DEVOUT('          ')
        setcor(1)
ENDIF
WVW_DrawLabel(,00,85,'P'+STRZERO(mcod_merc,5)+'.jpg',,,,, 'terminal',13,4,,,,,)
botao(01,82,09,98)
IF FILE(ALLTRIM(m_cfg[61])+'P'+STRZERO(mcod_merc,5)+'.jpg')
        WVW_DrawImage( ,01,82,09,98,ALLTRIM(m_cfg[61])+'P'+STRZERO(mcod_merc,5)+'.jpg',.T.,.F.)
ELSEIF FILE(ALLTRIM(m_cfg[61])+'P'+STRZERO(mcod_merc,5)+'.bmp')
        WVW_DrawImage( ,01,82,09,98,ALLTRIM(m_cfg[61])+'P'+STRZERO(mcod_merc,5)+'.bmp',.T.,.F.)
ENDIF
WVW_SetMouseMove(,.F.)
INKEY(0,255)
INKEY(0,255)
IF LASTKEY() = 289
        smedalbum('P',STRZERO(mcod_merc,5),c_m[1,9],m_cfg[61],m_cfg[5]+'\PRODUTO\')
ELSEIF LASTKEY() = 84 .OR. LASTKEY() = 116
        cons_tb := {}
        sr_getconnection():exec("SELECT * FROM sactabpg ORDER BY codigo",,.t.,@cons_tb)
        IF LEN(cons_tb) = 0
                atencao('Nao foi encontrado nenhuma TABELA..')
        ELSE
                m_tab := {}
                m_p  := {}
                vpoint  := i:=0
                FOR i = 1 TO LEN(cons_tb)
                        IF cons_tb[i,5] = 0;LOOP;ENDIF
                        AADD(m_tab,' '+cons_tb[i,3];
                                   +' - '+cons_tb[i,4];
                                   +'  '+SUBSTR(cons_tb[i,6],1,1)+'-'+SUBSTR(cons_tb[i,6],2);
                                   +'  '+TRANSFORM(c_m[1,46] * ((cons_tb[i,5] / 100) +1),ALLTRIM(m_set[1,98]));
                                   +'  '+TRANSFORM((c_m[1,46] * ((cons_tb[i,5] / 100) +1)) / (VAL(SUBSTR(cons_tb[i,6],1,1))+VAL(SUBSTR(cons_tb[i,6],2))),ALLTRIM(m_set[1,98]));
                                   +'  '+ALLTRIM(STR(cons_tb[i,7]))+'-'+ALLTRIM(STR(cons_tb[i,8]))+'-'+ALLTRIM(STR(cons_tb[i,9]))+'-'+ALLTRIM(STR(cons_tb[i,10]))+'-';
                                   +ALLTRIM(STR(cons_tb[i,11]))+'-'+ALLTRIM(STR(cons_tb[i,12]))+'-'+ALLTRIM(STR(cons_tb[i,13]))+'-'+ALLTRIM(STR(cons_tb[i,14]))+'-';
                                   +ALLTRIM(STR(cons_tb[i,15]))+'-'+ALLTRIM(STR(cons_tb[i,16]))+'-'+ALLTRIM(STR(cons_tb[i,17]))+'-'+ALLTRIM(STR(cons_tb[i,18]))+'-';
                                   +ALLTRIM(STR(cons_tb[i,19]))+'-'+ALLTRIM(STR(cons_tb[i,20]))+'-'+ALLTRIM(STR(cons_tb[i,21])))
                        AADD(m_p,cons_tb[i,25])
                NEXT
                vpoint := ACHOICE(14,01,44,99,m_tab,,,vpoint)
        ENDIF
ENDIF
WVW_SetMouseMove(,.F.)
wvw_lclosewindow()
RETURN .T.
*************************** f i m *******************************************

FUNCTION ver_banco(mnum_banco,mret)
**********************

LOCAL mcons_banco

IF EMPTY(mnum_banco)
        RETURN .F.
ENDIF
mcons_banco := {}
sr_getconnection():exec("SELECT * FROM sacbanco WHERE num_banco = "+sr_cdbvalue(mnum_banco),,.t.,@mcons_banco)
IF LEN(mcons_banco) = 0
        atencao('BANCO nao Cadastrado !!!')
        RETURN .F.
ENDIF
IF mret = NIL
        RETURN ALLTRIM(mcons_banco[1,1])
ELSEIF mret = 'N'
        RETURN ALLTRIM(mcons_banco[1,2])
ELSEIF mret = 'L'
        RETURN ALLTRIM(mcons_banco[1,13])
ENDIF
***************************  F I M  **********************************
***************************
* ALTERACAO DE MERCADORIA
***************************
FUNCTION alt_prod2(vcd_prod)
*****************
LOCAL li:=08,ci:=10,lb:=23,cb:=89,mp_venda:=0,mtelap,telapro,malt_merc:={}

MEMVAR mponto,mcod_merc,mquantd,mvlr_fat,menvelope,m_matriz,;
       m_codigo,ali,m_alt,lci,cci,lba,cba,opcao,mcomissao,cod_operado,;
       mproducao,mcont_item,mtot_ped,mdesconto,msubtotal,mtot_custo,mvarejo,;
       mperc,mcod_cli,mmasc_qtd,c_pedi,m_posi

op_tela(4,10,29,89,' ALTERACAO DE PRODUTOS ')
SETCOR(3)
DEVPOS(00,01);DEVOUT(' PRODUTO                                      QUANTD.    PR.UNIT.      TOTAL')
@ 01,00 TO 01,100
SETCOR(1)
mensagem('Escolha com as Setas e Tecle <ENTER>p/Alterar ou <ESC>p/Abandonar')
setcor(1)
c_pedi := {}
sr_getconnection():exec("SELECT * FROM sacped_s WHERE pnum_ped = "+sr_cdbvalue(STRZERO(mnum_ped,6)),,.t.,@c_pedi)
m_alt := {}
m_codigo := {}
m_posi := {}
i := 0
FOR i = 1 TO LEN(c_pedi)
        AADD(m_posi,c_pedi[i,107])
        AADD(m_codigo,c_pedi[i,6])
        IF RTRIM(c_pedi[i,8]) = 'EV'
                AADD(m_alt,c_pedi[i,6]+' '+LEFT(c_pedi[i,7],27)+' '+c_pedi[i,10]+' '+TRANSFORM(c_pedi[i,14],'99999.99')+' '+TRANSFORM(c_pedi[i,17],ALLTRIM('@E '+m_set[1,98]))+' '+TRANSFORM(c_pedi[i,17] * c_pedi[i,14],ALLTRIM('@E '+m_set[1,98])))
        ELSE
                AADD(m_alt,c_pedi[i,6]+' '+LEFT(c_pedi[i,7],38)+' '+TRANSFORM(c_pedi[i,14],'99999.99')+' '+TRANSFORM(c_pedi[i,17],ALLTRIM('@E '+m_set[1,98]))+' '+TRANSFORM(c_pedi[i,17] * c_pedi[i,14],ALLTRIM('@E '+m_set[1,98])))
        ENDIF
NEXT
mponto:=0
IF vcd_prod # NIL
        mponto := ASCAN(m_codigo,vcd_prod)
ENDIF
mponto := ACHOICE(02,01,27,78,m_alt,,,mponto)
wvw_lclosewindow()
IF mponto = 0
        RETURN .T.
ENDIF
op_tela(10,10,17,79,' ALTERACAO DE PRODUTOS ')
CLEAR GETS
DO WHILE .T.
        malt_merc := {}
        sr_getconnection():exec("SELECT * FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto]),,.t.,@malt_merc)
        IF LEN(malt_merc) = 0
                atencao('Codigo Barra nao cadastrado')
                LOOP
        ENDIF
        mcod_merc := VAL(malt_merc[1,8])
        IF EMPTY(mcod_merc)
		EXIT
        ENDIF
        DEVPOS(00,00);DEVOUT('Produto....:')
        IF RTRIM(c_pedi[mponto,8]) = 'EV'
                DEVPOS(01,00);DEVOUT('No.Envelope:')
        ELSEIF RTRIM(c_pedi[mponto,8]) = 'PL'
                DEVPOS(01,00);DEVOUT('No.Placa...:')
        ENDIF
/*
        IF m_matriz[mponto,6] = 'EV'
                DEVPOS(01,00);DEVOUT('No.Envelope:')
        ELSEIF m_matriz[mponto,6] = 'PL'
                DEVPOS(01,00);DEVOUT('No.Placa...:')
        ENDIF
*/
        DEVPOS(02,00);DEVOUT('Saldo......:')
        DEVPOS(03,00);DEVOUT('Quantidade.:')
        DEVPOS(04,00);DEVOUT('Prc.Tabela :')
        SETCOR(3)
        IF malt_merc[1,23] > 0
                WVW_DrawBoxGet(,04,14,10)
                DEVPOS(04,14);DEVOUT(TRANSFORM(malt_merc[1,46],'999,999.99'))
        ENDIF
        DEVPOS(05,00);DEVOUT('Preco Venda:')
        //setcor(3)
        DEVPOS(00,14);DEVOUT(STRZERO(mcod_merc,5))
        DEVPOS(00,COL()+1);DEVOUT(malt_merc[1,9])
        DEVPOS(02,14);DEVOUTPICT(malt_merc[1,56],ALLTRIM(m_set[1,98]))
        SETCOR(1)
        mvlr_fat = c_pedi[mponto,17]
        //mvlr_fat = m_matriz[mponto,2]
        mp_venda = malt_merc[1,46]
        IF ! EMPTY(malt_merc[1,23])
                mp_venda := mvlr_fat
                //SETCOLOR([6])
                @ 00,COL()+1 SAY '(P)'
        ENDIF
        mquantd = c_pedi[mponto,14]
        menvelope := c_pedi[mponto,10]
/*
        mquantd = m_matriz[mponto,1]
        menvelope := m_matriz[mponto,24]
*/
        setcor(1)
        IF RTRIM(c_pedi[mponto,8]) = 'EV'
                WVW_DrawBoxGet(,01,14,LEN(menvelope))
                @ 01,14 GET menvelope PICT '@!' VALID IF(EMPTY(menvelope),.F.,.T.)
                READ
        ELSEIF RTRIM(c_pedi[mponto,8]) = 'PL'
                WVW_DrawBoxGet(,01,14,LEN(menvelope))
                @ 01,14 GET menvelope PICT '@!' VALID IF(EMPTY(menvelope),.F.,.T.)
                READ
        ENDIF
        IF LASTKEY() = 27;EXIT;ENDIF
        mmasc_qtd := unidade(malt_merc[1,14])
        WVW_DrawBoxGet(,03,14,LEN(mmasc_qtd))
        @ 03,14 GET mquantd PICT mmasc_qtd WHEN men_get(lba-10,cci+42,'Informe a quantidade que deseja, so nao pode ultrapassar o saldo da mercadoria') VALID lim_get()
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        mpacote := mpecas := 0
        IF ! EMPTY(malt_merc[1,19]) .AND. mquantd > 0
                IF VAL(SUBSTR(TRANSFORM(mquantd/malt_merc[1,19],'999,999.99'),9)) > 0
                        mquantd_aux := VAL(SUBSTR(TRANSFORM(mquantd/malt_merc[1,19],'999,999.99'),1,7)) +1
                        mquantd := mquantd_aux * malt_merc[1,19]
                ENDIF
                mpacote := VAL(SUBSTR(TRANSFORM((mquantd/malt_merc[1,19])/malt_merc[1,20],'999,999.99'),1,7))
                mpecas  := VAL(SUBSTR(TRANSFORM((mquantd/malt_merc[1,19])/malt_merc[1,20],'999,999.9'),9))
                setcor(3,'*')
                DEVPOS(lba-6,cci+46);DEVOUTPICT(mquantd,ALLTRIM(mmasc_qtd))
                DEVPOS(lba-3,cci+05);DEVOUTPICT(mpacote,'9,999.99')
                DEVPOS(lba-3,cci+19);DEVOUTPICT(mpecas,'999')
                setcor(1)
        ENDIF
        //IF mquantd > malt_merc[1,56] + m_matriz[mponto,1] .AND. m_set[1,107] = 'S' .AND. ali = 'ped_s'
        IF mquantd > malt_merc[1,56] + c_pedi[mponto,14] .AND. m_set[1,107] = 'S' .AND. ali = 'ped_s'
                IF ! aut_sen('Quantidade maior que saldo... Senha de autorizacao:','LIB_SALDO',,'',STRZERO(mcod_merc,5))
                        EXIT
                ENDIF
        ENDIF
        IF mquantd = 0
                IF ver_serie() = '141414'
                        IF ! aut_sen('Quantidade menor que o Solicitador Anteriormente:','LIB_ALTSLDPED',,'')
                                LOOP
                        ENDIF
                ENDIF
                opcao := op_simnao('S','Confirma Exclusao da Mercadoria:')
                IF opcao = 'S'
                        c_ped := {}
                        sr_getconnection():exec("SELECT * FROM sacped_s WHERE pnum_ped = "+sr_cdbvalue(STRZERO(mnum_ped,6)),,.t.,@c_ped)
                        IF LEN(c_ped) = 1
                                atencao('Nao e possivel Excluir este Produto pois so existe (01) Um produto no pedido !!!!')
                                LOOP
                        ENDIF
                        mquantd = 0
                        aret:={}
                        mensagem('Atualizando o Produto...')
/*
                        IF mproducao = 'N'
                                cComm  := "SELECT saldo_est FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto])
                                sr_getconnection():exec(ccomm,,.t.,@aret)
                                ccomm :="UPDATE sacmerc SET saldo_est = "+sr_cdbvalue(aret[1,1] + c_pedi[mponto,14]) +" WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto])
                                sr_getconnection():exec(ccomm,,.f.)
                        ELSE
*/  
                                sr_getconnection():exec("SELECT saldo_mer,saldo_est FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto]),,.t.,@aret)
                                sr_getconnection():exec("UPDATE sacmerc SET saldo_mer = "+sr_cdbvalue(aret[1,1] + c_pedi[mponto,14])+" WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto]),,.f.)
/*
                                IF ver_serie() = '141235'
                                        ccomm :="UPDATE sacmerc SET saldo_est = "+sr_cdbvalue(aret[1,2] + c_pedi[mponto,14])+" WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto])
                                        sr_getconnection():exec(ccomm,,.f.)
                                ENDIF
*/
                                mensagem('Atualizando o Arquivo de LOG...')
                                sr_getconnection():exec('INSERT INTO logproduto (data_sis,data,'+;
                                                                                'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                                                'processo,ent_sai,SR_DELETED )'+;
                                                                                ' VALUES ('+;
                                                                                sr_cdbvalue(DATE())+','+; //1
                                                                                sr_cdbvalue(mdata_sis)+','+; //2
                                                                                sr_cdbvalue(TIME())+','+; //3
                                                                                sr_cdbvalue(m_codigo[mponto])+','+; //4
                                                                                sr_cdbvalue(c_pedi[mponto,14])+','+; //5
                                                                                sr_cdbvalue(aret[1,1])+','+; //6
                                                                                sr_cdbvalue(aret[1,1] + c_pedi[mponto,14] )+','+; //7
                                                                                sr_cdbvalue(cod_operado)+','+; //8
                                                                                sr_cdbvalue('SAC23PD1')+','+; //9
                                                                                sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                                                sr_cdbvalue('EXCLUSAO PD: '+STRZERO(mnum_ped,6))+','+; //11
                                                                                sr_cdbvalue('E')+','+; //11
                                                                                sr_cdbvalue(' ')+')',,.f.)
                        //ENDIF
                        mensagem('Atualizando o Arquivo de PEDIDO...')
                        sr_getconnection():exec("DELETE FROM sacped_s WHERE SR_RECNO = "+sr_cdbvalue(m_posi[mponto]),,.f.)
                        sr_getconnection():exec("COMMIT",,.f.)
                        **********
                        //SELE('merc');ORDSETFOCUS(1)
                        **********
                        m_codigo[mponto] = '     '
*                       m_merc[mponto] = SPACE(40)
                        m_matriz[mponto,1] := m_matriz[mponto,2] := ;
                        m_matriz[mponto,3] := 0
                        mcont_item --
                        DEVPOS(lba-2,cci+10);DEVOUT(STRZERO(mcont_item,3))
                        setcor(1)
                        mquantd := 1
                        EXIT
                ELSE
                        mquantd := 1
                        EXIT
                ENDIF
        ENDIF
        IF mvarejo = 2
                IF ! EMPTY(malt_merc[1,47])
                        mp_venda = malt_merc[1,47]
                ELSE
                        mp_venda = ROUND(malt_merc[1,46]*((malt_merc[1,50]/100)+1),m_set[1,103])
                ENDIF
        ELSEIF mperc > 0
                mp_venda = ROUND(malt_merc[1,46]*((mperc/100)+1),m_set[1,103])
        ELSEIF ver_descon(mcod_cli,mcod_merc,malt_merc[1,7]) > 0
                mp_venda = ROUND(malt_merc[1,46] - (malt_merc[1,46]*(ver_descon(mcod_cli,mcod_merc,malt_merc[1,7])/100)),m_set[1,103])
        ELSE
                mp_venda = ROUND(malt_merc[1,46],m_set[1,103])
        ENDIF
        mensagem('Digite o valor do produto - <ESC>Abandonar')
        WVW_DrawBoxGet(,05,14,LEN(ALLTRIM(m_set[1,98])))
        @ 05,14 GET mvlr_fat PICT ALLTRIM(m_set[1,98]) VALID IF(malt_merc[1,23] > 0 .AND. mvlr_fat < mp_venda,.F.,.T.) WHEN m_set[1,38] <> 'P'
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        IF ! EMPTY(m_set[1,154]) .AND. mvlr_fat > m_set[1,154]
                IF ! aut_sen('Valor por Produto Solicitada: '+ALLTRIM(TRANSFORM(mvlr_fat,'999,999,999.99'))+' maior que Permitido pela ADM: '+ALLTRIM(TRANSFORM(m_set[1,154],'999,999.99'))+' ... Senha de autorizacao:','LIB_SALDO',,'',STRZERO(mcod_merc,5))
                        LOOP
                ENDIF
        ENDIF
        IF ROUND(mp_venda,m_set[1,103]) > mvlr_fat
                IF ((ROUND(mp_venda,m_set[1,103]) - mvlr_fat)/ROUND(mp_venda,m_set[1,103]))*100 > m_set[1,33] .AND. EMPTY(malt_merc[1,80])
                        IF ! aut_sen(TRANSFORM(((ROUND(mp_venda,m_set[1,103]) - mvlr_fat)/ROUND(mp_venda,m_set[1,103]))*100,'999.99')+'% Desconto nao e permitido.. senha autorizacao:','LIB_DESC',,'',STRZERO(mcod_merc,5))
                                LOOP
                        ENDIF
                ENDIF
                IF (((ROUND(mp_venda,m_set[1,103]) - mvlr_fat)/ROUND(mp_venda,m_set[1,103]))*100 > malt_merc[1,80] .AND. ! EMPTY(malt_merc[1,80])) .AND. ! EMPTY(malt_merc[1,80])
                        IF ver_serie() = '141220' .OR. ver_serie() = '141350' .OR. ver_serie() = '141384'
                                atencao(TRANSFORM(((ROUND(mp_venda,m_set[1,103]) - mvlr_fat)/ROUND(mp_venda,m_set[1,103]))*100,'999.99')+'% Desconto nao e permitido.. ')
                                mquantd := 1
                                LOOP
                        ENDIF
                        IF ! aut_sen(TRANSFORM(((ROUND(mp_venda,m_set[1,103]) - mvlr_fat)/ROUND(mp_venda,m_set[1,103]))*100,'999.99')+'% Desconto nao e permitido.. senha autorizacao:','LIB_DESC',,'',STRZERO(mcod_merc,5))
                                LOOP
                        ENDIF
                ENDIF
        ENDIF
        IF m_set[1,38] = 'C'
                IF mvlr_fat < ROUND(mp_venda,m_set[1,103])
                       IF mvlr_fat < malt_merc[1,45]
                                IF ! aut_sen('Senha de autorizacao:','LIB_DESC',,'',STRZERO(mcod_merc,5))
                                        LOOP
                                ENDIF
                        ENDIF
                ENDIF
        ELSEIF m_set[1,38] = 'V'
                IF mvlr_fat < ROUND(mp_venda,m_set[1,103])
                       IF mvlr_fat < ROUND(mp_venda,m_set[1,103])
                                IF ! aut_sen('Senha de autorizacao:','LIB_DESC',,'',STRZERO(mcod_merc,5))
                                        LOOP
                                ENDIF
                        ENDIF
                ENDIF
        ENDIF
        IF m_set[1,37] = 'S'
                mmontador := VAL(c_pedi[mponto,36])
                mmontador1 := VAL(c_pedi[mponto,38])
/*
                mmontador := m_matriz[mponto,37]
                mmontador1 := m_matriz[mponto,38]
*/
                op_tela(10,25,13,75,' Informe o Montador ')
                DEVPOS(00,00);DEVOUT('Montador 1:')
                DEVPOS(01,00);DEVOUT('Montador 2:')
                WVW_DrawBoxGet(,00,14,3)
                WVW_DrawBoxGet(,01,14,3)
                @ 00,14 GET mmontador PICT '999' VALID ven(mmontador,00,18)
                @ 01,14 GET mmontador1 PICT '999' VALID IF(mmontador1 = mmontador,.F.,ven(mmontador1,01,18)) WHEN ! EMPTY(mmontador)
                READ
                opcao := op_simnao('S','Confirma os Montador:')
                wvw_lclosewindow()
                IF  opcao = 'N'
                        LOOP
                ENDIF
        ENDIF
        IF m_set[1,115] = 'S'
                //mcomissao := m_matriz[mponto,15]
                mcomissao := c_pedi[mponto,53]
                op_tela(10,10,11,65,'Comissao do Produto')
                DEVPOS(00,00);DEVOUT('Digite o percentual de Comissao do Vendedor [%]:')
                WVW_DrawBoxGet(,00,COL()+1,6)
                @ 00,COL()+1 GET mcomissao PICT '999.99' VALID IF(EMPTY(mcomissao),.F.,.T.)
                READ
                wvw_lclosewindow()
                IF LASTKEY() = 27
                        LOOP
                ENDIF
        ENDIF
        mtot_ped = 0
        mtot_ped = mvlr_fat * mquantd
        opcao := op_simnao('S','Confirma Alteracao da Mercadoria:')
        IF opcao = 'S'
                mdesconto := 0
*               IF mvlr_fat < ROUND(malt_merc[1,46],m_set[1,103])
*                       mdesconto := ((ROUND(malt_merc[1,46],m_set[1,103])-mvlr_fat)/ROUND(malt_merc[1,46],m_set[1,103]))*100
                IF mvlr_fat < ROUND(mp_venda,m_set[1,103])
                        mdesconto := ((ROUND(mp_venda,m_set[1,103])-mvlr_fat)/ROUND(mp_venda,m_set[1,103]))*100
                ENDIF
                aret:={}
/*
                IF mproducao = 'N'
                        
                        sr_getconnection():exec("SELECT saldo_est FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto]),,.t.,@aret)
                        sr_getconnection():exec("UPDATE sacmerc SET saldo_est = "+sr_cdbvalue(aret[1,1] - (mquantd - c_pedi[mponto,14])) +" WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto]),,.f.)
                ELSE
*/
                        
                        sr_getconnection():exec("SELECT saldo_mer,saldo_est FROM sacmerc WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto]),,.t.,@aret)
                        sr_getconnection():exec("UPDATE sacmerc SET saldo_mer = "+sr_cdbvalue(aret[1,1] - (mquantd - c_pedi[mponto,14]))+" WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto]),,.f.)
/*
                        IF ver_serie() = '141235'
                                ccomm :="UPDATE sacmerc SET saldo_est = "+sr_cdbvalue(aret[1,2] - (mquantd - c_pedi[mponto,14]))+" WHERE cod_merc = "+sr_cdbvalue(m_codigo[mponto])
                                sr_getconnection():exec(ccomm,,.f.)
                        ENDIF
*/
                        sr_getconnection():exec('INSERT INTO logproduto (data_sis,data,'+;
                                                             'hora,cod_prod,quantd,saldo_ant,saldo_pos,cod_oper,prog,terminal,'+;
                                                             'processo,ent_sai,SR_DELETED )'+;
                                                             ' VALUES ('+;
                                                             sr_cdbvalue(DATE())+','+; //1
                                                             sr_cdbvalue(mdata_sis)+','+; //2
                                                             sr_cdbvalue(TIME())+','+; //3
                                                             sr_cdbvalue(m_codigo[mponto])+','+; //4
                                                             sr_cdbvalue(IF(mquantd - c_pedi[mponto,14] < 0,(mquantd - c_pedi[mponto,14])*-1,mquantd - c_pedi[mponto,14]))+','+; //5
                                                             sr_cdbvalue(aret[1,1])+','+; //6
                                                             sr_cdbvalue(aret[1,1] - (mquantd - c_pedi[mponto,14]))+','+; //7
                                                             sr_cdbvalue(cod_operado)+','+; //8
                                                             sr_cdbvalue('SAC23PD1')+','+; //9
                                                             sr_cdbvalue(LEFT(NETNAME(),15))+','+; //12
                                                             sr_cdbvalue('ALTERACAO PD: '+STRZERO(mnum_ped,6))+','+; //11
                                                             sr_cdbvalue(IF(mquantd < c_pedi[mponto,14],'E','S'))+','+; //12
                                                             sr_cdbvalue(' ')+')',,.f.)
                //ENDIF
                cComm  := "UPDATE sacped_s SET pquantd = "+sr_cdbvalue(mquantd)
                cComm  := ccomm + ",pvlr_fat = "+sr_cdbvalue(mvlr_fat)
                cComm  := ccomm + ",ppre_dig = "+sr_cdbvalue(mvlr_fat)
                cComm  := ccomm + ",pdesc = "+sr_cdbvalue(mdesconto)
                cComm  := ccomm + ",pcomissao = "+sr_cdbvalue(mcomissao)
                cComm  := ccomm + ",penvelope = "+sr_cdbvalue(menvelope)
                cComm  := ccomm + ",pmontador = "+sr_cdbvalue(mmontador)
                cComm  := ccomm + ",pmontador1 = "+sr_cdbvalue(mmontador1)
                cComm  := ccomm + ",ppacote = "+sr_cdbvalue(mpacote)
                cComm  := ccomm + ",ppecas = "+sr_cdbvalue(mpecas)
                cComm  := ccomm + " WHERE SR_RECNO = "+sr_cdbvalue(m_posi[mponto])
                sr_getconnection():exec(ccomm,,.f.)
                sr_getconnection():exec("COMMIT",,.f.)

                m_matriz[mponto,1] = mquantd
                m_matriz[mponto,2] = mvlr_fat
                m_matriz[mponto,3] = mdesconto
                m_matriz[mponto,15] = mcomissao
                m_matriz[mponto,24] = menvelope
                m_matriz[mponto,37] = mmontador
                m_matriz[mponto,38] = mmontador1
                m_matriz[mponto,42] = mpacote
                m_matriz[mponto,43] = mpecas
                **********
                //SELE('merc');ORDSETFOCUS(1)
                **********
                mquantd := 1
                EXIT
        ELSE
                mquantd := 1
                EXIT
        ENDIF
ENDDO
malterou := '*'
CLEAR GETS
wvw_lclosewindow()
RETURN .T.
********************************** F I M ***************************************
FUNCTION tira_acento(mpalavra)
******************************
mpalavra := STRTRAN(mpalavra,'Ç','C')
mpalavra := STRTRAN(mpalavra,'ç','C')
mpalavra := STRTRAN(mpalavra,'á','A')
mpalavra := STRTRAN(mpalavra,'Á','A')
mpalavra := STRTRAN(mpalavra,'Ã','A')
mpalavra := STRTRAN(mpalavra,'ã','A')
mpalavra := STRTRAN(mpalavra,'Õ','O')
mpalavra := STRTRAN(mpalavra,'õ','O')
mpalavra := STRTRAN(mpalavra,'º','O')
mpalavra := STRTRAN(mpalavra,'ª','A')
mpalavra := STRTRAN(mpalavra,'','C')
mpalavra := STRTRAN(mpalavra,'','C')
RETURN mpalavra
********************************** F I M ***************************************
********************************
* AREDONDAMENTO DE NUMERO
********************************
FUNCTION iat(mvlr_iat,mind)
******************************
LOCAL mvalor,qtd
IF AT('.',m_set[1,97]) > 0
        qtd := LEN(SUBSTR(m_set[1,97],AT('.',m_set[1,97])+1))
ENDIF
IF mind = 'T'
        mvalor := VAL(SUBSTR(STR(mvlr_iat,16,5),1,11+qtd))
ELSE
        mvalor := ROUND(mvlr_iat,qtd)
ENDIF
RETURN mvalor












