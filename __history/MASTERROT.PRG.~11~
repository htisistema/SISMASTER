MEMVAR getlist,cod_operado,mcgc_firm,minsc_firm,nivel_acess,mdata_sis
*******************
FUNCTION calc_cus(consulta)
*******************
LOCAL msele,morde,icm_aux:=0,mmedio_ven,mtipo_preco,firm_aux:=0,pis_aux:=0,;
      confis_aux:=0,micm_calc:=0

MEMVAR mcod_merc,micm,mcod_op,micm_firm,mpis,mconfis,mvlr_merc,mcust_merc,mpr_unit,;
       mdesc1,mdesc2,mdesc3,mencargo_f,mipi,mfrete,mii,mdisp_asse,mvlr_icmsub,;
       mvlr_nota,mimposto,mp_lucro,mfator,mcust_real,mquantd,mpr_medio,mpr_venda,;
       mpercent,lci,cci,mnivel_cal,micmsub
msele := SELE()
morde := INDEXORD()
****************
SELE('merc');ORDSETFOCUS(1)
****************

SEEK STRZERO(mcod_merc,5)

micm_calc := icm_aux := micm
firm_aux := micm_firm
pis_aux  := mpis
confis_aux := mconfis
IF merc->isento = 'S'   //.OR. mcod_op = '02'
        micm_firm := micm_calc := mpis := mconfis := 0
ENDIF
IF mnivel_cal = '1'
        mvlr_merc := mpr_unit - (mpr_unit*(mdesc1/100))
        mvlr_merc := mvlr_merc - (mpr_unit*(mdesc2/100))
        mvlr_merc := mvlr_merc - (mpr_unit*(mdesc3/100))
        mvlr_merc := mvlr_merc + (ROUND(mvlr_merc * mencargo_f,2)) + (ROUND(mvlr_merc * mfrete,2))

        IF mipi > 0
                mcust_merc := mvlr_merc + (mvlr_merc * (mipi/100)) - (mvlr_merc * (micm_calc/100))
        ELSE
                mcust_merc := mvlr_merc * (100 - micm_calc)
                mcust_merc := mcust_merc / 100
        ENDIF
        IF mii > 0
                mcust_merc := mvlr_merc + (mvlr_merc * (mii/100))
        ENDIF
        IF mdisp_asse > 0
                mcust_merc := mcust_merc + (mvlr_merc * mdisp_asse)
        ENDIF
        micmsub := 0
        IF mvlr_icmsub > 0
                micmsub := (mvlr_merc * (mvlr_icmsub/mvlr_nota))
                mcust_merc := mcust_merc + micmsub
        ENDIF
        **********************************************************************
        mfator := 100 - (mpis + mconfis + micm_firm + mimposto + mp_lucro)
        **********************************************************************
        mcust_real := (mcust_merc / (100 - (micm_firm+mpis+mconfis+mimposto)))*100
        IF merc->saldo_mer > 0
                mpr_medio := ((mquantd * mcust_real) + (merc->saldo_mer * merc->pr_medio)) / (mquantd + merc->saldo_mer)
        ELSE
                mpr_medio := mcust_real
        ENDIF
        IF set->tp_lucro == 'O'
                mpr_venda := (mcust_merc / (100 - (micm_firm+mpis+mconfis+mimposto+mp_lucro)))*100
        ELSEIF set->tp_lucro == 'M'
                IF mpercent == 'P'
                        mpr_venda := mpr_medio * ((mp_lucro/100)+1)  // pelo CUSTO REAL
                ELSEIF mpercent == 'F'
                        mpr_venda := (mpr_medio / (100-mp_lucro)) * 100  // pelo CUSTO REAL
                ENDIF
        ELSEIF set->tp_lucro == 'R'
                IF mpercent == 'P'
                        mpr_venda := mcust_real * ((mp_lucro/100)+1)  // pelo CUSTO REAL
                ELSEIF mpercent == 'F'
                        mpr_venda := (mcust_real / (100-mp_lucro)) * 100  // pelo CUSTO REAL
                ENDIF
        ENDIF
        IF mcod_op = '04'
                mpr_unit4 := mpr_unit / IF(EMPTY(mper_vlr),1,mper_vlr/100)
                mvlr_merc4 := mpr_unit4 - (mpr_unit4*(mdesc1/100))
                mvlr_merc4 := mvlr_merc4 - (mpr_unit4*(mdesc2/100))
                mvlr_merc4 := mvlr_merc4 - (mpr_unit4*(mdesc3/100))
                mvlr_merc4 := mvlr_merc4 + (ROUND(mvlr_merc4 * mencargo_f,2)) + (ROUND(mvlr_merc4 * mfrete,2))

                IF mipi > 0
                        mcust_merc4 := mvlr_merc4 + (mvlr_merc4 * (mipi/100)) - (mvlr_merc4 * (micm_calc/100))
                ELSE
                        mcust_merc4 := mvlr_merc4 * (100 - micm_calc)
                        mcust_merc4 := mcust_merc4 / 100
                ENDIF
                IF mii > 0
                        mcust_merc4 := mvlr_merc4 + (mvlr_merc4 * (mii/100))
                ENDIF
                IF mdisp_asse > 0
                        mcust_merc4 := mcust_merc4 + (mvlr_merc4 * mdisp_asse)
                ENDIF
                micmsub := 0
                IF mvlr_icmsub > 0
                        micmsub := (mvlr_merc4 * (mvlr_icmsub/mvlr_nota))
                        mcust_merc4 := mcust_merc4 + micmsub
                ENDIF
                **********************************************************************
                mfator := 100 - (mpis + mconfis + micm_firm + mimposto + mp_lucro)
                **********************************************************************
                mcust_real4 := (mcust_merc4 / (100 - (micm_firm+mpis+mconfis+mimposto)))*100
                IF merc->saldo_mer > 0
                        mpr_medio := ((mquantd * mcust_real4) + (merc->saldo_mer * merc->pr_medio)) / (mquantd + merc->saldo_mer)
                ELSE
                        mpr_medio := mcust_real4
                ENDIF
                IF set->tp_lucro == 'O'
                        mpr_venda4 := (mcust_merc4 / (100 - (micm_firm+mpis+mconfis+mimposto+mp_lucro)))*100
                ELSEIF set->tp_lucro == 'M'
                        IF mpercent == 'P'
                                mpr_venda4 := mpr_medio4 * ((mp_lucro/100)+1)  // pelo CUSTO REAL
                        ELSEIF mpercent == 'F'
                                mpr_venda4 := (mpr_medio4 / (100-mp_lucro)) * 100  // pelo CUSTO REAL
                        ENDIF
                ELSEIF set->tp_lucro == 'R'
                        IF mpercent == 'P'
                                mpr_venda4 := mcust_real4 * ((mp_lucro/100)+1)  // pelo CUSTO REAL
                        ELSEIF mpercent == 'F'
                                mpr_venda4 := (mcust_real4 / (100-mp_lucro)) * 100  // pelo CUSTO REAL
                        ENDIF
                ENDIF
        ENDIF
ELSEIF mnivel_cal = '2'
        mvlr_merc := mpr_unit
        mcust_merc := mvlr_merc
        mcust_real := mcust_merc
        mpr_medio := ((mquantd * mcust_real) + (merc->saldo_mer * merc->pr_medio)) / (mquantd + merc->saldo_mer)
        IF set->tp_lucro == 'M'
                mpr_venda := mpr_medio * ((mp_lucro/100)+1)  // pelo CUSTO REAL
        ELSEIF set->tp_lucro == 'R'
                mpr_venda := mcust_real * ((mp_lucro/100)+1)  // pelo CUSTO REAL
        ENDIF
ENDIF
setcor(3)
DEVPOS(lci+17,cci+01);DEVOUTPICT(merc->vlr_merc,'9,999,999.99')
DEVPOS(lci+17,cci+14);DEVOUTPICT(merc->cust_merc,'9,999,999.99')
DEVPOS(lci+17,cci+27);DEVOUTPICT(merc->cust_real,'9,999,999.99')
DEVPOS(lci+17,cci+40);DEVOUTPICT(merc->pr_medio,'9,999,999.99')
DEVPOS(lci+17,cci+66);DEVOUTPICT(merc->pr_venda-merc->pr_medio,'9,999,999.99')
DEVPOS(lci+18,cci+27);DEVOUTPICT(merc->saldo_mer,'999,999.99')

DEVPOS(lci+21,cci+01);DEVOUTPICT(mvlr_merc,'9,999,999.99')
DEVPOS(lci+21,cci+14);DEVOUTPICT(mcust_merc,'9,999,999.99')
DEVPOS(lci+21,cci+27);DEVOUTPICT(mcust_real,'9,999,999.99')
DEVPOS(lci+21,cci+40);DEVOUTPICT(mpr_medio,'9,999,999.99')
DEVPOS(lci+21,cci+66);DEVOUTPICT(mpr_venda-mpr_medio,'9,999,999.99')
DEVPOS(lci+22,cci+23);DEVOUTPICT(merc->saldo_mer+mquantd,'999,999.99')
IF merc->pr_venda <> mpr_venda
        setcor(3,'*')
        DEVPOS(lci+17,cci+53);DEVOUTPICT(merc->pr_venda,'9,999,999.99')
        DEVPOS(lci+21,cci+53);DEVOUTPICT(mpr_venda,'9,999,999.99')
        setcor(1)
        mtipo_preco := 'N'
        mensagem('Digite [N] nao atualizar preco de venda [A] p/Atualizar:')
        @ MAXROW()-1,COL()+1 GET mtipo_preco PICT '@!' VALID mtipo_preco $ 'N,A'
        READ
        IF mtipo_preco = 'N'
                mpr_venda := merc->pr_venda
        ENDIF
ELSE
        DEVPOS(lci+17,cci+53);DEVOUTPICT(merc->pr_venda,'9,999,999.99')
        DEVPOS(lci+21,cci+53);DEVOUTPICT(mpr_venda,'9,999,999.99')
ENDIF
setcor(1)
******************
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
******************
micm       := icm_aux
micm_firm  := firm_aux
mpis       := pis_aux
mconfis    := confis_aux
RETURN .T.
************************** F I M **********************
********************
* VERIFICA A ENTRADA
***********************

FUNCTION ver_entrada(mcod,mdoc)

LOCAL msele,morde

msele := SELE()
morde := INDEXORD()

***************
SELE('mov');ORDSETFOCUS(4)
GO TOP
***************

IF mov->(DBSEEK('NF'+STRZERO(VAL(mdoc),6)+'  '+'E'+STRZERO(mcod,4)))
        atencao('Esta nota ja foi processada OK !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ELSE
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
RETURN NIL
***************************** F I M ****************************************
*********************
* VERIFICA O FABRICANTE
***********************

FUNCTION ver_fab(mcod,ld,cd,p)
******************************

LOCAL msele,morde

MEMVAR muf,mfabrica
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacforn','forn');RETURN NIL;ENDIF
IF mcod = 0
        IF ld <> NIL
                setcor(3)
                DEVPOS(ld,cd);DEVOUT(SPACE(30))
                setcor(1)
        ENDIF
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
***************
SELE('forn');ORDSETFOCUS(1)
GO TOP
***************

IF ! forn->(DBSEEK(STRZERO(mcod,4)))
        mcod := 0
        IF p = NIL
                setcor(3)
                DEVPOS(ld,cd);DEVOUT(SPACE(30))
                atencao('Fabricante nao Cadastrado !!!')
        ENDIF
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
IF p = NIL
        muf := forn->uf
        mfabrica := forn->razao
ENDIF
IF ld <> NIL
        setcor(3)
        DEVPOS(ld,cd);DEVOUT(forn->razao)
        setcor(1)
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
**************** f i m **********************************
*********************
* VERIFICA O TRANSPORTADORA
***********************

FUNCTION ver_trans(mcod,ld,cd,p)

LOCAL msele,morde
MEMVAR mdata_frete,mtransp
msele := SELE()
morde := INDEXORD()

IF mcod = 0
        IF ld <> NIL
                setcor(3)
                DEVPOS(ld,cd);DEVOUT(SPACE(30))
                setcor(1)
        ENDIF
        RETURN .T.
ENDIF
***************
SELE('tran');ORDSETFOCUS(1)
GO TOP
***************

IF ! tran->(DBSEEK(STRZERO(mcod,4)))
        mcod := 0
        IF p = NIL
                setcor(3)
                DEVPOS(ld,cd);DEVOUT(SPACE(30))
                atencao('Transportadora nao Cadastrada !!!')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF
ENDIF
IF p = NIL
        mdata_frete := mdata_frete + VAL(tran->prazo_pag)
        mtransp := tran->razao
ENDIF
setcor(3)
DEVPOS(ld,cd);DEVOUT(tran->razao)
setcor(1)
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
**************** f i m **********************************

FUNCTION ver_gru(vgru,ld,cd,t)
**********************

LOCAL msele,morde

msele := SELE()
morde := INDEXORD()

IF EMPTY(vgru)
        RETURN .T.
ENDIF

**************
SELE('grup');ORDSETFOCUS(1)
GO TOP
**************

SEEK STRZERO(vgru,3)+'  '

IF t = .T. .AND. FOUND()
        vgru := 0
        atencao('Codigo ja Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
IF ! FOUND()
        vgru := 0
        atencao('Grupo nao Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF

setcor(3)
DEVPOS(ld,cd);DEVOUT(grup->merc)
setcor(1)
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
********************** F I M ********************************
********************
* VERIFICA SUB-GRUPO
********************

FUNCTION ver_sgru(vgru,vsgru,ld,cd,t)
**********************

LOCAL msele,morde

IF EMPTY(vsgru)
        RETURN .T.
ENDIF
msele := SELE()
morde := INDEXORD()
**************
SELE('grup');ORDSETFOCUS(1)
GO TOP
**************

SEEK STRZERO(vgru,3)+STRZERO(vsgru,2)

IF t = .T. .AND. FOUND()
        vsgru := 0
        atencao('Sub-Grupo ja Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
IF ! FOUND()
        vsgru := 0
        atencao('Sub-Grupo nao Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF

setcor(3)
DEVPOS(ld,cd);DEVOUT(grup->merc)
setcor(1)
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
**************** f i m **********************************

FUNCTION prt_gru(vgru)
**********************

LOCAL msele,morde
MEMVAR mtipo_imp
msele := SELE()
morde := INDEXORD()

**************
SELE('grup');ORDSETFOCUS(1)
GO TOP
**************

SEEK STRZERO(vgru,3)

IF ! FOUND()
        vgru := 0
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
imprt(mtipo_imp,'N')
DEVPOS(PROW()+1,00);DEVOUT(PADC('>>> GRUPO: '+STRZERO(vgru,3)+'-'+ALLTRIM(grup->merc)+' <<<',79))
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
********************** F I M ********************************
********************
* VERIFICA SUB-GRUPO
********************

FUNCTION prt_sgru(vgru,vsgru)
**********************

LOCAL msele,morde

msele := SELE()
morde := INDEXORD()

**************
SELE('grup');ORDSETFOCUS(1)
GO TOP
**************

SEEK STRZERO(vgru,3)+STRZERO(vsgru,2)

IF ! FOUND()
        vsgru := 0
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
DEVPOS(PROW()+1,00);DEVOUT(PADC('*** Sub-Grupo: '+SUBSTR(grup->gru_sub,1,3)+'.'+SUBSTR(grup->gru_sub,4,2)+' - '+ALLTRIM(grup->merc)+' ***',79))
DEVPOS(PROW()+1,00);DEVOUT(' ')
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
********************** F I M ********************************

**************************
* VERIFICA CODIGO DE BARRA
**************************

FUNCTION vercodbarra(vgru,li,ci,t)
**********************

LOCAL msele,morde

IF EMPTY(vgru)
        RETURN .T.
ENDIF

msele := SELE()
morde := INDEXORD()

**************
SELE('merc');ORDSETFOCUS(6)
GO TOP
**************

SEEK vgru

IF t = '*'
        IF FOUND()
                vgru := SPACE(14)
                atencao('Codigo ja Cadastrado !!!')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ELSE
                IF li <> NIL
                        setcor(3)
                        DEVPOS(li,ci);DEVOUT(merc->descri)
                        setcor(1)
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RETURN .T.
                ELSE
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RETURN .T.
                ENDIF
        ENDIF
ENDIF
IF ! FOUND()
        vgru := SPACE(14)
        atencao('Codigo nao Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
IF li <> NIL
        setcor(3)
        DEVPOS(li,ci);DEVOUT(merc->descri)
        setcor(1)
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
RETURN .T.
********************** F I M ********************************

******************
* VERIFICA CODIGO
******************

FUNCTION ver_cod(vgru,li,ci,t,mzero,p)
**********************

LOCAL msele,morde

IF ((mzero <> NIL .OR. mzero = 0) .AND. mzero <> 1) .AND. EMPTY(vgru)
        RETURN .T.
ENDIF

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacmerc','merc');RETURN NIL;ENDIF

**************
SELE('merc');ORDSETFOCUS(1)
GO TOP
**************

SEEK STRZERO(vgru,5)

IF t = .T. .AND. FOUND()
        vgru := 0
        atencao('Este Codigo: '+STRZERO(vgru,5)+' ja Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
IF ! FOUND()
        vgru := 0
        IF p = NIL
                atencao('Codigo: '+STRZERO(vgru,5)+' nao Cadastrado !!!')
        ENDIF
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
IF li = NIL
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
setcor(3)
DEVPOS(li,ci);DEVOUT(merc->descri)
setcor(1)
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
********************** F I M ********************************
******************
* VERIFICA ESPECIE DO PRODUTO
******************

FUNCTION ver_espe(vespe,li,ci,t,mzero)
**********************

LOCAL msele,morde

IF (mzero <> NIL .OR. mzero = 0) .AND. mzero <> 1
        IF EMPTY(vespe)
                IF li <> NIL
                        setcor(3)
                        DEVPOS(li,ci);DEVOUT(SPACE(20))
                        setcor(1)
                ENDIF
                RETURN .T.
        ENDIF
ENDIF

msele := SELE()
morde := INDEXORD()

**************
SELE('espe');ORDSETFOCUS(1)
GO TOP
**************

SEEK STRZERO(vespe,4)

IF t = .T. .AND. FOUND()
        vespe := 0
        atencao('Codigo ja Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
IF ! FOUND()
        vespe := 0
        atencao('Codigo nao Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
IF li = NIL
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
setcor(3)
DEVPOS(li,ci);DEVOUT(espe->descri)
setcor(1)
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
********************** F I M ********************************
*****************************
FUNCTION ver_merc()
*****************************

LOCAL msele,morde
MEMVAR mcod_merc,mmerc,munidade,mp_lucro,mpeso,lci,cci

msele := SELE()
morde := INDEXORD()

****************
SELE('merc');ORDSETFOCUS(1)
GO TOP
****************

SEEK STRZERO(mcod_merc,5)

IF ! FOUND()
        atencao('Codigo da Mercadoria nao Cadastrada !!!')
        mcod_merc := 0
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF

WHILE .T.
        mensagem('<>Prox.Reg. - <>Registro Ant. - <ENTER>p/Confirma')
        mcod_merc := VAL(merc->cod_merc)
        mmerc := merc->descri
        munidade := merc->unidade
        mp_lucro := merc->p_lucro
        mpeso := merc->peso
        setcor(3)
        DEVPOS(lci+12,cci+14);DEVOUT(STRZERO(mcod_merc,5))
        DEVPOS(lci+12,cci+20);DEVOUT(mmerc)
        DEVPOS(lci+12,cci+66);DEVOUT(munidade)
        DEVPOS(lci+13,cci+28);DEVOUTPICT(mp_lucro,'999.99')
        DEVPOS(lci+17,cci+01);DEVOUTPICT(merc->vlr_merc,'9,999,999.99')
        DEVPOS(lci+17,cci+14);DEVOUTPICT(merc->cust_merc,'9,999,999.99')
        DEVPOS(lci+17,cci+27);DEVOUTPICT(merc->cust_real,'9,999,999.99')
        DEVPOS(lci+17,cci+40);DEVOUTPICT(merc->pr_medio,'9,999,999.99')
        DEVPOS(lci+17,cci+53);DEVOUTPICT(merc->pr_venda,'9,999,999.99')
        DEVPOS(lci+17,cci+66);DEVOUTPICT(merc->pr_venda-merc->pr_medio,'9,999,999.99')
        DEVPOS(lci+18,cci+27);DEVOUTPICT(merc->saldo_mer,'999,999.99')
        setcor(1)
        INKEY(0)
        IF LASTKEY()= 13
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                mensagem('Preencha o restante dos Campos')
                RETURN .T.
        ENDIF
        IF LASTKEY() = 5
                SKIP
                IF EOF()
                        SKIP -1
                        atencao('Fim de Arquivo !!!')
                ENDIF
                LOOP
        ENDIF
        IF LASTKEY() = 24
                SKIP -1
                IF BOF()
                        SKIP
                        atencao('Inicio de Arquivo !!!')
                ENDIF
        ELSE
                LOOP
        ENDIF
ENDDO
RETURN NIL

**************************** F I M ******************************************
***********************
FUNCTION v_fornece(vcod,li,ci,p)
***********************

LOCAL msele,morde
MEMVAR mfornece

msele := SELE()
morde := INDEXORD()

IF EMPTY(vcod)
        mfornece := space(40)
        RETURN .T.
ENDIF
IF ! AbriArq('sacforn','forn');RETURN NIL;ENDIF

*************
SELE('forn');ORDSETFOCUS(1)
GO TOP
*************

IF ! forn->(DBSEEK(STRZERO(vcod,4)))
        IF p = NIL
                atencao('Codigo Fornecedor nao Existe no Arquivo !!!')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ELSE
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
ELSE
        IF li = NIL .AND. ci = NIL
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
        setcor(3)
        DEVPOS(li,ci);DEVOUT(forn->razao)
        setcor(1)
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
RETURN .T.
******************************** f i m **********************************
***********************
FUNCTION ent_forn(vcod,li,ci)
***********************

LOCAL msele,morde
MEMVAR muf,mfornece

IF EMPTY(vcod)
        RETURN .T.
ENDIF

IF SELE() <> 0
        msele := SELE()
        morde := INDEXORD()
ENDIF
*************
SELE('forn');ORDSETFOCUS(1)
GO TOP
*************

IF ! forn->(DBSEEK(STRZERO(vcod,4)))
         atencao('Codigo Fornecedor nao Existe no Arquivo !!!')
         vcod := 0
         SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
         RETURN .F.
ENDIF
muf := forn->uf
mfornece := forn->razao
setcor(3)
DEVPOS(li,ci);DEVOUT(forn->razao)
setcor(1)
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
******************************** f i m **********************************
***********************
FUNCTION ver_cli(vcod,li,ci,p)
***********************

LOCAL msele,morde
MEMVAR mcliente,mcpf,mcgc

msele := SELE()
morde := INDEXORD()

IF EMPTY(vcod)
        mcliente := SPACE(40)
        RETURN .T.
ENDIF

IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
*************
SELE('cli');ORDSETFOCUS(1)
GO TOP
*************

SEEK STRZERO(vcod,5)

IF ! FOUND()
        IF p = NIL
                atencao('Codigo Cliente nao Existe no Arquivo !!!')
                vcod := 0
                mcliente := SPACE(40)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ELSE
                mcliente := SPACE(40)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF
ELSE
        IF li = NIL .AND. ci = NIL
                mcliente := cli->razao
                mcpf := cli->cpf
                mcgc := cli->cgc
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
        mcliente := cli->razao
        mcpf := cli->cpf
        mcgc := cli->cgc
        setcor(3)
        DEVPOS(li,ci);DEVOUT(cli->razao)
        setcor(1)
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
******************************** f i m **********************************
********************************
* FUNCAO P/CONSULTAR MERCADORIAS
********************************
#include "inkey.ch"              // constantes de codigos das teclas

FUNCTION f4_merc(cons,mfab,mvar_atac,mpercentual)
*****************
LOCAL f4tela,f4tela1,f4lci,f4cci,f4lba,f4cba,f4msele,f4morde,f4men,PULA,y,mcod,;
      oconsprod,ocolprod[4],i,nkey,mteste,f4,lin_br,mopcao:=' ',mprec:=0,mcodmerc,mreg,;
      local4,mtela_help
MEMVAR mdata_sis,nivel_acess,mcod_merc,mcod_bc

Local4:= Space(0)
f4 := '*'
f4lci := f4cci := 01
f4lba := 14
f4cba := 79
f4tela := SAVESCREEN(00,00,MAXROW(),79)
f4msele := SELE()
f4morde := INDEXORD()
pula := '*'
IF ! AbriArq('mastprod','merc');RETURN NIL;ENDIF
*************
SELE('merc');ORDSETFOCUS(3)
mreg := RECNO()
*************
*************
SELE('merc');ORDSETFOCUS(1)
GO BOTT
mcodmerc:=merc->codigo
*************
*************
SELE('merc');ORDSETFOCUS(3)
GO mreg
*************
IF mfab <> NIL
        *************
        ORDSETFOCUS(4)
        *************
ENDIF
f4men := SAVESCREEN(MAXROW(),00,MAXROW(),79)
mensagem('<Alt+P>Cod. <ALT+E>Especie <ALT+A>vancada <Alt+I>nclusao <Alt+H>Ajuda')
IF mpercentual = NIL
        mvar_atac := '1'
        mpercentual:=0
ENDIF
exibi_prg('F4_MERC')
botao(f4lci-1,f4cci-1,f4lba-1,f4cba+1,,' PRODUTOS  - Ult.Cod.:'+mcodmerc+' -  Quantd.Reg.: '+TRANSFORM(LASTREC(),'999,999'),'*')
oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-2,f4cba)
ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||merc->descri})
ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->codigo})
ocolprod[3] := TBCOLUMNNEW('Tipo',{||merc->tipo})
ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||TRANSFORM(merc->pr_venda,'999,999.99')})

i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
oconsprod:CARGO := '*****'
botao(f4lba,f4cci,f4lba+8,f4cba,,' Detalhe do Produto ')
setcor(4)
limpa(f4lba,f4cci+09,f4lba,f4cci+LEN(merc->descri)+9)
WHILE .T.
        mensagem('<Alt+P>Cod. <ALT+E>Especie <ALT+A>vancada <Alt+I>nclusao <Alt+H>Ajuda')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                setcor(3)
                DEVPOS(f4lba,f4cci+1);DEVOUT('Pesquisa:  ')
                /*
                DEVPOS(f4lba+1,f4cci+1);DEVOUT(IF(cfg->tip_cod='B','Codigo......','Codigo Barra')+':')
                DEVPOS(f4lba+1,f4cci+32);DEVOUT('Un:')
                DEVPOS(f4lba+1,f4cci+45);DEVOUT('Fab.:')
                DEVPOS(f4lba+2,f4cci+1);DEVOUT('Prc1: ')
                DEVPOS(f4lba+2,f4cci+20);DEVOUT('Prc2: ')
                DEVPOS(f4lba+2,f4cci+39);DEVOUT('Prc3: ')
                DEVPOS(f4lba+2,f4cci+58);DEVOUT('Prc4: ')
                DEVPOS(f4lba+4,f4cci+1);DEVOUT('Aplicacao:')
                setcor(1)
                DEVPOS(f4lba+1,f4cci+16);DEVOUT(IF(cfg->cod_sc='B',merc->cod_merc,merc->cod_barr))
                DEVPOS(f4lba+1,f4cci+36);DEVOUT(merc->unidade)
                DEVPOS(f4lba+1,f4cci+50);DEVOUT(merc->cod_fab+'-'+LEFT(merc->fabrica,23))
                IF merc->dolar = 'S'
                        mprec := ROUND(IF(mvar_atac='1',merc->pr_venda,merc->pr_venda1)*ver_dolar(mdata_sis),set->aredonda)
                ELSE
                        mprec := IF(mvar_atac='1',merc->pr_venda,merc->pr_venda1)
                ENDIF
                IF ! EMPTY(set->pz_perc1)
                        DEVPOS(f4lba+2,f4cci+7);DEVOUT(TRANSFORM(ROUND(mprec*((set->pz_perc1/100)+1),set->aredonda),ALLTRIM(set->masc_numt)))
                ENDIF
                IF ! EMPTY(set->pz_perc2)
                        DEVPOS(f4lba+2,f4cci+26);DEVOUT(TRANSFORM(ROUND(mprec*((set->pz_perc2/100)+1),set->aredonda),ALLTRIM(set->masc_numt)))
                ENDIF
                IF ! EMPTY(set->pz_perc3)
                        DEVPOS(f4lba+2,f4cci+45);DEVOUT(TRANSFORM(ROUND(mprec*((set->pz_perc3/100)+1),set->aredonda),ALLTRIM(set->masc_numt)))
                ENDIF
                IF ! EMPTY(set->pz_perc4)
                        DEVPOS(f4lba+2,f4cci+64);DEVOUT(TRANSFORM(ROUND(mprec*((set->pz_perc4/100)+1),set->aredonda),ALLTRIM(set->masc_numt)))
                ENDIF
                IF nivel_acess = '1'
                        setcor(3)
                        DEVPOS(f4lba+3,f4cci+1);DEVOUT('V.M.: ')
                        DEVPOS(f4lba+3,f4cci+25);DEVOUT('C.M.: ')
                        DEVPOS(f4lba+3,f4cci+50);DEVOUT('C.R.: ')
                        setcor(1)
                        DEVPOS(f4lba+3,f4cci+07);DEVOUT(TRANSFORM(merc->vlr_merc,ALLTRIM(set->masc_numt)))
                        DEVPOS(f4lba+3,f4cci+31);DEVOUT(TRANSFORM(merc->pr_medio,ALLTRIM(set->masc_numt)))
                        DEVPOS(f4lba+3,f4cci+56);DEVOUT(TRANSFORM(merc->cust_real,ALLTRIM(set->masc_numt)))
                ENDIF
                DEVPOS(f4lba+4,f4cci+11);DEVOUT(merc->aplic0)
                DEVPOS(f4lba+5,f4cci+11);DEVOUT(merc->aplic1)
                DEVPOS(f4lba+6,f4cci+11);DEVOUT(merc->aplic2)
                DEVPOS(f4lba+7,f4cci+11);DEVOUT(merc->aplic3)
                IF ! EMPTY(merc->ref)
                        setcor(3)
                        DEVPOS(f4lba+8,f4cci+1);DEVOUT('Referencia Auxiliar: ')
                        DEVPOS(f4lba+8,f4cci+34);DEVOUT('Loc.: ')
                        setcor(1)
                        DEVPOS(f4lba+8,f4cci+22);DEVOUT(merc->ref)
                        DEVPOS(f4lba+8,f4cci+40);DEVOUT(merc->local)
                ENDIF
                */
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                mcod_merc := VAL(merc->cod_merc)
                mcod_bc := merc->cod_merc
                IF EMPTY(mcod_merc)
                        LOOP
                ENDIF
                IF cons <> NIL
                        mopcao := mensagem1('Tecle [A] p/ Alteracao [E] p/ Exclusao:','A','A,E')
                        IF LASTKEY() = 27
                                LOOP
                        ENDIF
                        IF mopcao = 'A'
                                //sac111()
                        ELSEIF mopcao = 'E'
                                //sac112()
                        ENDIF
                        *************
                        SELE('merc');ORDSETFOCUS(3)
                        *************
                        oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
                        ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||merc->descri})
                        ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->codigo})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||merc->tipo})
                        ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||TRANSFORM(merc->pr_venda,'999,999.99')})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ELSE
                        EXIT
                ENDIF
        ELSEIF nkey = 279
                ORDSETFOCUS(1)
                //sac110()
                oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
                ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||merc->descri})
                ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->codigo})
                ocolprod[3] := TBCOLUMNNEW('Tipo',{||merc->tipo})
                ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||TRANSFORM(merc->pr_venda,'999,999.99')})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF nkey == -41
                calcu()
        ELSEIF nkey == 275
                mcod := cons_ref(merc->ref)
                IF ! EMPTY(mcod)
                        GO mcod
                        mcod_merc := VAL(merc->cod_merc)
                        mcod_bc := merc->cod_merc
                        IF EMPTY(merc->cod_merc)
                                LOOP
                        ENDIF
                        oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
                        ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||merc->descri})
                        ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->codigo})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||merc->tipo})
                        ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||TRANSFORM(merc->pr_venda,'999,999.99')})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ELSEIF  nkey >= 32 .AND. nkey <= 255
                ORDSETFOCUS(3)
                Local4:= Upper(Local4 + Chr(nkey))
                IF (Len(Local4) > Len(merc->descri))
                        Local4:= Upper(right(Local4, Len(Local4) - 1))
                ENDIF
                @ f4lba, f4cci + (f4cba - f4cci) / 2 - Len(merc->descri) / 2 - 7;
                SAY Local4 color SubStr('g/w,gr+/g', rat(",", 'g/w,gr+/g') + 1)
                set softseek on
                dbSeek(Local4, Nil, Nil)
                set softseek off
                oconsprod:refreshall()
        ELSEIF nkey == 8
                ORDSETFOCUS(3)
                Local4:= Upper(Left(Local4, Len(Local4) - 1))
                @ f4lba, f4cci + (f4cba - f4cci) / 2 - Len(merc->descri) / 2 - 7;
                        SAY Local4 + " " color SubStr('g/w,gr+/g', rat(",", 'g/w,gr+/g') + 1)
                set softseek on
                dbSeek(Local4, Nil, Nil)
                set softseek off
                oconsprod:refreshall()
        ELSE
                IF genkey(oconsprod,nkey,'merc')
                        oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
                        ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||merc->descri})
                        ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->codigo})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||merc->tipo})
                        ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||TRANSFORM(merc->pr_venda,'999,999.99')})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:CARGO := '*****'
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f4msele);IF(f4morde>0,ORDSETFOCUS(f4morde),)
RESTSCREEN(MAXROW(),00,MAXROW(),79,f4men)
RESTSCREEN(00,00,MAXROW(),79,f4tela)
RELEASE f4tela,f4tela1,f4lci,f4cci,f4lba,f4cba,f4msele,f4morde,f4men,PULA,y,mcod,;
        oconsprod,ocolprod[8],i,nkey,mteste
RETURN .F.
*************************** f i m *******************************************
********************************
* FUNCAO P/CONSULTAR TRANSPORTADORA
********************************

FUNCTION f5_trans(mnome,mcgc,mend,mmun,muf,minsc,mplaca,mcod)
*******************************************************

LOCAL tela,lci,cci,lba,cba,point,msele,morde,men,m_transp:={},m_point:={},opcao
MEMVAR mcgccpf,mcpf,mcod_tran
msele := SELE()
morde := INDEXORD()
men := SAVESCREEN(24,00,24,79)
lci := 05
cci := 40
lba := 22
cba := 78
************
SELE('tran');ORDSETFOCUS(2)
GO TOP
*************
IF ! EMPTY(mcod)
        ************
        SELE('tran');ORDSETFOCUS(1)
        GO TOP
        *************
        IF tran->(DBSEEK(mcod))
                mnome := tran->razao
                IF ! EMPTY(tran->cgc)
                        mcgc := tran->cgc
                        mcgccpf := 'tran->CGC'
                ELSEIF ! EMPTY(tran->cpf)
                        mcgc := tran->cpf
                        mcgccpf := 'CPF'
                ENDIF
                mcod := tran->cod_tran
                mend := tran->endereco
                mmun := tran->cidade
                muf := tran->uf
                minsc := tran->insc
                mplaca := tran->placa
                mensagem('Preencha os Campos - <ESC> p/Retornar ')
                ******************
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                ******************
                RESTSCREEN(01,00,24,79,tela)
                RESTSCREEN(24,00,24,79,men)
                RETURN NIL
        ENDIF
ENDIF
ASIZE(m_transp,0)
ASIZE(m_point,0)
WHILE ! EOF()
        AADD(m_transp,tran->razao+' - '+tran->cod_tran)
        AADD(m_point,RECNO())
        SKIP
ENDDO
tela := SAVESCREEN(01,00,24,79)
WHILE .T.
        setcor(3)
        botao(lci,cci,lba,cba,,' Consulta de Transportadoras ','*')
        point := ACHOICE(lci+1,cci+1,lba-1,cba-1,m_transp)
        IF point = 0
                RESTSCREEN(01,00,24,79,tela)
                RESTSCREEN(24,00,24,79,men)
                ******************
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                ******************
                RETURN NIL
        ELSE
                GO m_point[point]
                mnome := tran->razao
                IF ! EMPTY(tran->cgc)
                        mcgc := tran->cgc
                        mcgccpf := 'CGC'
                ELSEIF ! EMPTY(tran->cpf)
                        mcgc := tran->cpf
                        mcgccpf := 'CPF'
                ENDIF
                mcod_tran := tran->cod_tran
                mend := tran->endereco
                mmun := tran->cidade
                muf := tran->uf
                minsc := tran->insc
                mplaca := tran->placa
                mensagem('Preencha os Campos - <ESC> p/Retornar ')
                ******************
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                ******************
                RESTSCREEN(01,00,24,79,tela)
                RESTSCREEN(24,00,24,79,men)
                RETURN NIL
        ENDIF
ENDDO
RETURN NIL
*********************** F I M ************************************************
********************************
* FUNCAO P/CONSULTAR FORNECEDOR
********************************

FUNCTION f6_forn(mop)
*****************
LOCAL mprg:='F6_FORN',;
      f6tela,f6tela1,f6lci,f6cci,f6lba,f6cba,f6msele,f6morde,f6men

LOCAL oconsprod,ocolprod[7],f6i,f6nkey,f6opcao
MEMVAR mcod_forn

IF ! ver_nivel(mprg,'CADASTRO DE FORNECEDOR','15',nivel_acess)
        RETURN NIL
ENDIF

f6lci := f6cci := 02
f6lba := 18
f6cba := 78

f6tela := SAVESCREEN(01,00,24,79)

f6msele := SELE()
f6morde := INDEXORD()
IF ! AbriArq('sacforn','forn');RETURN NIL;ENDIF
*************
SELE('forn');ORDSETFOCUS(2)
*************
f6men := SAVESCREEN(24,00,24,79)

botao(f6lci-1,f6cci-1,f6lba,f6cba+1,,' Fornecedor / Despesas ','*')
exibi_prg(mprg)
oconsprod := TBROWSEDB(f6lci,f6cci,f6lba-1,f6cba)
ocolprod[1] := TBCOLUMNNEW('Fornecedor',{||forn->razao})
ocolprod[2] := TBCOLUMNNEW('Cod.',{||forn->cod_forn})
ocolprod[3] := TBCOLUMNNEW('Tipo',{||forn->tipo})
ocolprod[4] := TBCOLUMNNEW('Descricao da Despesa',{||verdesp(forn->tipo,,,,1)})
ocolprod[5] := TBCOLUMNNEW('UF',{||forn->uf})
ocolprod[6] := TBCOLUMNNEW('      CNPJ',{||TRANSFORM(forn->cgc,'@@R 99.999.999/9999-99')})
ocolprod[7] := TBCOLUMNNEW('       CPF',{||TRANSFORM(forn->cpf,'@@R 999.999.999-99')})
f6i:=0
FOR f6i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[f6i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('< > <P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<> <PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        f6nkey := 0
        WHILE f6nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                botao(f6lba+1,f6cci,f6lba+4,f6cba,,' Detalhe ')
                setcor(3)
                DEVPOS(f6lba+2,f6cci+1);DEVOUT('End.:')
                DEVPOS(f6lba+3,f6cci+1);DEVOUT('Cidade:')
                DEVPOS(f6lba+3,f6cci+30);DEVOUT('UF:')
                DEVPOS(f6lba+3,f6cci+37);DEVOUT('Tel.:')
                setcor(1)
                DEVPOS(f6lba+2,f6cci+6);DEVOUT(forn->endereco+' - '+forn->bairro)
                DEVPOS(f6lba+3,f6cci+8);DEVOUT(forn->cidade)
                DEVPOS(f6lba+3,f6cci+33);DEVOUT(forn->uf)
                DEVPOS(f6lba+3,f6cci+42);DEVOUT(forn->tel1)
                f6nkey := INKEY(0)
        END
        IF f6nkey == K_ESC
                EXIT
        ELSEIF f6nkey == K_ENTER
                mcod_forn := VAL(forn->cod_forn)
                IF mop = '*'
                        mensagem('Deseja <A>lterar <E>xcluir:')
                        f6opcao := 'A'
                        @ 23,COL()+1 GET f6opcao PICT '@!' VALID f6opcao $ 'A,E'
                        READ
                        IF LASTKEY() = 27
                                LOOP
                        ELSEIF f6opcao = 'A'
                                //sac141()
                        ELSEIF f6opcao = 'E'
                                //sac142()
                        ENDIF
                ELSE
                        EXIT
                ENDIF
                GO TOP
                oconsprod := TBROWSEDB(f6lci,f6cci,f6lba-1,f6cba)
                ocolprod[1] := TBCOLUMNNEW('Fornecedor',{||forn->razao})
                ocolprod[2] := TBCOLUMNNEW('Cod.',{||forn->cod_forn})
                ocolprod[3] := TBCOLUMNNEW('Tipo',{||forn->tipo})
                ocolprod[4] := TBCOLUMNNEW('UF',{||forn->uf})
                ocolprod[5] := TBCOLUMNNEW('      CNPJ',{||TRANSFORM(forn->cgc,'@@R 99.999.999/9999-99')})
                ocolprod[6] := TBCOLUMNNEW('       CPF',{||TRANSFORM(forn->cpf,'@@R 999.999.999-99')})
                f6i:=0
                FOR f6i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f6i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,f6nkey,'forn')
                        oconsprod := TBROWSEDB(f6lci,f6cci,f6lba-1,f6cba)
                        ocolprod[1] := TBCOLUMNNEW('Fornecedor',{||forn->razao})
                        ocolprod[2] := TBCOLUMNNEW('Cod.',{||forn->cod_forn})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||forn->tipo})
                        ocolprod[4] := TBCOLUMNNEW('UF',{||forn->uf})
                        ocolprod[5] := TBCOLUMNNEW('      CNPJ',{||TRANSFORM(forn->cgc,'@@R 99.999.999/9999-99')})
                        ocolprod[6] := TBCOLUMNNEW('       CPF',{||TRANSFORM(forn->cpf,'@@R 999.999.999-99')})
                        f6i:=0
                        FOR f6i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[f6i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f6msele);IF(f6morde>0,ORDSETFOCUS(f6morde),)
RESTSCREEN(24,00,24,79,f6men)
RESTSCREEN(01,00,24,79,f6tela)
RELEASE f6tela,f6tela1,f6lci,f6cci,f6lba,f6cba,f6msele,f6morde,f6men,oconsprod,ocolprod[7],i,f6nkey,f6opcao
IF f6nkey == K_ESC
        RETURN NIL
ELSE
        RETURN mcod_forn
ENDIF
RETURN NIL
*********************** F I M ************************************************
********************************
* FUNCAO P/CONSULTAR CONTA DESPESA
********************************

FUNCTION f9_conta(mop)
*****************

LOCAL tela,lci,cci,lba,cba,msele,morde,men,;
      oconsprod,ocolprod[3],i,nkey,opcao,;
      mdesc1 := SPACE(25),mtipo  := SPACE(1),tela1
MEMVAR mcodconta
lci := 02
cci := 10
lba := 19
cba := 70

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacdesp','cdesp');RETURN NIL;ENDIF
*************
SELE('cdesp');ORDSETFOCUS(1)
*************
men := SAVESCREEN(24,00,24,79)

botao(lci-1,cci-1,lba,cba+1)
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Codigo',{||cdesp->codigo})
ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||cdesp->desc1})
ocolprod[3] := TBCOLUMNNEW('Tipo',{||cdesp->tipo})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('< > <P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<> <PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                IF mop = '*'
                        mensagem('Deseja <A>lterar <E>xcluir:')
                        opcao := 'A'
                        @ 23,COL()+1 GET opcao PICT '@!' VALID opcao $ 'A,E'
                        READ
                        IF LASTKEY() = 27
                                LOOP
                        ELSEIF opcao = 'A'
                                mensagem('Digite a descricao - <ESC> p/Retornar')
                                mcodconta := SPACE(4)
                                mdesc1 := SPACE(25)
                                mtipo  := SPACE(1)
                                botao(lba+1,cci,lba+3,cba,,' Inclusao Despesas ')
                                DEVPOS(lba+2,cci+2);DEVOUT('Cod.:')
                                DEVPOS(lba+2,cci+15);DEVOUT('Descricao:')
                                DEVPOS(lba+2,cci+53);DEVOUT('Tipo:')
                                setcor(3)
                                DEVPOS(lba+2,cci+8);DEVOUTPICT(cdesp->codigo,'9.99')
                                setcor(1)
                                IF LASTKEY() = 27
                                        EXIT
                                ENDIF
                                mdesc1 := cdesp->desc1
                                mtipo  := cdesp->tipo
                                @ lba+2,cci+26 GET mdesc1 PICT '@!'
                                @ lba+2,cci+58 GET mtipo PICT '@!' VALID mtipo $ 'V,F,I, ' .AND. lim_get() WHEN men_get(lba-3,cci+58,'<V>ariavel - <F>ixas - <I>nvestimento - < > em branco')
                                READ
                                IF LASTKEY() = 27 .OR. EMPTY(mdesc1)
                                        EXIT
                                ENDIF
                                mensagem('Confirma Alteracao [S/n]:')
                                opcao := 'S'
                                @ 23,COL()+1 GET opcao PICT '@!' VALID opcao $ 'S,N'
                                READ
                                IF LASTKEY() = 27 .OR. opcao = 'N'
                                        LOOP
                                ENDIF
                                IF BLOQREG()
                                        Cdesp-> desc1 := mdesc1
                                        Cdesp-> tipo  := mtipo
                                        DBCOMMIT()
                                        DBUNLOCK()
                                ELSE
                                        atencao('Nao foi possivel acessar o Arquivo !!!')
                                        LOOP
                                ENDIF
                        ELSEIF opcao = 'E'
                                opcao := mensagem1('Confirma a Exclusao da Conta Despesa','N','S,N')
                                IF opcao = 'S'
                                        BLOQREG()
                                        DELE
                                        DBUNLOCK()
                                        DBCOMMIT()
                                ENDIF
                        ENDIF
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||cdesp->codigo})
                        ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||cdesp->desc1})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||cdesp->tipo})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ELSE
                        mcodconta := cdesp->codigo
                        EXIT
                ENDIF
        ELSEIF nkey = 105 .OR. nkey = 73
                WHILE .T.
                        mensagem('Digite o Codigo da despesa e faca a descricao - <ESC> p/Retornar')
                        mcodconta := SPACE(4)
                        mdesc1 := SPACE(25)
                        mtipo  := SPACE(1)
                        botao(lba+1,cci,lba+3,cba,,' Inclusao Despesas ')
                        DEVPOS(lba+2,cci+2);DEVOUT('Cod.:')
                        DEVPOS(lba+2,cci+15);DEVOUT('Descricao:')
                        DEVPOS(lba+2,cci+53);DEVOUT('Tipo:')
                        @ lba+2,cci+8 GET mcodconta PICT '@! X.XX'
                        READ
                        IF LASTKEY() = 27
                                EXIT
                        ENDIF
                        IF EMPTY(mcodconta)
                                LOOP
                        ENDIF
                        *************
                        SELE('cdesp');ORDSETFOCUS(1)
                        GO TOP
                        *************
                        IF cdesp->(DBSEEK(mcodconta))
                                atencao('Conta Despesa ja Cadastrada')
                                LOOP
                        ENDIF
                        @ lba+2,cci+26 GET mdesc1 PICT '@!'
                        @ lba+2,cci+58 GET mtipo PICT '@!' VALID mtipo $ 'V,F,I, ' .AND. lim_get() WHEN men_get(lba-3,cci+58,'<V>ariavel - <F>ixas - <I>nvestimento - < > em branco')
                        READ
                        IF LASTKEY() = 27 .OR. EMPTY(mdesc1)
                                LOOP
                        ENDIF
                        mensagem('Confirma Inclusao [S/n]:')
                        opcao := 'S'
                        @ 23,COL()+1 GET opcao PICT '@!' VALID opcao $ 'S,N'
                        READ
                        IF LASTKEY() = 27 .OR. opcao = 'N'
                                LOOP
                        ENDIF
                        IF ADIREG()
                                Cdesp-> codigo := mcodconta
                                Cdesp-> desc1 := mdesc1
                                Cdesp-> tipo  := mtipo
                                COMMIT
                                UNLOCK
                        ELSE
                                atencao('Nao foi possivel acessar o Arquivo !!!')
                                ORDSETFOCUS(3)
                                LOOP
                        ENDIF
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||cdesp->codigo})
                        ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||cdesp->desc1})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||cdesp->tipo})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDDO
        ELSE
                IF genkey(oconsprod,nkey,'cdesp')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||cdesp->codigo})
                        ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||cdesp->desc1})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||cdesp->tipo})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
CLEAR GETS
IF nkey == K_ESC
        RETURN NIL
ELSE
        RETURN mcodconta
ENDIF
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR ESPECIE
********************************

FUNCTION cons_espe()
*****************

LOCAL tela,tela1,lci,cci,lba,cba,msele,morde,men

LOCAL oconsprod,ocolprod[2],i,nkey,opcao
MEMVAR mcod_espe
lci := 02
cci := 15
lba := MAXROW()-3
cba := 50

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacespe','espe');RETURN NIL;ENDIF
*************
SELE('espe');ORDSETFOCUS(2)
*************
men := SAVESCREEN(24,00,24,79)

botao(lci-1,cci-1,lba,cba+1)
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Codigo',{||espe->cod_espe})
ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||espe->descri})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        mensagem('<> <PGUP> <PGDN> <P>esquisa <ENTER> Conf. <ESC>Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                mcod_espe:= VAL(espe->cod_espe)
                EXIT
        ELSE
                IF genkey(oconsprod,nkey,'espe')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||espe->cod_espe})
                        ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||espe->descri})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
CLEAR GETS
IF nkey == K_ESC
        RETURN NIL
ELSE
        RETURN mcod_espe
ENDIF
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR GRUPO E SUB_GRUPO
********************************

FUNCTION cons_grup()
********************

LOCAL tela,tela1,lci,cci,lba,cba,msele,morde,men,;
      oconsprod,ocolprod[2],i,nkey,opcao
MEMVAR mgrupo,mgru_sub
lci := 02
cci := 15
lba := MAXROW()-3
cba := 70

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacgrupo','grup');RETURN NIL;ENDIF
*************
SELE('grup');ORDSETFOCUS(2)
*************
men := SAVESCREEN(24,00,24,79)

botao(lci-1,cci-1,lba,cba+1)
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Codigo',{||SUBSTR(grup->gru_sub,1,3)+'.'+SUBSTR(grup->gru_sub,4,2)})
ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||grup->merc})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        mensagem('<> <PGUP> <PGDN> <P>esquisa <ENTER> Conf. <ESC>Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                IF READVAR() = 'MGRUPO'
                        mgrupo:= VAL(SUBSTR(grup->gru_sub,1,3))
                ELSEIF READVAR() = 'MGRU_SUB'
                        mgru_sub:= VAL(SUBSTR(grup->gru_sub,4))
                ENDIF
                EXIT
        ELSE
                IF genkey(oconsprod,nkey,'espe')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||grup->gru_sub})
                        ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||grup->merc})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
CLEAR GETS
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR CONTA DESPESA
********************************

FUNCTION cons_desp()
*****************

LOCAL tela,tela1,lci,cci,lba,cba,msele,morde,men

LOCAL oconsprod,ocolprod[2],i,nkey,opcao
MEMVAR mcoddesp
lci := 02
cci := 15
lba := MAXROW()-3
cba := 70

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('saccadde','desp');RETURN NIL;ENDIF
*************
SELE('desp');ORDSETFOCUS(1)
*************
men := SAVESCREEN(24,00,24,79)

botao(lci-1,cci-1,lba,cba+1)
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Codigo',{||desp->codigo})
ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||desp->desc1})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        mensagem('<> <PGUP> <PGDN> <P>esquisa <ENTER> Conf. <ESC>Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                mcoddesp := VAL(desp->codigo)
                EXIT
        ELSE
                IF genkey(oconsprod,nkey,'cdesp')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||desp->codigo})
                        ocolprod[2] := TBCOLUMNNEW('Descricao da Despesa',{||desp->desc1})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
CLEAR GETS
IF nkey == K_ESC
        RETURN NIL
ELSE
        RETURN mcoddesp
ENDIF
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR ROMANEIOS
********************************

FUNCTION cons_roma()
*****************

LOCAL tela,tela1,lci,cci,lba,cba,msele,morde,men

LOCAL oconsprod,ocolprod[7],i,nkey,opcao
MEMVAR mnum_roma
lci := 02
cci := 10
lba := MAXROW()-3
cba := 70

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacroma','roma');RETURN NIL;ENDIF
*************
SELE('roma');ORDSETFOCUS(1)
*************
men := SAVESCREEN(24,00,24,79)

botao(lci-1,cci-1,lba,cba+1)
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Romaneio',{||roma->num_roma})
ocolprod[2] := TBCOLUMNNEW('Data',{||DTOC(roma->dat_roma)})
ocolprod[3] := TBCOLUMNNEW('No.Ped.',{||roma->num_ped})
ocolprod[4] := TBCOLUMNNEW('Cod.Mot.',{||roma->cod_mot})
ocolprod[5] := TBCOLUMNNEW('Placa',{||roma->placa_mot})
ocolprod[6] := TBCOLUMNNEW('Data Ent.',{||DTOC(roma->entregue)})
ocolprod[7] := TBCOLUMNNEW('Oper.',{||roma->cod_ope})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        mensagem('<> <PGUP> <PGDN> <P>esquisa <ENTER> Conf. <ESC>Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                mnum_roma := VAL(roma->num_roma)
                EXIT
        ELSE
                IF genkey(oconsprod,nkey,'roma')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Romaneio',{||roma->num_roma})
                        ocolprod[2] := TBCOLUMNNEW('Data',{||DTOC(roma->dat_roma)})
                        ocolprod[3] := TBCOLUMNNEW('No.Ped.',{||roma->num_ped})
                        ocolprod[4] := TBCOLUMNNEW('Cod.Mot.',{||roma->cod_mot})
                        ocolprod[5] := TBCOLUMNNEW('Placa',{||roma->placa_mot})
                        ocolprod[6] := TBCOLUMNNEW('Data Ent.',{||DTOC(roma->entregue)})
                        ocolprod[7] := TBCOLUMNNEW('Oper.',{||roma->cod_ope})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
CLEAR GETS
IF nkey == K_ESC
        RETURN NIL
ELSE
        RETURN mnum_roma
ENDIF
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR DOCUMENTOS A RECEBER
********************************

FUNCTION cons_doc(mcons,mtp_c)
*****************
LOCAL tela,tela1,tela2,lci,cci,lba,cba,msele,morde,men,;
      mdias_atras:=0,mmulta:=0,mjuros:=0,mvlpago:=0,;
      oconsprod,ocolprod[13],i,nkey,opcao,mponto_reg:=0,mcons_doc,;
      m_dup:={},m_pos:={},point:=0,mtipo_doc,mali_c

MEMVAR mduplicata,mcod_cli,mtipo,mdata_sis

lci := 02
cci := 01
lba := MAXROW()-3
cba := 78

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
*************
*SELE('dupr');ORDSETFOCUS(2)
*************
men := SAVESCREEN(24,00,24,79)
IF mtp_c = NIL .OR. mtp_c > 0
        botao(lci-1,cci-1,lba,cba+1,,' Consulta de DOCUMENTOS CONTAS A RECEBER ','*')
        mali_c := 'dupr'
ELSE
        botao(lci-1,cci-1,lba,cba+1,,' Consulta de CREDITO CLIENTE ','*')
        mali_c := 'cred'
ENDIF
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Tipo',{||(mali_c)->tipo})
ocolprod[2] := TBCOLUMNNEW('No.Documento',{||(mali_c)->duplicata+(mali_c)->conta})
ocolprod[3] := TBCOLUMNNEW('Op.',{||(mali_c)->tip_pg})
ocolprod[4] := TBCOLUMNNEW('Valor Doc.',{||TRANSFORM((mali_c)->valor,'999,999.99')})
ocolprod[5] := TBCOLUMNNEW('Vencimento',{||DTOC((mali_c)->venc)})
ocolprod[6] := TBCOLUMNNEW('Emissao',{||DTOC((mali_c)->emissao)})
ocolprod[7] := TBCOLUMNNEW('Dt.Pg/Trf.',{||(mali_c)->datpag})
ocolprod[8] := TBCOLUMNNEW('Pg/Trf',{||(mali_c)->pago})
ocolprod[9] := TBCOLUMNNEW('Cod.',{||(mali_c)->fornec})
ocolprod[10] := TBCOLUMNNEW('Cliente',{||(mali_c)->cliente})
ocolprod[11] := TBCOLUMNNEW('Baixa [M]ov.[C]aixa',{||(mali_c)->mov_cx})
ocolprod[12] := TBCOLUMNNEW('Baixa Parcial',{||(mali_c)->baix_parc})
ocolprod[13] := TBCOLUMNNEW('Oper.',{||(mali_c)->oper_parc})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        mensagem('< > - <P>esquisa - <ENTER>p/Consulta <D>etalhes  <ESC>Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                IF mcons = NIL
                        EXIT
                ENDIF
                mduplicata := (mali_c)->duplicata
                mcod_cli   := VAL((mali_c)->fornec)
                mtipo      := (mali_c)->tipo
                mdias_atras := mmulta := mjuros := mvlpago := 0
                mdias_atras := mdata_sis-(mali_c)->venc
                IF mdias_atras > 0
                        mmulta := (mali_c)->valor * ((set->multa_dup)/100)
                        mjuros := mjuros + ((mali_c)->valor * ((mdias_atras*set->juros_dup)/100))
                ENDIF
                mvlpago=(mali_c)->valor+mjuros+mmulta
                tela1 := SAVESCREEN(00,00,24,79)
                botao(02,00,22,79)
                DEVPOS(03,01);DEVOUT('Cliente.............:')
                DEVPOS(04,01);DEVOUT('Banco...............:')
                DEVPOS(04,27);DEVOUT('Agencia:')
                DEVPOS(04,51);DEVOUT('C/C:')
                DEVPOS(05,01);DEVOUT('No.da Documento ....:')
                DEVPOS(05,40);DEVOUT('Tipo Operacao:')
                DEVPOS(05,58);DEVOUT('No.:')
                DEVPOS(06,01);DEVOUT('Data Emissao........:')
                DEVPOS(07,01);DEVOUT('Data Vencimento.....:')
                DEVPOS(07,35);DEVOUT('Venc.Anterior:')
*               DEVPOS(07,01);DEVOUT('Data Transferencia:')
                DEVPOS(08,01);DEVOUT('Vlr.Bruto Documento.:')
                DEVPOS(09,01);DEVOUT('Vlr. Documento ...R$:')


                DEVPOS(15,01);DEVOUT('No.do Pedido........:')
                DEVPOS(15,32);DEVOUT('Operador:')
                DEVPOS(16,01);DEVOUT('Correntista.........:')
                DEVPOS(17,01);DEVOUT('OBS.Incl.:')
                DEVPOS(21,01);DEVOUT('OBS.Baixa:')

                setcor(3)
                DEVPOS(03,23);DEVOUT((mali_c)->fornec+'-'+(mali_c)->cliente)
                DEVPOS(04,21);DEVOUT((mali_c)->numero)
                DEVPOS(04,36);DEVOUT((mali_c)->agencia)
                DEVPOS(04,56);DEVOUT((mali_c)->c_c)
                DEVPOS(05,23);DEVOUT((mali_c)->tipo+(mali_c)->duplicata)
                DEVPOS(05,55);DEVOUT((mali_c)->tip_pg)
                DEVPOS(05,63);DEVOUT((mali_c)->cheque)
                DEVPOS(06,23);DEVOUT(DTOC((mali_c)->emissao))
                DEVPOS(07,23);DEVOUT(DTOC((mali_c)->venc))
                DEVPOS(07,50);DEVOUT(DTOC((mali_c)->venc1))
                DEVPOS(08,23);DEVOUT(TRANSFORM((mali_c)->valor_dup,'9,999,999.99'))
                DEVPOS(09,23);DEVOUT(TRANSFORM((mali_c)->valor,'9,999,999.99'))
                DEVPOS(09,COL()+1);DEVOUT((mali_c)->conta)

                DEVPOS(15,23);DEVOUT((mali_c)->num_ped)
                DEVPOS(15,42);DEVOUT((mali_c)->operador)
                DEVPOS(16,23);DEVOUT((mali_c)->corrente)
                DEVPOS(17,12);DEVOUT((mali_c)->obs)
                DEVPOS(18,12);DEVOUT((mali_c)->lin1)
                DEVPOS(19,12);DEVOUT((mali_c)->lin2)
                DEVPOS(20,12);DEVOUT((mali_c)->lin3)
                DEVPOS(21,12);DEVOUT((mali_c)->obs1)

                IF ! EMPTY((mali_c)->datpag) .OR. (mali_c)->pago <> ' '
                        setcor(1)
                        IF ! EMPTY((mali_c)->dat_tran)
                                DEVPOS(10,01);DEVOUT('Data Transferencia:')
                                setcor(3)
                                DEVPOS(10,23);DEVOUT(DTOC((mali_c)->dat_tran))
                        ELSE
                                DEVPOS(10,01);DEVOUT('Data Pagamento .....:')
                                DEVPOS(11,01);DEVOUT('Pago efetuado Com...:')
                                DEVPOS(12,01);DEVOUT('Juros Pago .......R$:')
                                DEVPOS(13,01);DEVOUT('Desconto .........R$:')
                                DEVPOS(14,01);DEVOUT('Valor Pago .......R$:')
                                DEVPOS(14,37);DEVOUT('Tipo Baixa:')
                                setcor(3)
                                DEVPOS(10,23);DEVOUT(DTOC((mali_c)->datpag))
                                DEVPOS(11,23);DEVOUT(STRZERO((mali_c)->datpag-(mali_c)->venc,3)+' Dias.')
                                DEVPOS(12,23);DEVOUT(TRANSFORM((mali_c)->juros,'9,999,999.99'))
                                DEVPOS(13,23);DEVOUT(TRANSFORM((mali_c)->desc,'9,999,999.99'))
                                DEVPOS(14,23);DEVOUT(TRANSFORM((mali_c)->vlpago,'9,999,999.99'))
                                IF (mali_c)->mov_cx = 'C'
                                        DEVPOS(14,48);DEVOUT('CAIXA')
                                ELSEIF (mali_c)->mov_cx = 'M'
                                        DEVPOS(14,48);DEVOUT('MOVIMENTO')
                                ENDIF
                        ENDIF
                ELSE
                        setcor(1)
                        DEVPOS(10,01);DEVOUT('Prazo estipulado....:')
                        DEVPOS(12,01);DEVOUT('Vlr. Multa+Juros..R$:')
                        DEVPOS(13,01);DEVOUT('Vlr. a Pagar......R$:')
                        IF mdata_sis<(mali_c)->venc
                                setcor(1)
                                DEVPOS(11,01);DEVOUT('Faltam p/ Vencimento:')
                                setcor(3)
                                DEVPOS(11,23);DEVOUT(STRZERO((mali_c)->venc-mdata_sis,3)+' Dias.')
                        ELSE
                                setcor(1)
                                DEVPOS(11,01);DEVOUT('Atrazo do vencimento:')
                                setcor(3)
                                DEVPOS(11,23);DEVOUT(STRZERO(mdata_sis-(mali_c)->venc,3)+' Dias.')
                        ENDIF
                        setcor(3)
                        DEVPOS(10,23);DEVOUT(STRZERO((mali_c)->venc-(mali_c)->emissao,3)+' Dias.')
                        DEVPOS(12,23);DEVOUT(TRANSFORM(mmulta+mjuros,'9,999,999.99'))
                        DEVPOS(13,23);DEVOUT(TRANSFORM(mvlpago,'9,999,999.99'))
                ENDIF
                setcor(1)
                mensagem('Pressione [P] - Visualizar o Processo ou qualquer tecla p/retornar')
                INKEY(0)
                IF LASTKEY() = 80 .OR. LASTKEY() = 112
                        botao(15,10,21,73,,' Processo do Documento No.:'+(mali_c)->tipo+(mali_c)->duplicata)
                        setcor(3)
                        DEVPOS(16,11);DEVOUT((mali_c)->lin1)
                        DEVPOS(17,11);DEVOUT((mali_c)->lin2)
                        DEVPOS(18,11);DEVOUT((mali_c)->lin3)
                        DEVPOS(19,11);DEVOUT((mali_c)->lin4)
                        DEVPOS(20,11);DEVOUT((mali_c)->lin5)
                        setcor(1)
                        mensagem('Pressione qualquer tecla p/retornar')
                        INKEY(0)
                ENDIF
                RESTSCREEN(00,00,24,79,tela1)
                LOOP
        ELSEIF nkey == 68 .OR. nkey == 100
                mponto_reg := RECNO()
                ASIZE(m_dup,0)
                ASIZE(m_pos,0)
                IF (mali_c)->pago = 'T' .OR. (mali_c)->conta = '*'
                        CLEAR GETS
                        tela1 := SAVESCREEN(00,00,24,79)
                        botao(lci,cci,lba,cba,,' Resumo do DOCUMENTO: '+(mali_c)->tipo+(mali_c)->duplicata)
                        DEVPOS(lci+1,cci+1);DEVOUT('Documento')
                        DEVPOS(lci+1,cci+15);DEVOUT('Cliente')
                        DEVPOS(lci+1,cci+37);DEVOUT('Emissao')
                        DEVPOS(lci+1,cci+47);DEVOUT('Venc.')
                        DEVPOS(lci+1,cci+54);DEVOUT('Dta.Pag.')
                        DEVPOS(lci+1,cci+67);DEVOUT('Valor')
                        DEVPOS(lci+1,cci+75);DEVOUT('Vend')
                        ASIZE(m_pos)
                        ASIZE(m_dup)
                        point := 0
                        mtipo_doc := (mali_c)->tipo
                        IF (mali_c)->pago = 'T'
                                mcons_doc := (mali_c)->tipo+(mali_c)->duplicata
                                ORDSETFOCUS(13)
                                GO TOP
                                IF ! (mali_c)->(DBSEEK(mcons_doc))
                                        atencao('Nao foi encontrado nenhum Documento Transferido')
                                        LOOP
                                ENDIF
                                WHILE mcons_doc = (mali_c)->doc_tran .AND. ! EOF()
                                        AADD(m_pos,RECNO())
                                        AADD(m_dup,(mali_c)->tipo+(mali_c)->duplicata+(mali_c)->conta+' '+(mali_c)->tip_pg+' '+(mali_c)->fornec+'-'+LEFT((mali_c)->cliente,10);
                                            +' '+DTOC((mali_c)->emissao)+' '+DTOC((mali_c)->venc)+' '+DTOC((mali_c)->datpag)+' '+TRANSFORM((mali_c)->valor,'9,999,999.99');
                                            +' '+(mali_c)->vendedor)
                                        SKIP
                                ENDDO
                        ELSE
                                mcons_doc := (mali_c)->duplicata
                                ORDSETFOCUS(10)
                                GO TOP
                                IF ! (mali_c)->(DBSEEK(mcons_doc+mtipo_doc))
                                        atencao('Nao foi encontrado nenhum Documento Transferido')
                                        LOOP
                                ENDIF
                                WHILE mcons_doc = (mali_c)->duplicata .AND. ! EOF()
                                        AADD(m_pos,RECNO())
                                        AADD(m_dup,(mali_c)->tipo+(mali_c)->duplicata+(mali_c)->conta+' '+(mali_c)->tip_pg+' '+(mali_c)->fornec+'-'+LEFT((mali_c)->cliente,10);
                                            +' '+DTOC((mali_c)->emissao)+' '+DTOC((mali_c)->venc)+' '+DTOC((mali_c)->datpag)+' '+TRANSFORM((mali_c)->valor,'9,999,999.99');
                                            +' '+(mali_c)->vendedor)
                                        SKIP
                                ENDDO
                        ENDIF
                        WHILE .T.
                                CLEAR TYPEAHEAD
                                mensagem("< ou > Consulta  -  <ESC> Retorna  -  <ENTER> p/Resumo" )
                                point := ACHOICE(lci+3,cci+1,lba-3,cba-1,m_dup,,,point)

                                DO CASE
                                        CASE LASTKEY()=27
                                                RESTSCREEN(00,00,24,79,tela1)
                                                EXIT
                                        CASE LASTKEY() = 13
                                                IF m_pos[point] = 0
                                                        LOOP
                                                ENDIF
                                                IF SUBSTR(m_dup[point],1,1) = 'F' .AND. SUBSTR(m_dup[point],1,2) <> 'FI'
                                                        atencao('Este Documento nao pode ser consultado porque e da FILIAL')
                                                        LOOP
                                                ENDIF
                                                GO m_pos[point]
                                                tela2 := SAVESCREEN(00,00,24,79)
                                                botao(01,00,22,79)
                                                DEVPOS(02,01);DEVOUT('Cliente.............:')
                                                DEVPOS(03,01);DEVOUT('Banco...............:')
                                                DEVPOS(03,27);DEVOUT('Agencia:')
                                                DEVPOS(03,51);DEVOUT('C/C:')
                                                DEVPOS(04,01);DEVOUT('No.da Documento ....:')
                                                DEVPOS(04,40);DEVOUT('Tipo Operacao:')
                                                DEVPOS(05,01);DEVOUT('Data Emissao........:')
                                                DEVPOS(06,01);DEVOUT('Data Vencimento.....:')
                                                DEVPOS(07,01);DEVOUT('Vlr.Bruto Documento.:')
                                                DEVPOS(08,01);DEVOUT('Vlr. Documento ...R$:')


                                                DEVPOS(15,01);DEVOUT('No.do Pedido........:')
                                                DEVPOS(15,32);DEVOUT('Operador:')
                                                DEVPOS(16,01);DEVOUT('Correntista.........:')
                                                DEVPOS(17,01);DEVOUT('OBS.Incl.:')
                                                DEVPOS(18,01);DEVOUT('OBS.Baixa:')
                                                DEVPOS(20,01);DEVOUT('Cod.Fornecedor/Despesa:')
                                                DEVPOS(21,01);DEVOUT('Data da Baixa Parcial.:')
                                                DEVPOS(21,39);DEVOUT('Operador:')

                                                setcor(3)
                                                DEVPOS(19,01);DEVOUT('BAIXA PARCIAL')
                                                DEVPOS(02,23);DEVOUT((mali_c)->fornec+'-'+(mali_c)->cliente)
                                                DEVPOS(03,21);DEVOUT((mali_c)->numero)
                                                DEVPOS(03,36);DEVOUT((mali_c)->agencia)
                                                DEVPOS(03,56);DEVOUT((mali_c)->c_c)
                                                DEVPOS(04,23);DEVOUT((mali_c)->tipo+(mali_c)->duplicata)
                                                DEVPOS(04,55);DEVOUT((mali_c)->tip_pg)
                                                DEVPOS(05,23);DEVOUT(DTOC((mali_c)->emissao))
                                                DEVPOS(06,23);DEVOUT(DTOC((mali_c)->venc))
                                                DEVPOS(07,23);DEVOUT(TRANSFORM((mali_c)->valor_dup,'9,999,999.99'))
                                                DEVPOS(08,23);DEVOUT(TRANSFORM((mali_c)->valor,'9,999,999.99'))
                                                DEVPOS(08,COL()+1);DEVOUT((mali_c)->conta)

                                                DEVPOS(15,23);DEVOUT((mali_c)->num_ped)
                                                DEVPOS(15,42);DEVOUT((mali_c)->operador)
                                                DEVPOS(16,23);DEVOUT((mali_c)->corrente)
                                                DEVPOS(17,12);DEVOUT((mali_c)->obs)
                                                DEVPOS(18,12);DEVOUT((mali_c)->obs1)
                                                DEVPOS(20,25);DEVOUT((mali_c)->cod_forn)
                                                DEVPOS(21,25);DEVOUT((mali_c)->baix_parc)
                                                DEVPOS(21,49);DEVOUT((mali_c)->oper_parc)
                                                v_fornece(VAL((mali_c)->cod_forn),20,30)
                                                IF ! EMPTY((mali_c)->datpag) .OR. (mali_c)->pago <> ' '
                                                        setcor(1)
                                                        DEVPOS(09,01);DEVOUT('Data Pagamento .....:')
                                                        DEVPOS(10,01);DEVOUT('Pago efetuado Com...:')
                                                        DEVPOS(11,01);DEVOUT('Juros Pago .......R$:')
                                                        DEVPOS(12,01);DEVOUT('Desconto .........R$:')
                                                        DEVPOS(13,01);DEVOUT('Valor Pago .......R$:')
                                                        DEVPOS(13,37);DEVOUT('Tipo Baixa:')
                                                        DEVPOS(14,01);DEVOUT('Local Pagamento.....:')
                                                        setcor(3)
                                                        DEVPOS(09,23);DEVOUT(DTOC((mali_c)->datpag))
                                                        DEVPOS(10,23);DEVOUT(STRZERO((mali_c)->datpag-(mali_c)->venc,3)+' Dias.')
                                                        DEVPOS(11,23);DEVOUT(TRANSFORM((mali_c)->juros,'9,999,999.99'))
                                                        DEVPOS(12,23);DEVOUT(TRANSFORM((mali_c)->desc,'9,999,999.99'))
                                                        DEVPOS(13,23);DEVOUT(TRANSFORM((mali_c)->vlpago,'9,999,999.99'))
                                                        IF (mali_c)->mov_cx = 'C'
                                                                DEVPOS(13,48);DEVOUT('CAIXA')
                                                        ELSEIF (mali_c)->mov_cx = 'M'
                                                                DEVPOS(13,48);DEVOUT('MOVIMENTO')
                                                        ENDIF
                                                        DEVPOS(14,23);DEVOUT((mali_c)->banco)
                                                ELSE
                                                        setcor(1)
                                                        DEVPOS(09,01);DEVOUT('Prazo estipulado....:')
                                                        DEVPOS(11,01);DEVOUT('Vlr. Multa+Juros..R$:')
                                                        DEVPOS(12,01);DEVOUT('Vlr. a Pagar......R$:')
                                                        DEVPOS(13,01);DEVOUT('Local Pagamento.....:')
                                                        IF mdata_sis<(mali_c)->venc
                                                                setcor(1)
                                                                DEVPOS(10,01);DEVOUT('Faltam p/ Vencimento:')
                                                                setcor(3)
                                                                DEVPOS(10,23);DEVOUT(STRZERO((mali_c)->venc-mdata_sis,3)+' Dias.')
                                                        ELSE
                                                                setcor(1)
                                                                DEVPOS(10,01);DEVOUT('Atrazo do vencimento:')
                                                                setcor(3)
                                                                DEVPOS(10,23);DEVOUT(STRZERO(mdata_sis-(mali_c)->venc,3)+' Dias.')
                                                        ENDIF
                                                        setcor(3)
                                                        DEVPOS(09,23);DEVOUT(STRZERO((mali_c)->venc-(mali_c)->emissao,3)+' Dias.')
                                                        DEVPOS(13,23);DEVOUT((mali_c)->banco)
                                                ENDIF
                                                setcor(1)
                                                mensagem('Pressione qualquer tecla p/retornar')
                                                INKEY(0)
                                                RESTSCREEN(00,00,24,79,tela2)
                                                LOOP
                                ENDCASE
                        ENDDO
                ELSE
                        atencao('Este Documento nao tem Detalhes (*** Nao foi pago por conta *** ou *** Foi transformado em outros documentos ***)')
                ENDIF
                GO mponto_reg
        ELSE
                IF genkey(oconsprod,nkey,'dupr')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Tipo',{||(mali_c)->tipo})
                        ocolprod[2] := TBCOLUMNNEW('No.Documento',{||(mali_c)->duplicata+(mali_c)->conta})
                        ocolprod[3] := TBCOLUMNNEW('Op.',{||(mali_c)->tip_pg})
                        ocolprod[4] := TBCOLUMNNEW('Valor Doc.',{||TRANSFORM((mali_c)->valor,'999,999.99')})
                        ocolprod[5] := TBCOLUMNNEW('Vencimento',{||DTOC((mali_c)->venc)})
                        ocolprod[6] := TBCOLUMNNEW('Emissao',{||DTOC((mali_c)->emissao)})
                        ocolprod[7] := TBCOLUMNNEW('Dt.Pg/Trf.',{||(mali_c)->datpag})
                        ocolprod[8] := TBCOLUMNNEW('Pg/Trf',{||(mali_c)->pago})
                        ocolprod[9] := TBCOLUMNNEW('Cod.',{||(mali_c)->fornec})
                        ocolprod[10] := TBCOLUMNNEW('Cliente',{||(mali_c)->cliente})
                        ocolprod[11] := TBCOLUMNNEW('Baixa [M]ov.[C]aixa',{||(mali_c)->mov_cx})
                        ocolprod[12] := TBCOLUMNNEW('Baixa Parcial',{||(mali_c)->baix_parc})
                        ocolprod[13] := TBCOLUMNNEW('Oper.',{||(mali_c)->oper_parc})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
CLEAR GETS
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR DOCUMENTOS A APAGAR
********************************

FUNCTION cons_apag(mop)
*****************

LOCAL tela,tela1,lci,cci,lba,cba,msele,morde,men

LOCAL mdias_atras:=0,mmulta:=0,mjuros:=0,mvlpago:=0

LOCAL oconsprod,ocolprod[9],i,nkey,opcao
MEMVAR mduplicata,mcod_cli,mtipo,mdata_sis


lci := 02
cci := 01
lba := MAXROW()-3
cba := 78

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
*************
SELE('dupp');ORDSETFOCUS(2)
*************
men := SAVESCREEN(24,00,24,79)

botao(lci-1,cci-1,lba,cba+1,,' Consulta de DOCUMENTOS CONTAS APAGAR ','*')
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Tipo',{||dupp->tipo})
ocolprod[2] := TBCOLUMNNEW('No.Docuemnto',{||dupp->duplicata})
ocolprod[3] := TBCOLUMNNEW('Valor Doc.',{||TRANSFORM(dupp->valor,'999,999.99')})
ocolprod[4] := TBCOLUMNNEW('Vencimento',{||DTOC(dupp->venc)})
ocolprod[5] := TBCOLUMNNEW('Emissao',{||DTOC(dupp->emissao)})
ocolprod[6] := TBCOLUMNNEW('Data Pag.',{||dupp->datpag})
ocolprod[7] := TBCOLUMNNEW('Cod.',{||dupp->fornec})
ocolprod[8] := TBCOLUMNNEW('Forncedor/Despesas',{||dupp->cliente})
ocolprod[9] := TBCOLUMNNEW('Tipo Conta',{||dupp->tip_for})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('< > <P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<> <PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                CLEAR GETS
                EXIT
        ELSEIF nkey == K_ENTER
                mduplicata := dupp->duplicata
                mcod_cli   := VAL(dupp->fornec)
                mtipo      := dupp->tipo
                IF mop = '*'
                        mdias_atras := mmulta := mjuros := mvlpago := 0
                        mdias_atras := mdata_sis-dupp->venc
                        mvlpago=dupp->valor+mjuros+mmulta
                        tela1 := SAVESCREEN(00,00,24,79)
                        botao(05,00,22,79)
                        DEVPOS(06,01);DEVOUT('Cliente.............:')
                        DEVPOS(07,01);DEVOUT('No.da Documento ....:')
                        DEVPOS(08,01);DEVOUT('Data Emissao........:')
                        DEVPOS(09,01);DEVOUT('Data Vencimento.....:')
                        DEVPOS(10,01);DEVOUT('Vlr. Documento ...R$:')

                        DEVPOS(11,01);DEVOUT('Operador............:')
                        DEVPOS(12,01);DEVOUT('OBS.:')

                        setcor(3)
                        DEVPOS(06,23);DEVOUT(dupp->fornec+'-'+dupp->cliente)
                        DEVPOS(07,23);DEVOUT(dupp->tipo+dupp->duplicata)
                        DEVPOS(08,23);DEVOUT(DTOC(dupp->emissao))
                        DEVPOS(09,23);DEVOUT(DTOC(dupp->venc))
                        DEVPOS(10,23);DEVOUT(TRANSFORM(dupp->valor,'9,999,999.99'))
                        DEVPOS(11,23);DEVOUT(dupp->operador)
                        DEVPOS(12,07);DEVOUT(dupp->obs)

                        IF ! EMPTY(dupp->datpag) .OR. dupp->pago <> ' '
                                setcor(1)
                                DEVPOS(13,01);DEVOUT('Data Pagamento .....:')
                                DEVPOS(14,01);DEVOUT('Pago efetuado Com...:')
                                DEVPOS(15,01);DEVOUT('Juros Pago .......R$:')
                                DEVPOS(16,01);DEVOUT('Desconto .........R$:')
                                DEVPOS(17,01);DEVOUT('Valor Pago .......R$:')
                                setcor(3)
                                DEVPOS(13,23);DEVOUT(DTOC(dupp->datpag))
                                DEVPOS(14,23);DEVOUT(STRZERO(dupp->datpag-dupp->venc,3)+' Dias.')
                                DEVPOS(15,23);DEVOUT(TRANSFORM(dupp->juros,'9,999,999.99'))
                                DEVPOS(16,23);DEVOUT(TRANSFORM(dupp->desc,'9,999,999.99'))
                                DEVPOS(17,23);DEVOUT(TRANSFORM(dupp->vlpago,'9,999,999.99'))
                        ELSE
                                setcor(1)
                                DEVPOS(13,01);DEVOUT('Prazo estipulado....:')
                                DEVPOS(15,01);DEVOUT('Vlr. Multa+Juros..R$:')
                                DEVPOS(16,01);DEVOUT('Vlr. a Pagar......R$:')
                                IF mdata_sis<dupp->venc
                                        setcor(1)
                                        DEVPOS(14,01);DEVOUT('Faltam p/ Vencimento:')
                                        setcor(3)
                                        DEVPOS(14,23);DEVOUT(STRZERO(dupp->venc-mdata_sis,3)+' Dias.')
                                ELSE
                                        setcor(1)
                                        DEVPOS(14,01);DEVOUT('Atrazo do vencimento:')
                                        setcor(3)
                                        DEVPOS(14,23);DEVOUT(STRZERO(mdata_sis-dupp->venc,3)+' Dias.')
                                ENDIF
                                setcor(3)
                                DEVPOS(13,23);DEVOUT(STRZERO(dupp->venc-dupp->emissao,3)+' Dias.')
                                DEVPOS(15,23);DEVOUT(TRANSFORM(mmulta+mjuros,'9,999,999.99'))
                                DEVPOS(16,23);DEVOUT(TRANSFORM(mvlpago,'9,999,999.99'))
                        ENDIF
                        setcor(1)
                        mensagem('Pressione qualquer tecla p/retornar')
                        INKEY(0)
                        RESTSCREEN(00,00,24,79,tela1)
                        LOOP
                ELSE
                        CLEAR GETS
                        EXIT
                ENDIF
                GO TOP
                oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                ocolprod[1] := TBCOLUMNNEW('Tipo',{||dupp->tipo})
                ocolprod[2] := TBCOLUMNNEW('No.Docuemnto',{||dupp->duplicata})
                ocolprod[3] := TBCOLUMNNEW('Valor Doc.',{||TRANSFORM(dupp->valor,'999,999.99')})
                ocolprod[4] := TBCOLUMNNEW('Vencimento',{||DTOC(dupp->venc)})
                ocolprod[5] := TBCOLUMNNEW('Emissao',{||DTOC(dupp->emissao)})
                ocolprod[6] := TBCOLUMNNEW('Data Pag.',{||dupp->datpag})
                ocolprod[7] := TBCOLUMNNEW('Cod.',{||dupp->fornec})
                ocolprod[8] := TBCOLUMNNEW('Forncedor/Despesas',{||dupp->cliente})
                ocolprod[9] := TBCOLUMNNEW('Tipo Conta',{||dupp->tip_for})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,nkey,'dupp')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Tipo',{||dupp->tipo})
                        ocolprod[2] := TBCOLUMNNEW('No.Docuemnto',{||dupp->duplicata})
                        ocolprod[3] := TBCOLUMNNEW('Valor Doc.',{||TRANSFORM(dupp->valor,'999,999.99')})
                        ocolprod[4] := TBCOLUMNNEW('Vencimento',{||DTOC(dupp->venc)})
                        ocolprod[5] := TBCOLUMNNEW('Emissao',{||DTOC(dupp->emissao)})
                        ocolprod[6] := TBCOLUMNNEW('Data Pag.',{||dupp->datpag})
                        ocolprod[7] := TBCOLUMNNEW('Cod.',{||dupp->fornec})
                        ocolprod[8] := TBCOLUMNNEW('Forncedor/Despesas',{||dupp->cliente})
                        ocolprod[9] := TBCOLUMNNEW('Tipo Conta',{||dupp->tip_for})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
CLEAR GETS
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR CLIENTES
********************************
FUNCTION f7_cli(mop)
*****************
LOCAL f7tela,f7tela1,f7lci,f7cci,f7lba,f7cba,f7msele,f7morde,f7men,;
      oconsprod,ocolprod[9],f7i,f7nkey,f7opcao,mcodcli,mponto,mmens:=''
MEMVAR mcod_cli
PRIVATE mcompras:=0

f7lci := f7cci := 01
*f7lba := MAXROW()-3
f7lba := 15
f7cba := 78

f7tela := SAVESCREEN(00,00,24,79)

f7msele := SELE()
f7morde := INDEXORD()
IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
IF ! AbriArq('sachist','hist');RETURN NIL;ENDIF
IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
*************
SELE('cli');ORDSETFOCUS(2)
*************
mponto := RECNO()
*************
SELE('cli');ORDSETFOCUS(1)
GO BOTT
mcodcli:=cli->cod_cli
*************
*************
SELE('cli');ORDSETFOCUS(2)
GO mponto
*************
f7men := SAVESCREEN(24,00,24,79)

botao(f7lci-1,f7cci-1,f7lba,f7cba+1,,' CLIENTES            Ult.Cliente:'+mcodcli+'  -  Quantidades: '+TRANSFORM(LASTREC(),'999,999'),'*')
oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
ocolprod[1] := TBCOLUMNNEW('Razao Social',{||LEFT(cli->razao,35)})
ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||LEFT(cli->nome,35)})
ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
ocolprod[4] := TBCOLUMNNEW('Tipo',{||cli->tipo})
ocolprod[5] := TBCOLUMNNEW('Cidade',{||cli->cidade})
ocolprod[6] := TBCOLUMNNEW('UF',{||cli->uf})
ocolprod[7] := TBCOLUMNNEW('      CNPJ',{||TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99')})
ocolprod[8] := TBCOLUMNNEW('       CPF',{||TRANSFORM(cli->cpf,'@@R 999.999.999-99')})
ocolprod[9] := TBCOLUMNNEW('Ult.Atua.',{||DTOC(cli->data_atu)})
f7i:=0
FOR f7i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[f7i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('< > <P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<> <PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        f7nkey := 0
        WHILE f7nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                mcompras := 0
                //mcompras := ver_compras(VAL(cli->cod_cli))
                mmens := ''
                mmens := ver_debito(VAL(cli->cod_cli))
                botao(f7lba+1,f7cci,f7lba+7,f7cba,,' Detalhe '+IF(cli->bloqueio='S',' *** CREDITO BLOQUEADO *** ',IF(! EMPTY(mmens),mmens,'')))
                setcor(3)
                DEVPOS(f7lba+2,f7cci+1);DEVOUT('End.:')
                DEVPOS(f7lba+2,f7cci+43);DEVOUT('Bairro:')
                DEVPOS(f7lba+3,f7cci+1);DEVOUT('Cidade:')
                DEVPOS(f7lba+3,f7cci+30);DEVOUT('UF:')
                DEVPOS(f7lba+3,f7cci+37);DEVOUT('Tel.:')
                DEVPOS(f7lba+3,f7cci+57);DEVOUT('Tel.:')
                DEVPOS(f7lba+4,f7cci+1);DEVOUT('Limite: 999,999.99')
                DEVPOS(f7lba+4,f7cci+21);DEVOUT('Saldo Devedor:')
                DEVPOS(f7lba+4,f7cci+48);DEVOUT('Saldo:')
                DEVPOS(f7lba+5,f7cci+1);DEVOUT('Tabela de Cond.Pagamento:')
                DEVPOS(f7lba+6,f7cci+1);DEVOUT('Observacao:')
                setcor(1)
                DEVPOS(f7lba+2,f7cci+6);DEVOUT(cli->endereco)
                DEVPOS(f7lba+2,f7cci+50);DEVOUT(cli->bairro)
                DEVPOS(f7lba+3,f7cci+8);DEVOUT(cli->cidade)
                DEVPOS(f7lba+3,f7cci+33);DEVOUT(cli->uf)
                DEVPOS(f7lba+3,f7cci+42);DEVOUT(cli->tel1)
                DEVPOS(f7lba+3,f7cci+62);DEVOUT(cli->tel2)
                DEVPOS(f7lba+4,f7cci+9);DEVOUTPICT(cli->limite,'999,999.99')
                DEVPOS(f7lba+4,f7cci+36);DEVOUTPICT(mcompras,'999,999.99')
                DEVPOS(f7lba+4,f7cci+55);DEVOUTPICT(cli->limite-mcompras,'999,999.99')
                DEVPOS(f7lba+5,f7cci+27);DEVOUT(cli->cod_cond)
                //ver_cond(VAL(cli->cod_cond),f7lba+5,f7cci+31)
                DEVPOS(f7lba+6,f7cci+13);DEVOUT(cli->obs)
                f7nkey := INKEY(0)
        ENDDO
        IF f7nkey == K_ESC
                EXIT
        ELSEIF f7nkey == K_ENTER
                mcod_cli := VAL(cli->cod_cli)
                IF mop = '*'
                        mensagem('Deseja <A>lterar <E>xcluir:')
                        f7opcao := 'A'
                        @ 23,COL()+1 GET f7opcao PICT '@!' VALID f7opcao $ 'A,E'
                        READ
                        IF LASTKEY() = 27
                                LOOP
                        ELSEIF f7opcao = 'A'
                                //sac131()
                        ELSEIF f7opcao = 'E'
                                //sac132()
                        ENDIF
                ELSE
                        CLEAR GETS
                        EXIT
                ENDIF
                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                ocolprod[1] := TBCOLUMNNEW('Razao Social',{||LEFT(cli->razao,35)})
                ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||LEFT(cli->nome,35)})
                ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
                ocolprod[4] := TBCOLUMNNEW('Tipo',{||cli->tipo})
                ocolprod[5] := TBCOLUMNNEW('Cidade',{||cli->cidade})
                ocolprod[6] := TBCOLUMNNEW('UF',{||cli->uf})
                ocolprod[7] := TBCOLUMNNEW('      CNPJ',{||TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99')})
                ocolprod[8] := TBCOLUMNNEW('       CPF',{||TRANSFORM(cli->cpf,'@@R 999.999.999-99')})
                ocolprod[9] := TBCOLUMNNEW('Ult.Atua.',{||DTOC(cli->data_atu)})
                f7i:=0
                FOR f7i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,f7nkey,'cli')
                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                        ocolprod[1] := TBCOLUMNNEW('Razao Social',{||LEFT(cli->razao,35)})
                        ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||LEFT(cli->nome,35)})
                        ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
                        ocolprod[4] := TBCOLUMNNEW('Tipo',{||cli->tipo})
                        ocolprod[5] := TBCOLUMNNEW('Cidade',{||cli->cidade})
                        ocolprod[6] := TBCOLUMNNEW('UF',{||cli->uf})
                        ocolprod[7] := TBCOLUMNNEW('      CNPJ',{||TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99')})
                        ocolprod[8] := TBCOLUMNNEW('       CPF',{||TRANSFORM(cli->cpf,'@@R 999.999.999-99')})
                        ocolprod[9] := TBCOLUMNNEW('Ult.Atua.',{||DTOC(cli->data_atu)})
                        f7i:=0
                        FOR f7i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f7msele);IF(f7morde>0,ORDSETFOCUS(f7morde),)
RESTSCREEN(24,00,24,79,f7men)
RESTSCREEN(00,00,24,79,f7tela)
RELEASE f7tela,f7tela1,f7lci,f7cci,f7lba,f7cba,f7msele,f7morde,f7men,oconsprod,ocolprod[8],f7i,f7nkey,f7opcao,;
        mcompras:=0
IF f7nkey == K_ESC
        RETURN NIL
ELSE
        CLEAR GETS
        RETURN mcod_cli
ENDIF
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR NIVEIS
********************************

FUNCTION f3_nivel(mop)
*****************
LOCAL mprg:='F3_NIVEL'
LOCAL tela,tela1,lci,cci,lba,cba,msele,morde,men,mnivel

LOCAL oconsprod,ocolprod[5],i,nkey,opcao
MEMVAR nivel_acess
IF ! ver_nivel(mprg,'NIVEL DE ACESSOS','1',nivel_acess)
        RETURN NIL
ENDIF

lci := 02
cci := 05
lba := MAXROW()-3
cba := 75

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
*************
IF ! AbriArq('sacconf','conf');RETURN NIL;ENDIF
SELE('conf');ORDSETFOCUS(1)
GO TOP
*************
men := SAVESCREEN(24,00,24,79)

botao(lci-1,cci-1,lba,cba+1)
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Descricao',{||conf->descri})
ocolprod[2] := TBCOLUMNNEW('Niveis',{||conf->nivel})
ocolprod[3] := TBCOLUMNNEW('Modulo',{||conf->modulo})
ocolprod[4] := TBCOLUMNNEW('Data Alt.',{||conf->data_alt})
ocolprod[5] := TBCOLUMNNEW('Oper.Alt.',{||conf->oper_alt})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        mensagem('< > <P>esquisa <ENTER>p/Alterar Niveis  <ESC>Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                CLEAR GETS
                mnivel := conf->nivel
                @ ROW(),66 GET mnivel PICT '9999999999'
*               @ ROW(),COL()+61 GET mnivel PICT '9999999999'
                READ
                IF LASTKEY() = 27
                        LOOP
                ENDIF
                mensagem('Confirma a Alteracao do Niveis [S/n]:')
                opcao := 'S'
                @ 23,COL()+1 GET opcao PICT '@!' VALID opcao $ 'S,N'
                READ
                IF LASTKEY() = 27 .OR. opcao = 'N'
                        LOOP
                ELSE
                        BLOQREG()
                        conf->nivel := mnivel
                        conf->data_alt  := mdata_sis
                        conf->oper_alt  := cod_operado
                        DBUNLOCK()
                        DBCOMMIT()
                ENDIF
                oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                ocolprod[1] := TBCOLUMNNEW('Descricao',{||conf->descri})
                ocolprod[2] := TBCOLUMNNEW('Niveis',{||conf->nivel})
                ocolprod[3] := TBCOLUMNNEW('Modulo',{||conf->modulo})
                ocolprod[4] := TBCOLUMNNEW('Data Alt.',{||conf->data_alt})
                ocolprod[5] := TBCOLUMNNEW('Oper.Alt.',{||conf->oper_alt})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,nkey,'conf')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Descricao',{||conf->descri})
                        ocolprod[2] := TBCOLUMNNEW('Niveis',{||conf->nivel})
                        ocolprod[3] := TBCOLUMNNEW('Modulo',{||conf->modulo})
                        ocolprod[4] := TBCOLUMNNEW('Data Alt.',{||conf->data_alt})
                        ocolprod[5] := TBCOLUMNNEW('Oper.Alt.',{||conf->oper_alt})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
CLOSE conf
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR CEPS
********************************

FUNCTION f8_cep()
*****************

LOCAL tela,tela1,lci,cci,lba,cba,msele,morde,men

LOCAL oconsprod,ocolprod[4],i,nkey,opcao
MEMVAR mcep
lci := 02
cci := 02
lba := MAXROW()-3
cba := 78

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
*************
SELE('cep');ORDSETFOCUS(1)
*************
men := SAVESCREEN(24,00,24,79)

botao(lci-1,cci-1,lba,cba+1)
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Logradouro',{||cep->nome})
ocolprod[2] := TBCOLUMNNEW('Cep',{||cep->cep8})
ocolprod[3] := TBCOLUMNNEW('Bairro',{||cep->bairro1})
ocolprod[4] := TBCOLUMNNEW('Local',{||cep->local})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        mensagem('< > <P>esquisa  <ESC>Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                mcep := SUBSTR(cep->cep8,1,5)+'-'+SUBSTR(cep->cep8,6)
                CLEAR GETS
                EXIT
        ELSE
                IF genkey(oconsprod,nkey,'cep')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Logradouro',{||cep->nome})
                        ocolprod[2] := TBCOLUMNNEW('Cep',{||cep->cep8})
                        ocolprod[3] := TBCOLUMNNEW('Bairro',{||cep->bairro1})
                        ocolprod[4] := TBCOLUMNNEW('Local',{||cep->local})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
IF nkey == K_ESC
        RETURN NIL
ELSE
        RETURN mcep
ENDIF
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR OCORRENCIAS
********************************

FUNCTION ocorre()
*****************

LOCAL tela,tela1,lci,cci,lba,cba,msele,morde,men

LOCAL oconsprod,ocolprod[12],i,nkey,opcao

lci := 02
cci := 00
lba := MAXROW()-3
cba := 79

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacocorr','ocorr');RETURN NIL;ENDIF

*************
SELE('ocorr');ORDSETFOCUS(1)
GO TOP
*************
men := SAVESCREEN(24,00,24,79)

botao(lci-1,cci-1,lba,cba+1)
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Tipo',{||ocorr->tipo})
ocolprod[2] := TBCOLUMNNEW('Documento',{||ocorr->documento})
ocolprod[3] := TBCOLUMNNEW('Cod.Merc',{||ocorr->codigo})
ocolprod[4] := TBCOLUMNNEW('   Saldo Ant',{||TRANSFORM(ocorr->saldo_atu,'9,999,999.99')})
ocolprod[5] := TBCOLUMNNEW('     Quantd.',{||TRANSFORM(ocorr->quantd,'9,999,999.99')})
ocolprod[6] := TBCOLUMNNEW('  Saldo Apos',{||TRANSFORM(ocorr->saldo_exe,'9,999,999.99')})
ocolprod[7] := TBCOLUMNNEW('Data Op.',{||DTOC(ocorr->data_exe)})
ocolprod[8] := TBCOLUMNNEW('Imp/Ped',{||ocorr->pedido})
ocolprod[9] := TBCOLUMNNEW('Oper.',{||ocorr->cod_oper})
ocolprod[10] := TBCOLUMNNEW('Vend',{||ocorr->cod_vend})
ocolprod[11] := TBCOLUMNNEW('Ocorrencia',{||DTOC(ocorr->data_oco)})
ocolprod[12] := TBCOLUMNNEW('OBS.:',{||ocorr->obs})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        mensagem('< > <P>esquisa  <ESC>Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                CLEAR GETS
                EXIT
        ELSE
                IF genkey(oconsprod,nkey,'ocorr')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Tipo',{||ocorr->tipo})
                        ocolprod[2] := TBCOLUMNNEW('Documento',{||ocorr->documento})
                        ocolprod[3] := TBCOLUMNNEW('Cod.Merc',{||ocorr->codigo})
                        ocolprod[4] := TBCOLUMNNEW('   Saldo Ant',{||TRANSFORM(ocorr->saldo_atu,'9,999,999.99')})
                        ocolprod[5] := TBCOLUMNNEW('     Quantd.',{||TRANSFORM(ocorr->quantd,'9,999,999.99')})
                        ocolprod[6] := TBCOLUMNNEW('  Saldo Apos',{||TRANSFORM(ocorr->saldo_exe,'9,999,999.99')})
                        ocolprod[7] := TBCOLUMNNEW('Data Op.',{||DTOC(ocorr->data_exe)})
                        ocolprod[8] := TBCOLUMNNEW('Imp/Ped',{||ocorr->pedido})
                        ocolprod[9] := TBCOLUMNNEW('Oper.',{||ocorr->cod_oper})
                        ocolprod[10] := TBCOLUMNNEW('Vend',{||ocorr->cod_vend})
                        ocolprod[11] := TBCOLUMNNEW('Ocorrencia',{||DTOC(ocorr->data_oco)})
                        ocolprod[12] := TBCOLUMNNEW('OBS.:',{||ocorr->obs})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
RETURN NIL
******************************* f i m *********************************************
********************************
* VERIFICA O PERCENTUAL PELA UF
********************************

FUNCTION ver_uf(nuf)
********************

LOCAL men,msele,morde,opcao := 'S'
MEMVAR mcod_op,mperc
men := SAVESCREEN(23,00,24,79)
msele := SELE()
morde := INDEXORD()
WHILE .T.
        IF ! v_uf(nuf) .OR. nuf = SPACE(2)
                RETURN .F.
        ENDIF
        ****************
        SELE('tabuf');ORDSETFOCUS(1)
        GO TOP
        ****************

        IF ! tabuf->(DBSEEK(nuf))
                CLEAR GETS
                mensagem('Estado de ')
                setcor(3)
                DEVPOS(23,COL());DEVOUT(nuf)
                setcor(1)
                DEVPOS(23,COL()+1);DEVOUT('nao esta cadastrado...Deseja Cadastra [S/n]:')
                @ MAXROW()-1,COL()+1 GET opcao PICT '@!' VALID opcao $ 'S,N'
                READ
                IF LASTKEY() = 27
                        LOOP
                ENDIF
                IF opcao = 'N'
                        RESTSCREEN(23,00,23,79,men)
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RETURN .F.
                ELSE
                        incl_tab()
                        CLEAR TYPEAHEAD
                        RESTSCREEN(23,00,23,79,men)
                        mensagem('Tecle <ENTER> p/continuar...')
                        INKEY(0)
                        LOOP
                ENDIF

        ENDIF
        mperc := tabuf->percent
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDDO
RESTSCREEN(23,00,23,79,men)
RETURN NIL
********************************* f i m ******************************************
******************************
* VERIFICA O CPF
******************************

FUNCTION ver_cpf(ncpf)
********************

LOCAL men,msele,morde,opcao := 'S'
MEMVAR mcgc,mcpf,mcod_cli,mcliente
men := SAVESCREEN(24,00,24,79)
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
WHILE .T.
        IF EMPTY(ncpf)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
        *****************
        SELE('cli');ORDSETFOCUS(4)
        GO TOP
        *****************
        IF SUBSTR(ncpf,10,2) <> GDV2(SUBSTR(ncpf,1,9))
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF

        IF ! cli->(DBSEEK(ncpf))
                CLEAR GETS
                mensagem('C.P.F nao cadastrado...Deseja Cadastra [S/n]:')
                @ MAXROW()-1,COL()+1 GET opcao PICT '@!' VALID opcao $ 'S,N'
                READ
                IF LASTKEY() = 27
                        LOOP
                ENDIF
                IF opcao = 'N'
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RESTSCREEN(24,00,24,79,men)
                        RETURN .F.
                ELSE
                        //sac130(mcpf,mcgc)
                        CLEAR TYPEAHEAD
                        RESTSCREEN(24,00,24,79,men)
                        LOOP
                ENDIF
        ENDIF
        mcod_cli := VAL(cli->cod_cli)
        mcliente := cli->razao
        mcgc := cli->cgc

        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDDO
RETURN NIL
******************************* f i m *********************************************
******************************
* VERIFICA O CGC
******************************

FUNCTION ver_cgc(ncgc)
********************

LOCAL men,msele,morde,opcao := 'S'
MEMVAR mcgc,mcpf,mcod_cli,mcliente

men := SAVESCREEN(24,00,24,79)
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
WHILE .T.
        IF EMPTY(ncgc)
                RETURN .T.
        ENDIF
        IF ! VCGC(ncgc)
                IF aut_sen('O CNPJ nao confere senha de autorizacao:','LIB_AMB')
                        RETURN .T.
                ENDIF
                RETURN .F.
        ENDIF
        *****************
        SELE('cli');ORDSETFOCUS(3)
        GO TOP
        *****************

        IF ! cli->(DBSEEK(ncgc))
                CLEAR GETS
                mensagem('CNPJ nao cadastrado...Deseja Cadastra [S/n]:')
                @ MAXROW()-1,COL()+1 GET opcao PICT '@!' VALID opcao $ 'S,N'
                READ
                IF LASTKEY() = 27
                        LOOP
                ENDIF
                IF opcao = 'N'
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RESTSCREEN(24,00,24,79,men)
                        RETURN .F.
                ELSE
                        sac130(mcpf,mcgc)
                        CLEAR TYPEAHEAD
                        RESTSCREEN(24,00,24,79,men)
                        LOOP
                ENDIF
        ENDIF
        mcod_cli := VAL(cli->cod_cli)
        mcliente := cli->razao
        mcpf := cli->cpf

        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDDO
RETURN NIL
********************************** F I M ***********************************
FUNCTION ver_ven(mcod_ven,p,tip)
********************

LOCAL men,msele,morde,point,mnome

msele := SELE()
morde := INDEXORD()
point := RECNO()
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
IF tip <> NIL
        IF mcod_ven = '000';RETURN .T.;ENDIF
ENDIF

*****************
SELE('sen');ORDSETFOCUS(2)
GO TOP
*****************

IF ! sen->(DBSEEK(mcod_ven))
        IF p = NIL
                atencao('Codigo do OPERADOR/VENDEDOR nao encontrado')
        ENDIF
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
************************************ F I M ************************************
**********************************
* TESTE DE EXISTENCIA DE VENDEDOR
**********************************

FUNCTION ven(mcod_ven,li,ci,p)

LOCAL msele,morde
MEMVAR mnome_vend,mcom_ap,mcom_ven

IF EMPTY(mcod_ven); RETURN .T.;END

msele := SELE()
morde := INDEXORD()
mnome_vend = SPACE(30)
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF

**************
SELECT('sen');ORDSETFOCUS(2)
GO TOP
**************

IF ! sen->(DBSEEK(STRZERO(mcod_ven,3)))
        IF p = NIL
                atencao('Vendedor nao Cadastrado !!!')
        ENDIF
        mcod_ven = 0
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ELSE
        mnome_vend = sen->snome
        mcom_ven := sen->scomissao
        mcom_ap := sen->scom_praz
        IF li = NIL
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ELSE
                setcor(3)
                DEVPOS(li,ci);DEVOUT(mnome_vend)
                setcor(1)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
ENDIF
RETURN NIL
************************************ F I M ************************************
**********************************
* TESTE DE EXISTENCIA DE DESPESAS
**********************************

FUNCTION ver_desp(mcod_des,li,ci)

LOCAL msele,morde
MEMVAR mdescri1,mdescri2

IF EMPTY(mcod_des); RETURN .T.;END

msele := SELE()
morde := INDEXORD()

**************
SELECT('desp');ORDSETFOCUS(1)
GO TOP
**************
IF ! desp->(DBSEEK(STRZERO(mcod_des,3)))
        atencao('Despesa nao Cadastrada !!!')
        mcod_des = 0
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ELSE
        mdescri1 = desp->desc1
        mdescri2 = desp->desc2
        IF li = NIL
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ELSE
                setcor(3)
                DEVPOS(li,ci);DEVOUT(mdescri1)
                DEVPOS(li+1,ci);DEVOUT(mdescri2)
                setcor(1)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
ENDIF
RETURN NIL
*************************** f i m *********************************************
***************************
* VERIFICA MERCADORIA
***************************

FUNCTION v_merc(mcod,li,ci)
***************************

IF ! merc->(DBSEEK(STRZERO(mcod,5)))
        atencao('Codigo nao Cadastrado !!!')
        RETURN .F.
ENDIF

setcor(3)
DEVPOS(li,ci);DEVOUT(LEFT(merc->descri,35))
setcor(1)

RETURN .T.
************************ f i m **************************************
****************************
* VERIFICA CARTAO DE CREDITO
****************************

FUNCTION ver_cartao(mcod,li,ci,t)
*******************************

LOCAL msele,morde
MEMVAR mdesc_cart,mprazo_cart,mcartao


msele := SELE()
morde := INDEXORD()
IF ! AbriArq('saccarta','car');RETURN NIL;ENDIF

IF EMPTY(mcod) .AND. t = NIL
        RETURN .T.
ENDIF
*************
SELE('car');ORDSETFOCUS(1)
GO TOP
*************

IF ! car->(DBSEEK(STRZERO(mcod,3)))
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF li <> NIL
                atencao('Cartao nao Cadastrado !!!')
                setcor(3)
                DEVPOS(li,ci);DEVOUT(' - '+SPACE(20))
                setcor(1)
                RETURN .F.
        ENDIF
        RETURN 'CARTAO NAO IDENTIFICADO'
ENDIF
IF li <> NIL
        mdesc_cart := car->desconto
        mprazo_cart := car->prazo
        mcartao := car->cartao
        setcor(3)
        DEVPOS(li,ci);DEVOUT(' - '+mcartao)
        setcor(1)
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN car->cartao
************************ F I M **************************************
******************************
* PESQUISA O CGC SE EXISTE
******************************

FUNCTION pesq_cgc(ncgc,narq,condicao,pesq_ali)
********************

LOCAL men,msele,morde,opcao := 'S',mpoint

men := SAVESCREEN(24,00,24,79)
msele := SELE()
morde := INDEXORD()
IF EMPTY(ncgc)
        RETURN .T.
ENDIF
IF ! VCGC(ncgc)
        IF aut_sen('O CNPJ nao confere senha de autorizacao:','LIB_AMB')
                IF LASTKEY() = 27
                        RETURN .F.
                ENDIF
                RETURN .T.
        ENDIF
        RETURN .F.
ENDIF
mpoint := RECNO()
ORDSETFOCUS(3)
*****************

SEEK ncgc

IF condicao <> NIL .AND. FOUND()
        atencao('CNPJ ja cadastrado...Deseja Incluir mesmo assim')
        ORDSETFOCUS(morde)
        GO mpoint
        RETURN .T.
ENDIF
ORDSETFOCUS(morde)
GO mpoint
RETURN .T.
********************************** F I M ***********************************
******************************
* PESQUISA O CPF SE EXISTE
******************************

FUNCTION pesq_cpf(ncpf,narq,condicao)
********************

LOCAL men,msele,morde,mpoint

msele := SELE()
morde := INDEXORD()
IF EMPTY(ncpf)
        RETURN .T.
ENDIF
IF SUBSTR(ncpf,10,2) <> GDV2(SUBSTR(ncpf,1,9))
        atencao('C.P.F. nao confere OK !!!')
        RETURN .F.
ENDIF
mpoint := RECNO()
ORDSETFOCUS(4)
*****************

SEEK ncpf

IF condicao <> NIL .AND. FOUND()
        atencao('C.P.F. ja cadastrado OK !!!')
        ORDSETFOCUS(morde)
        GO mpoint
        RETURN .F.
ENDIF
ORDSETFOCUS(morde)
GO mpoint
RETURN .T.
******************************* f i m *********************************************
********************************
* FUNCAO P/VERIFICAR AUTORIZACAO
********************************
FUNCTION aut_sen(men,mdl,mlin,mnum_cli,mnum_prod)
****************
LOCAL linhas,i,lin,matencao,li,ci,la,ca,mpos,;
      msel_sen,mord_sen,mcont,tela,mok:=' ',linha,msenha,mn_ped:=SPACE(6),;
      mc_cli:=SPACE(5),msel,mord,mcodaux:=SPACE(14),;
      maut_oper:=SPACE(3),msol_aut:=' ',mpoint:=0

MEMVAR mautoriza,mnum_ped

PRIVATE mcod_aut:=SPACE(6),mcod_oper:=0

IF ver_modulo(mdl)
        RESTSCREEN(00,00,24,79,tela)
        RETURN .T.
ENDIF
msel_sen := SELE()
mord_sen := INDEXORD()
linha := 18
IF ! AbriArq('saclog','log');RETURN NIL;ENDIF
IF ! AbriArq('sacconf','conf');RETURN NIL;ENDIF
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
tela := SAVESCREEN(00,00,24,79)
*****************
SELE('sen');ORDSETFOCUS(2)
*****************
mcont := 0
men := RTRIM(men)
IF LEN(men) > 60
        mpos := 60
        ci := 10
ELSEIF LEN(men) < LEN(' MODULO DE LIBERACAO P/SENHA ')
        mpos := LEN(' MODULO DE LIBERACAO P/SENHA ')    //+20
        ci := (80-LEN(' MODULO DE LIBERACAO P/SENHA ')) / 2
ELSE
        mpos := LEN(men)
        ci := (80-LEN(men)) / 2
ENDIF
linhas := MLCOUNT(men,mpos)
li := 12
IF linha <> NIL
        IF linha + linhas + 4 > 24
                li := 24 - (linhas + 4)
        ELSE
                li := linha
        ENDIF
ENDIF
IF mlin <> NIL .AND. mlin < li
        li := mlin
ENDIF
la := li+linhas+4
ca := ci+1+mpos+1
IF ca - ci < 50
        ci := 10
        ca := 70
ENDIF
matencao := SAVESCREEN(00,00,24,79)
botao(li,ci,la,ca,,' MODULO DE LIBERACAO P/SENHA ')
FOR i = 1 TO  linhas
        LIN := MEMOLINE(men,mpos,i,,)
        DEVPOS(li+i,ci+1);DEVOUT(PADC(RTRIM(LIN),mpos))
NEXT
WHILE mcont < 3
        CLEAR GETS
        mok := ' '
        mcod_aut := SPACE(6)
        msol_aut := 'N'
        setcor(1)
        DEVPOS(li+i,ci+1);  DEVOUT('Codigo Operador:')
        DEVPOS(li+i+1,ci+1);DEVOUT('Senha Liberacao:')
        DEVPOS(li+i+2,ci+1);DEVOUT('Solicitar [s/N]:')
        @ li+i,ci+18 GET mcod_oper PICT '999' VALID IF(EMPTY(mcod_oper),.F.,ven(mcod_oper,li+i,ci+22))
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF

        msenha = ''
        pegasenha(@msenha,li+i+1,ci+18,setcor(6,'*'))
        IF msenha = 'NAO'
                EXIT
        ENDIF
        IF ! EMPTY(msenha)
                maut_oper := sen->scod_op
        ENDIF

        @ li+i+2,ci+18 GET msol_aut PICT '@!' VALID IF(msol_aut = 'S',soli_aut(STRZERO(mcod_oper,3),mnum_cli,mnum_prod),.T.) WHEN EMPTY(msenha)
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        DEVPOS(li+i+2,ci+18);DEVOUT(mcod_aut)
        IF mcod_aut = 'NEGATIVO'
                atencao('Autorizao NEGADA')
                EXIT
        ENDIF
        IF (! EMPTY(mnum_cli) .OR. ! EMPTY(mnum_prod)) .AND. ! EMPTY(sen->scod_aut) .AND. EMPTY(msenha)
                mcodaux := mcod_aut+IF(! EMPTY(mnum_cli),mnum_cli,mnum_prod)+STRZERO(mcod_oper,3)
                IF mcodaux = SUBSTR(sen->scod_aut,1,14)
                        msenha := ALLTRIM(DCRIPTO(sen->ssenha))
                        msel := SELE()
                        mord := INDEXORD()
                        **************************
                        SELE('sen');ORDSETFOCUS(2)
                        **************************
                        BLOQREG()
                        mcodaux := sen->scod_aut
                        sen->scod_aut := SPACE(17)
                        DBCOMMIT()
                        DBUNLOCK()
                        GO TOP
                        maut_oper := SUBSTR(mcodaux,15,3)
                        ven(VAL(maut_oper))
                        msenha := ALLTRIM(DCRIPTO(sen->ssenha))
                ELSEIF EMPTY(mcod_aut)
                        msenha = ''
                        pegasenha(@msenha,li+i+2,ci+18,setcor(6,'*'))
                        IF msenha = 'NAO'
                                EXIT
                        ENDIF
                        IF EMPTY(msenha)
                                LOOP
                        ENDIF
                        maut_oper := sen->scod_op
                ELSE
                        atencao('Codigo de Autorizacao nao confere !!!')
                        mcont ++
                        LOOP
                ENDIF
        ENDIF
        IF ALLTRIM(msenha) == ALLTRIM(DCRIPTO(sen->ssenha))
                IF mdl = 'LIB_SALDO'
                        IF(ver_nivel(mdl,'LIBERACAO DE QUANTD.SOLICITADA MAIOR QUE O SALDO DO PRODUTO','15',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'OPER_PED'
                        IF(ver_nivel(mdl,'LIBERACAO DE OPERADOR COM PEDIDOS PEDENTES','1',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'ALT_DADOS'
                        IF(ver_nivel(mdl,'LIBERACAO P/ALTERACAO NA ENTRADA DE MERCADORIA','1',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'LIB_DESC'
                        IF(ver_nivel(mdl,'LIBERACAO DE DESCONTO A MAIOR NO PRECO DE VENDA PRODUTO','15',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'LIB_AJUST'
                        IF(ver_nivel(mdl,'LIBERACAO DE AJUSTE DE SALDO DOS PRODUTOS','1',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'LIBSLDNF'
                        IF(ver_nivel(mdl,'LIBERACAO DE SALDO A MENOR NA NOTA FISCAL','15',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'LIB_AMB'
                        IF(ver_nivel(mdl,'LIBERACAO DE AMBIENTE NAO AUTORIZADO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'DESC_CX'
                        IF ver_nivel(mdl,'LIBERACAO DE DESCONTO NO RECEBIMENTO DO PEDIDO (CAIXA)','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'LIB_ALTSLDPED'
                        IF ver_nivel(mdl,'LIBERACAO DA QUANTIDADE NA ALTERACAO DO PEDIDO IMPRESSO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'LIB_PED_LIB'
                        IF ver_nivel(mdl,'LIBERACAO DE PEDIDO JA LIBERADOR PELO FINANCEIRO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'PRZ_REC'
                        IF ver_nivel(mdl,'LIBERACAO DE PRAZO MAIOR QUE ESTIPULADO NO PEDIDO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'LIB_DEV'
                        IF ver_nivel(mdl,'LIBERACAO DE CLIENTE DEVEDOR, CHQ.S/FUNDO OU LIMITE ESTOURADO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'LIB_TAX'
                        IF ver_nivel(mdl,'LIBERACAO DA TAXA DE ACRESCIMO NO PEDIDO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'LIB_PRZ'
                        IF ver_nivel(mdl,'LIBERACAO DE PRAZO A MAIOR QUE O PERMITIDO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'CHQ_DEV'
                        IF ver_nivel(mdl,'LIBERACAO DE CLIENTE COM *** CHEQUE SEM FUNDOS ***','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'LIMIT_EST'
                        IF ver_nivel(mdl,'LIBERACAO DE CLIENTE COM *** LIMITE ESTOURADO ***','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'LIB_RECE'
                        IF ver_nivel(mdl,'LIBERACAO DE SALDO A RECEBER POR CONTA','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'LIB_ORCA'
                        IF ver_nivel(mdl,'LIBERACAO DE ORCAMENTO PRECO CUSTO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'LIB_INSC'
                        IF ver_nivel(mdl,'LIBERACAO DE INSCRICAO ESTADUAL','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'LIBCLIVEN'
                        IF ver_nivel(mdl,'LIBERACAO DE VENDEDOR DIFERENTE DO VENDEDOR RESP.PELO CLIENTE','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'EST_PEDEXP'
                        IF ver_nivel(mdl,'ESTORNO DE PEDIDO EXPEDIDO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'LIB_PED'
                        IF ver_nivel(mdl,'LIBERAR OU CANCELAR PEDIDOS','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'LIB_PED_VLR'
                        IF ver_nivel(mdl,'LIBERAR VALOR MAIOR DO QUE O PEDIDO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'LIB_2VIAPED'
                        IF ver_nivel(mdl,'LIBERAR 2a.VIA PEDIDO JA EMITIDO NOTA FISCAL','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'SAC101EXC'
                        IF ver_nivel(mdl,'EXCLUSAO DE SUB-GRUPO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'SAC10EXC'
                        IF ver_nivel(mdl,'EXCLUSAO DE GRUPO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'BALSLSAIDA'
                        IF ver_nivel(mdl,'BALANCO ** CORRECAO DE SALDO (SAIDA) **','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'FORMPAGPED'
                        IF ver_nivel(mdl,'LIBERACAO DA FORMA DE PAG. NA ALTERCAO DO PEDIDO (AV -> AP)','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'LIB_FORMA_PG'
                        IF ver_nivel(mdl,'LIBERA FORMA DE PAGAMENTO NO RECEBIMENTO DE AVISTA P/APRAZO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF (RAT(IF(EMPTY(SUBSTR(sen->snivel,1,1)),'*',SUBSTR(sen->snivel,1,1)),conf->nivel) > 0 .OR. RAT(IF(EMPTY(SUBSTR(sen->snivel,2,1)),'*',SUBSTR(sen->snivel,2,1)),conf->nivel) > 0) .OR. STRZERO(VAL(maut_oper),3) = 999
                        mok := '*'
                ENDIF
                IF mok = '*'
                        mautoriza := SPACE(3)
                        mautoriza := sen->scod_op
                        *****************
                        SELE('log');ORDSETFOCUS(1)
                        *****************
                        ADIREG()
                        log->data_sis := DATE()
                        log->data     := mdata_sis
                        log->hora     := TIME()
                        log->tipo     := 'AUTORIZACAO'
                        log->documento:= mn_ped
                        log->cod_cli  := mc_cli
                        log->aut_oper := maut_oper
                        log->cod_oper := cod_operado
                        log->modulo   := conf->modulo
                        log->descri   := conf->descri
                        log->cod_aut  := mcodaux
                        DBCOMMIT()
                        DBUNLOCK()
                        *********************
                        SELE(msel_sen);IF(mord_sen>0,ORDSETFOCUS(mord_sen),)
                        *********************
                        RESTSCREEN(00,00,24,79,tela)
                        RETURN .T.
                ENDIF
                atencao('Cod. Operador:'+maut_oper+' - Operador nao Autorizada !!!')
                mcont ++
                LOOP
        ELSE
                atencao('Senha nao Autorizada 2 !!!')
                mcont ++
                LOOP
        ENDIF
ENDDO
RESTSCREEN(00,00,24,79,tela)
*********************
SELE(msel_sen);IF(mord_sen>0,ORDSETFOCUS(mord_sen),)
*SELE(msel_sen);ORDSETFOCUS(mord_sen)
*********************
RETURN .F.
***************************** F I M ****************************************
************************
* SOLICITAR AUTORIZACAO
************************
FUNCTION soli_aut(sope,scli,sprod)
**********************************
LOCAL mcont:=1,mponto_sen:=0
mponto_sen := RECNO()
BLOQREG()
sen->sstatus := 'S'
IF scli <> NIL
        sen->scliente := scli
ENDIF
IF sprod <> NIL
        sen->sproduto := sprod
ENDIF
sen->sope     := sope
DBUNLOCK()
DBCOMMIT()
WHILE LASTKEY() <> 27
        GO mponto_sen
        IF sen->sstatus = 'S'
                mensagem('Aguarde solicitanto AUTORIZACAO '+REPLI('.',mcont))
        ELSEIF sen->sstatus = 'A'
                mensagem('Aguarde um momento em ANALISE '+REPLI('.',mcont))
        ELSEIF sen->sstatus = 'L'
                mcod_aut := SUBSTR(sen->scod_aut,1,6)
                EXIT
        ELSEIF sen->sstatus = 'N'
                mcod_aut := 'NEGATIVO'
                EXIT
        ENDIF
        mcont ++
        IF mcont = 5
                mcont := 1
        ENDIF
        INKEY(.5)
        IF LASTKEY() = 27
                mcod_aut := 'NEGATIVO'
                EXIT
        ENDIF
ENDDO
BLOQREG()
sen->sstatus := ' '
sen->scliente := sen->sproduto := SPACE(5)
sen->sope     := SPACE(3)
DBUNLOCK()
DBCOMMIT()
RETURN .T.

***************
FUNCTION vencim(mv,t,dup,memi,prz_dia,m_doc)
***************
MEMVAR memissao
IF memi = NIL
        memi := memissao
ENDIF
IF prz_dia = NIL
        prz_dia := 0
ENDIF
IF m_doc <> NIL .AND. EMPTY(m_doc) .AND. EMPTY(mv)
        RETURN .T.
ENDIF
IF t = NIL .AND. mv=ctod("  /  /  ")
        atencao('Data de Vencimento deve ser preenchida! [] Continua.')
        RETURN .F.
ENDIF
IF (dup = NIL .OR. ! EMPTY(dup)) .AND. DTOS(mv)<DTOS(memi)
        atencao('Data de Vencimento menor que Data de Emissao! [] Continua.')
        RETURN .F.
ENDIF
IF (dup = NIL .OR. ! EMPTY(dup)) .AND. DTOS(mv) > DTOS((memi+prz_dia+set->prz_rec)) .AND. ! EMPTY(prz_dia) .AND. ! EMPTY(set->prz_rec)
        IF ! aut_sen('Vencimento maior que Prazo estipulado no PEDIDO mais TOLERANCIA de '+STRZERO(set->prz_rec,3)+' Dias.','PRZ_REC')
                RETURN .F.
        ENDIF
        IF LASTKEY() = 27
                RETURN .F.
        ENDIF
ENDIF
IF dow(mv)=7 .OR. dow(mv)=1
        atencao('Data de Vencimento cai no '+IF(dow(mv)=7,'SABADO','DOMINGO')+' Final de semana')
        ?? chr(7)
ENDIF
RETURN .T.

************************** F I M ***************************************
********************************
* FIM DA TECLA DE ATALHO
********************************

FUNCTION fimset()
*****************

SET KEY -1 TO
SET KEY -2 TO
SET KEY -3 TO
SET KEY -4 TO
SET KEY -5 TO
SET KEY -6 TO
SET KEY -7 TO
SET KEY -8 TO
SET KEY -40 TO
RETURN NIL

****************************** F I M **************************************
***********************************
* ATIVA AS TECLAS DE ATALHO
***********************************

FUNCTION set_key(s1,s2,s3,s4,t)
********************************************************

IF (s1 = 'merc' .OR. s2 = 'merc' .OR. s3 = 'merc' .OR. s4 = 'merc') .AND. t = NIL
        SET KEY -3 TO f4_merc()
ENDIF
IF (s1 = 'merc' .OR. s2 = 'merc' .OR. s3 = 'merc' .OR. s4 = 'merc') .AND. t <> NIL
        SET KEY -3 TO f4_merc()
ENDIF
IF s1 = 'cliente' .OR. s2 = 'cliente' .OR. s3 = 'cliente' .OR. s4 = 'cliente'
        SET KEY -6 TO f7_cli()
ENDIF
IF s1 = 'forn' .OR. s2 = 'forn' .OR. s3 = 'forn' .OR. s4 = 'forn'
        SET KEY -5 TO f6_forn()
ENDIF
IF s1 = 'trans' .OR. s2 = 'trans' .OR. s3 = 'trans' .OR. s4 = 'trans'
        SET KEY -4 TO f5_trans()
ENDIF

RETURN NIL
*********************************** F I M *************************************
*******************************************
* FUNCAO PARA VERIFICAR COD.NAT.OPERACAO
*******************************************

FUNCTION ver_nat(cod)
*********************

LOCAL msele,morde
MEMVAR mnatureza,mcredito,msai_ent


IF EMPTY(cod)
        RETURN .T.
ENDIF
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacop','op');RETURN NIL;ENDIF
*****************
SELE('op');ORDSETFOCUS(1)
GO TOP
*****************

IF ! op->(DBSEEK(cod))
        atencao('Este CFOP: '+cod+'  nao esta cadastrado em nossos arquivos !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ELSE
        mnatureza := op->descr_op
        mcredito :=  op->credito
        msai_ent := op->sai_ent
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
RETURN NIL
********************** F I M ********************************
*****************************
FUNCTION icm_merc(cod)
*****************************

LOCAL msele,morde
MEMVAR mdif_icm,micm_sub


msele := SELE()
morde := INDEXORD()

****************
SELE('merc');ORDSETFOCUS(1)
GO TOP
****************

IF ! merc->(DBSEEK(STRZERO(cod,5)))
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
mdif_icm := merc->bebida
micm_sub := merc->icm_sub
RETURN NIL

**************************** F I M ******************************************
******************************
* CONFIGURACAO DE IMPRESSORA
******************************
*****************************
FUNCTION impressora()
*****************************

LOCAL msele,morde,mimp:={},mpoint:={},point,tela

msele := SELE()
morde := INDEXORD()
tela := SAVESCREEN(01,00,24,79)
ASIZE(mimp,0)
ASIZE(mpoint,0)
****************
SELE('prn');ORDSETFOCUS(1)
GO TOP
****************
WHILE ! EOF()
        AADD(mimp,prn->impressora)
        AADD(mpoint,RECNO())
        SKIP
ENDDO
botao(06,02,13,24,,' Impressoras ')
point := ACHOICE(07,03,12,23,mimp)
IF LASTKEY() = 13
        GO mpoint[point]
        RESTSCREEN(01,00,24,79,tela)
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ELSEIF LASTKEY() = 27
        RESTSCREEN(01,00,24,79,tela)
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
RETURN NIL
********************* FIM *********************************
*************************
* CADASTRO DE ESTADOS
*************************

FUNCTION incl_tab
******************

LOCAL tela1,tela,lci,cci,lba,cba,point,pode,msele,morde,men,;
      opcao,muf,mestado,mperc,f,m_uf:={}

lci := 07
cci := 28
lba := 17
cba := 65

tela := SAVESCREEN(01,00,24,79)

IF SELE() <> 0
        msele := SELE()
        morde := INDEXORD()
ENDIF
men := SAVESCREEN(24,00,24,79)

************
SELE('tabuf');ORDSETFOCUS(1)
GO TOP
************
SET CURSOR ON
tela1 := SAVESCREEN(01,00,24,79)
WHILE .T.
        mensagem('Digite a Sigla do Estado a ser Cadastrado')
        muf := SPACE(2)
        mestado :=  SPACE(20)
        mperc :=  0
        botao(lba+2,cci,lba+4,cba,,' Inclusao ')
        @ lba+3,cci+2 GET muf PICT '@!' VALID v_uf(muf)
        READ

        IF LASTKEY() = 27
                RESTSCREEN(01,00,24,79,tela1)
                RETURN NIL
        ENDIF
        IF EMPTY(muf)
                LOOP
        ENDIF
        *************
        IF tabuf->(DBSEEK(muf))
                atencao('Estado ja Cadastrado')
                LOOP
        ENDIF
        @ lba+3,cci+7 GET mestado PICT '@!'
        @ lba+3,cci+30 GET mperc PICT '99.99'
        READ
        IF LASTKEY() = 27
                LOOP
        ENDIF
        mensagem('Confirma Inclusao [S/n]:')
        opcao := 'S'
        @ MAXROW()-1,COL()+1 GET opcao PICT '@!' VALID opcao $ 'S,N'
        READ
        IF LASTKEY() = 27
                LOOP
        ENDIF
        IF opcao = 'S'
                IF ADIREG()
                        REPLA uf WITH muf
                        REPLA estado WITH mestado
                        REPLA percent WITH mperc
                        COMMIT
                        UNLOCK
                ELSE
                        atencao('Nao foi Possivel Acessar o Arquivo')
                        LOOP
                ENDIF
        ELSE
                LOOP
        ENDIF
ENDDO
RETURN NIL
*************************** f i m *******************************************
* FIM DO SISTEMA
****************
FUNCTION fim_prg

LOCAL mlinha,msenha

mlinha := SAVESCREEN(24,00,24,79)
setcor(1)
* mensagem('Digite Senha finalizacao do sistema:')
msenha = ''
pegasenha(@msenha,25,COL()+1,setcor(6,'*'))
setcor(1)
IF msenha = 'NAO'
        RETURN NIL
        RESTSCREEN(24,00,24,79,mlinha)
ENDIF
IF msenha = 'MIF'
        *----------------------------------------------------------------------------
        CLOSE ALL
        IF ! AbriArq('sacmov','mov','E');RETURN NIL;ENDIF
        GO TOP
        *----------------------------------------------------------------------------
        WHILE ! EOF()
                IF mov->tipo = '02'
                        DELE
                ENDIF
                SKIP
        ENDDO
        PACK
        DBCOMMITALL()
        DBUNLOCKALL()
        CLOSE ALL
ENDIF
RESTSCREEN(24,00,24,79,mlinha)
RETURN NIL
********************************* F I M **************************
***************************
* FUNCAO PARA PROGRESSAO
***************************
FUNCTION prog(l,c,q,marq,t)
***********************************
LOCAL i
setcor(1)
limpa(l,c,l,c+(80-c))
DEVPOS(l,c+18);DEVOUT('Campos: ')
DEVPOS(l,c);DEVOUT('')
setcor(3)
DEVPOS(l,c+25);DEVOUT(marq)
DEVPOS(l,c+13);DEVOUT(TRANSFORM(0,'999'))
IF q = 0
        DEVPOS(l,c+13);DEVOUT(TRANSFORM(0,'999'))
        RETURN NIL
ENDIF
i := 0
FOR i = 1 TO q/10
        DEVPOS(l,c);DEVOUT(REPLI('',i))
        DEVPOS(l,c+13);DEVOUT(TRANSFORM(i*10,'999'))
NEXT
setcor(1)
RETURN NIL
************************* F I M ******************************
**************************************
* FUNCAO PARA CHECAR O SPC
**************************************

FUNCTION spc(mcod,mvalor,mtipo,mped,mlib,mcons)
*************************

LOCAL liberado:='*',rodape,ponto,msele,morde,mcont_ch,mpesq,;
      mmensagem:=' ',mok:=' ',mcont_arq:=0,mcam_arq:=' ',i:=0,;
      mcpfcnpj := ' ',mcli_spc,mcam_cli:=' '
MEMVAR ok,mdata_sis,mlim_venc,mlim_avenc,mtot_limite

rodape := SAVESCREEN(23,00,23,79)
mlim_venc := mlim_avenc := mtot_limite := 0
IF mlib <> NIL .AND. mlib = '*'
        RETURN .T.
ENDIF
IF STRZERO(mcod,5) = set->cli_def .OR. cli->spc = 'N'
        RETURN .T.
ENDIF
mok := ' '
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('saccheq','cheq');RETURN NIL;ENDIF
IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
IF ! AbriArq('sacped_s','ped_s');RETURN NIL;ENDIF
******************
SELE('cheq');ORDSETFOCUS(8)
GO TOP
******************
IF cheq->(DBSEEK(STRZERO(mcod,5)+' '))
        IF mok = ' '
                IF (ver_serie() = '141287' .OR. ver_serie() = '14128D') .AND. ;
                   ! aut_sen('CLIENTE COM CHEQUE DEVOLVIDO','CHQ_DEV',,STRZERO(mcod,5))
                        UNLOCK
                        RESTSCREEN(23,00,23,79,rodape)
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RETURN .F.
                ENDIF
                liberado := ' '
                mmensagem:='*** CHEQUE DEVOLVIDO ***'
                mok:='*'
        ENDIF
ENDIF
********************
SELE('dupr');ORDSETFOCUS(6)
********************
IF ver_serie() = '141287'
        mpesq := STRZERO(mcod,5)
ELSE
        mpesq := STRZERO(mcod,5)+' '
ENDIF
IF dupr->(DBSEEK(mpesq))
        ponto := RECNO()
        WHILE STRZERO(mcod,5) = dupr->fornec .AND. ! EOF()
                IF ver_serie() = '141287'
                        IF dupr->venc < mdata_sis .AND. dupr->pago = ' '
                                mtot_limite := mtot_limite + dupr->valor
                                mlim_venc   := mlim_venc + dupr->valor
                        ELSEIF dupr->pago = ' '
                                mtot_limite := mtot_limite + dupr->valor
                                mlim_avenc   := mlim_avenc + dupr->valor
                        ELSEIF ! EMPTY(dupr->pago) .AND. dupr->venc > dupr->datpag .AND. dupr->venc > mdata_sis
                                mtot_limite := mtot_limite + dupr->valor
                                mlim_avenc   := mlim_avenc + dupr->valor
                        ENDIF
                ELSE
                        IF dupr->venc < mdata_sis .AND. dupr->pago = ' '
                                mtot_limite := mtot_limite + dupr->valor
                                mlim_venc   := mlim_venc + dupr->valor
                        ELSEIF dupr->pago = ' '
                                mtot_limite := mtot_limite + dupr->valor
                                mlim_avenc   := mlim_avenc + dupr->valor
                        ENDIF
                ENDIF
                SKIP
        ENDDO
        GO ponto
        WHILE STRZERO(mcod,5) = dupr->fornec .AND. dupr->pago = ' ' .AND. ! EOF()
                IF dupr->conta = '*' .AND. dupr->venc < mdata_sis .AND. dupr->pago = ' '
                        liberado := ' '
                        mmensagem:= mmensagem+' - *** DOCUMENTO VENCIDO (p/CONTA) - MATRIZ !!! ***'
                        mok:='*'
                        EXIT
                ELSE
                        IF dupr->venc+set->dia_venc < mdata_sis .AND. dupr->pago = ' '
                                liberado := ' '
                                mmensagem:= mmensagem+' - *** DOCUMENTO VENCIDO - MATRIZ !!! ***'
                                mok:='*'
                                EXIT
                        ENDIF
                ENDIF
                SKIP
        ENDDO
ENDIF
IF ! EMPTY(cfg->dir_filial)
        mcpfcnpj := ' '
        mcli_spc := cli->cod_cli
        IF ! EMPTY(cli->cpf)
                mcpfcnpj := '1'+cli->cpf
        ELSEIF ! EMPTY(cli->cgc)
                mcpfcnpj := '2'+cli->cgc
        ENDIF
        IF VAL(SUBSTR(mcpfcnpj,1,1)) > 0 .OR. cfg->tipo_cons = 'C'
                i :=0
                IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
                FOR i = 1 TO 10
                        IF i = 1
                                mcam_arq := cfg->dir_filial
                                mcam_cli := cfg->cli_filial
                        ELSEIF i = 2
                                mcam_arq := cfg->dir_filia1
                                mcam_cli := cfg->cli_filia1
                        ELSEIF i = 3
                                mcam_arq := cfg->dir_filia2
                                mcam_cli := cfg->cli_filia2
                        ELSEIF i = 4
                                mcam_arq := cfg->dir_filia3
                                mcam_cli := cfg->cli_filia3
                        ELSEIF i = 5
                                mcam_arq := cfg->dir_filia4
                                mcam_cli := cfg->cli_filia4
                        ELSEIF i = 6
                                mcam_arq := cfg->dir_filia5
                                mcam_cli := cfg->cli_filia5
                        ELSEIF i = 7
                                mcam_arq := cfg->dir_filia6
                                mcam_cli := cfg->cli_filia6
                        ELSEIF i = 8
                                mcam_arq := cfg->dir_filia7
                                mcam_cli := cfg->cli_filia7
                        ELSEIF i = 9
                                mcam_arq := cfg->dir_filia8
                                mcam_cli := cfg->cli_filia8
                        ELSEIF i = 10
                                mcam_arq := cfg->dir_filia9
                                mcam_cli := cfg->cli_filia9
                        ENDIF
                        IF ! EMPTY(ALLTRIM(mcam_arq))
                                IF cfg->tipo_cons = 'P'
                                        cli->(DBCLOSEAREA())
                                        IF AbriArq('saccli','cli',,,,,mcam_cli)
                                                ***********
                                                SELE('cli')
                                                ***********
                                                IF SUBSTR(mcpfcnpj,1,1) = '1'
                                                        ORDSETFOCUS(4);GO TOP
                                                ELSE
                                                        ORDSETFOCUS(3);GO TOP
                                                ENDIF
                                                IF cli->(DBSEEK(SUBSTR(mcpfcnpj,2)))
                                                        mcli_spc := cli->cod_cli
                                                ELSE
                                                        LOOP
                                                ENDIF
                                        ELSE
                                                IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
                                        ENDIF
                                ENDIF
                                dupr->(DBCLOSEAREA())
                                IF AbriArq('sacdupr','dupr',,,,,mcam_arq)
                                        **************
                                        SELE('dupr');ORDSETFOCUS(6)
                                        ***************
                                        GO TOP
                                        IF ver_serie() = '141287'
                                                mpesq := mcli_spc
                                        ELSE
                                                mpesq := mcli_spc+' '
                                        ENDIF
                                        IF ! dupr->(DBSEEK(mpesq))
                                                LOOP
                                        ENDIF
                                        ponto := RECNO()
                                        WHILE mcli_spc = dupr->fornec .AND. ! EOF()
                                                IF ver_serie() = '141287'
                                                        IF dupr->venc < mdata_sis .AND. dupr->pago = ' '
                                                                mtot_limite := mtot_limite + dupr->valor
                                                                mlim_venc   := mlim_venc + dupr->valor
                                                        ELSEIF dupr->pago = ' '
                                                                mtot_limite := mtot_limite + dupr->valor
                                                                mlim_avenc   := mlim_avenc + dupr->valor
                                                        ELSEIF ! EMPTY(dupr->pago) .AND. dupr->venc > dupr->datpag .AND. dupr->venc > mdata_sis
                                                                mtot_limite := mtot_limite + dupr->valor
                                                                mlim_avenc   := mlim_avenc + dupr->valor
                                                        ENDIF
                                                ELSE
                                                        IF dupr->venc < mdata_sis .AND. dupr->pago = ' '
                                                                mtot_limite := mtot_limite + dupr->valor
                                                                mlim_venc   := mlim_venc + dupr->valor
                                                        ELSEIF dupr->pago = ' '
                                                                mtot_limite := mtot_limite + dupr->valor
                                                                mlim_avenc   := mlim_avenc + dupr->valor
                                                        ENDIF
                                                ENDIF
                                                SKIP
                                        ENDDO
                                        GO ponto
                                        WHILE mcli_spc = dupr->fornec .AND. dupr->pago = ' ' .AND. ! EOF()
                                                IF dupr->conta = '*'
                                                        IF dupr->venc < mdata_sis .AND. dupr->pago = ' '
                                                                liberado := ' '
                                                                mmensagem:= mmensagem+' - *** DOCUMENTO VENCIDO (p/CONTA) - FILIAL = '+STRZERO(i,3)+' !!! ***'
                                                                mok:='*'
                                                                EXIT
                                                        ENDIF
                                                ELSE
                                                        IF dupr->venc+set->dia_venc < mdata_sis .AND. dupr->pago = ' '
                                                                liberado := ' '
                                                                mmensagem:= mmensagem+' - *** DOCUMENTO VENCIDO - FILIAL = '+STRZERO(i,3)+' !!! ***'
                                                                mok:='*'
                                                                EXIT
                                                        ENDIF
                                                ENDIF
                                                SKIP
                                        ENDDO
                                ELSE
                                        IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
                                ENDIF
                        ENDIF
                NEXT
                dupr->(DBCLOSEAREA())
                cli->(DBCLOSEAREA())
                IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
                IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
                ***************************
                SELE('cli');ORDSETFOCUS(1)
                cli->(DBSEEK(STRZERO(mcod,5)))
                ***************************
        ENDIF
ENDIF
IF ver_serie() = '141204'
        ***************************
        SELE('ped_s');ORDSETFOCUS(14)
        GO TOP
        ped_s->(DBSEEK(' '+STRZERO(mcod,5)))
        ***************************
        WHILE EMPTY(ped_s->ppag) .AND. ! EOF() .AND. STRZERO(mcod,5) = ped_s->pcod_cli
                mtot_limite := mtot_limite + ped_s->pquantd * ped_s->pvlr_fat
                mlim_venc   := mlim_venc + ped_s->pquantd * ped_s->pvlr_fat
                SKIP
        ENDDO
ENDIF
***************************
SELE('cli');ORDSETFOCUS(1)
cli->(DBSEEK(STRZERO(mcod,5)))
***************************
IF cli->limite > 0 .AND. mtot_limite+mvalor > cli->limite
        IF mtipo = NIL
                IF (ver_serie() = '141287' .OR. ver_serie() = '14128D') .AND. ;
                   ! aut_sen('CLIENTE COM LIMITE ESTOURADO','LIMIT_EST',,STRZERO(mcod,5))
                        UNLOCK
                        RESTSCREEN(23,00,23,79,rodape)
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RETURN .F.
                ELSE
                        mmensagem:= mmensagem+' - *** LIMITE R$: '+TRANSFORM(cli->limite,'99,999,999.99')+' ESTORADO em '+TRANSFORM((mtot_limite+mvalor) - cli->limite,'99,999,999.99')+' ***'
                ENDIF
                liberado := ' '
                mok:='*'
        ELSE
                atencao('Cliente com LIMITE R$: '+TRANSFORM(cli->limite,'99,999,999.99')+' ESTORADO em '+TRANSFORM((mtot_limite+mvalor) - cli->limite,'99,999,999.99')+' !!!')
        ENDIF

ENDIF

IF mped = NIL
        ********************
        SELE('ped_s');ORDSETFOCUS(8)
        GO TOP
        ********************
        IF ped_s->(DBSEEK(STRZERO(mcod,5)+' '))
                atencao('Cliente com PEDIDO EM ABERTO !!!')
                IF ver_serie() = '141287' .OR. ver_serie() = '14128D'
                        liberado := ' '
                        mmensagem:= mmensagem+' - *** PEDIDO EM ABERTO ***'
                ENDIF
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        ENDIF
ENDIF
IF mcons = NIL
        IF mok = '*' .AND. ! aut_sen(mmensagem,'LIB_DEV',,STRZERO(mcod,5))
                UNLOCK
                RESTSCREEN(23,00,23,79,rodape)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF
ELSE
        atencao(mmensagem)
ENDIF
mlib := liberado := '*'
IF liberado = '*' .OR. mtipo <> NIL
        RESTSCREEN(23,00,23,79,rodape)
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ELSE
        RESTSCREEN(23,00,23,79,rodape)
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .F.
************************* F I M ******************************
**************************************
* FUNCAO PARA CHECAR O SPC
**************************************

FUNCTION ver_debito(mcod)
*************************

LOCAL msele,morde,mmensagem:=''

IF STRZERO(mcod,5) = set->cli_def .OR. cli->spc = 'N'
        RETURN mmensagem
ENDIF
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('saccheq','cheq');RETURN NIL;ENDIF
IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
IF ! AbriArq('sacped_s','ped_s');RETURN NIL;ENDIF
******************
SELE('cheq');ORDSETFOCUS(8)
GO TOP
******************
IF cheq->(DBSEEK(STRZERO(mcod,5)+' '))
        mmensagem := ' *** CHEQUE DEVOLVIDO *** '
ENDIF
********************
SELE('dupr');ORDSETFOCUS(6)
********************
mpesq := STRZERO(mcod,5)+' '
IF dupr->(DBSEEK(mpesq))
        IF dupr->venc < mdata_sis
                mmensagem:= mmensagem+' *** DOCUMENTO VENCIDO *** '
        ENDIF
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN mmensagem
******************************** F I M ************************************88
**************************************
* FUNCAO PARA CHECAR O LIMITE
**************************************

FUNCTION limite(mcod,mvalor,mtipo,mped)
*************************

LOCAL liberado:='*',rodape,ponto,msel_lim,mord_lim,mcont_ch,mcam_arq:=' ',i:=0,;
      mcpfcnpj := ' ',mcli_spc,mcam_cli:=' '

MEMVAR mlim_venc,mlim_avenc,mtot_limite,mdata_sis

rodape := SAVESCREEN(23,00,23,79)
mlim_venc := mlim_avenc := mtot_limite := 0
IF STRZERO(mcod,5) = set->cli_def .OR. cli->spc = 'N'
        RETURN .T.
ENDIF
msel_lim := SELE()
mord_lim := INDEXORD()
IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
IF ! AbriArq('sacped_s','ped_s');RETURN NIL;ENDIF
********************
SELE('dupr');ORDSETFOCUS(2)
GO TOP
********************
IF dupr->(DBSEEK(STRZERO(mcod,5)))
        WHILE STRZERO(mcod,5) = dupr->fornec .AND. ! EOF()
                IF dupr->venc < mdata_sis .AND. dupr->pago = ' '
                        mtot_limite := mtot_limite + dupr->valor
                        mlim_venc   := mlim_venc + dupr->valor
                ELSEIF dupr->pago = ' '
                        mtot_limite := mtot_limite + dupr->valor
                        mlim_avenc   := mlim_avenc + dupr->valor
                ENDIF
                SKIP
        ENDDO
ENDIF
IF ! EMPTY(cfg->dir_filial)
        mcpfcnpj := ' '
        mcli_spc := cli->cod_cli
        IF ! EMPTY(cli->cpf)
                mcpfcnpj := '1'+cli->cpf
        ELSEIF ! EMPTY(cli->cgc)
                mcpfcnpj := '2'+cli->cgc
        ENDIF
        IF VAL(SUBSTR(mcpfcnpj,1,1)) > 0 .OR. cfg->tipo_cons = 'C'
                i :=0
                IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
                FOR i = 1 TO 10
                        IF i = 1
                                mcam_arq := cfg->dir_filial
                                mcam_cli := cfg->cli_filial
                        ELSEIF i = 2
                                mcam_arq := cfg->dir_filia1
                                mcam_cli := cfg->cli_filia1
                        ELSEIF i = 3
                                mcam_arq := cfg->dir_filia2
                                mcam_cli := cfg->cli_filia2
                        ELSEIF i = 4
                                mcam_arq := cfg->dir_filia3
                                mcam_cli := cfg->cli_filia3
                        ELSEIF i = 5
                                mcam_arq := cfg->dir_filia4
                                mcam_cli := cfg->cli_filia4
                        ELSEIF i = 6
                                mcam_arq := cfg->dir_filia5
                                mcam_cli := cfg->cli_filia5
                        ELSEIF i = 7
                                mcam_arq := cfg->dir_filia6
                                mcam_cli := cfg->cli_filia6
                        ELSEIF i = 8
                                mcam_arq := cfg->dir_filia7
                                mcam_cli := cfg->cli_filia7
                        ELSEIF i = 9
                                mcam_arq := cfg->dir_filia8
                                mcam_cli := cfg->cli_filia8
                        ELSEIF i = 10
                                mcam_arq := cfg->dir_filia9
                                mcam_cli := cfg->cli_filia9
                        ENDIF
                        IF ! EMPTY(ALLTRIM(mcam_arq))
                                IF cfg->tipo_cons = 'P'
                                        cli->(DBCLOSEAREA())
                                        IF AbriArq('saccli','cli',,,,,mcam_cli)
                                                ***********
                                                SELE('cli')
                                                ***********
                                                IF SUBSTR(mcpfcnpj,1,1) = '1'
                                                        ORDSETFOCUS(4);GO TOP
                                                ELSE
                                                        ORDSETFOCUS(3);GO TOP
                                                ENDIF
                                                IF cli->(DBSEEK(SUBSTR(mcpfcnpj,2)))
                                                        mcli_spc := cli->cod_cli
                                                ELSE
                                                        LOOP
                                                ENDIF
                                        ELSE
                                                IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
                                        ENDIF
                                ENDIF
                                dupr->(DBCLOSEAREA())
                                IF AbriArq('sacdupr','dupr',,,,,mcam_arq)
                                        **************
                                        SELE('dupr');ORDSETFOCUS(6)
                                        ***************
                                        GO TOP
                                        IF ver_serie() = '141287'
                                                mpesq := mcli_spc
                                        ELSE
                                                mpesq := mcli_spc+' '
                                        ENDIF
                                        IF ! dupr->(DBSEEK(mpesq))
                                                LOOP
                                        ENDIF
                                        ponto := RECNO()
                                        WHILE mcli_spc = dupr->fornec .AND. ! EOF()
                                                IF ver_serie() = '141287'
                                                        IF dupr->venc < mdata_sis .AND. dupr->pago = ' '
                                                                mtot_limite := mtot_limite + dupr->valor
                                                                mlim_venc   := mlim_venc + dupr->valor
                                                        ELSEIF dupr->pago = ' '
                                                                mtot_limite := mtot_limite + dupr->valor
                                                                mlim_avenc   := mlim_avenc + dupr->valor
                                                        ELSEIF ! EMPTY(dupr->pago) .AND. dupr->venc > dupr->datpag .AND. dupr->venc > mdata_sis
                                                                mtot_limite := mtot_limite + dupr->valor
                                                                mlim_avenc   := mlim_avenc + dupr->valor
                                                        ENDIF
                                                ELSE
                                                        IF dupr->venc < mdata_sis .AND. dupr->pago = ' '
                                                                mtot_limite := mtot_limite + dupr->valor
                                                                mlim_venc   := mlim_venc + dupr->valor
                                                        ELSEIF dupr->pago = ' '
                                                                mtot_limite := mtot_limite + dupr->valor
                                                                mlim_avenc   := mlim_avenc + dupr->valor
                                                        ENDIF
                                                ENDIF
                                                SKIP
                                        ENDDO
                                ELSE
                                        IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
                                ENDIF
                        ENDIF
                NEXT
                dupr->(DBCLOSEAREA())
                cli->(DBCLOSEAREA())
                IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
                IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
                ***************************
                SELE('cli');ORDSETFOCUS(1)
                cli->(DBSEEK(STRZERO(mcod,5)))
                ***************************
        ENDIF
ENDIF
IF ! EMPTY(cfg->dir_filial)
        i := 0
        FOR i = 1 TO 10
                dupr->(DBCLOSEAREA())
                IF i = 1
                        mcam_arq := cfg->dir_filial
                ELSEIF i = 2
                        mcam_arq := cfg->dir_filia1
                ELSEIF i = 3
                        mcam_arq := cfg->dir_filia2
                ELSEIF i = 4
                        mcam_arq := cfg->dir_filia3
                ELSEIF i = 5
                        mcam_arq := cfg->dir_filia4
                ELSEIF i = 6
                        mcam_arq := cfg->dir_filia5
                ELSEIF i = 7
                        mcam_arq := cfg->dir_filia6
                ELSEIF i = 8
                        mcam_arq := cfg->dir_filia7
                ELSEIF i = 9
                        mcam_arq := cfg->dir_filia8
                ELSEIF i = 10
                        mcam_arq := cfg->dir_filia9
                ENDIF
                IF AbriArq('sacdupr','dupr',,,,,mcam_arq)
                        ********************
                        SELE('dupr');ORDSETFOCUS(2)
                        ********************
                        IF dupr->(DBSEEK(STRZERO(mcod,5)))
                                WHILE STRZERO(mcod,5) = dupr->fornec .AND. ! EOF()
                                        IF dupr->venc < mdata_sis .AND. dupr->pago = ' '
                                                mtot_limite := mtot_limite + dupr->valor
                                                mlim_venc   := mlim_venc + dupr->valor
                                        ELSEIF dupr->pago = ' '
                                                mtot_limite := mtot_limite + dupr->valor
                                                mlim_avenc   := mlim_avenc + dupr->valor
                                        ENDIF
                                        SKIP
                                ENDDO
                        ENDIF
                        dupr->(DBCLOSEAREA())
                ENDIF
                IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
        NEXT
ENDIF
IF ver_serie() = '141204'
        ***************************
        SELE('ped_s');ORDSETFOCUS(14)
        GO TOP
        cli->(DBSEEK(' '+STRZERO(mcod,5)))
        ***************************
        WHILE EMPTY(ped_s->ppag) .AND. ! EOF() .AND. STRZERO(mcod,5) = ped_s->pcod_cli
                mtot_limite := mtot_limite + ped_s->pquantd * ped_s->pvlr_fat
                mlim_venc   := mlim_venc + ped_s->pquantd * ped_s->pvlr_fat
                SKIP
        ENDDO
ENDIF
IF cli->limite > 0
        IF mtot_limite+mvalor > cli->limite
                IF mtipo = NIL
                        liberado := ' '
                        IF ! aut_sen('Cliente LIMITE R$: '+TRANSFORM(cli->limite,'999999.99')+' ESTORADO em '+TRANSFORM((mtot_limite+mvalor) - cli->limite,'999999.99')+'Senha de autorizacao:','LIMIT_EST',,STRZERO(mcod,5))
                                UNLOCK
                                RESTSCREEN(23,00,23,79,rodape)
                                SELE(msel_lim);IF(mord_lim>0,ORDSETFOCUS(mord_lim),)
                                RETURN .F.
                        ENDIF
                        liberado := '*'
                ELSE
                        atencao('Cliente com LIMITE R$: '+TRANSFORM(cli->limite,'999999.99')+' ESTORADO em '+TRANSFORM((mtot_limite+mvalor) - cli->limite,'999999.99')+' !!!')
                ENDIF

        ENDIF
ENDIF
IF liberado = '*' .OR. mtipo <> NIL
        RESTSCREEN(23,00,23,79,rodape)
        SELE(msel_lim);IF(mord_lim>0,ORDSETFOCUS(mord_lim),)
        RETURN .T.
ELSE
        RESTSCREEN(23,00,23,79,rodape)
        SELE(msel_lim);IF(mord_lim>0,ORDSETFOCUS(mord_lim),)
        RETURN .F.
ENDIF
SELE(msel_lim);IF(mord_lim>0,ORDSETFOCUS(mord_lim),)
RETURN .F.
**************************** F I M ****************************************
***************************
* VER ALIQUOTA DO FINANCIAMENTO
***************************

FUNCTION ver_aliq(mcod,mtip)
************************

LOCAL msele,morder
MEMVAR maliq_fin

msele := SELE()
morder := INDEXORD()

***************
SELE('fin');ORDSETFOCUS(1)
GO TOP
***************

IF ! fin->(DBSEEK(STRZERO(mcod,3)+mtip))
        atencao('Esta Tipo de financiamento nao esta cadastrado !!!')
        SELE(msele);IF(morder>0,ORDSETFOCUS(morder),)
        RETURN .F.
ENDIF
maliq_fin := fin->aliq_fin
SELE(msele);IF(morder>0,ORDSETFOCUS(morder),)
RETURN .T.
**************************** F I M ****************************************
********************************
* AREDONDAMENTO DE NUMERO
********************************
FUNCTION aredonda(vlr,qtd)
**********************
LOCAL mvalor

mvalor := VAL(SUBSTR(STR(vlr,16,5),1,11+qtd))
RETURN mvalor
**************************** F I M ****************************************
*****************************
* VER NUMERO DA SERIE
*****************************
FUNCTION ver_serie
******************
IF ! AbriArq('sacsetup','set');RETURN NIL;ENDIF
RETURN DCRIPTO(SUBSTR(set->serie,15,6))
**************************** F I M ****************************************
***********************
FUNCTION serie_prod(vcod,p)
***********************
LOCAL msele,morde

msele := SELE()
morde := INDEXORD()

IF EMPTY(vcod)
        RETURN .T.
ENDIF

*************
SELE('serie');ORDSETFOCUS(2)
GO TOP
*************

IF ! serie->(DBSEEK(vcod))
        IF p = NIL
                atencao('No. de Serie nao Existe !!!')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
******************************** f i m **********************************
*************************************
* IMPRESSAO DA DUPLICATA DO SISTEMA
*************************************
FUNCTION dup_sis(mcod,mnome,mend,mbairro,mcidade,muf,mcep,mtel,;
                 mcgc,minsc,mcpf,mend_cob,mbairro_cob,mcidade_cob,muf_cob,;
                 mcep_cob,mfone_cob,mtipo,mduplicata,memi_dup,mvenc_dup,mcod_ven,;
                 mvlr_dup,mfantasia,mn_fat,mv_fat,mdup_prom)
*****************
LOCAL mextenso:='',mlinha,mlin,lin,mtraco:=REPLI('-',80)
MEMVAR mtipo_imp
IF ! AbriArq('sacemp','emp');RETURN NIL;ENDIF
IF cfg->tipfrmped = 'B'
        mtraco:=REPLI('-',60)
        imprt(mtipo_imp,'N')
        DEVPOS(PROW()+1,00);DEVOUT(memp_resa)
        imprt(mtipo_imp,'C')
        DEVPOS(PROW()+1,00);DEVOUT(mend_firm)
        DEVPOS(PROW()+1,00);DEVOUT(mcid_firm)
        DEVPOS(PROW()+1,00);DEVOUT('Fone: '+mfone_firm)
        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   CNPJ: '+mcgc_firm)
        @ PROW()+1,00 SAY mtraco
        @ PROW()+1,00 SAY 'Cliente:'
        @ PROW(),09 SAY mcod
        @ PROW(),15 SAY mnome
        IF set->nome_fan = 'S' .AND. ! EMPTY(mfantasia)
                @ PROW()+1,00 SAY 'Nome Fantasia: '+mfantasia
        ENDIF
        @ PROW()+1,00 SAY 'End.: '+mend
        @ PROW()+1,00 SAY 'Bairro: '+RTRIM(mbairro)+'-Cidade: '+RTRIM(mcidade)+'-'+muf+'- CEP:'+mcep
        @ PROW()+1,00 SAY 'Fone: '+mtel
        IF cli->cgc <> SPACE(14)
                @ PROW()+1,00 SAY 'CNPJ:'
                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(mcgc,'@@R 99.999.999/9999-99')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' - Insc.: '+minsc)
        ELSEIF cli->cpf <> SPACE(11)
                @ PROW()+1,00 SAY 'CPF:'
                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(mcpf,'@@R 999.999.999-99')
        ENDIF
        IF ! EMPTY(mend_cob)
                @ PROW()+1,00 SAY 'End. COBRANCA: '+mend_cob
                @ PROW()+1,00 SAY 'Bairro: '+RTRIM(mbairro_cob)+'-Cidade: '+RTRIM(mcidade_cob)+'-'+muf_cob+'- CEP:'+mcep_cob
                @ PROW()+1,00 SAY 'Fone:'+mfone_cob
        ENDIF
        @ PROW()+1,00 SAY mtraco
        imprt(mtipo_imp,'N')
        IF mdup_prom <> NIL
                @ PROW()+1,00 SAY 'DUPLICATA No.: '+mtipo+mduplicata
        ELSE
                @ PROW()+1,00 SAY 'NOTA PROMISSORIA No.: '+mtipo+mduplicata
        ENDIF
        imprt(mtipo_imp,'C')
        @ PROW()+1,00 SAY 'Emissao:'
        @ PROW(),10 SAY memi_dup
        @ PROW(),25 SAY 'Vencimento:'
        @ PROW(),37 SAY mvenc_dup
        @ PROW(),49 SAY 'Cod.:'
        @ PROW(),55 SAY STRZERO(mcod_ven,3)
        @ PROW()+1,00 SAY mtraco
        IF mdup_prom = NIL
                IF mv_fat <> NIL .AND. ! EMPTY(mn_fat)
                        @ PROW()+1,00 SAY 'Fatura No.: '+mn_fat+'  Valor:'+TRANSFORM(mv_fat,'9,999,999.99')
                ELSE
                        @ PROW()+1,00 SAY 'Fatura No.:...............  Valor:..............'
                ENDIF
        ENDIF
        @ PROW()+1,00 SAY mtraco
        DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(ROUND(mvlr_dup,2),'99,999,999.99'))+')',60))
        mextenso:= '('+RTRIM(EXT(ROUND(mvlr_dup,2),10))+')'
        mlinha := MLCOUNT(mextenso,60)
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,60,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),60))
        NEXT
        @ PROW()+1,00 SAY mtraco
        IF mdup_prom <> NIL
                mextenso:= 'Reconheco(cemos) a exatidao desta NOTA PROMISSORIA em unica via, na importancia acima que pagarei(emos) a '+memp_resa+', ou a sua ordem na praca e vencimento indicados.'
        ELSE
                mextenso:= 'Reconheco(cemos) a exatidao desta DUPLICATA DE VENDA MERCANTIL, na importancia acima que pagarei(emos) a '+memp_resa+', ou a sua ordem na praca e vencimento indicados.'
        ENDIF
        mlinha := 0
        mlinha := MLCOUNT(mextenso,60)
        lin := 0
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,60,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(RTRIM(mlin))
        NEXT
        @ PROW()+1,00 SAY mtraco
        DEVPOS(PROW()+3,00);DEVOUT(PADC('---------------------------------------------',60))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('Assinatura do Emitente',60))
        DEVPOS(PROW()+2,00);DEVOUT(PADC('Em         /        /        ',60))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('Data do Aceite',60))
        DEVPOS(PROW()+3,00);DEVOUT(PADC('---------------------------------------------',60))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('Assinatura do Sacado',60))
        DEVPOS(PROW()+3,00);DEVOUT(PADC('---------------------------------------------',60))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('Assinatura do Avalista',60))
        @ PROW()+1,00 SAY mtraco
        IF ! EMPTY(set->roda_dup1)
                @ PROW()+1,00 SAY PADC(RTRIM(set->roda_dup1),80)
                @ PROW()+1,00 SAY PADC(RTRIM(set->roda_dup2),80)
                @ PROW()+1,00 SAY mtraco
        ENDIF
        DEVPOS(PROW()+cfg->qtdlinped,00);DEVOUT(CHR(18))
ELSE
        mtraco:=REPLI('-',80)
        imprt(mtipo_imp,'N')
        IF set->cabecalho = 'S'
                imprt(cfg->imp_dup,'E')
                IF mmult_emp = 'N'
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        imprt(cfg->imp_dup,'C',1)
                        DEVPOS(PROW(),00);DEVOUT(RTRIM(mend_firm)+'-'+RTRIM(mcid_firm)+' - FONE: '+mfone_firm+' - INSCR.:'+minsc_firm+' - CNPJ:'+mcgc_firm)
                ELSE
                        DEVPOS(PROW(),00);DEVOUT(ALLTRIM(IF(emp->nome_cab = 'F',emp->fantasia,emp->razao)))
                        imprt(cfg->imp_dup,'C',1)
                        DEVPOS(PROW(),00);DEVOUT(RTRIM(emp->end)+'-'+RTRIM(emp->cidade)+' - FONE: '+emp->fone+' - INSCR.:'+emp->insc+' - CNPJ:'+emp->cnpj)
                ENDIF
                imprt(cfg->imp_dup,'N')
                @ PROW()+1,00 SAY mtraco
                @ PROW()+1,00 SAY ''
        ENDIF
        @ PROW(),00 SAY 'Cliente:'
        @ PROW(),PCOL()+1 SAY mcod
        @ PROW(),PCOL()+1 SAY mnome
        IF set->nome_fan = 'S' .AND. ! EMPTY(mfantasia)
                @ PROW()+1,00 SAY 'Nome Fantasia: '+mfantasia
        ENDIF
        imprt(cfg->imp_dup,'C')
        @ PROW()+1,00 SAY 'End.: '+mend
        @ PROW()+1,00 SAY 'Bairro: '+RTRIM(mbairro)+'-Cidade: '+RTRIM(mcidade)+'-'+muf+'- CEP:'+mcep+'- Fone:'+mtel
*       imprt(cfg->imp_dup,'N')
        IF mcgc <> SPACE(14)
                @ PROW(),PCOL()+3 SAY 'CNPJ:'
                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(mcgc,'@@R 99.999.999/9999-99')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' - Insc.: '+minsc)
        ELSEIF mcpf <> SPACE(11)
                @ PROW(),PCOL()+3 SAY 'CPF:'
                DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(mcpf,'@@R 999.999.999-99')
        ENDIF
        IF ! EMPTY(mend_cob)
                imprt(cfg->imp_dup,'C')
                @ PROW()+1,00 SAY 'End. COBRANCA: '+mend_cob+' - Bairro: '+RTRIM(mbairro_cob)+'-Cidade: '+RTRIM(mcidade_cob)+'-'+muf_cob+'- CEP:'+mcep_cob+'- Fone:'+mfone_cob
                imprt(cfg->imp_dup,'N')
        ENDIF
        @ PROW()+1,00 SAY mtraco
        imprt(mtipo_imp,'E',1)
        IF mdup_prom <> NIL
                @ PROW(),00 SAY 'DUPLICATA No.: '+mtipo+mduplicata
        ELSE
                @ PROW(),00 SAY 'NOTA PROMISSORIA No.: '+mtipo+mduplicata
        ENDIF
        imprt(mtipo_imp,'N')
        @ PROW()+1,00 SAY 'Emissao:'+DTOC(memi_dup)
        @ PROW(),PCOL()+1 SAY 'Vencimento:'+DTOC(mvenc_dup)
        IF mdup_prom = NIL
                IF mv_fat <> NIL .AND. ! EMPTY(mn_fat)
                        @ PROW(),PCOL()+1 SAY 'Fatura:'+mn_fat+' Valor:'+TRANSFORM(mv_fat,'999,999.99')
                ELSE
                        @ PROW(),PCOL()+1 SAY 'Fatura No.:........ Valor:........'
                ENDIF
        ENDIF
        @ PROW(),PCOL()+1 SAY 'Cod.:'
        @ PROW(),PCOL() SAY STRZERO(mcod_ven,3)
*       @ PROW()+1,00 SAY mtraco
        DEVPOS(PROW()+1,00);DEVOUT('Valor R$: ('+LTRIM(TRANSFORM(mvlr_dup,'99,999,999.99'))+')')
        mextenso:= '('+RTRIM(EXT(ROUND(mvlr_dup,2),10))+')'
        mlinha := MLCOUNT(mextenso,80)
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,80,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
        NEXT
        @ PROW()+1,00 SAY mtraco
        IF mdup_prom <> NIL
                mextenso:= 'Reconheco(cemos) a exatidao desta NOTA PROMISSORIA em unica via, na importancia acima que pagarei(emos) a '+memp_resa+', ou a sua ordem na praca e vencimento indicados.'
        ELSE
                mextenso:= 'Reconheco(cemos) a exatidao desta DUPLICATA DE VENDA MERCANTIL, na importancia acima que pagarei(emos) a '+memp_resa+', ou a sua ordem na praca e vencimento indicados.'
        ENDIF
        mlinha := 0
        mlinha := MLCOUNT(mextenso,80)
        lin := 0
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,80,lin,,10)
                IF mlin # ' '
                        DEVPOS(PROW()+1,00);DEVOUT(RTRIM(mlin))
                ENDIF
        NEXT
*       @ PROW()+1,00 SAY mtraco
        DEVPOS(PROW()+2,00);DEVOUT(PADC('Data do Aceite em ...../...../.....',80))
        DEVPOS(PROW()+2,00);DEVOUT(PADC('...................       .....................      ...................',80))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('   Ass. Emitente               Ass. Sacado              Ass. Avalista   ',80))
        @ PROW()+1,00 SAY mtraco
        IF ! EMPTY(set->roda_dup1)
                @ PROW()+1,00 SAY PADC(RTRIM(set->roda_dup1),80)
                @ PROW()+1,00 SAY PADC(RTRIM(set->roda_dup2),80)
                @ PROW()+1,00 SAY mtraco
        ENDIF
        SETPRC(00,00)
        EJECT
ENDIF
RETURN NIL
******************************** F I M ************************************88
***************************************************************************
* Recebe um arquivo texto, cria um dbf, grava  neste arquivo e mostra na
* tela, quando sair os arquivos temporarios criados serao apagados.
***************************************************************************
FUNCTION lertexto(arquivo)

*Para arquivo
*#INCLUDE "INKEY.CH"
#INCLUDE "SETCURS.CH"
LOCAL local1:= {},acamp:=[15]
LOCAL cor_ant := setcolor()    // Salva cor antiga
LOCAL dbf_veio := select()      // Salva arquivo que estava selecionado
LOCAL tela_con := SAVESCREEN(00,00,24,79)
LOCAL otab
LOCAL i,nRow,nCol,nkey,arq,arq_dbf
MEMVAR lin_br
aadd(Local1, {"TELA01", "C", 13, 0})
aadd(Local1, {"TELA02", "C", 13, 0})
aadd(Local1, {"TELA03", "C", 13, 0})
aadd(Local1, {"TELA04", "C", 13, 0})
aadd(Local1, {"TELA05", "C", 13, 0})
aadd(Local1, {"TELA06", "C", 13, 0})
aadd(Local1, {"TELA07", "C", 13, 0})
aadd(Local1, {"TELA08", "C", 13, 0})
aadd(Local1, {"TELA09", "C", 13, 0})
aadd(Local1, {"TELA10", "C", 13, 0})
aadd(Local1, {"TELA11", "C", 13, 0})
aadd(Local1, {"TELA12", "C", 13, 0})
aadd(Local1, {"TELA13", "C", 13, 0})
aadd(Local1, {"TELA14", "C", 13, 0})
aadd(Local1, {"TELA15", "C", 13, 0})
IF SELE('tela') = 0
        DBCREATE("tela", Local1)
        SELE 99  // ou comando de rede
        USE tela ALIAS tela
ELSE
        lertext1(arquivo)
        RESTSCREEN(00,00,24,79,tela_con)
        RETURN NIL
ENDIF
*append from &(ALLTRIM(arquivo)) sdf   //nomecompl_arq sdf
APPEND FROM &arquivo SDF   //nomecompl_arq sdf
GOTO TOP
SET CURSOR OFF
*botao(00,00,24,79)
@ 00,00 to 22,79 colo 'w+/n' //BOX CHR(219)
 //               /-------------> Cor do TBrowse
 //              /    /---------> Cor da barra em destaque
 //             /    /      /---> Cor da barra luminosa
 set color to "w+/N,n/w,,,g+/b"

oTab := TBrowseDB(00,01,22,78)
oTab:colsep := ""  // CHR(219)+" "
OTAB:HEADSEP:= '' // CHR(205)+CHR(203)+CHR(205)
OTAB:COLSEP := ''  // CHR(032)+CHR(186)+CHR(032)
OTAB:FOOTSEP:= '' // CHR(205)+CHR(202)+CHR(205)

FOR i = 1 TO fcount()
        OTAB:ADDCOLUMN(TBCOLUMNNEW("", FIELDWBLOCK(FIELDNAME(i),SELE() )))
NEXT

*@ 01,01 say 'Mensagem: Tecle <C> para congelar as colunas que estao  direita do cursor     ' colo 'w-/b'
*@ 01,01 say 'Mensagem: <C> p/congelar colunas que estao  direita do cursor - <ALT+P>Imprimir ' colo 'w-/n'
Mensagem('<C>p/congelar  direita do cursor - <ALT+P>Imprimir - <ALT+S>Consultas')
lin_br=30
WHILE .T.
        nRow := ROW()
        nCol := COL()

        WHILE !oTab:Stabilize() ; ENDDO
        oTAB:hilite()
        SETPOS( nRow, nCol )
        nKey := INKEY()

        IF oTAB:stable
                SETPOS( nRow, nCol )
                nKey := INKEY(0)
        ENDIF
        IF nKey == K_F1
        ELSEIF nKey == K_F2
        ELSEIF nKey == K_F3
        ELSEIF nKey == K_F4
        ELSEIF nKey == K_F5
        ELSEIF nKey == K_F6
        ELSEIF nKey == K_F7
        ELSEIF nKey == -41          ; calcu()
        ELSEIF nKey == 281          ; arq_imp(arquivo)
        //ELSEIF nKey == 287
                //sac5ped1()
                //IF SELE('tela') = 0
                        //USE tela ALIAS tela
                //ENDIF
                //LOOP
        ELSEIF nKey == K_UP         ; oTab:UP()
        ELSEIF nKey == K_DOWN       ; oTab:DOWN()
        ELSEIF nKey == K_LEFT       ; oTab:LEFT()
        ELSEIF nKey == K_CTRL_LEFT  ; oTab:PANLEFT()
        ELSEIF nKey == K_RIGHT      ; oTab:RIGHT()
        ELSEIF nKey == K_CTRL_RIGHT ; oTab:PANRIGHT()
        ELSEIF nKey == K_PGUP       ; oTab:PAGEUP()
        ELSEIF nKey == K_CTRL_PGUP  ; oTab:GOTOP()
        ELSEIF nKey == K_PGDN       ; oTab:PAGEDOWN()
        ELSEIF nKey == K_CTRL_PGDN  ; oTab:GOBOTTOM()
        ELSEIF nKey == K_HOME       ; oTab:HOME()
        ELSEIF nKey == K_CTRL_HOME  ; oTab:PANHOME()
        ELSEIF nKey == K_END        ; oTab:END()
        ELSEIF nKey == K_CTRL_END   ; oTab:PANEND()
        ELSEIF nKey == K_ESC        ; EXIT
        ELSEIF nkey == 99 .or. nkey==67
                IF otab:freeze=0
                        otab:freeze := otab:colpos -1
                        lin_br=21
                ELSE
                        otab:freeze = 0
                        lin_br= 30
                        otab:panhome()
                        otab:refreshall()
                ENDIF
        ENDIF
        oTab:colorRect({1,1,lin_br,oTab:freeze},{2,5})
ENDDO
SET CURSOR ON
arq=dbf()
USE
arq_dbf=alltrim(arq)+'.DBF'
*ERASE &arq_dbf   // apaga o arquivo dbf que mostra na tela a impressao.
ERASE tela.dbf   // apaga o arquivo dbf que mostra na tela a impressao.
**********  erase &arquivo   // apaga o arquivo prn que mostra na tela a impressao.
SELE &dbf_veio   // seleciona novamente o arquivo que estava aberto
SETCOR(1)
RESTSCREEN(00,00,24,79,tela_con)
RETURN NIL
***************************** F I M ****************************************
*************************************
FUNCTION lertext1(arquiv)
*************************************
*Para arquivo
*#INCLUDE "INKEY.CH"
*#INCLUDE "SETCURS.CH"
LOCAL local1:= {},acamp:=[15]
LOCAL cor_ant := setcolor()    // Salva cor antiga
LOCAL msele := select()      // Salva arquivo que estava selecionado
LOCAL tela_con := SAVESCREEN(00,00,24,79)
LOCAL otab1
LOCAL i,nRow1,nCol1,nkey1,arq,arq_dbf
MEMVAR lin_br
aadd(Local1, {"TELA01", "C", 13, 0})
aadd(Local1, {"TELA02", "C", 13, 0})
aadd(Local1, {"TELA03", "C", 13, 0})
aadd(Local1, {"TELA04", "C", 13, 0})
aadd(Local1, {"TELA05", "C", 13, 0})
aadd(Local1, {"TELA06", "C", 13, 0})
aadd(Local1, {"TELA07", "C", 13, 0})
aadd(Local1, {"TELA08", "C", 13, 0})
aadd(Local1, {"TELA09", "C", 13, 0})
aadd(Local1, {"TELA10", "C", 13, 0})
aadd(Local1, {"TELA11", "C", 13, 0})
aadd(Local1, {"TELA12", "C", 13, 0})
aadd(Local1, {"TELA13", "C", 13, 0})
aadd(Local1, {"TELA14", "C", 13, 0})
aadd(Local1, {"TELA15", "C", 13, 0})
DBCREATE("tela1", Local1)
SELE 99  // ou comando de rede
USE tela1 ALIAS tel1
*append from &(ALLTRIM(arquiv)) sdf   //nomecompl_arq sdf
APPEND FROM &arquiv SDF   //nomecompl_arq sdf
GOTO TOP
SET CURSOR OFF
*botao(00,00,24,79)
@ 00,00 to 22,79 colo 'w+/n' //BOX CHR(219)
 //               /-------------> Cor do TBrowse
 //              /    /---------> Cor da barra em destaque
 //             /    /      /---> Cor da barra luminosa
 set color to "w+/N,n/w,,,g+/b"

otab1 := TBrowseDB(00,01,22,78)
otab1:colsep := ""  // CHR(219)+" "
otab1:HEADSEP:= '' // CHR(205)+CHR(203)+CHR(205)
otab1:COLSEP := ''  // CHR(032)+CHR(186)+CHR(032)
otab1:FOOTSEP:= '' // CHR(205)+CHR(202)+CHR(205)

FOR i = 1 TO fcount()
        otab1:ADDCOLUMN(TBCOLUMNNEW("", FIELDWBLOCK(FIELDNAME(i),SELE() )))
NEXT

*@ 01,01 say 'Mensagem: Tecle <C> para congelar as colunas que estao  direita do cursor     ' colo 'w-/b'
*@ 01,01 say 'Mensagem: <C> p/congelar colunas que estao  direita do cursor - <ALT+P>Imprimir ' colo 'w-/n'
Mensagem('<C>p/congelar  direita do cursor - <ALT+P>Imprimir - <ALT+S>Consultas')
lin_br=30
WHILE .T.
        nRow1 := ROW()
        nCol1 := COL()

        WHILE !otab1:Stabilize() ; ENDDO
        otab1:hilite()
        SETPOS( nRow1, nCol1 )
        nkey1 := INKEY()

        IF otab1:stable
                SETPOS( nRow1, nCol1 )
                nkey1 := INKEY(0)
        ENDIF
        IF nkey1 == K_F1
        ELSEIF nkey1 == K_F2
        ELSEIF nkey1 == K_F3
        ELSEIF nkey1 == K_F4
        ELSEIF nkey1 == K_F5
        ELSEIF nkey1 == K_F6
        ELSEIF nkey1 == K_F7
        ELSEIF nkey1 == -41          ; calcu()
        ELSEIF nkey1 == 281          ; arq_imp(arquiv)
        ELSEIF nkey1 == K_UP         ; otab1:UP()
        ELSEIF nkey1 == K_DOWN       ; otab1:DOWN()
        ELSEIF nkey1 == K_LEFT       ; otab1:LEFT()
        ELSEIF nkey1 == K_CTRL_LEFT  ; otab1:PANLEFT()
        ELSEIF nkey1 == K_RIGHT      ; otab1:RIGHT()
        ELSEIF nkey1 == K_CTRL_RIGHT ; otab1:PANRIGHT()
        ELSEIF nkey1 == K_PGUP       ; otab1:PAGEUP()
        ELSEIF nkey1 == K_CTRL_PGUP  ; otab1:GOTOP()
        ELSEIF nkey1 == K_PGDN       ; otab1:PAGEDOWN()
        ELSEIF nkey1 == K_CTRL_PGDN  ; otab1:GOBOTTOM()
        ELSEIF nkey1 == K_HOME       ; otab1:HOME()
        ELSEIF nkey1 == K_CTRL_HOME  ; otab1:PANHOME()
        ELSEIF nkey1 == K_END        ; otab1:END()
        ELSEIF nkey1 == K_CTRL_END   ; otab1:PANEND()
        ELSEIF nkey1 == K_ESC        ; EXIT
        ELSEIF nkey1 == 99 .or. nkey1==67
                IF otab1:freeze=0
                        otab1:freeze := otab1:colpos -1
                        lin_br=21
                ELSE
                        otab1:freeze = 0
                        lin_br= 30
                        otab1:panhome()
                        otab1:refreshall()
                ENDIF
        ENDIF
        otab1:colorRect({1,1,lin_br,otab1:freeze},{2,5})
ENDDO
SET CURSOR ON
*arq=dbf()
*USE
*arq_dbf=alltrim(arq)+'.DBF'
tel1->(DBCLOSEAREA())
ERASE tela1.dbf  // apaga o arquivo dbf que mostra na tela a impressao.
**********  erase &arquivo   // apaga o arquivo prn que mostra na tela a impressao.
SELE(msele)   // seleciona novamente o arquivo que estava aberto
SETCOR(1)
RESTSCREEN(00,00,24,79,tela_con)
RETURN NIL
***************************** F I M ****************************************
********************************
* VERIFICA A UF DO ESTADO
********************************
FUNCTION v_uf(ve_uf)
*********************
IF EMPTY(ve_uf) .OR. AT(ve_uf,'AC,AL,AP,AM,BA,CE,ES,GO,MA,MT,MS,MG,PA,PB,PR,PE,PI,RN,RS,RR,RO,RJ,SC,SE,SP,TO,DF,EX') > 0
        RETURN .T.
ELSE
        RETURN .F.
ENDIF
RETURN NIL
******************************* f i m *********************************************
********************************
* FUNCAO P/CONSULTAR ARQUIVO DE LOG
********************************
FUNCTION cons_log(mop)
*****************
LOCAL mprg := 'CONS_LOG*',;
      tela,tela1,lci,cci,lba,cba,msele,morde,men,;
      mdias_atras:=0,mmulta:=0,mjuros:=0,mvlpago:=0,;
      oconsprod,ocolprod[17],i,nkey,opcao
MEMVAR mduplicata,mcod_cli,mtipo,mdata_sis

IF ! ver_nivel(mprg,'CONSULTA DE ARQUIVO DE LOG','1',nivel_acess)
        RETURN NIL
ENDIF


lci := 02
cci := 01
lba := MAXROW()-3
cba := 78

tela := SAVESCREEN(01,00,24,79)

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('saclog','log');RETURN NIL;ENDIF
*************
SELE('log');ORDSETFOCUS(1)
*************
men := SAVESCREEN(24,00,24,79)

botao(lci-1,cci-1,lba,cba+1,," Consulta de ARQUIVO DE LOG'S ",'*')
oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
ocolprod[1] := TBCOLUMNNEW('Data',{||log->data})
ocolprod[2] := TBCOLUMNNEW('Hora',{||log->hora})
ocolprod[3] := TBCOLUMNNEW('Data S.O.',{||log->data_sis})
ocolprod[4] := TBCOLUMNNEW('Oper.',{||log->cod_oper})
ocolprod[5] := TBCOLUMNNEW('Aut.',{||log->aut_oper})
ocolprod[6] := TBCOLUMNNEW('Tipo Oper.',{||log->tipo})
ocolprod[7] := TBCOLUMNNEW('Documento',{||log->documento})
ocolprod[8] := TBCOLUMNNEW('Descricao',{||log->descri})
ocolprod[9] := TBCOLUMNNEW('Cod.Prod.',{||log->cod_prod})
ocolprod[10] := TBCOLUMNNEW('Vlr.Anterior',{||TRANSFORM(log->valor1,'999,999.99')})
ocolprod[11] := TBCOLUMNNEW('Vlr.Posterior',{||TRANSFORM(log->valor2,'999,999.99')})
ocolprod[12] := TBCOLUMNNEW('Qtd.Anterior',{||TRANSFORM(log->quantd1,'99,999.99')})
ocolprod[13] := TBCOLUMNNEW('Qtd.Posterior',{||TRANSFORM(log->quantd2,'99,999.99')})
ocolprod[14] := TBCOLUMNNEW('Venc.Ant.',{||DTOC(log->venc1)})
ocolprod[15] := TBCOLUMNNEW('Venc.Post.',{||DTOC(log->venc2)})
ocolprod[16] := TBCOLUMNNEW('Modulo',{||log->modulo})
ocolprod[17] := TBCOLUMNNEW('Autorizacao',{||log->cod_aut})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('< > <P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<> <PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                CLEAR GETS
                EXIT
        ELSEIF nkey == K_ENTER
                CLEAR GETS
                EXIT
        ELSE
                IF genkey(oconsprod,nkey,'log')
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba)
                        ocolprod[1] := TBCOLUMNNEW('Data',{||log->data})
                        ocolprod[2] := TBCOLUMNNEW('Hora',{||log->hora})
                        ocolprod[3] := TBCOLUMNNEW('Data S.O.',{||log->data_sis})
                        ocolprod[4] := TBCOLUMNNEW('Oper.',{||log->cod_oper})
                        ocolprod[5] := TBCOLUMNNEW('Aut.',{||log->aut_oper})
                        ocolprod[6] := TBCOLUMNNEW('Tipo Oper.',{||log->tipo})
                        ocolprod[7] := TBCOLUMNNEW('Documento',{||log->documento})
                        ocolprod[8] := TBCOLUMNNEW('Descricao',{||log->descri})
                        ocolprod[9] := TBCOLUMNNEW('Cod.Prod.',{||log->cod_prod})
                        ocolprod[10] := TBCOLUMNNEW('Vlr.Anterior',{||TRANSFORM(log->valor1,'999,999.99')})
                        ocolprod[11] := TBCOLUMNNEW('Vlr.Posterior',{||TRANSFORM(log->valor2,'999,999.99')})
                        ocolprod[12] := TBCOLUMNNEW('Qtd.Anterior',{||TRANSFORM(log->quantd1,'99,999.99')})
                        ocolprod[13] := TBCOLUMNNEW('Qtd.Posterior',{||TRANSFORM(log->quantd2,'99,999.99')})
                        ocolprod[14] := TBCOLUMNNEW('Venc.Ant.',{||DTOC(log->venc1)})
                        ocolprod[15] := TBCOLUMNNEW('Venc.Post.',{||DTOC(log->venc2)})
                        ocolprod[16] := TBCOLUMNNEW('Modulo',{||log->modulo})
                        ocolprod[17] := TBCOLUMNNEW('Autorizacao',{||log->cod_aut})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RESTSCREEN(24,00,24,79,men)
RESTSCREEN(01,00,24,79,tela)
CLEAR GETS
RETURN NIL
********************** F I M ********************************
******************************
* VERIFICA O CNPJ E CPF
******************************

FUNCTION v_cnpjcpf(ncgc)
********************

LOCAL men,msele,morde,opcao := 'S'
MEMVAR mcgc,mcpf,mcod_cli,mcliente

men := SAVESCREEN(24,00,24,79)
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
IF EMPTY(ncgc)
        RETURN .T.
ENDIF
IF LEN(ALLTRIM(ncgc)) = 14
        *****************
        SELE('cli');ORDSETFOCUS(3)
        GO TOP
        *****************
        IF ! cli->(DBSEEK(ALLTRIM(ncgc)))
                CLEAR GETS
                atencao('CNPJ nao cadastrado...')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RESTSCREEN(24,00,24,79,men)
                RETURN .F.
        ENDIF
ELSE
        *****************
        SELE('cli');ORDSETFOCUS(4)
        GO TOP
        *****************
        IF ! cli->(DBSEEK(ALLTRIM(ncgc)))
                CLEAR GETS
                atencao('CPF nao cadastrado...')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RESTSCREEN(24,00,24,79,men)
                RETURN .F.
        ENDIF
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
mcod_cli := VAL(cli->cod_cli)
RETURN .T.
********************************** F I M ***********************************
*****************************
* GERAR NUMERO DE AUTORIZACAO
*****************************
FUNCTION gera_num
*****************
LOCAL mnum_co,mhora
mhora := TIME()
mnum_co := SUBSTR(mhora,7,2)+STRZERO(VAL(SUBSTR(mhora,4,1))+VAL(SUBSTR(mhora,5,1)),2)+STRZERO(VAL(SUBSTR(mhora,1,1))+VAL(SUBSTR(mhora,2,1))+VAL(SUBSTR(mhora,7,2)),2)
RETURN mnum_co

