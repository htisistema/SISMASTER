#INCLUDE "COMMCTRL.CH"
#include "wvwtools.ch"
#INCLUDE "wingdi.ch"
#INCLUDE "winuser.ch"
//SQLRDD***********************************
#include "sqlrdd.ch"
#include "pgs.ch"          // Needed if you plan to use native connection to Postgres
#include "mysql.ch"        // Needed if you plan to use native connection to MySQL
#include "oracle.ch"       // Needed if you plan to use native connection to Oracle
#include "firebird.ch"     // Needed if you plan to use native connection to Firebird
*******************************************
//REQUEST SQLRDD             // SQLRDD should be linked in
//REQUEST SR_FIREBIRD        // Needed if you plan to use native connection to Firebird
REQUEST DBFCDX
REQUEST DBFFPT
//#define mvar ' '
MEMVAR mdata_sis,cod_operado,nivel_acess,mversao,sistema,;
       memp_resa,cor,mend_firm,mcid_firm,mfone_firm,mcgc_firm,getlist,mt_cor
**********************
* EXECUTAR PROGRAMAS EXTERNOS
**********************
*********************************
FUNC MYRUN( cComando )
*********************************
local oShell, RET
oShell := CreateObject( "WScript.Shell" )
RET := oShell:Run( "%comspec% /c " + cComando, 0, .T. )
oShell := NIL
return iif( RET = 0, .T., .F. )
*********************************
***********************
FUNCTION MyRun2( cRun )
***********************
Local hIn, hOut, nRet //, hProc
Local hProc := HB_OpenProcess(cRun , @hIn, @hOut, @hOut )

IF hProc < 0
   	FClose( hProc )
   	FClose( hIn )
   	FClose( hOut )
   	Return(.F.)
	//atencao("Error: " + valtoprg(FError()))
ENDIF
nRet := HB_ProcessValue( hProc,.f. )
IF nRet > 0
   	FClose( hProc )
   	FClose( hIn )
   	FClose( hOut )
   	Return(.F.)
endif
FClose( hProc )
FClose( hIn )
FClose( hOut )
Return(.T.)
************************** f i m ******************************
FUNCTION atencao(men,tempo,tipo,alerta,linha)
**********************
LOCAL linhas,i,lin,matencao,li,ci,la,ca,mpos
men := RTRIM(men)
//WVW_MessageBox( ,men,' ATENCAO ',MB_ICONEXCLAMATION + MB_ICONQUESTION + MB_SYSTEMMODAL  )
WVW_MessageBox( ,men,' ATENCAO ',MB_ICONWARNING)
//WVW_MessageBox( ,men,' ATENCAO ',MB_ICONEXCLAMATION + MB_SYSTEMMODAL  )
//WVW_MessageBox( ,men,' ATENCAO ',MB_OK)
RETURN .T.
*************************** f i m ****************************
**********************
* OPCAO TELA
**********************
FUNCTION op_tela(op_l,op_c,op_lb,op_cb,op_mensagem,mli,mcent,mclose)
************************************
LOCAL msel,mord
wvw_maximize()
wvw_nopenwindow(,op_l,op_c,op_lb,op_cb)
Wvw_SetTitle( ,op_mensagem)
IF mclose <> NIL
        wvw_noclose()
ENDIF
IF mcent = NIL .AND. (op_lb >= 30 .OR. op_cb = 90)
        WVW_CenterWindow(,.T.,.T.)
ENDIF
IF mcent # NIL
        WVW_CenterWindow(,.T.,.T.)
ENDIF
IF mli = NIL
        WVW_SBCreate()
        WVW_SBAddPart(,,800,0,.F.)
ENDIF
RETURN NIL
************************* F I M ****************************************
#INCLUDE 'winuser.ch'
#INCLUDE 'INKEY.CH'
*******************
* FUNCAO DE CORES
*******************
FUNCTION setcor(nTipCor,mtipo)
************************
mt_cor:='A'
IF mt_cor = 'A'
        IF nTipCor = 1 .AND. mtipo = NIL
                SETCOLOR('n+/w*,w*/b,,,N/w*')          && cor PRINCIPAL
        ELSEIF nTipCor = 1 .AND. mtipo <> NIL
                SETCOLOR('n/w*,W*/N,,,n/w*')          && cor PRINCIPAL
        ELSEIF nTipCor = 2 .AND. mtipo = NIL
                SETCOLOR('N/W*,x')                     && cor para os SAY
        ELSEIF nTipCor = 2 .AND. mtipo <> NIL
                SETCOLOR('n/w*,x')                     && cor para os SAY
        ELSEIF nTipCor = 3 .AND. mtipo = NIL
                SETCOLOR('n/w*,w*/b,x')                     && cor para os SAY
        ELSEIF nTipCor = 3 .AND. mtipo <> NIL
                SETCOLOR('n*/w*,w*/b,x')                     && cor para os SAY
        ELSEIF nTipCor = 4 .AND. mtipo = NIL
                SETCOLOR('w*/B,x')                     && cor para os SAY
        ELSEIF nTipCor = 4 .AND. mtipo <> NIL
                SETCOLOR('b/w*,x')                     && cor FUNDO
        ELSEIF nTipCor = 5 .AND. mtipo = NIL
                SETCOLOR('b/w*,x')                     && cor ABRINDO ARQUIVO
        ELSEIF nTipCor = 5 .AND. mtipo <> NIL
                 SETCOLOR('b/w*,x')                     && cor ABRINDO ARQUIVO
        ELSEIF nTipCor = 6 .AND. mtipo = NIL
                SETCOLOR('W/B+,W+/w,,,W+/b+')          && cor PRINCIPAL
        ELSEIF nTipCor = 6 .AND. mtipo <> NIL
                SETCOLOR('GR+/B+,b/w,,,gr+/b+')          && cor PRINCIPAL
        ELSEIF nTipCor = 7 .AND. mtipo = NIL
                SETCOLOR('n+/w,x')                    && cor LOGOTIPO
        ELSEIF nTipCor = 7 .AND. mtipo <> NIL
                SETCOLOR('B*/w,x')                    && cor LOGOTIPO
        ELSEIF nTipCor = 8 .AND. mtipo = NIL
                SETCOLOR('w+/w,w/w+,x')
        ELSEIF nTipCor = 9 .AND. mtipo = NIL
                SETCOLOR('n/w,w+/n,,b+/w,b+/n')
        ELSEIF nTipCor = 10 .AND. mtipo = NIL
                SETCOLOR('b/b')
        ELSEIF nTipCor = 11 .AND. mtipo = NIL
                RETURN 'w/b,x'                      && cor do relogio
        ENDIF
ELSE
        IF nTipCor = 1 .AND. mtipo = NIL
                SETCOLOR('n+/w,w+/g,,,N/w')          && cor PRINCIPAL
        ELSEIF nTipCor = 1 .AND. mtipo <> NIL
                SETCOLOR('n/w*,W/N,,,n/w')          && cor PRINCIPAL
        ELSEIF nTipCor = 2 .AND. mtipo = NIL
                SETCOLOR('N/W,x')                     && cor para os SAY
        ELSEIF nTipCor = 2 .AND. mtipo <> NIL
                SETCOLOR('n/w*,x')                     && cor para os SAY
        ELSEIF nTipCor = 3 .AND. mtipo = NIL
                SETCOLOR('n/w,n/g,x')                     && cor para os SAY
        ELSEIF nTipCor = 3 .AND. mtipo <> NIL
                SETCOLOR('n*/w,n/g,x')                     && cor para os SAY
        ELSEIF nTipCor = 4 .AND. mtipo = NIL
                SETCOLOR('w+/g,x')                     && cor para os SAY
        ELSEIF nTipCor = 4 .AND. mtipo <> NIL
                SETCOLOR('b/w*,x')                     && cor FUNDO
        ELSEIF nTipCor = 5 .AND. mtipo = NIL
                SETCOLOR('g/w,x')                     && cor ABRINDO ARQUIVO
        ELSEIF nTipCor = 5 .AND. mtipo <> NIL
                SETCOLOR('g/w*,x')                     && cor ABRINDO ARQUIVO
        ELSEIF nTipCor = 6 .AND. mtipo = NIL
                SETCOLOR('W/G,W+/w,,,W+/G')          && cor PRINCIPAL
        ELSEIF nTipCor = 6 .AND. mtipo <> NIL
                SETCOLOR('w+/G,g/w,,,n/g')          && cor PRINCIPAL
        ELSEIF nTipCor = 7 .AND. mtipo = NIL
                SETCOLOR('n+/w,x')                    && cor LOGOTIPO
        ELSEIF nTipCor = 7 .AND. mtipo <> NIL
                SETCOLOR('G*/w,x')                    && cor LOGOTIPO
        ELSEIF nTipCor = 8 .AND. mtipo = NIL
                SETCOLOR('w+/w,w/w+,x')
        ELSEIF nTipCor = 9 .AND. mtipo = NIL
                SETCOLOR('n/w,w+/G,,G/w,GR+/G')
        ELSEIF nTipCor = 10 .AND. mtipo = NIL
                SETCOLOR('g/g')
        ELSEIF nTipCor = 11 .AND. mtipo = NIL
                RETURN 'w+/g,x'                      && cor do relogio
        ENDIF
ENDIF
RETURN .T.
***************************** F I M ****************************************
**************************
* LIMPA UMA AREA
**************************
FUNCTION limpa(li,ci,lb,cb)
***************************
@ li,ci CLEAR TO lb,cb
RETURN NIL
***************** F I M **************************
FUNCTION mensagem(men)
**********************
WVW_SBSetText(,1,'Mensagem: '+men)
RETURN NIL
******************************* F I M ****************************************
*****************************
* FUNCAO PARA DES-CRIPTOGRAFA
*****************************
FUNCTION dcripto(mexp)
*********************
LOCAL mletra:={},maux:={},msenha,i
ASIZE(mletra,0)
ASIZE(maux,0)
msenha := ''
i:=0
FOR i = 1 TO LEN(mexp)
        IF SUBSTR(mexp,i,1) = ' ' .OR. SUBSTR(mexp,i,1) = NIL
                LOOP
        ENDIF
        AADD(mletra,SUBSTR(mexp,i,1))
NEXT
i:=0
IF EMPTY(mletra)
        RETURN NIL
ENDIF
FOR i = 1 TO LEN(mletra)
        IF mletra[i] = CHR(189)
                AADD(maux,'A')
        ELSEIF mletra[i] = CHR(184)
                AADD(maux,'B')
        ELSEIF mletra[i] = CHR(154)
                AADD(maux,'C')
        ELSEIF mletra[i] = CHR(181)
                AADD(maux,'D')
        ELSEIF mletra[i] = CHR(228)
                AADD(maux,'E')
        ELSEIF mletra[i] = CHR(230)
                AADD(maux,'F')
        ELSEIF mletra[i] = CHR(232)
                AADD(maux,'G')
        ELSEIF mletra[i] = CHR(218)
                AADD(maux,'H')
        ELSEIF mletra[i] = CHR(204)
                AADD(maux,'I')
        ELSEIF mletra[i] = CHR(236)
                AADD(maux,'J')
        ELSEIF mletra[i] = CHR(231)
                AADD(maux,'K')
        ELSEIF mletra[i] = CHR(245)
                AADD(maux,'L')
        ELSEIF mletra[i] = CHR(225)
                AADD(maux,'M')
        ELSEIF mletra[i] = CHR(237)
                AADD(maux,'N')
        ELSEIF mletra[i] = CHR(224)
                AADD(maux,'O')
        ELSEIF mletra[i] = CHR(208)
                AADD(maux,'P')
        ELSEIF mletra[i] = CHR(166)
                AADD(maux,'Q')
        ELSEIF mletra[i] = CHR(168)
                AADD(maux,'R')
        ELSEIF mletra[i] = CHR(172)
                AADD(maux,'S')
        ELSEIF mletra[i] = CHR(157)
                AADD(maux,'T')
        ELSEIF mletra[i] = CHR(140)
                AADD(maux,'U')
        ELSEIF mletra[i] = CHR(174)
                AADD(maux,'W')
        ELSEIF mletra[i] = CHR(20)
                AADD(maux,'V')
        ELSEIF mletra[i] = CHR(223)
                AADD(maux,'X')
        ELSEIF mletra[i] = CHR(239)
                AADD(maux,'Y')
        ELSEIF mletra[i] = CHR(235)
                AADD(maux,'Z')
        ELSEIF mletra[i] = CHR(251)
                AADD(maux,'0')
        ELSEIF mletra[i] = CHR(253)
                AADD(maux,'1')
        ELSEIF mletra[i] = CHR(252)
                AADD(maux,'2')
        ELSEIF mletra[i] = CHR(248)
                AADD(maux,'3')
        ELSEIF mletra[i] = CHR(216)
                AADD(maux,'4')
        ELSEIF mletra[i] = CHR(200)
                AADD(maux,'5')
        ELSEIF mletra[i] = CHR(136)
                AADD(maux,'6')
        ELSEIF mletra[i] = CHR(127)
                AADD(maux,'7')
        ELSEIF mletra[i] = CHR(21)
                AADD(maux,'8')
        ELSEIF mletra[i] = CHR(23)
                AADD(maux,'9')
        ELSEIF mletra[i] = '0'
                AADD(maux,' ')
        ELSEIF mletra[i] = '1'
                AADD(maux,'*')
        ELSEIF mletra[i] = '2'
                AADD(maux,'-')
        ELSEIF mletra[i] = '3'
                AADD(maux,'/')
        ELSEIF mletra[i] = '4'
                AADD(maux,'.')
        ELSEIF mletra[i] = '5'
                AADD(maux,',')
        ELSEIF mletra[i] = 'A'
                AADD(maux,'"')
        ELSEIF mletra[i] = '6'
                AADD(maux,"'")
        ELSEIF mletra[i] = '7'
                AADD(maux,'(')
        ELSEIF mletra[i] = '8'
                AADD(maux,')')
        ELSEIF mletra[i] = '9'
                AADD(maux,'=')
        ELSEIF mletra[i] = 'B'
                AADD(maux,'%')
        ELSEIF mletra[i] = 'C'
                AADD(maux,'*')
        ELSEIF mletra[i] = 'D'
                AADD(maux,'+')
        ELSEIF mletra[i] = 'E'
                AADD(maux,'@')
        ELSEIF mletra[i] = 'F'
                AADD(maux,']')
        ELSEIF mletra[i] = 'G'
                AADD(maux,'[')
        ELSEIF mletra[i] = 'I'
                AADD(maux,'{')
        ELSEIF mletra[i] = 'J'
                AADD(maux,'}')
        ELSEIF mletra[i] = 'K'
                AADD(maux,'&')
        ELSEIF mletra[i] = 'L'
                AADD(maux,'#')
        ELSEIF mletra[i] = 'M'
                AADD(maux,'!')
        ELSEIF mletra[i] = 'N'
                AADD(maux,':')
        ELSEIF mletra[i] = 'O'
                AADD(maux,';')
        ELSEIF mletra[i] = 'P'
                AADD(maux,'?')
        ELSEIF mletra[i] = 'Q'
                AADD(maux,'|')
        ELSEIF mletra[i] = 'R'
                AADD(maux,'\')
        ELSEIF mletra[i] = 'S'
                AADD(maux,'ç')
        ELSEIF mletra[i] = 'Ç'
                AADD(maux,'Ç')
        ELSEIF mletra[i] = 'U'
                AADD(maux,'Ã')
        ELSEIF mletra[i] = 'V'
                AADD(maux,'ã')
        ELSEIF mletra[i] = 'X'
                AADD(maux,'Õ')
        ELSEIF mletra[i] = 'Y'
                AADD(maux,'õ')
        ELSEIF mletra[i] = 'Z'
                AADD(maux,'Á')
        ELSEIF mletra[i] = 'A'
                AADD(maux,'á')
        ELSEIF mletra[i] = 'b'
                AADD(maux,'º')
        ELSEIF mletra[i] = 'c'
                AADD(maux,'ª')
        ELSEIF mletra[i] = 'd'
                AADD(maux,NIL)
        ELSE
                LOOP
        ENDIF
NEXT
i:=0
msenha := maux[2] + maux[1]
FOR i = 3 TO LEN(maux)
        msenha := msenha + maux[i]
NEXT
RETURN msenha
******************************* F I M ******************************************
*****************************
* FUNCAO PARA CRIPTOGRAFA
*****************************
FUNCTION cripto(mexp,q,mprod)
*********************
LOCAL mletra:={},maux:={},msenha,i
IF LASTKEY() = 27
        RETURN .F.
ENDIF
IF LEN(mexp) < 2 .OR. (LEN(mexp) > 8 .AND. q = NIL)
        atencao('Senha Invalida !!!')
        RETURN .F.
ENDIF
msenha := ''
i:=0
FOR i = 1 TO LEN(mexp)
        AADD(mletra,SUBSTR(mexp,i,1))
NEXT
i:=0
FOR i = 1 TO LEN(mexp)
        IF mletra[i] = 'A'
                AADD(maux,CHR(189)) //¢
        ELSEIF mletra[i] = 'B'
                AADD(maux,CHR(184)) //©
        ELSEIF mletra[i] = 'C'
                AADD(maux,CHR(154)) //Ü
        ELSEIF mletra[i] = 'D'
                AADD(maux,CHR(181)) //Á
        ELSEIF mletra[i] = 'E'
                AADD(maux,CHR(228)) //õ
        ELSEIF mletra[i] = 'F'
                AADD(maux,CHR(230)) //µ
        ELSEIF mletra[i] = 'G'
                AADD(maux,CHR(232)) //Þ
        ELSEIF mletra[i] = 'H'
                AADD(maux,CHR(218)) //+
        ELSEIF mletra[i] = 'I'
                AADD(maux,CHR(204)) //¦
        ELSEIF mletra[i] = 'J'
                AADD(maux,CHR(236)) //ý
        ELSEIF mletra[i] = 'K'
                AADD(maux,CHR(231)) //þ
        ELSEIF mletra[i] = 'L'
                AADD(maux,CHR(245)) //§
        ELSEIF mletra[i] = 'M'
                AADD(maux,CHR(225)) //ß
        ELSEIF mletra[i] = 'N'
                AADD(maux,CHR(237)) //Ý
        ELSEIF mletra[i] = 'O'
                AADD(maux,CHR(224)) //Ó
        ELSEIF mletra[i] = 'P'
                AADD(maux,CHR(208))
        ELSEIF mletra[i] = 'Q'
                AADD(maux,CHR(166))
        ELSEIF mletra[i] = 'R'
                AADD(maux,CHR(168))
        ELSEIF mletra[i] = 'S'
                AADD(maux,CHR(172))
        ELSEIF mletra[i] = 'T'
                AADD(maux,CHR(157))
        ELSEIF mletra[i] = 'U'
                AADD(maux,CHR(140))
        ELSEIF mletra[i] = 'W'
                AADD(maux,CHR(174))
        ELSEIF mletra[i] = 'V'
                AADD(maux,CHR(20))
        ELSEIF mletra[i] = 'X'
                AADD(maux,CHR(223))
        ELSEIF mletra[i] = 'Y'
                AADD(maux,CHR(239))
        ELSEIF mletra[i] = 'Z'
                AADD(maux,CHR(235))
        ELSEIF mletra[i] = '0'
                AADD(maux,CHR(251))
        ELSEIF mletra[i] = '1'
                AADD(maux,CHR(253))
        ELSEIF mletra[i] = '2'
                AADD(maux,CHR(252))
        ELSEIF mletra[i] = '3'
                AADD(maux,CHR(248))
        ELSEIF mletra[i] = '4'
                AADD(maux,CHR(216))
        ELSEIF mletra[i] = '5'
                AADD(maux,CHR(200))
        ELSEIF mletra[i] = '6'
                AADD(maux,CHR(136))
        ELSEIF mletra[i] = '7'
                AADD(maux,CHR(127))
        ELSEIF mletra[i] = '8'
                AADD(maux,CHR(21))
        ELSEIF mletra[i] = '9'
                AADD(maux,CHR(23))
        ELSEIF mletra[i] = ' '
                AADD(maux,'0')
        ELSEIF mletra[i] = '*'
                AADD(maux,'1')
        ELSEIF mletra[i] = '-'
                AADD(maux,'2')
        ELSEIF mletra[i] = '/'
                AADD(maux,'3')
        ELSEIF mletra[i] = '.'
                AADD(maux,'4')
        ELSEIF mletra[i] = ','
                AADD(maux,'5')
        ELSEIF mletra[i] = '"'
                AADD(maux,'A')
        ELSEIF mletra[i] = "'"
                AADD(maux,'6')
        ELSEIF mletra[i] = '('
                AADD(maux,'7')
        ELSEIF mletra[i] = ')'
                AADD(maux,'8')
        ELSEIF mletra[i] = '='
                AADD(maux,'9')
        ELSEIF mletra[i] = '%'
                AADD(maux,'B')
        ELSEIF mletra[i] = '*'
                AADD(maux,'C')
        ELSEIF mletra[i] = '+'
                AADD(maux,'D')
        ELSEIF mletra[i] = '@'
                AADD(maux,'E')
        ELSEIF mletra[i] = ']'
                AADD(maux,'F')
        ELSEIF mletra[i] = '['
                AADD(maux,'G')
        ELSEIF mletra[i] = '{'
                AADD(maux,'I')
        ELSEIF mletra[i] = '}'
                AADD(maux,'J')
        ELSEIF mletra[i] = '&'
                AADD(maux,'K')
        ELSEIF mletra[i] = '#'
                AADD(maux,'L')
        ELSEIF mletra[i] = '!'
                AADD(maux,'M')
        ELSEIF mletra[i] = ':'
                AADD(maux,'N')
        ELSEIF mletra[i] = ';'
                AADD(maux,'O')
        ELSEIF mletra[i] = '?'
                AADD(maux,'P')
        ELSEIF mletra[i] = '|'
                AADD(maux,'Q')
        ELSEIF mletra[i] = '\'
                AADD(maux,'R')
        ELSEIF mletra[i] = 'ç'
                AADD(maux,'S')
        ELSEIF mletra[i] = 'Ç'
                AADD(maux,'T')
        ELSEIF mletra[i] = 'Ã'
                AADD(maux,'U')
        ELSEIF mletra[i] = 'ã'
                AADD(maux,'V')
        ELSEIF mletra[i] = 'Õ'
                AADD(maux,'X')
        ELSEIF mletra[i] = 'õ'
                AADD(maux,'Y')
        ELSEIF mletra[i] = 'Á'
                AADD(maux,'Z')
        ELSEIF mletra[i] = 'á'
                AADD(maux,'a')
        ELSEIF mletra[i] = 'º'
                AADD(maux,'b')
        ELSEIF mletra[i] = 'ª'
                AADD(maux,'c')
        ELSEIF mletra[i] = NIL
                AADD(maux,'d')
        ENDIF
NEXT
i:=0
msenha := maux[2] + maux[1]
FOR i = 3 TO LEN(mexp)
        msenha := msenha + maux[i]
NEXT
RETURN msenha
*************************** F I M ***********************************************
********************************
* FUNCAO PARA ABRIR ARQUIVOS
********************************
FUNCTION AbriArq(arq,al,tp,sit,vlocal,vext,vcamin,vmens)
**********************
LOCAL mcam:='',mcamcfg,mlocal:='',mestacao:='',mver:='',m_cfg1:={}

//mestacao := ver_ini()
SET AUTOPEN ON
IF SELECT(al) > 0 .AND. tp = NIL
        RETURN .T.
ENDIF

WHILE .T.
        IF m_line = 'ON' .AND. sit = NIL
                IF tp = 'E'
                        IF SELECT(al) > 0
                                (al)->(DBCLOSEAREA())
                        ENDIF
                        USE (arq) ALIAS (al) EXCLUSIVE NEW VIA 'SQLRDD'
                        IF ! NETERR()
                                RETURN .T.
                        ELSE
                                atencao('Este ARQUIVO esta sendo usado por outro usuario, Aguarde...Tentando Acesso ao Arquivo: '+UPPER(arq)+' EXCLUSIVO')
                        ENDIF
                ELSE
                        IF SELECT(al) > 0
                                RETURN .T.
                        ENDIF
                        USE (arq) ALIAS (al) SHARED NEW VIA 'SQLRDD'
                        IF ! NETERR()
                                RETURN .T.
                        ELSE
                                atencao('Este ARQUIVO esta sendo usado EXCLUSIVO por outro usuario, Aguarde...Tentando Acesso ao Arquivo: '+UPPER(arq)+' COMPARTILHADO')
                        ENDIF
                ENDIF
                IF LASTKEY() = 27
                        atencao('Nao foi possivel acessar este Arquivo: '+mcam+UPPER(arq))
                        RETURN .F.
                ENDIF
        ELSE
                IF tp = 'E'
                        IF SELECT(al) > 0
                                (al)->(DBCLOSEAREA())
                        ENDIF
                        USE (arq) ALIAS (al) EXCLUSIVE NEW VIA 'DBFCDX'
                        IF ! NETERR()
                                RETURN .T.
                        ELSE
                                atencao('Este ARQUIVO esta sendo usado por outro usuario, Aguarde...Tentando Acesso ao Arquivo: '+UPPER(arq)+' EXCLUSIVO')
                        ENDIF
                ELSE
                        IF SELECT(al) > 0
                                RETURN .T.
                        ENDIF
                        USE (arq) ALIAS (al) SHARED NEW VIA 'DBFCDX'
                        IF ! NETERR()
                                RETURN .T.
                        ELSE
                                atencao('Este ARQUIVO esta sendo usado EXCLUSIVO por outro usuario, Aguarde...Tentando Acesso ao Arquivo: '+UPPER(arq)+' COMPARTILHADO')
                        ENDIF
                ENDIF
                IF LASTKEY() = 27
                        atencao('Nao foi possivel acessar este Arquivo: '+mcam+UPPER(arq))
                        RETURN .F.
                ENDIF
        ENDIF
ENDDO
RETURN .F.
*************************** F I M *********************************
***************************
* FINALIZA OS SISTEMAS
***************************
FUNCTION fim(msist,mtti)
*************
LOCAL opcao,lci := 05,cci := 25,lba := 17,cba := 53,tela
tela := SAVESCREEN(00,00,24,79)
opcao := 0
WHILE .T.
        IF (msist = NIL .OR. SUBSTR(msist,1,8) <> '"SISCOM"') .AND. mtti = NIL
                SET CURSOR ON
        	sr_getconnection():exec("UPDATE insopera SET sult_fim = " + sr_cdbvalue(DATE())  +;
                                        ",shora_fim = " + sr_cdbvalue(TIME())+;
                                        ",sh_i_c = '     '"+;
                                        " WHERE scod_op = " + sr_cdbvalue(cod_operado),,.f.)
	       	sr_getconnection():exec("COMMIT",,.f.)
                SETCOLOR(cor)
                limpa(00,00,24,79)
                CLEAR MEMORY
                apaga_hrb() //apaga o arquivo de controle "HRB.001"
                QUIT
        ENDIF
        IF mtti = NIL
                setcor(3)
                botao(lci,cci,lba,cba,,' ESCOLHA A OPCAO ')
                botao(lci+2,cci+1,lci+4,cba-1)
                botao(lci+5,cci+1,lci+7,cba-1)
                botao(lci+8,cci+1,lci+10,cba-1)
                setcor(9)
                @ lci+3,cci+2 PROMPT '   Finalizar o sistema   ' MESSAGE '** Sai do sistema **'
                @ lci+6,cci+2 PROMPT ' Nao finalizar o sistema ' MESSAGE '** Retorna ao sistema **'
                SET INTEN ON
                MENU TO opcao
                IF LASTKEY() = 27
                        RESTSCREEN(00,00,24,79,tela)
                        setcor(1)
                        RETURN NIL
                ENDIF
        ELSE
                opcao := 1
        ENDIF

        DO CASE
                CASE opcao = 1
                        SET CURSOR ON
                        IF mtti = NIL

		        	sr_getconnection():exec("UPDATE insopera SET sult_fim = " + sr_cdbvalue(DATE())  +;
                		                        ",shora_fim = " + sr_cdbvalue(TIME())+;
                                		        ",sh_i_c = '     '"+;
		                                        " WHERE scod_op = " + sr_cdbvalue(cod_operado),,.f.)
	       			sr_getconnection():exec("COMMIT",,.f.)
                        ENDIF
                        CLEAR MEMORY
                        INKEY(1)
                        apaga_hrb() //apaga o arquivo de controle "HRB.001"
                        wvw_lclosewindow()
                        QUIT
                CASE opcao = 2
                        RESTSCREEN(00,00,24,79,tela)
                        setcor(1)
                        RETURN NIL
                CASE opcao = 3
                        RESTSCREEN(00,00,24,79,tela)
                        setcor(1)
                        //alt_senha()
                        RETURN NIL
       ENDCASE
ENDDO
RETURN NIL
***************************** F I M *********************************************
******************************************
* FUNCAO PARA BLOQUEAR REGISTRO EM REDE
******************************************
FUNCTION bloqreg
***********************
LOCAL vtela

IF RLOCK()
        RETURN (.T.)
ENDIF
vtela := SAVESCREEN(24,00,24,79)
mensagem('Aguarde um momento...Registro acessado p/outro usuario !!!')

WHILE LASTKEY() <> 27
        IF RLOCK()
                RESTSCREEN(24,00,24,79,vtela)
                RETURN (.T.)
        ENDIF
        INKEY(1)
ENDDO
RESTSCREEN(24,00,24,79,vtela)
RETURN (.F.)
****************************** F I M ***************************
****************************************************
* FUNCAO TENTA ADICIONA REGISTRO NO ARQUIVO EM REDE
*****************************************************
FUNCTION adireg
**********************
LOCAL vtela

APPEND BLANK
IF ! NETERR()
        RETURN .T.
ENDIF
WHILE LASTKEY() <> 27
        mensagem('Aguarde...Acessando o Arquivo: '+ALIAS(SELE()))
        APPEND BLANK
        IF ! NETERR()
                RETURN .T.
        ENDIF
ENDDO
RETURN .F.
*************************** F I M *********************************
*************************
* menu DE ERROS
*************************
FUNCTION erro
***************
atencao(lci,cci,lba,cba)
DEVPOS(0,0);DEVOUT('Corruption detection - general protection')
DEVPOS(1,0);DEVOUT(' programam aborterd. address: OAB9:1005')
CLEAR
QUIT
RETURN NIL
*********************** f i m ************************************
FUNCTION botao(l,c,ll,cc,t,titulo,lado,cor_tit,mtamanho)
WVW_SetPaintRefresh(0)
IF mtamanho = NIL
        mtamanho := 0
ENDIF
IF t <> NIL
        cc := c + 5 + LEN(t) + mtamanho
ENDIF
IF titulo <> NIL
        wvw_drawboxraised(,l,c,ll,cc)
        @ l,c clear to ll,cc
        setcor(2)
        IF lado = NIL
                //WVW_DrawBoxGet(,l-1,cc-(LEN(titulo)+2),LEN(' '+titulo+' '))
                //SETPOS(l-1,cc-(LEN(titulo)+2));DISPOUT(' '+titulo+' ')
                WVW_DrawBoxGet(,l-1,c,cc-c+1)
                SETPOS(l-1,c);DISPOUT(' '+titulo+SPACE((cc-c)-(LEN(titulo)+1)+1))
        ELSE
                WVW_DrawBoxGet(,l-1,c+2,LEN(' '+titulo+' '))
                SETPOS(l,c+2);DISPOUT(' '+titulo+' ')
        ENDIF
        setcor(1)

ELSE
        WVW_DrawBoxRecessed(,l,c,ll,cc)
        @ l,c clear to ll,cc
ENDIF
IF t <> NIL
        DEVPOS(l+1,c+1);DEVOUT(t)
ENDIF
setcor(1)
RETURN NIL
************************** F I M ******************************
FUNCTION botao1(l,c,ll,cc,t,titulo,lado,cor_tit,mtamanho)
****************
WVW_SetPaintRefresh(0)
IF mtamanho = NIL
        mtamanho := 0
ENDIF
IF t <> NIL
        cc := c + 5 + LEN(t) + 0
ENDIF
wvw_drawboxraised(,l,c,ll,cc)
IF t <> NIL
        setcolor('w/b')
        @ l,c clear to ll,cc
        DEVPOS(l+1,c+2);DEVOUT(t)
ENDIF
setcor(1)
RETURN NIL
************************** F I M ******************************
**********************************
* TESTE DE EXISTENCIA DE VENDEDOR
**********************************
FUNCTION ven(mcod_ven,li,ci,p)
**********************************
LOCAL msele,morde
MEMVAR mnome_vend,mcom_ap,mcom_ven

IF EMPTY(mcod_ven); RETURN .T.;END

mnome_vend = SPACE(30)

cons_ven:={}
sr_getconnection():exec("SELECT * FROM insopera WHERE scod_op = "+sr_cdbvalue(STRZERO(mcod_ven,3)),,.t.,@cons_ven)
IF LEN(cons_ven) = 0
        IF p = NIL
                atencao('Vendedor nao Cadastrado !!!')
        ENDIF
        mcod_ven = 0
        RETURN .F.
ELSE
        mnome_vend = cons_ven[1,2]
        mcom_ven := cons_ven[1,6]
        mcom_ap := cons_ven[1,7]
        IF li = NIL
                RETURN .T.
        ELSE
                setcor(3)
                DEVPOS(li,ci);DEVOUT(mnome_vend)
                setcor(1)
                RETURN .T.
        ENDIF
ENDIF
RETURN NIL
************************************ F I M ************************************
***************************
* VER NIVEL DE ACESSO
***************************
FUNCTION ver_nivel(mmodulo,mdescri,mnivel,mconf_nivel,mamb,mopera)
***************************************************
LOCAL msele,morde,mtela_nivel

msele := 0
IF SELE() > 0
        msele := SELE()
        morde := INDEXORD()
ENDIF
exibi_prg(mmodulo)
IF ! AbriArq('sacconf','conf');RETURN NIL;ENDIF
***************************
SELE('conf');ORDSETFOCUS(2)
GO TOP
***************************
mmodulo := mmodulo+SPACE(20-LEN(mmodulo))

WHILE .T.
        IF conf->(DBSEEK(mmodulo))
                BLOQREG()
                conf->descri := mdescri
                DBCOMMIT()
                DBUNLOCK()
*               IF RAT(mconf_nivel,conf->nivel) = 0 .AND. sen->scod_op <> '999'
*               IF RAT(mconf_nivel,conf->nivel) = 0 .AND. cod_operado <> '999'
                IF mopera = '999' .OR. cod_operado = '999'
                        IF ! EMPTY(msele);SELE(msele);ENDIF
                        IF ! EMPTY(morde);ORDSETFOCUS(morde);ENDIF
                        RETURN .T.
                ENDIF
                IF RAT(IF(EMPTY(SUBSTR(mconf_nivel,1,1)),'*',SUBSTR(mconf_nivel,1,1)),conf->nivel) = 0 .AND. RAT(IF(EMPTY(SUBSTR(mconf_nivel,2,1)),'*',SUBSTR(mconf_nivel,2,1)),conf->nivel) = 0
                        IF mamb = NIL
                                atencao('ACESSO NAO AUTORIZADO PARA ESTE AMBIENTE - NIVEL: '+mconf_nivel,2)
                                IF ! aut_sen('Senha de Liberacao do Ambiente:','LIB_AMB')
                                        IF ! EMPTY(msele);SELE(msele);ENDIF
                                        IF ! EMPTY(morde);ORDSETFOCUS(morde);ENDIF
                                        RETURN .F.
                                ELSE
                                        IF ! EMPTY(msele);SELE(msele);ENDIF
                                        IF ! EMPTY(morde);ORDSETFOCUS(morde);ENDIF
                                        RETURN .T.
                                ENDIF
                        ELSE
                                IF ! EMPTY(msele);SELE(msele);ENDIF
                                IF ! EMPTY(morde);ORDSETFOCUS(morde);ENDIF
                                RETURN .F.
                        ENDIF
                ELSE
                        IF ! EMPTY(msele);SELE(msele);ENDIF
                        IF ! EMPTY(morde);ORDSETFOCUS(morde);ENDIF
                        RETURN .T.
                ENDIF
        ELSE
                IF ! ADIREG()
                        atencao('Nao foi possivel adicionar o registro neste modulo')
                        IF ! EMPTY(msele);SELE(msele);ENDIF
                        IF ! EMPTY(morde);ORDSETFOCUS(morde);ENDIF
                        RETURN NIL
                ELSE
                        conf->modulo := mmodulo
                        conf->descri := mdescri
                        conf->nivel  := mnivel
                        DBUNLOCK()
                        DBCOMMIT()
                ENDIF
        ENDIF
ENDDO
IF ! EMPTY(msele);SELE(msele);ENDIF
IF ! EMPTY(morde);ORDSETFOCUS(morde);ENDIF
RETURN .T.
*********************************** f i m **************************************
**********************
* ALTERA A SENHA
**********************
FUNCTION alt_senha(p)
*********************
LOCAL mcont,msenha,lci,cci,lba,cba,tela,msele,morde,mmen,mcor,mponto,mponto1,;
      mcod_oper:=0
MEMVAR senha_acess
mcont:=0
lci := 12
cci := 10
lba := 15
cba := 75
mmen := SAVESCREEN(23,00,23,79)
tela := SAVESCREEN(00,00,24,79)
mcor := SETCOLOR()
msele := SELE()
morde := INDEXORD()
*-----------------------------------------------------
IF ! AbriArq('mastercfg','cfg');RETURN NIL;ENDIF
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
*-----------------------------------------------------
WHILE .T.
        *************
        SELE('sen')
        ORDSETFOCUS(2)
        GO TOP
        *************

        IF sen->(DBSEEK(cod_operado))
                mponto := RECNO()
                IF BLOQREG()
                        sen-> sult_fim := DATE()
                        sen-> shora_fim := TIME()
                        sen-> sh_i_c    := '     '
                        nivel_acess := sen->snivel
                        cod_operado := sen->scod_op
                        senha_acess := msenha
                        COMMIT
                        UNLOCK
                        IF p = NIL
                                setcor(4)
                                DEVPOS(24,67);DEVOUT('Operador: '+cod_operado)
                                setcor(1)
                        ENDIF
                ELSE
                        atencao('Nao foi Possivel Acessar o Arquivo')
                        LOOP
                ENDIF
                ver_mensa(cod_operado)          //verifica mensagens
        ENDIF

        WHILE .T.
                mcod_oper:=0
                setcor(3)
                botao(lci,cci,lba,cba,,' IDENTIFICAR O OPERADOR ','*')
                setcor(1)
                limpa(lci+1,cci+1,lci+1,cba-2)
                DEVPOS(lci+1,cci+1);DEVOUT('Codigo do Operador......:')
                DEVPOS(lci+2,cci+1);DEVOUT('Digite a Senha de Acesso:')
                @ lci+1,cci+27 GET mcod_oper PICT '999' VALID IF(EMPTY(mcod_oper),.F.,ven(mcod_oper,lci+1,cci+31))
                READ
                IF LASTKEY() = 27
                        IF p = '1'
                                RESTSCREEN(00,00,24,79,tela)
                                RESTSCREEN(23,00,23,79,mmen)
                                setcor(4)
                                DEVPOS(24,67);DEVOUT('Operador: '+cod_operado)
                                setcor(1)
                                atencao('Operador: '+cod_operado+'-'+RTRIM(sen->snome))
                                SETCOLOR(mcor)
                                sen->(DBSEEK(cod_operado))
                                IF BLOQREG()
                                        sen-> sult_ent := mdata_sis
                                        sen-> shora_ini := TIME()
                                        sen-> sh_i_c    := cfg->nome
                                        nivel_acess := sen->snivel
                                        cod_operado := sen->scod_op
                                        senha_acess := msenha
                                        COMMIT
                                        UNLOCK
                                ENDIF
                                SELE(msele);ORDSETFOCUS(morde)
                                RETURN .F.
                        ELSE
                                LOOP
                        ENDIF
                ENDIF
                msenha = ''
                pegasenha(@msenha,lci+2,cci+27,setcor(6,'*'))
                setcor(1)
                IF msenha = 'NAO'
                        LOOP
                ENDIF
                mcont ++
*               GO TOP
                IF EMPTY(msenha)
                        atencao('Senha Incorreta Tente Novamente')
                        LOOP
                ENDIF
                IF ALLTRIM(msenha) == ALLTRIM(DCRIPTO(sen->ssenha))
                        mponto1 := RECNO()
                        *************
                        SELE('sen')
                        ORDSETFOCUS(1)
                        *************
                        GO mponto1
                        IF BLOQREG()
                                sen-> sult_ent := mdata_sis
                                sen-> shora_ini := TIME()
                                sen-> sh_i_c    := cfg->nome
                                nivel_acess := sen->snivel
                                cod_operado := sen->scod_op
                                senha_acess := msenha
                                COMMIT
                                UNLOCK
                                RESTSCREEN(00,00,24,79,tela)
                                RESTSCREEN(23,00,23,79,mmen)
*                               IF p = NIL
                                        setcor(4)
                                        DEVPOS(24,67);DEVOUT('Operador: '+cod_operado)
                                        setcor(1)
*                               ENDIF
                                atencao('Operador: '+cod_operado+'-'+RTRIM(sen->snome))
                                SETCOLOR(mcor)
                                SELE(msele);ORDSETFOCUS(morde)
                                ver_mensa(cod_operado)          //verifica mensagens
                                RETURN .T.
                        ELSE
                                atencao('Nao foi Possivel Acessar o Arquivo')
                                LOOP
                        ENDIF
                ELSE
                        limpa(lci+1,cci+2,lci+1,cba-2)
                        atencao('Senha Incorreta Tente Novamente')
                        LOOP
                ENDIF
        ENDDO
ENDDO
RETURN NIL
************************** F I M ******************************
*****************************
* EXIBIR O PRG
*****************************
FUNCTION exibi_prg(vprg)
**********************
WVW_SBSetText(mnum_principal,1,vprg)
RETURN NIL
********************************* F I M **************************
********************************
* FUNCAO P/VERIFICAR AUTORIZACAO
********************************
FUNCTION aut_sen(men,mdl,mlin,mnum_cli,mnum_prod)
****************
LOCAL linhas,i,lin,matencao,li,ci,la,ca,mpos,;
      msel_sen,mord_sen,mcont,tela,mok:=' ',linha,msenha,mn_ped:=SPACE(6),;
      mc_cli:=SPACE(5),msel,mord,mcodaux:=SPACE(14),;
      maut_oper:=SPACE(3),msol_aut:=' ',mpoint:=0

MEMVAR mautoriza,mnum_ped

PRIVATE mcod_aut:=SPACE(6),mcod_oper:=0

IF ver_modulo(mdl)
        RESTSCREEN(00,00,24,79,tela)
        RETURN .T.
ENDIF
msel_sen := SELE()
mord_sen := INDEXORD()
linha := 18
IF ! AbriArq('sacconf','conf');RETURN NIL;ENDIF
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
tela := SAVESCREEN(00,00,24,79)
*****************
SELE('sen');ORDSETFOCUS(2)
*****************
mcont := 0
men := RTRIM(men)
IF LEN(men) > 60
        mpos := 60
        ci := 10
ELSEIF LEN(men) < LEN(' MODULO DE LIBERACAO P/SENHA ')
        mpos := LEN(' MODULO DE LIBERACAO P/SENHA ')    //+20
        ci := (80-LEN(' MODULO DE LIBERACAO P/SENHA ')) / 2
ELSE
        mpos := LEN(men)
        ci := (80-LEN(men)) / 2
ENDIF
linhas := MLCOUNT(men,mpos)
li := 12
IF linha <> NIL
        IF linha + linhas + 4 > 24
                li := 24 - (linhas + 4)
        ELSE
                li := linha
        ENDIF
ENDIF
IF mlin <> NIL .AND. mlin < li
        li := mlin
ENDIF
la := li+linhas+4
ca := ci+1+mpos+1
IF ca - ci < 50
        ci := 10
        ca := 70
ENDIF
matencao := SAVESCREEN(00,00,24,79)
botao(li,ci,la,ca,,' MODULO DE LIBERACAO P/SENHA ')
FOR i = 1 TO  linhas
        LIN := MEMOLINE(men,mpos,i,,)
        DEVPOS(li+i,ci+1);DEVOUT(PADC(RTRIM(LIN),mpos))
NEXT
WHILE mcont < 3
        CLEAR GETS
        mok := ' '
        mcod_aut := SPACE(6)
        msol_aut := 'N'
        setcor(1)
        DEVPOS(li+i,ci+1);  DEVOUT('Codigo Operador:')
        DEVPOS(li+i+1,ci+1);DEVOUT('Senha Liberacao:')
        DEVPOS(li+i+2,ci+1);DEVOUT('Solicitar [s/N]:')
        @ li+i,ci+18 GET mcod_oper PICT '999' VALID IF(EMPTY(mcod_oper),.F.,ven(mcod_oper,li+i,ci+22))
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF

        msenha = ''
        pegasenha(@msenha,li+i+1,ci+18,setcor(6,'*'))
        IF msenha = 'NAO'
                EXIT
        ENDIF
        IF ! EMPTY(msenha)
                maut_oper := sen->scod_op
        ENDIF

        @ li+i+2,ci+18 GET msol_aut PICT '@!' VALID IF(msol_aut = 'S',soli_aut(STRZERO(mcod_oper,3),mnum_cli,mnum_prod),.T.) WHEN EMPTY(msenha)
        READ
        IF LASTKEY() = 27
                EXIT
        ENDIF
        DEVPOS(li+i+2,ci+18);DEVOUT(mcod_aut)
        IF mcod_aut = 'NEGATIVO'
                atencao('Autorizao NEGADA')
                EXIT
        ENDIF
        IF (! EMPTY(mnum_cli) .OR. ! EMPTY(mnum_prod)) .AND. ! EMPTY(sen->scod_aut) .AND. EMPTY(msenha)
                mcodaux := mcod_aut+IF(! EMPTY(mnum_cli),mnum_cli,mnum_prod)+STRZERO(mcod_oper,3)
                IF mcodaux = SUBSTR(sen->scod_aut,1,14)
                        msenha := ALLTRIM(DCRIPTO(sen->ssenha))
                        msel := SELE()
                        mord := INDEXORD()
                        **************************
                        SELE('sen');ORDSETFOCUS(2)
                        **************************
                        BLOQREG()
                        mcodaux := sen->scod_aut
                        sen->scod_aut := SPACE(17)
                        DBCOMMIT()
                        DBUNLOCK()
                        GO TOP
                        maut_oper := SUBSTR(mcodaux,15,3)
                        ven(VAL(maut_oper))
                        msenha := ALLTRIM(DCRIPTO(sen->ssenha))
                ELSEIF EMPTY(mcod_aut)
                        msenha = ''
                        pegasenha(@msenha,li+i+2,ci+18,setcor(6,'*'))
                        IF msenha = 'NAO'
                                EXIT
                        ENDIF
                        IF EMPTY(msenha)
                                LOOP
                        ENDIF
                        maut_oper := sen->scod_op
                ELSE
                        atencao('Codigo de Autorizacao nao confere !!!')
                        mcont ++
                        LOOP
                ENDIF
        ENDIF
        IF ALLTRIM(msenha) == ALLTRIM(DCRIPTO(sen->ssenha))
                IF mdl = 'LIB_SALDO'
                        IF(ver_nivel(mdl,'LIBERACAO DE QUANTD.SOLICITADA MAIOR QUE O SALDO DO PRODUTO','15',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'OPER_PED'
                        IF(ver_nivel(mdl,'LIBERACAO DE OPERADOR COM PEDIDOS PEDENTES','1',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'ALT_DADOS'
                        IF(ver_nivel(mdl,'LIBERACAO P/ALTERACAO NA ENTRADA DE MERCADORIA','1',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'LIB_DESC'
                        IF(ver_nivel(mdl,'LIBERACAO DE DESCONTO A MAIOR NO PRECO DE VENDA PRODUTO','15',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'LIB_AJUST'
                        IF(ver_nivel(mdl,'LIBERACAO DE AJUSTE DE SALDO DOS PRODUTOS','1',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'LIBSLDNF'
                        IF(ver_nivel(mdl,'LIBERACAO DE SALDO A MENOR NA NOTA FISCAL','15',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'LIB_AMB'
                        IF(ver_nivel(mdl,'LIBERACAO DE AMBIENTE NAO AUTORIZADO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3)),mok := '*',' ')
                ELSEIF mdl = 'DESC_CX'
                        IF ver_nivel(mdl,'LIBERACAO DE DESCONTO NO RECEBIMENTO DO PEDIDO (CAIXA)','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'LIB_ALTSLDPED'
                        IF ver_nivel(mdl,'LIBERACAO DA QUANTIDADE NA ALTERACAO DO PEDIDO IMPRESSO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'LIB_PED_LIB'
                        IF ver_nivel(mdl,'LIBERACAO DE PEDIDO JA LIBERADOR PELO FINANCEIRO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'PRZ_REC'
                        IF ver_nivel(mdl,'LIBERACAO DE PRAZO MAIOR QUE ESTIPULADO NO PEDIDO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'LIB_DEV'
                        IF ver_nivel(mdl,'LIBERACAO DE CLIENTE DEVEDOR, CHQ.S/FUNDO OU LIMITE ESTOURADO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'LIB_TAX'
                        IF ver_nivel(mdl,'LIBERACAO DA TAXA DE ACRESCIMO NO PEDIDO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'LIB_PRZ'
                        IF ver_nivel(mdl,'LIBERACAO DE PRAZO A MAIOR QUE O PERMITIDO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'CHQ_DEV'
                        IF ver_nivel(mdl,'LIBERACAO DE CLIENTE COM *** CHEQUE SEM FUNDOS ***','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'LIMIT_EST'
                        IF ver_nivel(mdl,'LIBERACAO DE CLIENTE COM *** LIMITE ESTOURADO ***','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                        ENDIF
                ELSEIF mdl = 'LIB_RECE'
                        IF ver_nivel(mdl,'LIBERACAO DE SALDO A RECEBER POR CONTA','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'LIB_ORCA'
                        IF ver_nivel(mdl,'LIBERACAO DE ORCAMENTO PRECO CUSTO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'LIB_INSC'
                        IF ver_nivel(mdl,'LIBERACAO DE INSCRICAO ESTADUAL','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'LIBCLIVEN'
                        IF ver_nivel(mdl,'LIBERACAO DE VENDEDOR DIFERENTE DO VENDEDOR RESP.PELO CLIENTE','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'EST_PEDEXP'
                        IF ver_nivel(mdl,'ESTORNO DE PEDIDO EXPEDIDO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'LIB_PED'
                        IF ver_nivel(mdl,'LIBERAR OU CANCELAR PEDIDOS','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'LIB_PED_VLR'
                        IF ver_nivel(mdl,'LIBERAR VALOR MAIOR DO QUE O PEDIDO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'LIB_2VIAPED'
                        IF ver_nivel(mdl,'LIBERAR 2a.VIA PEDIDO JA EMITIDO NOTA FISCAL','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'SAC101EXC'
                        IF ver_nivel(mdl,'EXCLUSAO DE SUB-GRUPO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'SAC10EXC'
                        IF ver_nivel(mdl,'EXCLUSAO DE GRUPO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'BALSLSAIDA'
                        IF ver_nivel(mdl,'BALANCO ** CORRECAO DE SALDO (SAIDA) **','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                        ENDIF
                ELSEIF mdl = 'FORMPAGPED'
                        IF ver_nivel(mdl,'LIBERACAO DA FORMA DE PAG. NA ALTERCAO DO PEDIDO (AV -> AP)','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF mdl = 'LIB_FORMA_PG'
                        IF ver_nivel(mdl,'LIBERA FORMA DE PAGAMENTO NO RECEBIMENTO DE AVISTA P/APRAZO','1',sen->snivel,1,STRZERO(VAL(maut_oper),3))
                                mok := '*'
                                mc_cli := cli->cod_cli
                                mn_ped := STRZERO(mnum_ped,6)
                        ENDIF
                ELSEIF (RAT(IF(EMPTY(SUBSTR(sen->snivel,1,1)),'*',SUBSTR(sen->snivel,1,1)),conf->nivel) > 0 .OR. RAT(IF(EMPTY(SUBSTR(sen->snivel,2,1)),'*',SUBSTR(sen->snivel,2,1)),conf->nivel) > 0) .OR. STRZERO(VAL(maut_oper),3) = 999
                        mok := '*'
                ENDIF
                IF mok = '*'
                        mautoriza := SPACE(3)
                        mautoriza := sen->scod_op
                        RESTSCREEN(00,00,24,79,tela)
                        RETURN .T.
                ENDIF
                atencao('Cod. Operador:'+maut_oper+' - Operador nao Autorizada !!!')
                mcont ++
                LOOP
        ELSE
                atencao('Senha nao Autorizada 2 !!!')
                mcont ++
                LOOP
        ENDIF
ENDDO
RESTSCREEN(00,00,24,79,tela)
*********************
SELE(msel_sen);IF(mord_sen>0,ORDSETFOCUS(mord_sen),)
*SELE(msel_sen);ORDSETFOCUS(mord_sen)
*********************
RETURN .F.
***************************** F I M ****************************************
************************
* SOLICITAR AUTORIZACAO
************************
FUNCTION soli_aut(sope,scli,sprod)
**********************************
LOCAL mcont:=1,mponto_sen:=0
mponto_sen := RECNO()
BLOQREG()
sen->sstatus := 'S'
IF scli <> NIL
        sen->scliente := scli
ENDIF
IF sprod <> NIL
        sen->sproduto := sprod
ENDIF
sen->sope     := sope
DBUNLOCK()
DBCOMMIT()
WHILE LASTKEY() <> 27
        GO mponto_sen
        IF sen->sstatus = 'S'
                mensagem('Aguarde solicitanto AUTORIZACAO '+REPLI('.',mcont))
        ELSEIF sen->sstatus = 'A'
                mensagem('Aguarde um momento em ANALISE '+REPLI('.',mcont))
        ELSEIF sen->sstatus = 'L'
                mcod_aut := SUBSTR(sen->scod_aut,1,6)
                EXIT
        ELSEIF sen->sstatus = 'N'
                mcod_aut := 'NEGATIVO'
                EXIT
        ENDIF
        mcont ++
        IF mcont = 5
                mcont := 1
        ENDIF
        INKEY(.5)
        IF LASTKEY() = 27
                mcod_aut := 'NEGATIVO'
                EXIT
        ENDIF
ENDDO
BLOQREG()
sen->sstatus := ' '
sen->scliente := sen->sproduto := SPACE(5)
sen->sope     := SPACE(3)
DBUNLOCK()
DBCOMMIT()
RETURN .T.
***************************** F I M ****************************************
// Function PegaChar
// Programada por Paulo Nasi em 21.04.1992
// Recupera caracter digitado pelo usuario
//
Function PegaChar
*****************
SETPOS(25,00)
Return Inkey(0)



//
// Function PegaSenha
// Programada por Paulo Nasi em 29.06.1993
// Pega senha digitada pela usuario
//
Procedure PegaSenha ( Senha, LinSenha, ColSenha , cor )


Local SenhaTamMax  := 8
Local CharDigitado
Local SenhaTela    := ""
limpa(linsenha,colsenha,linsenha,colsenha+9)

Do While Len(SenhaTela) <= SenhaTamMax

   CharDigitado := PegaChar()
   Do Case
      Case CharDigitado >= 97 .And. CharDigitado <= 122   /* ALFA MINUSCULA */
           Senha     := Senha + Upper(Chr(CharDigitado))
           SenhaTela := SenhaTela + "*"
      Case CharDigitado >= 65 .And. CharDigitado <= 90    /* ALFA MAIUSCULA */
           Senha     := Senha + Chr(CharDigitado)
           SenhaTela := SenhaTela + "*"
      Case CharDigitado >= 48 .And. CharDigitado <= 57    /* NUMERICO */
           Senha     := Senha + Chr(CharDigitado)
           SenhaTela := SenhaTela + "*"
      Case (CharDigitado = K_LEFT) .Or. (CharDigitado = K_BS)
           If Len(Senha) != 0
              Senha     := Left(Senha,Len(Senha)-1)
              SenhaTela := Left(SenhaTela,Len(SenhaTela)-1)
           EndIf
      Case CharDigitado = K_ENTER
           Exit
      Case CharDigitado = K_ESC
           Senha := "NAO"
           Exit
   EndCase
   IF cor <> NIL
          SETCOLOR(cor)
   ENDIF
   @ LinSenha,ColSenha Say PadR(SenhaTela,SenhaTamMax)

EndDo

Return
********************************* f i m ********************************
************************
* VERIFICA SE A MENSAGEM
************************
FUNCTION ver_mensa(mcod,tp,rapida)
**********************************
LOCAL msele,morde,mcor,mpesq,cons_mensa:={},mmensagem,opcao
MEMVAR mdata_sis
//msele := SELE()
//morde := INDEXORD()
//mcor := SETCOLOR()

cons_mensa:={}
cComm  := "SELECT * FROM sacmensa WHERE cod_rec = "+sr_cdbvalue(mcod)+" AND ler = 'R'"
sr_getconnection():exec(ccomm,,.t.,@cons_mensa)
IF LEN(cons_mensa) > 0
	//atencao( 'REMETENTE....: '+cons_mensa[1,3]+'  -  Emissao: '+DTOC(cons_mensa[1,1])+' - Hora: '+cons_mensa[1,2]+SPACE(90);
        WHILE .T.
	       opcao := op_simnao('N','REMETENTE....: '+cons_mensa[1,3]+'  -  Emissao: '+DTOC(cons_mensa[1,1])+' - Hora: '+cons_mensa[1,2]+SPACE(165);
	                +'ASSUNTO......: '+cons_mensa[1,5]+SPACE(97)+cons_mensa[1,6]+cons_mensa[1,7]+cons_mensa[1,8]+cons_mensa[1,9];
                        +cons_mensa[1,10]+cons_mensa[1,11]+cons_mensa[1,12]+cons_mensa[1,13]+cons_mensa[1,14]+cons_mensa[1,15];
                        +cons_mensa[1,16]+cons_mensa[1,17]+cons_mensa[1,18]+cons_mensa[1,19]+cons_mensa[1,20]+cons_mensa[1,21];
                        +cons_mensa[1,22]+cons_mensa[1,23]+cons_mensa[1,24]+cons_mensa[1,25])
                IF opcao = 'S'
                        EXIT
                ENDIF
        ENDDO
        cComm  := "UPDATE sacmensa SET ler = '*',data_ler = "+sr_cdbvalue(mdata_sis)+" WHERE cod_rec = "+sr_cdbvalue(mcod)+" AND ler = 'R'"
        sr_getconnection():exec(ccomm,,.f.)
        sr_getconnection():exec('COMMIT',,.f.)
ENDIF
IF rapida <> NIL
        RETURN .T.
ENDIF
cons_mensa:={}
cComm  := "SELECT * FROM sacmensa WHERE cod_rec = "+sr_cdbvalue(mcod)+" AND (ler IS NULL OR ler = ' ') AND data_men <= "+sr_cdbvalue(mdata_sis)
sr_getconnection():exec(ccomm,,.t.,@cons_mensa)
IF LEN(cons_mensa) > 0
        IF tp = NIL
		atencao('Existe Mensagens para este Operador')
        ENDIF
        RETURN .T.
ELSE
        RETURN .F.
ENDIF
RETURN NIL
/*
IF ! AbriArq('sacmensa','mensa');RETURN NIL;ENDIF
***************
SELE('mensa');ORDSETFOCUS(1)
GO TOP
***************
mpesq := mcod+' '
IF mensa->(DBSEEK(mpesq))
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF tp = NIL .AND. mensa->data_men <= mdata_sis
                atencao('Existe Mensagens para este Operador',1)
        ENDIF
        IF mensa->data_men <= mdata_sis
                DEVPOS(03,70);DEVOUT('Mensagem')
        ENDIF
        RETURN .T.
ELSE
        IF msele > 0
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        ENDIF
        DEVPOS(03,70);DEVOUT('        ')
        RETURN .F.
ENDIF
RETURN NIL
*/
******************************* f i m *********************************************
***************************
* VER NIVEL DE MODULO
***************************
FUNCTION ver_modulo(mmodulo)
***************************************************
LOCAL msele,morde,mtela_nivel,mcons_nivel:={}

mmodulo := mmodulo+SPACE(20-LEN(mmodulo))
mcons_nivel := {}
sr_getconnection():exec("SELECT * FROM sacconf WHERE modulo = "+sr_cdbvalue(mmodulo),,.t.,@mcons_nivel)
IF LEN(mcons_nivel) > 0 .AND. SUBSTR(mcons_nivel[1,3],1,1) = '0'
        RETURN .T.
ELSE
        RETURN .F.
ENDIF
RETURN NIL
*********************************** f i m **************************************
***************
FUNCTION ver_dia(mv)
***************
LOCAL mdia
IF dow(mv)=1
        mdia := 'DOMINGO'
ELSEIF dow(mv)=2
        mdia := 'SEGUNDA FEIRA'
ELSEIF dow(mv)=3
        mdia := 'TERCA FEIRA'
ELSEIF dow(mv)=4
        mdia := 'QUARTA FEIRA'
ELSEIF dow(mv)=5
        mdia := 'QUINTA FEIRA'
ELSEIF dow(mv)=6
        mdia := 'SEXTA FEIRA'
ELSEIF dow(mv)=7
        mdia := 'SABADO'
ENDIF
RETURN mdia
************************** F I M ***************************************
*****************************************
* APAGA O ARQUIVOI DE CONTROLE "HRB.001"
*****************************************
FUNCTION apaga_hrb()
mensagem('Ajustando o ambiente do sistema HRB.001')
WHILE .T.
        MYRUN('DEL HRB.001')
        IF ! SR_PhFile('HRB.001')
                EXIT
        ENDIF
ENDDO
RETURN NIL
************************ F I M ***********************************************
**********************
* OPCAO SIM OU NAO
**********************
FUNCTION op_simnao(mtipo_op,mensagem,mtitulo)
*********************************************
LOCAL mopcao_simnao
mopcao_simnao := WVW_MessageBox( ,mensagem,IF(mtitulo=NIL,' Escolha a Opcao ',mtitulo),MB_YESNO + MB_ICONQUESTION + MB_SYSTEMMODAL + IF(mtipo_op = 'S',MB_DEFBUTTON1,MB_DEFBUTTON2))
IF mopcao_simnao = 6
        RETURN 'S'
ELSE
        RETURN 'N'
ENDIF
RETURN NIL
*************************** f i m ****************************
Function VCGC(xArg1)
********************
If (Empty(xArg1))
        Return .T.
EndIf
xArg1:= Trim(xArg1)
If (Len(xArg1) # 14)
        Return .F.
EndIf
dv1_f:= Val(SubStr(xArg1,13,1))
dv2_f:= Val(SubStr(xArg1,14,1))
num_:= SubStr(xArg1,1,12)
dv1_c:= 0
posi_:= 12
mu_:= "543298765432"
Do While (posi_ > 0)
        dv1_c:= dv1_c+Val(SubStr(num_,posi_,1))*Val(SubStr(mu_,posi_,1))
        posi_--
EndDo
rest_:= dv1_c-Int(dv1_c/11)*11
dv1_c:= IIf(rest_ < 2,0,11-rest_)
dv_:= SubStr(Str(dv1_c,1),1)
num_:= num_+dv_
dv2_c:= 0
mu_:= "6"+mu_
posi_:= 13
Do While (posi_ > 0)
        dv2_c:= dv2_c+Val(SubStr(num_,posi_,1))*Val(SubStr(mu_,posi_,1))
        posi_--
EndDo
rest_:= dv2_c-Int(dv2_c/11)*11
dv2_c:= IIf(rest_ < 2,0,11-rest_)
Return dv1_c = dv1_f .AND. dv1_c = dv1_f .AND. dv2_c = dv2_f
*********************** F I M *************************************************************************
* FUNCAO PARA QUALIDADE DE IMPRESSAO
************************************
FUNCTION imprt(imp,tipo,linha,col)
******************************
*e chr(27)+"w1" aumenta a altura da fonte, e "w0" volta ao normal
IF col = NIL
        col := 0
ENDIF
IF linha = NIL
        linha := 0
ENDIF
IF imp = 'M' .AND. tipo = 'C'	//CONDENSADO
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+CHR(15))
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'N'	//NORMAL DRAFT
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(18))
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'N+'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"E")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'N-'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"F")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'R'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"k0")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'S'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"k1")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'T+'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"x1")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'T-'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+"x0")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'S+'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+CHR(45)+"1")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'S-'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+CHR(45)+"0")
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'E'
       DEVPOS(PROW()+linha,col);DEVOUT(CHR(14))
       RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'M'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(15)+CHR(14))
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'P8'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'0')
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'A'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'W'+'1')
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'P6'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'2')
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'W1'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'W'+'1')
        RETURN .T.
ELSEIF imp = 'M' .AND. tipo = 'W0'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'W'+'0')
        RETURN .T.
/*
ELSEIF imp = 'J' .AND. tipo = 'C'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s16.67H')
*        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s15H')
        RETURN NIL
ELSEIF imp = 'J' .AND. tipo = 'N'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s10H')
        RETURN NIL
ELSEIF imp = 'J' .AND. tipo = 'M'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s10H')
        RETURN NIL
ELSEIF imp = 'J' .AND. tipo = 'E'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s5H')
        RETURN NIL
ELSEIF imp = 'J' .AND. tipo = 'P8'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s1P')
        RETURN NIL
ELSEIF imp = 'J' .AND. tipo = 'P6'
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(27)+'(s0P')
        RETURN NIL
*/
ELSEIF imp = 'D' .AND. tipo = 'C'
        DEVPOS(PROW()+linha,col);DEVOUT('M')
        RETURN .T.
ELSEIF imp = 'D' .AND. tipo = 'N'
        DEVPOS(PROW()+linha,col);DEVOUT('P')
        RETURN .T.
ELSEIF imp = 'D' .AND. tipo = 'E'
        DEVPOS(PROW()+linha,col);DEVOUT('P')
        RETURN .T.
ELSE
        DEVPOS(PROW()+linha,col);DEVOUT(CHR(18))
        RETURN .T.
ENDIF

RETURN NIL
******************************** F I M ********************************
#xtranslate :fileHandle   => :cargo\[1\]
#xtranslate :fileLine     => :cargo\[2\]
#xtranslate :lineOffset   => :cargo\[3\]
#xtranslate FTell(<fHandle>) => FSeek(<fHandle>, 0, 1)
#define FILE_BRWS_NUM_IVARS 3
#define MAX_LINE_LEN  256
#define CR    Chr(13)
#define LF    Chr(10)
#define CRLF  CR + LF
#define SET_IVAR(iVar, p) iif(p == NIL, NIL, iVar := p)

#INCLUDE "wingdi.ch"
#INCLUDE "winuser.ch"
FUNCTION lertexto(cFname)
*************************
LOCAL oTbr, oTbc,;
      lExitRequested := .F.,;
      cSearcher, nSavefPos,;
      nKey,;
      GetList := {},;
      tela_edit,;
      edit_tela,otab,mfile

MEMVAR lin_br

//IF m_set[1,41] = 'P'
        mfile := STRTRAN(ALLTRIM(cFname),'.REL','.TXT')
        IF frename(cfname,mfile) = -1
                atencao('ERRO: Nao foi possivel renomear...')
        ENDIF
        cfname := STRTRAN(ALLTRIM(cFname),'.REL','')
        //atencao(cfname)

        //MYRUN('DOSPRINTER /SEL2 /DEL '+ALLTRIM(m_cfg[12])+'HRB.REL')
        //RETURN
//ENDIF

set_pesquisa = 0
cSearcher := Space(20)
SET SCOREBOARD OFF
cfname := ALLTRIM(m_cfg[12])+cfname
atencao(cfname)
IF cFname == NIL .OR. !File(cFname)
        atencao("NAO FOI POSSIVEL ENCONTRAR O ARQUIVO, VERIFIQUE O CAMINHO NA CONFIGURACAO INDIVIDUAL DE TERMINAL")
        RETURN  NIL
ENDIF
//WVW_SetFont(,"lucida console",13, 7,, PROOF_QUALITY )  // 800X600
op_tela(00,00,50,140,'VISUALIZACAO DO ARQUIVO: '+cfname,,1)
setcor(1)
mensagem("[F2] - Procura abaixo [F3] - Procura acima  [F4] - repetir pesquisa - [F5] Imprimir na Impressora Padrao")
SETCOLOR('n/w,gr+/b,,,w/n')          && cor PRINCIPAL
IF (oTbr := FBrowseNew()) != NIL
        FBrowseOpen(oTbr, cFname)
        oTbr:nTop    := oTbr:nLeft   := 0
        oTbr:nBottom := 50
        oTbr:nRight  := 140
        oTbc := TBColumnNew(, {|| SubStr(oTbr:fileLine, oTbr:lineOffset) })
        oTbc:width := 140
        oTbr:addColumn(oTbc)
        DO WHILE !lExitRequested
                DO WHILE !oTbr:stabilize() ;ENDDO

                nKey := InKey(0)
                DO CASE
                        CASE nKey == 27
                                setcor(1)
                                lExitRequested := .T.
                        CASE nKey == 19
                                IF oTbr:lineOffset > 1
                                        oTbr:lineOffset--
                                        oTbr:refreshall()
                                ENDIF
                        CASE nKey == 4
                                IF oTbr:lineOffset < len(oTbr:fileLine)
                                        oTbr:lineOffset++
                                        oTbr:refreshall()
                                ENDIF
                        CASE nKey == 1
                                oTbr:lineOffset := 1
                                oTbr:refreshall()
                        CASE nKey == 6
                                oTbr:lineOffset := Max(1, Len(oTbr:fileLine) - ;
                                oTbc:width + 1)
                                oTbr:refreshAll()
                                #define TAB_SIZE 10
                        CASE nKey == 9
                                IF oTbr:lineOffset <= Len(oTbr:fileLine) - TAB_SIZE
                                        oTbr:lineOffset += TAB_SIZE
                                        oTbr:refreshAll()
                                ENDIF
                        CASE nKey == 271
                                oTbr:lineOffset := MAX(1, oTbr:lineOffset - TAB_SIZE)
                                oTbr:refreshall()
                        CASE nKey == -1
                                setcor(1)
                                op_tela(10,10,12,45,'Digite o Texto que Deseja')
                                WVW_DrawBoxGet(,01,01,20)
                                @ 01,01 GET csearcher
                                READ
                                SETCOLOR('w/n,b/w,,,n/w')
                                wvw_lclosewindow()
                                IF FrwdSrch(oTbr, Trim(cSearcher))
                                        oTbr:refreshAll()
                                ELSE
                                        atencao("Nao encontrado")
                                ENDIF
                                set_pesquisa = -1

                        CASE nKey == -2
                                setcor(1)
                                op_tela(10,10,12,45,'Digite o Texto que Deseja')
                                WVW_DrawBoxGet(,01,01,20)
                                @ 01,01 GET csearcher
                                READ
                                SETCOLOR('w/n,b/w,,,n/w')
                                wvw_lclosewindow()
                                IF BkwdSrch(oTbr, Trim(cSearcher))
                                        nSavefPos := FilePos(oTbr)
                                        oTbr:refreshAll()
                                        DO WHILE !oTbr:stabilize()
                                        ENDDO

                                        // Ensure same line selected
                                        DO WHILE FilePos(oTbr) != nSavefPos
                                                oTbr:up()
                                                DO WHILE !oTbr:stabilize()
                                                ENDDO
                                        ENDDO
                                ELSE
                                        atencao("Nao encontrado")
                                ENDIF
                                set_pesquisa = -2

                        case nkey == -3
                                do case
                                        case set_pesquisa = 0
                                                atencao("Nao foi efetuado nenhuma pesquisa")
                                                loop
                                        case set_pesquisa = -1
                                                IF FrwdSrch(oTbr, Trim(cSearcher))
                                                        oTbr:refreshAll()
                                                ELSE
                                                        atencao("Nao encontrado")
                                                ENDIF
                                        case set_pesquisa = -2
                                                IF BkwdSrch(oTbr, Trim(cSearcher))
                                                        nSavefPos := FilePos(oTbr)
                                                        oTbr:refreshAll()
                                                        DO WHILE !oTbr:stabilize()
                                                        ENDDO
                                                        DO WHILE FilePos(oTbr) != nSavefPos
                                                                oTbr:up()
                                                                DO WHILE !oTbr:stabilize()
                                                                ENDDO
                                                        ENDDO
                                                ELSE
                                                        atencao("Nao encontrado")
                                                ENDIF
                                endcase
                        case nkey == -4
                                setcor(1)
                                lExitRequested := .T.
//				EXIT
                        OTHERWISE
                        IF StdMeth(oTbr, nKey)
                                //  Handled as standard key
                        ELSE
                                // Otherwise ignore
                        ENDIF
                ENDCASE
        ENDDO
ENDIF
FClose(oTbr:filehandle)
IF LASTKEY() = -4
	IF op_simnao('S','Confirma a Impressao:') = 'S'
		PrintFileRaw(GetDefaultPrinter(),cFname,"teste de impressao")
	ENDIF
ENDIF
setcor(1)
wvw_lclosewindow()
//WVW_SetFont(,'terminal',12, 8,FW_MEDIUM, DEFAULT_QUALITY  )  // 800X600
//wvw_cbsetfont(, 'Fontes Pequenas', 8, 6 )
//wvw_pbsetfont(, 'terminal', 9, 4 )
RETURN NIL
*------------------------------------------------------------------------------*
FUNCTION FilePos(oTbr)
RETURN FTell(oTbr:fileHandle)
*------------------------------------------------------------------------------*
FUNCTION FBrowseNew
LOCAL oTbr := TBrowseNew()
oTbr:cargo := Array(FILE_BRWS_NUM_IVARS)
oTbr:lineOffset := 1

oTbr:goTopBlock    := {| | FileGoFirst(oTbr) }
oTbr:goBottomBlock := {| | FileGoLast(oTbr)  }
oTbr:skipBlock     := {|n| FileSkip(n, oTbr) }

RETURN oTbr
*------------------------------------------------------------------------------*
FUNCTION FBrowseOpen(oTbr, cFileName)
LOCAL fHandle := FOpen(cFileName)

IF fHandle >= 0
        oTbr:fileHandle := fHandle
        FileGoFirst(oTbr)
ENDIF

RETURN fHandle > 0
*------------------------------------------------------------------------------*
PROCEDURE FileBrowseClose(oTbr)
FClose(oTbr:filehandle)
RETURN

// Go to first line in file, and read it into oTbr:fileLine
*------------------------------------------------------------------------------*
STATIC PROCEDURE FileGoFirst(oTbr)
LOCAL cLine
LOCAL fHandle := oTbr:fileHandle
FSeek(fHandle, 0, 0)
FReadLn(fHandle, @cline, MAX_LINE_LEN)
cline = strtran(cline,chr(12) + chr(13),chr(13) + chr(10))

oTbr:fileLine := cLine
FSeek(fHandle, 0, 0)

RETURN
*------------------------------------------------------------------------------*
STATIC PROCEDURE FileGoLast(oTbr)
FSeek(oTbr:fileHandle, 0, 2)
GoPrevLn(oTbr)
RETURN
*------------------------------------------------------------------------------*
STATIC FUNCTION FileSkip(n, oTbr)
LOCAL nSkipped := 0
IF n > 0
        DO WHILE nSkipped != n .AND. GoNextLn(oTbr)
                nSkipped++
        ENDDO
ELSE
        DO WHILE nSkipped != n .AND. GoPrevLn(oTbr)
                nSkipped--
        ENDDO
ENDIF

RETURN nSkipped
*------------------------------------------------------------------------------*
FUNCTION GoNextLn(oTbr)
LOCAL fHandle := oTbr:fileHandle
LOCAL nSavePos := FTell(fHandle), ;
      cBuff := "", lMoved, nNewPos

FSeek(fHandle, Len(oTbr:fileLine) + 2, 1)
nNewPos := FTell(fHandle)
IF FReadLn(fHandle, @cBuff, MAX_LINE_LEN)
        lMoved := .T.
        oTbr:fileLine := cBuff
        FSeek(fHandle, nNewPos, 0)
ELSE
        lMoved := .F.
        FSeek(fHandle, nSavePos, 0)
ENDIF

RETURN lMoved
*------------------------------------------------------------------------------*
FUNCTION GoPrevLn(oTbr)
LOCAL fHandle := oTbr:fileHandle
LOCAL nOrigPos := FTell(fHandle), nMaxRead, nNewPos, ;
          lMoved, cBuff, nWhereCrLf, nPrev, cTemp

IF nOrigPos == 0
        lMoved := .F.
ELSE
        lMoved := .T.
        //  Check preceeding 2 chars for CR / LF
        FSeek(fHandle, -2, 1)
        cTemp := Space(2)
        FRead(fHandle, @cTemp, 2)
        IF cTemp == CRLF
                FSeek(fHandle, -2, 1)
        ENDIF
        nMaxRead := MIN(MAX_LINE_LEN, FTell(fHandle))

        cBuff := Space(nMaxRead)
        nNewPos := FSeek(fHandle, -nMaxRead, 1)
        FRead(fHandle, @cBuff, nMaxRead)
        *    cbuff = strtran(cbuff,chr(12) + chr(13),chr(13) + chr(10))
        nWhereCrLf := Rat(CRLF, cBuff)
        IF nWhereCrLf == 0
                nPrev := nNewPos
                oTbr:fileLine := cBuff
        ELSE
                nPrev := nNewPos + nWhereCrLf + 1
                oTbr:fileLine := SubStr(cBuff, nWhereCrLf + 2)
        ENDIF

        FSeek(fHandle, nPrev, 0)
ENDIF
RETURN lMoved
*------------------------------------------------------------------------------*
FUNCTION FrwdSrch(oTbr, cString)
LOCAL fHandle := oTbr:fileHandle
LOCAL lFound := .F.
LOCAL nSavePos := FTell(oTbr:fileHandle)
LOCAL cSavecLine := oTbr:fileLine

DO WHILE !lFound .AND. GoNextLn(oTbr)
        lFound := cString $ oTbr:fileLine
ENDDO

IF !lFound
        FSeek(fHandle, nSavePos, 0)
        oTbr:fileLine := cSavecLine
ENDIF

RETURN lFound
*------------------------------------------------------------------------------*
FUNCTION bkwdSrch(oTbr, cString)
LOCAL lFound := .F.
LOCAL fHandle := oTbr:fileHandle
LOCAL nSavePos := FTell(fHandle)
LOCAL cSavecLine := oTbr:fileLine
DO WHILE !lFound .AND. GoPrevLn(oTbr)
        lFound := cString $ oTbr:fileLine
ENDDO

IF !lFound
        FSeek(fHandle, nSavePos, 0)
        oTbr:fileLine := cSavecLine
ENDIF

RETURN lFound
*------------------------------------------------------------------------------*
FUNCTION FReadLn(fHandle, cBuffer, nMaxLine)
LOCAL cLine, nEol, nNumRead, nSavePos
  cLine   := Space(nMaxLine)
  cBuffer := ""
nSavePos := FTell(fHandle)
nNumRead := FRead(fHandle, @cLine, nMaxLine)
IF (nEol := At(CRLF, SubStr(cLine, 1, nNumRead))) == 0
        cBuffer := cLine                     // Line overflow or eof
ELSE
        cBuffer := SubStr(cLine, 1, nEol - 1)  // Copy up to eol
        FSeek(fHandle, nSavePos + nEol + 1, 0)
ENDIF

RETURN nNumRead != 0        // If last read didn't suceed, eof
*------------------------------------------------------------------------------*
FUNCTION StdMeth(oTbr, nKey)
LOCAL lKeyHandled := .T.
DO CASE
        CASE nKey == 24     ;  oTbr:down()
        CASE nKey == 05     ;  oTbr:up()
        CASE nKey == 03     ;  oTbr:pageDown()
        CASE nKey == 18     ;  oTbr:pageUp()
        CASE nKey == 31     ;  oTbr:goTop()
        CASE nKey == 30     ;  oTbr:goBottom()
        CASE nKey == 04     ;  oTbr:right()
        CASE nKey == 19     ;  oTbr:left()
        CASE nKey == 01     ;  oTbr:home()
        CASE nKey == 06     ;  oTbr:end()
        CASE nKey == 26     ;  oTbr:panLeft()
        CASE nKey == 02     ;  oTbr:panRight()
        CASE nKey == 29     ;  oTbr:panHome()
        CASE nKey == 23     ;  oTbr:panEnd()
        OTHERWISE;             lKeyHandled := .F.
ENDCASE
RETURN lKeyHandled
*------------------------------------------------------------------------------*
FUNCTION MemoBlock(nFieldNum)
RETURN {|nMode| iif(nMode == NIL, ;
                    "Memo", ;
                    FieldBlock(Field(nFieldNum))) }
*------------------------------------------------------------------------------*
PROC DbStabilize(oTbr)
LOCAL nSaveRecno := recno()
oTbr:refreshAll()
DO WHILE !oTbr:stabilize()
ENDDO
DO WHILE recno() != nSaveRecno
        oTbr:up()
        DO WHILE !oTbr:stabilize()
        ENDDO
ENDDO
RETURN
****************************** F I M *****************************************
FUNCTION arq_imp(marquivo)
********************
LOCAL mtexto,opcao,mtraco:=REPLI('-',80),linhas,linha,lin
MEMVAR mfirma_ins
PRIVATE mtipo_imp,mimp_tipo:=2,mporta_imp,marq:=SPACE(35)
********* VARIAVEIS DE IMPRESSAO *******************
mtipo_imp := 'M'
****************************************************
CLEAR GETS
IF ! AbriArq('saccfg','cfg');RETURN NIL;ENDIF
mensagem('Deseja Imprimir [S/n]:')
opcao := 'S'
@ MAXROW()-1,COL()+1 GET opcao PICT '@!' VALID opcao $ 'S,N'
READ
IF opcao = 'S'
        mensagem('Espere o Final da Impressao OK')
        SET DEVI TO PRINT
        SET PRINT TO (cfg->prt_rel)
        imprt(cfg->imp_rel,'E')
        DEVPOS(PROW(),00);DEVOUT(mfirma_ins)
        imprt(cfg->imp_rel,'N')
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        DEVPOS(PROW()+2,00);DEVOUT(' ')
        linhas := 0
        linhas := MLCOUNT(MEMOREAD(marquivo),80)
        linha := 0
        FOR linha = 1 TO  linhas
                lin := MEMOLINE(MEMOREAD(marquivo),80,linha,,)
                @ PROW()+1,00 SAY lin
                IF PROW() >= 58
                        EJECT
                        imprt(cfg->imp_rel,'E')
                        DEVPOS(PROW(),00);DEVOUT(mfirma_ins)
                        imprt(cfg->imp_rel,'N')
                        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                        DEVPOS(PROW()+1,00);DEVOUT('Continuacao')
                        DEVPOS(PROW()+2,00);DEVOUT(' ')
                ENDIF
        NEXT
        EJECT
        SETPRC(00,00)
        SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF
        RETURN .T.
ELSE
        RETURN .T.
ENDIF
RETURN .T.

***************************** F I M ****************************************
FUNCTION CALCU()
****************
IF ! MYRUN2('c:\windows\system32\calc.exe')
	atencao('NAO FOI ENCONTRADA A CALCULADORA COM WINDOWS FAVOR ENTRAR EM CONTATO COM O GERENTE DOS COMPUTADORES....')
ENDIF
RETURN  NIL
*************************** f i m *******************************************
*************************
* TIPO DE IMPRESSAO  ARQUIVOS OU IMPRESSORA
*************************
FUNCTION imp_arq(imp_arq,mporta,op,linha,comp,mens,msenha_lib,mexcel)
*********************************************************************
LOCAL tela,lci,cci,lba,cba,msele,morde,mtp_impre:=0

mimp_tipo :=0
mporta_imp:=mtipo_imp :=' '
mnome_arq := imp_arq
msele := SELE()
morde := INDEXORD()

op_tela(03,10,14,80,' Configuracao de IMPRESSAO - Arquivo: '+ALLTRIM(mnome_arq))
CLEAR GETS
//WvW_ClearGetVarList()
lci := cci := 0
lba := 09
cba := 70
IF op = NIL
        op := 'S'
ENDIF
IF mporta = NIL
        mporta := 'R'
ENDIF
mnome_arq := ALLTRIM(m_cfg[12])+imp_arq+SPACE(50-LEN(ALLTRIM(m_cfg[12])+imp_arq))

mtp_impre:=0
WHILE .T.
        imp_arq := mnome_arq
        mimp_tipo := 1
        mporta_imp := 'LPT1'
        mtipo_imp  := 'M'
	IF mtipo_imp = 'M'
		mtp_impre:=1
	ELSE
		mtp_impre:=2
	ENDIF
        limpa(00,00,30,80)
        setcor(1)
        @ lci+4,cci TO lci+4,cba
        DEVPOS(lci+6,cci+1);DEVOUT('Tipo da Impressora [J]ato [M]atriz...:')
        DEVPOS(lci+8,cci+1);DEVOUT('Nome do Arquivo de impressao.........:')
        DEVPOS(lci+9,cci+1);DEVOUT('Porta Impressora.....................:')
        DEVPOS(lci+10,cci+1);DEVOUT('Diminuir Espacos entre Linhas [s/N]..:')
        botao1(lci+5,cci+40,lci+7,cci+53)
        botao1(lci+5,cci+56,lci+7,cci+69)
        setcor(3)
        DEVPOS(lci+6,cci+41);DEVOUT(' MATRICIAL  ')
        DEVPOS(lci+6,cci+57);DEVOUT(' JATO TINTA ')
        setcor(1)

        botao1(lci+1,cci+02,lci+3,cci+15)
        botao1(lci+1,cci+20,lci+3,cci+33)
        botao1(lci+1,cci+37,lci+3,cci+50)
        botao1(lci+1,cci+55,lci+3,cci+68)
        @ lci+2,cci+03 PROMPT ' IMPRESSORA '
        @ lci+2,cci+21 PROMPT '  CONSULTA  '        //+marq
        @ lci+2,cci+38 PROMPT '  ARQUIVO   '        //+marq
        IF mexcel <> NIL
                @ lci+2,cci+56 PROMPT '   EXCEL    '        //+marq
        ELSE
                setcor(3)
                @ lci+2,cci+56 SAY '   EXCEL    '        //+marq
                setcor(1)
        ENDIF
        SET INTEN ON
        MENU TO mimp_tipo
        IF LASTKEY() = 27
                EXIT
        ENDIF
        IF ! mimp_tipo = 3
                @ lci+6,cci+41 PROMPT ' MATRICIAL  '
                @ lci+6,cci+57 PROMPT ' JATO TINTA '
                SET INTEN ON
                MENU TO mtp_impre
                IF LASTKEY() = 27
                        LOOP
                ENDIF
                IF mtp_impre = 1
                        mtipo_imp := 'M'
                ELSE
                        mtipo_imp := 'J'
                ENDIF
        ENDIF
        //IF mimp_tipo < 4
                IF (mtipo_imp = 'J' .AND. mimp_tipo = 1)
                        mimp_tipo := 3
                        mtipo_imp := 'D'
                        imp_arq := ALLTRIM(m_cfg[12])+'HRB.REL'
                ELSEIF mimp_tipo = 2
                        imp_arq := ALLTRIM(m_cfg[12])+'HRB.REL'
                ELSE
                        IF mimp_tipo = 1 .AND. ! EMPTY(mens)
                                IF msenha_lib = 'IMP_2VIAPED'
                                        IF ! ver_nivel('IMP_ARQ2VIA','" IMPRESSAO " DA 2a.VIA DE PEDIDO','12345',nivel_acess,,'AMBIE')
                                                LOOP
                                        ENDIF
                                ELSE
                                        IF ! aut_sen('Senha de autorizacao '+mens,msenha_lib)
                                                LOOP
                                        ENDIF
                                ENDIF
                        ELSEIF mimp_tipo = 2
                                mtipo_imp := 'M'
                        ELSEIF mimp_tipo = 3
                                mporta := 'PRN '
                                @ lci+08,cci+40 GET imp_arq PICT '@S30!' VALID IF(EMPTY(imp_arq),.F.,.T.)
                                READ
                                IF LASTKEY() = 27
                                        LOOP
                                ENDIF
                        ELSEIF mimp_tipo = 4
                                mporta := 'PRN '
                                imp_arq := SUBSTR(imp_arq,1,LEN(ALLTRIM(imp_arq))-4)+'.XLS'+SPACE(10)
                                @ lci+08,cci+40 GET imp_arq PICT '@S30!' VALID IF(EMPTY(imp_arq),.F.,.T.)
                                READ
                                IF LASTKEY() = 27
                                        LOOP
                                ENDIF
                                marq := ALLTRIM(imp_arq)
                        ENDIF
                ENDIF
                @ lci+9,cci+40 GET mporta_imp PICT '@!' WHEN mimp_tipo = 1 VALID mporta_imp $ 'LPT1,LPT2,LPT3,LPT4,LPT5,COM1,COM2,COM3,COM4,PRN ' .AND. IF(EMPTY(mporta_imp),.F.,.T.)
                @ lci+10,cci+40 GET comp PICT '@!' WHEN comp <> NIL VALID comp $ 'S,N'
                READ
                IF LASTKEY() = 27
                        LOOP
                ENDIF
        //ELSE
        //        mtipo_imp := 'D'
        //        marq := ALLTRIM(m_cfg[12])+'HRB.REL'
        //ENDIF
        IF mimp_tipo > 2
                setcor(3)
                DEVPOS(lci+08,cci+40);DEVOUT(imp_arq)
                setcor(1)
        ENDIF
        op := op_simnao('S','Confirma Impressao/Consulta [S/n]:')
        IF op = 'S'
                wvw_lclosewindow()
                mensagem('Espere o final da impressao !!!')
                IF mimp_tipo = 4
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RETURN .T.
                ENDIF
                SET DEVI TO PRINT
                IF mimp_tipo = 1
                        SET PRINT TO (mporta_imp)
                        IF comp <> NIL .AND. comp = 'S'
                                imprt(mtipo_imp,'P8')
                        ENDIF
                ELSE
                        SET PRINT ON
                        SET PRINT TO (imp_arq)
                ENDIF
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ELSE
                LOOP
        ENDIF
ENDDO
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
wvw_lclosewindow()
RETURN .F.
*************************** f i m *******************************************
*************************
* MENU ALTERACAO FIRMAS
*************************
FUNCTION incl_firma(t)
*******************
LOCAL mprg:='INCL_FIRMA',;
      opcao,mrazao,mfantasia,mend,mbairro,mcidade,mcgc,mserie,mfone,;
      mdataini,mcgc_aux,mlogradouro,mcont_numer,mcont_compl,mcont_bairro,;
      mcont_cep,mcontato,mcont_tel,mnome_cab,;
      lci,cci,lba,cba,tela,minsc,mcep,memail,mcont_cpf,mprodepe,mcodemp,minsc_mun,mcnae,mnumero,mcomplemento,;
      aret:={},m_emp:={}

IF ! ver_nivel(mprg,'INCLUSAO E ALTERACAO DA EMPRESA','1',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF
lci:=cci:=0
lba:=24
cba:=100

mcomplemento := SPACE(10)
mrazao    := SPACE(35)
mfantasia := SPACE(35)
mnome_cab := SPACE(1)
mend      := SPACE(40)
mfone     := SPACE(30)
mbairro   := mcidade   := SPACE(20)
mcep      := SPACE(8)
mcgc      := mcgc_aux  := minsc := SPACE(14)
mserie    := mnumero := SPACE(6)
memail    := SPACE(50)
mdataini  := DATE()

mrazao    := m_set[1,2]
mfantasia := m_set[1,3]
mnome_cab := m_set[1,4]
mend      := m_set[1,5]
mbairro   := m_set[1,8]
mcidade   := m_set[1,9]
mcep      := m_set[1,11]
memail    := m_set[1,13]

IF EMPTY(m_set[1,23])
        mcgc      := mcgc_aux  := SPACE(14)
        mserie    := SPACE(6)
ELSE
        mcgc      := mcgc_aux  := SUBSTR(m_set[1,23],1,14)
        mserie    := SUBSTR(m_set[1,23],15,6)
ENDIF
minsc     := m_set[1,14]
mfone     := m_set[1,12]
mdataini  := m_set[1,16]
mnumero   := m_set[1,6]
mcomplemento := m_set[1,7]
op_tela(lci,cci,lba,cba,' CONFIGURACAO DO SISTEMA P/FIRMA')
WHILE .T.
        opcao = 'S'
        setcor(3)
        @ lci+16,cci TO lci+16,cba
        setcor(1)
        DEVPOS(lci+1,cci+39);DEVOUT('Data de Inicio:')
        DEVPOS(lci+5,cci+2);DEVOUT('Razao Social.........:')
        DEVPOS(lci+6,cci+2);DEVOUT('Nome Fantasia........:')
        DEVPOS(lci+7,cci+2);DEVOUT('Nome p/Cabecalho dos documentos [F]antasia [R]azao:')
        DEVPOS(lci+8,cci+2);DEVOUT('CNPJ.................:')
        DEVPOS(lci+8,cci+45);DEVOUT('Inscricao:')

        DEVPOS(lci+10,cci+2);DEVOUT('Endereco.............:')
        DEVPOS(lci+10,cci+67);DEVOUT('Numero:')
        DEVPOS(lci+10,cci+82);DEVOUT('Compl.:')
        DEVPOS(lci+11,cci+2);DEVOUT('Bairro...............:')
        DEVPOS(lci+12,cci+2);DEVOUT('Cidade ..............:')
        DEVPOS(lci+12,cci+57);DEVOUT('CEP:')
        DEVPOS(lci+13,cci+2);DEVOUT('Telefones e Fax .....:')
        DEVPOS(lci+14,cci+2);DEVOUT('EMAIL................:')
        DEVPOS(lci+15,cci+2);DEVOUT('Serie................:')
        IF t = NIL
                IF cod_operado = '999'
                        DEVPOS(lci+15,cci+25);DEVOUT(mserie)
                ENDIF
        ENDIF
        @ lci+1,cci+55 GET mdataini VALID IF(EMPTY(mdataini),.F.,.T.)
        @ lci+5,cci+25 GET mrazao VALID IF(EMPTY(mrazao),.F.,.T.)
        @ lci+6,cci+25 GET mfantasia VALID IF(EMPTY(mfantasia),.F.,.T.)
        @ lci+7,cci+54 GET mnome_cab PICT '@!' VALID mnome_cab $ 'F,R'
        @ lci+8,cci+25 GET mcgc PICT '@@r 99.999.999/9999-99' VALID IF(VCGC(mcgc),.T.,.F.) WHEN cod_operado = '999'
        @ lci+8,cci+56 GET minsc PICT '@!'

        @ lci+10,cci+25 GET mend
        @ lci+10,cci+74 GET mnumero
        @ lci+10,cci+89 GET mcomplemento
        @ lci+11,cci+25 GET mbairro
        @ lci+12,cci+25 GET mcidade
        @ lci+12,cci+62 GET mcep
        @ lci+13,cci+25 GET mfone
        @ lci+14,cci+25 GET memail
        READ
        IF LASTKEY() = 27
                SET CURSOR ON
                EXIT
        ENDIF
        IF mcgc <> mcgc_aux .OR. cod_operado = '999'
                IF ! EMPTY(mserie)
                        opcao := op_simnao('S','Deseja alterar o No.de Serie:')
                        IF LASTKEY() = 27 .OR. opcao = 'N'
                                EXIT
                        ELSE
                                mserie = ''
                                pegasenha(@mserie,lci+15,cci+25,setcor(1))
                                setcor(1)
                         ENDIF
                ELSE
                        mserie = ''
                        pegasenha(@mserie,lci+15,cci+25,setcor(1))
                ENDIF
        ENDIF
        setcor(1)
        opcao := op_simnao('S','Confirma a Inclusao da Firma:')
        IF opcao = 'N'
                EXIT
        ENDIF
        m_set:={}
        sr_getconnection():exec("SELECT * FROM sacsetup",,.t.,@m_set)
        IF LEN(m_set) = 0
                sr_getconnection():exec('INSERT INTO sacsetup ('+;
                'razao      ,'+;
                'fantasia   ,'+;
                'nome_cab   ,'+;
                'end_firma  ,'+;
                'bairro     ,'+;
                'cidade     ,'+;
                'cep        ,'+;
                'fone       ,'+;
                'email      ,'+;
                'insc       ,'+;
                'dataini    ,'+;
                'serie      ,'+;
                'numero     ,'+;
                'complemento,'+;
                'SR_RECNO   ,'+;
                'SR_DELETED)'+;
                ' VALUES ('+;
                sr_cdbvalue(mrazao                                               )+','+; //5
                sr_cdbvalue(mfantasia                                            )+','+; //6
                sr_cdbvalue(mnome_cab                                            )+','+; //7
                sr_cdbvalue(mend                                                 )+','+; //8
                sr_cdbvalue(mbairro                                              )+','+;//9
                sr_cdbvalue(mcidade                                              )+','+;//10
                sr_cdbvalue(mcep                                                 )+','+;//9
                sr_cdbvalue(mfone                                                )+','+;//9
                sr_cdbvalue(memail                                               )+','+;//9
                sr_cdbvalue(minsc                                                )+','+;//9
                sr_cdbvalue(mdataini                                             )+','+;//9
                sr_cdbvalue(CRIPTO(ALLTRIM(mcgc),'*')+CRIPTO(ALLTRIM(mserie),'*'))+','+;//9
                sr_cdbvalue(mnumero                                              )+','+;//9
                sr_cdbvalue(mcomplemento                                         )+','+;//9
                sr_cdbvalue(1                                                    )+','+;//9
                sr_cdbvalue(' ')+')',,.f.)
                sr_getconnection():exec('COMMIT',,.f.)
        ELSE
                ccomm := "UPDATE sacsetup SET "
                ccomm := ccomm + " razao      = "+sr_cdbvalue(mrazao                                               )
                ccomm := ccomm + ",fantasia   = "+sr_cdbvalue(mfantasia                                            )
                ccomm := ccomm + ",nome_cab   = "+sr_cdbvalue(mnome_cab                                            )
                ccomm := ccomm + ",end_firma  = "+sr_cdbvalue(mend                                                 )
                ccomm := ccomm + ",bairro     = "+sr_cdbvalue(mbairro                                              )
                ccomm := ccomm + ",cidade     = "+sr_cdbvalue(mcidade                                              )
                ccomm := ccomm + ",cep        = "+sr_cdbvalue(mcep                                                 )
                ccomm := ccomm + ",fone       = "+sr_cdbvalue(mfone                                                )
                ccomm := ccomm + ",email      = "+sr_cdbvalue(memail                                               )
                ccomm := ccomm + ",insc       = "+sr_cdbvalue(minsc                                                )
                ccomm := ccomm + ",dataini    = "+sr_cdbvalue(mdataini                                             )
                ccomm := ccomm + ",numero     = "+sr_cdbvalue(mnumero                                              )
                ccomm := ccomm + ",complemento= "+sr_cdbvalue(mcomplemento                                         )
                ccomm := ccomm + ",serie      = "+sr_cdbvalue(CRIPTO(ALLTRIM(mcgc),'*')+CRIPTO(ALLTRIM(mserie),'*'))
                ccomm := ccomm + " WHERE sr_recno = 1"
                sr_getconnection():exec(ccomm,,.f.)
                sr_getconnection():exec('COMMIT',,.f.)
        ENDIF
        // Atualizando a matriz m_set (SACSETUP->Configuracoes)
        m_set:={}
        sr_getconnection():exec("SELECT * FROM sacsetup",,.t.,@m_set)
        m_set[1,23] := DCRIPTO(SUBSTR(m_set[1,23],1,14))+DCRIPTO(SUBSTR(m_set[1,23],15,6))
        EXIT
ENDDO
wvw_lclosewindow()
RETURN .T.
************************ F I M ***********************************************
***************************************
* FUNCAO PARA INICIALIZACAO DO SISTEMA
***************************************
FUNCTION inicializa()
*************************
LOCAL msenha,mnivel,mcod_op,msele,morde,mmen,mcor,mdir,;
      mnum_term:='001',marquivo:=' '

mcor := SETCOLOR()
IF FILE(curdrive()+':\HRBCFG.INI')
        RETURN NIL
ELSE
        op_tela(10,10,13,90)
        WHILE .T.
                setcor(1)
                msenha = SPACE(21)
                DEVPOS(00,00);DEVOUT('Numero de Serie...:')
                DEVPOS(00,30);DEVOUT('Data do Computador:')
                DEVPOS(01,00);DEVOUT('Codigo de ACESSO..:')
                setcor(3)
                DEVPOS(00,20);DEVOUT(ver_serie())
                DEVPOS(00,50);DEVOUT(DATE())
                setcor(1)
                WVW_DrawBoxGet(,01,20,21)

                @ 01,20 GET msenha
                READ
                IF LASTKEY() = 27
                        EXIT
                ENDIF
                setcor(1)
*               IF msenha == '19681966'
                IF ALLTRIM(msenha) == '9239'+ALLTRIM(ver_serie())+SUBSTR(DTOC(DATE()),1,2)+SUBSTR(DTOC(DATE()),7,2)+SUBSTR(DTOC(DATE()),4,2)+'92441';
                   .OR. ALLTRIM(msenha) == '9239'+ALLTRIM(ver_serie())+SUBSTR(DTOC(DATE()),1,2)+SUBSTR(DTOC(DATE()),7,2)+SUBSTR(DTOC(DATE()),4,2)+'92440'
                        IF SUBSTR(ALLTRIM(msenha),LEN(ALLTRIM(msenha)),1) = '1'
                                IF VAL(m_set[1,8]) <= 0
                                        atencao('Nao e possivel Incluir mais este terminal, Nao tem ACESSO DISPONIVEL, Favor entrar em contato com a HRB Sistemas')
                                        EXIT
                                ENDIF

                                sr_getconnection():exec("UPDATE sacsetup SET impress = "+sr_cdbvalue(STRZERO(VAL(m_set[1,8]) - 1,3)),,.f.)
                                sr_getconnection():exec("COMMIT",,.f.)
                                m_set:={}
                                sr_getconnection():exec("SELECT * FROM sacsetup",,.t.,@m_set)
                                m_set[1,123] := DCRIPTO(SUBSTR(m_set[1,123],1,14))+DCRIPTO(SUBSTR(m_set[1,123],15,6))
                        ENDIF
                        WVW_DrawBoxGet(,02,20,3)
                        SET DEVI TO PRINT
                        SET PRINT ON
                        SET PRINT TO (curdrive()+':\HRBCFG.INI')
                        DEVPOS(00,00);DEVOUT(mnum_term)
                        DEVPOS(01,00);DEVOUT(' ')
                        SET PRINT TO;SET PRINT OFF;SET DEVI TO SCREEN
                        wvw_lclosewindow()
                        RETURN .T.
                ELSE
                        atencao('Codigo de Acesso nao e valido...')
                        LOOP
                ENDIF
        ENDDO
        op_tela(00,00,24,79)
        setcor(5)
        DEVPOS(01,1);DEVOUT('ÚÛÛÛÚÛÛÛ ÚÛÛÛÛÛÛÛ ÚÛÛÛÛÛÛÛ')
        DEVPOS(02,1);DEVOUT('³ÛÛÛ³ÛÛÛ ³ÛÛÛ¿ÛÛÛ ³ÛÛÛ¿ÛÛÛ')
        DEVPOS(03,1);DEVOUT('³ÛÛÛÛÛÛÛ ³ÛÛÛÛÛÛÛ ³ÛÛÛÛÛÛÙ')
        DEVPOS(04,1);DEVOUT('³ÛÛÛ¿ÛÛÛ ³ÛÛÛ¿ÛÛÙ ³ÛÛÛ¿ÛÛÛ')
        DEVPOS(05,1);DEVOUT('³ÛÛÛ³ÛÛÛ ³ÛÛÛ³ÛÛÛ ³ÛÛÛÛÛÛÛ')
        DEVPOS(06,1);DEVOUT('ÀÄÄÙÀÄÄÙ ÀÄÄÙÀÄÄÙ ÀÄÄÄÄÄÄÙ')
        DEVPOS(07,1);DEVOUT(' Sistemas de Informatica  ')
        SETCOLOR('n/W,X')
        DEVPOS(01,10);DEVOUT('ÚÛÛÛÛÛÛÛ')
        DEVPOS(02,10);DEVOUT('³ÛÛÛ¿ÛÛÛ')
        DEVPOS(03,10);DEVOUT('³ÛÛÛÛÛÛÛ')
        DEVPOS(04,10);DEVOUT('³ÛÛÛ¿ÛÛÙ')
        DEVPOS(05,10);DEVOUT('³ÛÛÛ³ÛÛÛ')
        DEVPOS(06,10);DEVOUT('ÀÄÄÙÀÄÄÙ')
        setcor(1)
        @ 04,29 SAY 'Copia Exclusiva: '
        @ 05,29 SAY '___________________________________________'
        setcor(5)
        DEVPOS(04,46);DEVOUT(memp_resa)
        setcor(3)
        @ 07,28 to 12,74 double
        DEVPOS(08,30);DEVOUT('Rua Ten. Joao Cicero, 415 - Sl.05 - Boa Viagem')
        DEVPOS(09,30);DEVOUT('Recife - PE. - Fone: (81)3755.1489')
        DEVPOS(10,30);DEVOUT('Ze Helio:(81)9239.9698 - Camilla:(81)9171.5365')
        DEVPOS(11,30);DEVOUT('www.hrbsistemas.com.br - e-mail: suporte@hrbsistemas.com.br',setcor(5))
        @ 14,02 to 17,77 double
        SETCOLOR('r/w')
        DEVPOS(15,04);DEVOUT('               C O P I A    I L E G A L   !!!                      ',setcor(3))
        DEVPOS(16,04);DEVOUT('Para Adiquiri o Sistema Ligue (81)3755.1489, Desligue o Computador')
        DEVPOS(20,00);DEVOUT('')
        SETCOLOR('W/N,X')
        apaga_hrb() //apaga o arquivo de controle "HRB.001"
        QUIT
ENDIF
RETURN NIL
********************************** f i m **************************************
* VER NUMERO DA SERIE
*****************************
FUNCTION ver_serie
******************
RETURN SUBSTR(m_set[1,123],15,6)
**************************** F I M ****************************************
* ACHA O IP DA MAQUINA
***************************
FUNCTION GetIp()
****************
LOCAL aHosts,cName,;
      cEstacao:=netname(.f.)
InetInit()
aHosts := InetGetHosts( cEstacao )
IF aHosts == NIL
   aHosts := InetGetAlias( cEstacao )
ENDIF
IF Empty(aHosts)
   aHosts := InetGetAlias( cEstacao )
ENDIF
InetCleanup()
RETURN  ahosts[1 ]
********************************  F I M  ********************************************
* FUNCAO P/CONSULTAR NIVEIS
********************************
FUNCTION f3_nivel(mop)
*****************
LOCAL mprg:='F3_NIVEL',;
      tela,tela1,lci,cci,lba,cba,msele,morde,men,mnivel,mtipo_cons := 'D',mconsulta  := SPACE(30),;
      oconsprod,ocolprod[5],i,nkey,opcao,cons_m := {},point := 0

MEMVAR nivel_acess
IF ! ver_nivel(mprg,'NIVEL DE ACESSOS','1',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF

lci := cci := 0
lba := 25
cba := 95

msele := SELE()
morde := INDEXORD()
*************
IF ! AbriArq('sacconf','conf');RETURN NIL;ENDIF
SELE('conf');ORDSETFOCUS(1)
GO TOP
*************
op_tela(lci,cci,lba,cba,'NIVEL DE ACESSO')
oconsprod := TBROWSEDB(lci,cci,lba-1,cba,'conf')
ocolprod[1] := TBCOLUMNNEW('Descricao',{||conf->descri})
ocolprod[2] := TBCOLUMNNEW('Niveis',{||conf->nivel})
ocolprod[3] := TBCOLUMNNEW('Modulo',{||conf->modulo})
ocolprod[4] := TBCOLUMNNEW('Data Alt.',{||conf->data_alt})
ocolprod[5] := TBCOLUMNNEW('Oper.Alt.',{||conf->oper_alt})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        mensagem('<P>esquisa <ENTER>p/Alterar Niveis  <ESC>Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                CLEAR GETS
                mnivel := conf->nivel
                @ ROW(),63 GET mnivel PICT '9999999999'
*               @ ROW(),COL()+61 GET mnivel PICT '9999999999'
                READ
                IF LASTKEY() <> 27
                        opcao := op_simnao('S','Confirma a Alteracao do Niveis:')
                        IF opcao = 'N'
                                LOOP
                        ELSE
                                BLOQREG()
                                conf->nivel := mnivel
                                conf->data_alt  := mdata_sis
                                conf->oper_alt  := cod_operado
                                DBUNLOCK()
                                DBCOMMIT()
                        ENDIF
                ENDIF
                oconsprod := TBROWSEDB(lci,cci,lba-1,cba,'conf')
                ocolprod[1] := TBCOLUMNNEW('Descricao',{||conf->descri})
                ocolprod[2] := TBCOLUMNNEW('Niveis',{||conf->nivel})
                ocolprod[3] := TBCOLUMNNEW('Modulo',{||conf->modulo})
                ocolprod[4] := TBCOLUMNNEW('Data Alt.',{||conf->data_alt})
                ocolprod[5] := TBCOLUMNNEW('Oper.Alt.',{||conf->oper_alt})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF nkey = 112 .OR. nkey = 80
                op_tela(10,05,31,95,'CONSULTA NIVEL DE ACESSO')
                CLEAR GETS
                WHILE .T.
                        mtipo_cons := 'D'
                        mconsulta  := SPACE(60)
                        limpa(0,0,31,99)
                        mensagem('Digite a Consulta que deseja')
                        setcor(1)
                        DEVPOS(00,01);DEVOUT('Tipo de Pesquisa [D]escricao ou [M]odulo:')
                        DEVPOS(01,01);DEVOUT('Digite o que Deseja.....................:')
                        setcor(3)
                        @ 02,00 TO 02,100
                        DEVPOS(03,01);DEVOUT('Descricao                                                     Nivel      Modulo')
                        @ 04,00 TO 04,100
                        setcor(1)
                        @ 00,44 GET mtipo_cons PICT '@!'
                        @ 01,44 GET mconsulta PICT '@!'
                        READ
                        IF LASTKEY() = 27
                                CLEAR GETS
                                EXIT
                        ENDIF
                        IF EMPTY(mconsulta)
                                LOOP
                        ENDIF
                        cComm  := "SELECT * FROM sacconf WHERE descri IS NOT NULL"
                        IF mtipo_cons = 'D'
                                ccomm := ccomm + " AND descri LIKE "+sr_cdbvalue('%'+ALLTRIM(mconsulta)+'%')
                        ELSE
                                ccomm := ccomm + " AND modulo LIKE "+sr_cdbvalue('%'+ALLTRIM(mconsulta)+'%')
                        ENDIF
                        ccomm := ccomm + " ORDER BY descri"
                        cons_m := {}
                        sr_getconnection():exec(ccomm,,.t.,@cons_m)
                        IF LEN(cons_m) = 0
                                atencao('Nao foi encontrado nenhum Item ...')
                                LOOP
                        ENDIF
                        m_prod := {}
                        m_pos  := {}
                        point  := i := 0
                        FOR i = 1 TO LEN(cons_m)
                                AADD(m_prod,' '+cons_m[i,2];
                                           +' '+cons_m[i,3];
                                           +'  '+cons_m[i,1])
                                AADD(m_pos,cons_m[i,6])
                        NEXT
                        point := ACHOICE(05,01,30,94,m_prod,,,point)
                        DO CASE
                                CASE LASTKEY()=27
                                        LOOP
                                CASE LASTKEY() = 13
                                        *************
                                        SELE('conf');ORDSETFOCUS(1)
                                        GO m_pos[point]
                                        *************
                                        EXIT
                        ENDCASE
                ENDDO
                wvw_lclosewindow()
                oconsprod := TBROWSEDB(lci,cci,lba-1,cba,'conf')
                ocolprod[1] := TBCOLUMNNEW('Descricao',{||conf->descri})
                ocolprod[2] := TBCOLUMNNEW('Niveis',{||conf->nivel})
                ocolprod[3] := TBCOLUMNNEW('Modulo',{||conf->modulo})
                ocolprod[4] := TBCOLUMNNEW('Data Alt.',{||conf->data_alt})
                ocolprod[5] := TBCOLUMNNEW('Oper.Alt.',{||conf->oper_alt})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,nkey)
                        oconsprod := TBROWSEDB(lci,cci,lba-1,cba,'conf')
                        ocolprod[1] := TBCOLUMNNEW('Descricao',{||conf->descri})
                        ocolprod[2] := TBCOLUMNNEW('Niveis',{||conf->nivel})
                        ocolprod[3] := TBCOLUMNNEW('Modulo',{||conf->modulo})
                        ocolprod[4] := TBCOLUMNNEW('Data Alt.',{||conf->data_alt})
                        ocolprod[5] := TBCOLUMNNEW('Oper.Alt.',{||conf->oper_alt})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
CLOSE conf
wvw_lclosewindow()
RETURN NIL
******************************* f i m *********************************************
FUNCTION genkey(mconsulta,nkey,narq)

LOCAL mcon := SPACE(45),mt,mcod:=0,mopc,mavan:=' ',m_consulta:={},;
      m_ponto:={},point:=0,li:=03,ci:=02,la:=22,ca:=90,mtela_gen,mmenu:=' ',;
      mmens,i:=0,mcon1:=SPACE(2),mcon2:=SPACE(45),msele
MEMVAR mpoint
PRIVATE mc_fornece
mt := SAVESCREEN(00,00,24,79)
CLEAR GETS
DO CASE
        CASE nkey = K_UP
                mconsulta:UP()
        CASE nkey = K_DOWN
                mconsulta:DOWN()
        CASE nkey = K_PGUP
                mconsulta:PAGEUP()
        CASE nkey = K_PGDN
                mconsulta:PAGEDOWN()
        CASE nkey = K_LEFT
                mconsulta:LEFT()
        CASE nkey = K_RIGHT
                mconsulta:RIGHT()
        CASE nkey = K_CTRL_PGUP
                mconsulta:GOTOP()
        CASE nkey = K_CTRL_PGDN
                mconsulta:GOBOTTOM()
        CASE nkey = K_ALT_PGUP
                mconsulta:PAGEUP()
                mconsulta:PAGEUP()
        CASE nkey = K_ALT_PGDN
                mconsulta:PAGEDOWN()
                mconsulta:PAGEDOWN()
        CASE nkey = ASC('p') .OR. nkey = ASC('P')
                CLEAR GETS
                IF narq = 'dupr'
                        mopc := mensagem1('Pesquisa: [D]ocumento - [C]od.Cliente - [N]ome Cliente - [P]Data Pg.ou Transf.','D','D,C,N,P')
                        IF mopc = 'D'
                                ORDSETFOCUS(10)
                                mcon := SPACE(10)
                        ELSEIF mopc = 'C'
                                ORDSETFOCUS(2)
                                mcon := SPACE(5)
                        ELSEIF mopc = 'P'
                                ORDSETFOCUS(3)
                                mcon := CTOD('  /  /  ')
                        ELSEIF mopc = 'N'
                                mavan := 'N'
                                ORDSETFOCUS(8)
                                mcon := SPACE(40)
                        ENDIF
                ELSEIF narq = 'ocorr'
                        mopc := mensagem1('Pesquisa: [C]odigo Merc - [D]ata Operacao - [V]Cod. Vendedor - [O]Documento}','C','C,D,V,O')
                        IF mopc = 'C'
                                ORDSETFOCUS(1)
                                mcon := SPACE(5)
                        ELSEIF mopc = 'D'
                                ORDSETFOCUS(2)
                                mcon := CTOD('  /  /  ')
                        ELSEIF mopc = 'V'
                                ORDSETFOCUS(3)
                                mcon := SPACE(3)
                        ELSEIF mopc = 'O'
                                ORDSETFOCUS(4)
                                mcon := SPACE(6)
                        ENDIF
                ELSEIF narq = 'dupp'
                        mopc := mensagem1('Pesquisa: [D]ocumento - [C]od.Cliente - [N]ome Cliente','D','D,C,N')
                        IF mopc = 'D'
                                ORDSETFOCUS(8)
                                mcon := SPACE(10)
                        ELSEIF mopc = 'C'
                                ORDSETFOCUS(2)
                                mcon := SPACE(5)
                        ELSEIF mopc = 'N'
                                ORDSETFOCUS(6)
                                mcon := SPACE(40)
                        ENDIF
                ELSEIF narq = 'totnt'
                        mopc := mensagem1('Pesquisa: [D]ocumento - [E]Data Emissao - [N]ome Cliente','D','D,E,N')
                        IF mopc = 'D'
                                ORDSETFOCUS(7)
                                mcon := SPACE(8)
                        ELSEIF mopc = 'E'
                                ORDSETFOCUS(1)
                                mcon := CTOD('  /  /  ')
                        ELSEIF mopc = 'N'
                                ORDSETFOCUS(8)
                                mcon := SPACE(40)
                        ENDIF
                ELSEIF narq = 'log'
                        mopc := mensagem1('Pesquisa: [C]od.Operador - [A]Cod.Aut. - [L]Data Log - [D]escricao - [P]Cod.produto - Documen[T]o','C','C,A,D,L,P,T')
                        IF mopc = 'C'
                                ORDSETFOCUS(1)
                                mcon := SPACE(3)
                        ELSEIF mopc = 'A'
                                ORDSETFOCUS(2)
                                mcon := SPACE(3)
                        ELSEIF mopc = 'L'
                                ORDSETFOCUS(3)
                                mcon := CTOD('  /  /  ')
                        ELSEIF mopc = 'D'
                                ORDSETFOCUS(5)
                                mcon := SPACE(40)
                        ELSEIF mopc = 'P'
                                ORDSETFOCUS(6)
                                mcon := SPACE(5)
                        ELSEIF mopc = 'T'
                                ORDSETFOCUS(4)
                                mcon := SPACE(10)
                        ENDIF
                ELSEIF narq = 'roma'
                        mopc := mensagem1('Pesquisa: [N]umero Romaneio - [P]No.Pedido - [M]Cod.Motorista','N','N,P,M')
                        IF mopc = 'N'
                                ORDSETFOCUS(1)
                                mcon := SPACE(6)
                        ELSEIF mopc = 'P'
                                ORDSETFOCUS(2)
                                mcon := SPACE(6)
                        ELSEIF mopc = 'M'
                                ORDSETFOCUS(5)
                                mcon := SPACE(4)
                        ENDIF
                ELSEIF narq = 'cid'
                        mavan := 'CID'
                        ORDSETFOCUS(1)
                        mcon := SPACE(20)
                ELSEIF narq = 'cdesp'
                        ORDSETFOCUS(2)
                        mcon := SPACE(25)
                ELSEIF narq = 'sen'
                        ORDSETFOCUS(1)
                        mcon := SPACE(30)
                ENDIF
                setcor(3)
                op_tela(10,10,12,57,' PESQUISAR - p/Avancada: A= e o que deseja')
                setcor(1)
                //WVW_DrawBoxGet(,00,00,LEN(mcon))
                @ 00,00 GET mcon PICT '@!'
                READ
                wvw_lclosewindow()
                IF LASTKEY() = 27
                        CLEAR GETS
                        RETURN .F.
                ENDIF
                IF narq = 'merc'
                        ORDSETFOCUS(3)
                        mavan := 'M'
                ENDIF
                mpoint := RECNO()
                IF (narq = 'totnt' .AND. mopc = 'E');
                   .OR. (mopc = 'D' .AND. narq = 'ocorr');
                   .OR. (mopc = 'P' .AND. narq = 'dupr');
                   .OR. (mopc = 'L' .AND. narq = 'log')
                        IF ! (narq)->(DBSEEK(DTOS(mcon),.T.))
                                atencao('A Pesquisa nao foi realizada com sucesso')
                                GO mpoint
                                CLEAR GETS
                                RETURN .T.
                        ENDIF
                ELSEIF SUBSTR(mcon,1,2) = 'A='  //.AND. narq = 'CLI' .OR. narq = 'FORN' .OR. narq = 'DUPR'
                        mtela_gen:=SAVESCREEN(li,ci,la,ca)
                        mmens:=SAVESCREEN(10,10,12,70)
                        botao(10,10,13,70)
                        setcor(3)
                        DEVPOS(11,11);DEVOUT('Aguarde... Pesquisa Avancada estar sendo Realizada !!!')
                        DEVPOS(12,11);DEVOUT('Registro:')
                        DEVPOS(12,30);DEVOUT('Encontrados:')
                        setcor(1)
*                       SKIP
                        GO TOP
                        i := 0
                        WHILE ! EOF()
                                DEVPOS(12,21);DEVOUT(STRZERO(RECNO(),5))
                                IF mavan = 'N'
                                        IF AT(ALLTRIM(SUBSTR(mcon,3)),dupr->cliente) > 0
                                                AADD(m_consulta,' '+dupr->cliente+' - '+dupr->fornec)
                                                AADD(m_ponto,RECNO())
                                                DEVPOS(12,43);DEVOUT(STRZERO(i++,5))
                                        ENDIF
                                        mmenu := ' Pesquisa Avancada de CONTAS A RECEBER '
                                ENDIF
                                SKIP
                        ENDDO
                        RESTSCREEN(10,10,12,70,mmens)
                        IF LEN(m_consulta) > 0
                                mensagem('<ESC> Retorna  -  <ENTER> p/Confirmar')
                                botao(li,ci,la,ca,,mmenu)
                                setcor(3)
                                DEVPOS(li+1,ci+1);DEVOUT('Descricao')
                                DEVPOS(li+1,ci+44);DEVOUT('Codigo')
*                               DEVPOS(li+1,ci+55);DEVOUT('Saldo')
*                               DEVPOS(li+1,ci+62);DEVOUT('Preco Venda')
                                @ li+2,ci+1 TO li+2,ca-1
                                @ la-2,ci+1 TO la-2,ca-1
                                DEVPOS(la-1,ci+1);DEVOUT('Quantidade Encontrado:'+STRZERO(LEN(m_consulta),5))
                                setcor(1)
                                point := ACHOICE(li+3,ci+1,la-3,ca-1,m_consulta,,,point)
                                DO CASE
                                        CASE LASTKEY()=27
                                                GO mpoint
                                        CASE LASTKEY() = 13
                                                GO m_ponto[point]
                                ENDCASE
                        ELSE
                                atencao(mmenu+' nao foi realizada com sucesso')
                                GO mpoint
                        ENDIF
                        RESTSCREEN(li,ci,la,ca,mtela_gen)
                        CLEAR GETS
                        RETURN .T.
                ELSE
                        IF ! (narq)->(DBSEEK(RTRIM(mcon),.T.))
                                atencao('A Pesquisa nao foi realizada com sucesso')
                                GO mpoint
                                CLEAR GETS
                                RETURN .T.
                        ENDIF
                ENDIF
                CLEAR GETS
                RETURN .T.
        CASE nkey = 286
        CASE nkey = 16
                CLEAR GETS
                ORDSETFOCUS(3)
                mavan := 'M'
                mpoint := RECNO()
                mtela_gen:=SAVESCREEN(li,ci,la,ca)
                mmens:=SAVESCREEN(10,10,12,70)
                botao(10,10,13,70,,' PRODUTOS EM PROMOCAO ')
                setcor(3)
                DEVPOS(11,11);DEVOUT('Aguarde... Pesquisa Avancada estar sendo Realizada !!!')
                DEVPOS(12,11);DEVOUT('Registro:')
                DEVPOS(12,30);DEVOUT('Encontrados:')
                setcor(1)
                GO TOP
                WHILE ! EOF()
                        DEVPOS(12,21);DEVOUT(STRZERO(RECNO(),5))
                        IF EMPTY(merc->promocao)
                                SKIP
                                LOOP
                        ENDIF
                        AADD(m_consulta,' '+merc->merc+' - '+merc->cod_merc+'  '+TRANSFORM(merc->saldo_mer,'9,999.99')+'  '+TRANSFORM(merc->pr_venda-(merc->pr_venda * (merc->promocao/100)),'999,999.99'))
                        AADD(m_ponto,RECNO())
                        DEVPOS(12,43);DEVOUT(STRZERO(i++,5))
                        SKIP
                ENDDO
                IF EMPTY(m_consulta)
                        atencao('Nao existe nenhum PRODUTO em PROMOCAO')
                        GO mpoint
                        CLEAR GETS
                        RETURN .T.
                ENDIF
                RESTSCREEN(10,10,12,70,mmens)
                IF LEN(m_consulta) > 0
                        mensagem('<ESC> Retorna  -  <ENTER> p/Confirmar')
                        botao(li,ci,la,ca,,' PRODUTOS EM PROMOCAO ')
                        setcor(3)
                        DEVPOS(li+1,ci+1);DEVOUT('Descricao')
                        DEVPOS(li+1,ci+44);DEVOUT('Codigo')
                        DEVPOS(li+1,ci+55);DEVOUT('Saldo')
                        DEVPOS(li+1,ci+62);DEVOUT('Preco Venda')
                        @ li+2,ci+1 TO li+2,ca-1
                        @ la-2,ci+1 TO la-2,ca-1
                        DEVPOS(la-1,ci+1);DEVOUT('Quantidade Encontrado:'+STRZERO(LEN(m_consulta),5))
                        setcor(1)
                        point := ACHOICE(li+3,ci+1,la-3,ca-1,m_consulta,,,point)
                        DO CASE
                                CASE LASTKEY()=27
                                        GO mpoint
                                CASE LASTKEY() = 13
                                        GO m_ponto[point]
                        ENDCASE
                ELSE
                        atencao('A Pesquisa nao foi realizada com sucesso')
                        GO mpoint
                ENDIF
                RESTSCREEN(li,ci,la,ca,mtela_gen)
                CLEAR GETS
                RETURN .T.
        CASE nkey = 281 .OR. nkey = 304
                CLEAR GETS
                setcor(3)
                botao(10,10,12,40,,' PESQUISAR P/CODIGO '+IF(nkey=304,'DE BARRA',''))
                setcor(1)
                DEVPOS(11,11);DEVOUT('Codigo:')
                mcon := SPACE(16)
                IF narq = 'merc'
                        mcon := SPACE(14)
                        WVW_DrawBoxGet(,11,19,14)
                        @ 11,19 GET mcon PICT '@!'
                ELSE
                        WVW_DrawBoxGet(,11,19,4)
                        @ 11,19 GET mcod PICT '9999'
                ENDIF
                READ
                RESTSCREEN(00,00,24,79,mt)
                IF LASTKEY() = 27
                        CLEAR GETS
                        RETURN .F.
                ENDIF
                mpoint := RECNO()
                ORDSETFOCUS(1)
                IF narq = 'merc'
                        IF nkey = 304
                                *************
                                ORDSETFOCUS(6);GO TOP
                                *************
                                IF ! merc->(DBSEEK(RTRIM(mcon),.T.))
                                        atencao('Codigo de BARRA nao cadastrado')
                                        ORDSETFOCUS(3)
                                        GO mpoint
                                        CLEAR GETS
                                        RETURN .F.
                                ENDIF
                                CLEAR GETS
                                RETURN .T.
                        ELSEIF narq = 'merc' .AND. (LEN(RTRIM(mcon)) > 5 .OR. VAL(mcon) = 0)
                                *************
                                ORDSETFOCUS(6)
                                *************
                                IF ! merc->(DBSEEK(mcon))
                                        atencao('Codigo de BARRA nao cadastrado')
                                        ORDSETFOCUS(3)
                                        GO mpoint
                                        CLEAR GETS
                                        RETURN .F.
                                ENDIF
                        ELSE
                                mcod := VAL(mcon)
                                IF ! (narq)->(DBSEEK(STRZERO(mcod,5)))
                                        atencao('Nao foi possivel encontrar este produto')
                                        ORDSETFOCUS(3)
                                        GO mpoint
                                        CLEAR GETS
                                        RETURN .F.
                                ENDIF
                        ENDIF
                ELSE
                        IF ! (narq)->(DBSEEK(STRZERO(mcod,4)))
                                atencao('Nao foi possivel encontrar este produto')
                                ORDSETFOCUS(2)
                                GO mpoint
                                CLEAR GETS
                                RETURN .F.
                        ENDIF
                ENDIF
                IF narq = 'merc'  .AND. merc->disp = 'N'
                        atencao('Produto nao estar disponivel para VENDA')
                        ORDSETFOCUS(3)
                        GO mpoint
                        CLEAR GETS
                        RETURN .F.
                ENDIF
                IF narq = 'merc'
                        ORDSETFOCUS(3)
                ELSE
                        ORDSETFOCUS(2)
                ENDIF
                CLEAR GETS
                RETURN .T.
        CASE nkey = 274
        CASE nkey = 290
        CASE nkey = ASC('i') .OR. nkey = ASC('I')
                CLEAR GETS
                RETURN .T.
ENDCASE
CLEAR GETS
RETURN .F.
*************************** F I M ********************************
**#ifdef COM_CALE
FUNCTION CALE      // Rotina para exibir calend rio
*************
LOCAL cale_tela:=SAVESCREEN(0,0,25,79), cor_atual:=SETCOLOR(),;
      col_dia, dia_1, lisu_:=6, cosu_:=58, liin_:=20, coin_:=79,;
      i_, cl_, m_e_s, a_n_o, ult_dia,datac,;
      tbc:={;
             {K_DOWN, {||datac:=datac-30}},;
             {K_UP,   {||datac:=datac+30}},;
             {K_RIGHT,{||datac:=datac+365}},;
             {K_LEFT, {||datac:=datac-365}};
           },x,k,nm,sinal_,arqconf
PRIVATE op_sis:=0,vr_cale
*vr_cale=NOVAPOSI(@lisu_,@cosu_,@liin_,@coin_)                  // posicao atual do calendario
botao(lisu_,cosu_,liin_,coin_)                            // monta tela de apresentacao
@ lisu_+2,cosu_+1 SAY "Do 2a 3a 4a 5a 6a Sa"
@ lisu_+ 9,cosu_+1 SAY REPL("Ä",coin_-cosu_-1)
@ lisu_+10,cosu_+2 SAY " Incrementa o MES"                    // montra teclas disponiveis
@ lisu_+11,cosu_+2 SAY " Decrementa o MES"
@ lisu_+12,cosu_+2 SAY CHR(26)+" Incrementa o ANO"
@ lisu_+13,cosu_+2 SAY CHR(27)+" Decrementa o ANO"
datac := DATE()
WHILE .t.
*        @ lisu_+1,cosu_+1 SAY PADL(TRIM(NMES(datac))+" - "+STR(YEAR(datac)),20)
        dia_1=DOW(datac-DAY(datac)+1)                  // dia da semana do 1o. dia do mes
        cl_=lisu_+3
        @ cl_,cosu_+1 CLEAR TO liin_-6,coin_-1         // limpa area dos dias
        col_dia=1+cosu_+3*(dia_1-1)                    // coluna inicai do 1o. dia do mes
        m_e_s=MONTH(datac)                             // mes
        a_n_o=YEAR(datac)                              // ano
        IF INT(m_e_s/2) = m_e_s/2                      // acha ultimo dia do mes
                ult_dia=IF(m_e_s<8,IF(m_e_s=2,IF(INT(a_n_o/4)=a_n_o/4,29,28),30),31)
        ELSE
                ult_dia=IF(m_e_s<8,31,30)
        ENDI
        FOR i_=1 TO ult_dia                            // imprime os dias
                IF DAY(DATE())=i_                         // se for heje
                        setcor(3,'*')                  // enfatiza
                ENDI
                @ cl_,col_dia SAY PADL(STR(i_,2),2)       // imprime o dia na tela
                setcor(1)                       // retorna a cor normal
                col_dia+=3                                // proxima coluna
                IF dia_1/7=INT(dia_1/7)                   // fim da tela do calendario
                        cl_++ ; col_dia=cosu_+1              // passa para proxima linha
                ENDI
                dia_1++                                   // proximo dia
        NEXT
        x=SETCURSOR(0)                                 // apaga cursor, x=cursor atual
        #ifdef COM_MOUSE
                k=MOUSETECLA(lisu_+10,cosu_+2,liin_-1,cosu_+2)
        #ELSE
                #ifdef COM_TUTOR
                        k=IN_KEY(0)                          // aguarda pressionar tecla
                #ELSE
                        k=INKEY(0)                           // aguarda pressionar tecla
                #endi
        #endi
        SETCURSOR(x)                                   // volta tamanho original do cursor
        nm=ASCAN(tbc,{|ve_a| k=ve_a[1]})               // procura tecla dentro do vetor tbc (e' o CASE)
        IF nm!=0                                       // achou!
                EVAL(tbc[nm,2])                           // portanto, executa a acao...
        ELSE
                IF k=K_ALT_F8                             // muda calendario de posicao
*                        MUDA_PJ(@lisu_,@cosu_,@liin_,@coin_,cale_tela,.t.)
                        sinal_=" "
*                       PUBL &vr_cale.:=STR(lisu_,2)+STR(cosu_,2)
                        &vr_cale.:=STR(lisu_,2)+STR(cosu_,2)
                        SAVE TO (arqconf) ALL LIKE drv*      // salva as coordenadas em disco
                ELSE                                      // tecla sem acao, portanto,
                        EXIT                                 // fora...
                ENDI
        ENDI
ENDDO
RESTSCREEN(0,0,25,79,cale_tela)               // restaura tela e
#ifdef COM_MOUSE
        IF drvmouse                                    // se o mouse esta' ativo
                DO WHIL MOUSEGET(0,0)!=0                  // espera que os botoes sejam
                ENDD                                      // liberados (nao pressionados)
        ENDI
#endi
RETU
**#endi
******************************** F I M *******************************
***********************
* mensagem dos GET'S
***********************
FUNCTION men_get(men_li,men_ci,mensagem,mcol)
WVW_SBSetText(,1,'Mensagem: '+mensagem)
RETURN .T.
******************************* F I M ********************************
***********************
* mensagem dos GET'S
***********************
FUNCTION menget(men_li,men_ci,men)
********************************************
men := RTRIM(men)
IF LEN(men) > 60
        mpos := 60
        ci := 10
ELSEIF LEN(men) < LEN(' MODULO DE LIBERACAO P/SENHA ')
        mpos := LEN(' MODULO DE LIBERACAO P/SENHA ')    //+20
        ci := (80-LEN(' MODULO DE LIBERACAO P/SENHA ')) / 2
ELSE
        mpos := LEN(men)
        ci := (80-LEN(men)) / 2
ENDIF
linhas := MLCOUNT(men,mpos)
li := 12
IF linha <> NIL
        IF linha + linhas + 4 > 24
                li := 24 - (linhas + 4)
        ELSE
                li := linha
        ENDIF
ENDIF
IF mlin <> NIL .AND. mlin < li
        li := mlin
ENDIF
la := li+linhas+4
ca := ci+1+mpos+1
IF ca - ci < 50
        ci := 10
        ca := 70
ENDIF
op_tela(li,ci,la,ca,' MODULO DE LIBERACAO P/SENHA <<Modulo:'+mdl+'>>')
setcor(3)
FOR i = 1 TO  linhas
        LIN := MEMOLINE(men,mpos,i,,)
        DEVPOS(i,00);DEVOUT(PADC(RTRIM(LIN),mpos))
NEXT

botao(men_li,men_ci,la,ca)
WVW_SBSetText(,1,'Mensagem: '+mensagem)
RETURN .T.
******************************* F I M ********************************
***********************
* LIMPA mensagem dos GET'S
***********************
FUNCTION lim_get
WVW_SBSetText(,1,' ')
RETURN .T.
******************************* F I M ********************************
FUNCTION mensagem1(men,mop,mcond,linha,mop_linha,mesc,mmensagem)
**********************
LOCAL linhas,i,lin,li,ci,la,ca,mpos
CLEAR GETS
setcor(1)
men := RTRIM(men)
IF LEN(men) > 60
        mpos := 60
ELSEIF LEN(men) < LEN('Opcao ['+IF(mcond=NIL,'',mcond)+']:')
        mpos := LEN('Opcao ['+IF(mcond=NIL,'',mcond)+']:')
ELSE
        mpos := LEN(men)
ENDIF
linhas := MLCOUNT(men,mpos)
IF mop_linha = NIL
        li := ci := 10
ELSE
        li := mop_linha
        ci := 10
ENDIF
IF linha <> NIL
        IF linha + linhas + 2 > 24
                li := 24 - (linhas + 2)
        ELSE
                li := linha
        ENDIF
ENDIF
la := li+linhas+2
ca := ci+1+mpos+1
op_tela(li,ci,la,ca,'ESCOLHA A OPCAO')
IF mmensagem <> NIL
	mensagem(mmensagem)
ENDIF
IF mop = NIL
        INKEY(0)
        setcor(1)
        wvw_lclosewindow()
        RETURN .T.
ELSE
        i := 0
        FOR i = 1 TO  linhas
                LIN := MEMOLINE(men,mpos,i,,)
                DEVPOS(i,01);DEVOUT(PADC(RTRIM(LIN),mpos))
        NEXT
        setcor(1)
        //WVW_DrawBoxGet(,00,COL()+1,1)
	IF mcond <> NIL
		DEVPOS(ROW()+1,01);DEVOUT('Opcao ['+mcond+']:')
        	IF mcond = ' '
		        @ ROW(),COL()+1 GET mop PICT '@!' VALID IF(EMPTY(mop),.F.,.T.)
		ELSE
		        @ ROW(),COL()+1 GET mop PICT '@!' VALID mop $ mcond .AND. IF(mesc <> NIL .AND. LASTKEY() = 27,.F.,.T.)
		ENDIF
	ELSE
        	DEVPOS(ROW()+1,01);DEVOUT('Opcao:')
	        @ ROW(),COL()+1 GET mop PICT '@!' VALID IF(mesc <> NIL .AND. LASTKEY() = 27,.F.,.T.)
	ENDIF
        READ
        setcor(1)
        wvw_lclosewindow()
        RETURN mop
ENDIF
setcor(1)
wvw_lclosewindow()
RETURN .F.
******************************* F I M ********************************
* FUNCAO PARA PROGRESSAO
***************************
FUNCTION prog(l,c,q,marq,t)
***********************************
LOCAL i
setcor(1)
limpa(l,c,l,c+(80-c))
DEVPOS(l,c+18);DEVOUT('Campos: ')
DEVPOS(l,c);DEVOUT('±±±±±±±±±±')
setcor(3)
DEVPOS(l,c+25);DEVOUT(marq)
DEVPOS(l,c+13);DEVOUT(TRANSFORM(0,'999'))
IF q = 0
        DEVPOS(l,c+13);DEVOUT(TRANSFORM(0,'999'))
        RETURN NIL
ENDIF
i := 0
FOR i = 1 TO q/10
        DEVPOS(l,c);DEVOUT(REPLI('Û',i))
        DEVPOS(l,c+13);DEVOUT(TRANSFORM(i*10,'999'))
NEXT
setcor(1)
RETURN NIL
************************* F I M ******************************
* FUNCAO P/CONSULTAR CLIENTES
********************************
#include "inkey.ch"              // constantes de codigos das teclas
FUNCTION f7_cli(mop)
********************
LOCAL f7lci,f7cci,f7lba,f7cba,f7msele,f7morde,mprg:='F7_CLI',;
      oconsprod,ocolprod[4],f7i,f7nkey,f7opcao,mcodcli,mponto,mmens:='',c_cli:={},m_cli:={},;
      mcidade:=SPACE(20),point:=0,mcpfcnpj,mtelefone,mcolor,f7_contrato,nPBid
MEMVAR mcod_cli
PRIVATE mcompras:=0

IF ! ver_nivel(mprg,'CONSULTA DE CLIENTES','12345',nivel_acess,,'AMBIE')
        RELEASE ALL
        wvw_lclosewindow()
        RETURN NIL
ENDIF

f7lci := f7cci := 0
f7lba := 37
f7cba := 119

f7msele := SELE()
f7morde := INDEXORD()
IF ! AbriArq('mastcli','cli');RETURN NIL;ENDIF
*************
SELE('cli');ORDSETFOCUS(2)
*************
mponto := RECNO()
*************
SELE('cli');ORDSETFOCUS(1)
GO BOTT
mcodcli:=cli->cod_cli
*************
*************
SELE('cli');ORDSETFOCUS(2)
GO mponto
*************
setcor(1)
op_tela(00,01,48,119,memp_resa+SPACE(10)+' CLIENTES            Ult.Cliente:'+mcodcli+'  -  Quantidades: '+TRANSFORM(LASTREC(),'999,999'),,1)

oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba,'cli')
//          1       2      3      4       5       6     7     8      9       10      11     12      13
//mcolor := "B/W*+ , W+/R+ , W*/B , R+/W+ , W*/W+ , RJ/W , W/B , R/N , B+*/W , RW*/W , N+*/W, BG+*/W, RG+*/W"
//oconsprod:colorspec := mcolor

oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP  := CHR(179)
oconsprod:gotopblock({|| dbGoTop()})
oconsprod:gobottomblock({|| dbGoBottom()})
***brw:skipblock({|_1| MOV_PTR(_1)})
oconsprod:skipBlock:= {|nSkip| DbSkipper(nSkip) }

ocolprod[1] := TBCOLUMNNEW('Razao Social',{||cli->razao})
ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||cli->nome})
ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
ocolprod[4] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(cli->cgc),'CNPJ: '+TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99'),'CPF: '+TRANSFORM(cli->cpf,'@@R 999.999.999-99     '))})
f7i:=0
FOR f7i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[f7i])
        //oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")

NEXT
WVW_SetMousePos(,00,00)
WVW_SetMouseMove(,.F.)

WvW_PBSetFont( NIL, "Courier New", 15, 0,)
nPBid := wvw_pbCreate(NIL,39,100,40,115, '[I]-> INCLUIR',NIL,{||mast130()})
WVW_PBEnable( NIL, nPBId, .T. )

WHILE .T.
        exibi_prg('F7_CLI')
        IF mop = '*'
                mensagem('<P>esquisa - <I>nclusao - <ENTER>p/Alterar e Excluir - <C>Pesquisa por Cidade - <ESC>Retornar')
        ELSE
                mensagem('<P>esquisa - <I>nclusao - <C>Pesquisa por Cidade - <E>Pesq.p/Endereco - <ENTER> Confirma - <ESC>Retornar')
        ENDIF
        f7nkey := 0
        WHILE f7nkey == 0         //.AND. ! oconsprod:STABLE
                setcor(1)
                oconsprod:FORCESTABLE()
                //mmens := ver_debito(VAL(cli->cod_cli))
                //botao(f7lba+1,f7cci,f7lba+7,f7cba,,' Detalhe '+IF(cli->bloqueio='S',' *** CREDITO BLOQUEADO *** ',IF(! EMPTY(mmens),mmens,'')))
                botao(f7lba+1,f7cci,48,f7cba)
                setcor(3)
                DEVPOS(f7lba+2,f7cci+1);DEVOUT('End.:')
                DEVPOS(f7lba+2,f7cci+50);DEVOUT(IF(! EMPTY(RTRIM(cli->complemento)),' - Compl.:',''))
                DEVPOS(f7lba+3,f7cci+1);DEVOUT('Bairro:')
                DEVPOS(f7lba+4,f7cci+1);DEVOUT('Cidade:')
                DEVPOS(f7lba+4,f7cci+30);DEVOUT('UF:')
                DEVPOS(f7lba+5,f7cci+1);DEVOUT('Telefone..:')
                DEVPOS(f7lba+6,f7cci+1);DEVOUT('Telefone..:')
                DEVPOS(f7lba+7,f7cci+1);DEVOUT('Observacao:')
                setcor(1)
                DEVPOS(f7lba+2,f7cci+6);DEVOUT(cli->endereco+', '+RTRIM(cli->numero))
                DEVPOS(f7lba+2,f7cci+61);DEVOUT(IF(! EMPTY(RTRIM(cli->complemento)),RTRIM(cli->complemento),''))
                DEVPOS(f7lba+3,f7cci+57);DEVOUT(cli->bairro)
                DEVPOS(f7lba+4,f7cci+8);DEVOUT(cli->cidade)
                DEVPOS(f7lba+4,f7cci+34);DEVOUT(cli->uf)
                DEVPOS(f7lba+5,f7cci+13);DEVOUT(cli->tel1)
                DEVPOS(f7lba+6,f7cci+13);DEVOUT(cli->tel2)
                DEVPOS(f7lba+7,f7cci+13);DEVOUT(cli->obs)
                /*
                IF ver_aniv(VAL(cli->cod_cli),1)
                        setcor(7,'*')
                        DEVPOS(f7lba+9,f7cci+33);DEVOUT(' ANIVERSARIANTE DO MES ')
                ENDIF
                */
                WVW_DrawLabel(,38,85,'C'+cli->cod_cli+'.jpg',,,,, 'terminal',13,4,,,,,)
                botao(39,80,47,97)
                IF FILE(ALLTRIM(m_cfg[60])+'C'+cli->cod_cli+'.jpg')
                        WVW_DrawImage( ,39,80,47,97,m_cfg[60]+'C'+cli->cod_cli+'.jpg',.T.,.F.)
                ELSE
                        WVW_DrawImage( ,39,80,47,97,m_cfg[60]+'C'+cli->cod_cli+'.bmp',.T.,.F.)
                ENDIF
                WVW_DrawLabel(,48,85,'<ALT+F>p/Ampliar',,,,, 'terminal',13,4,,,,,)
                setcor(1)
                f7nkey := INKEY(0)
        ENDDO
        IF f7nkey == K_ESC
                EXIT
        ELSEIF f7nkey = 112 .OR. f7nkey = 80
                op_tela(00,00,33,100,memp_resa+SPACE(40)+' CONSULTA DE CLIENTES ')
                CLEAR GETS
                WHILE .T.
                        mcod_cl         := 0
                        mrazao          := mfantasia := mcidade := mendereco := SPACE(40)
                        mcpfcnpj        := mtelefone := minsc := SPACE(14)
                        limpa(0,0,31,99)
                        mensagem('Digite a descricao ou *descricao p/Pesquisa qualquer lugar da descricao')
                        setcor(1)
                        DEVPOS(00,01);DEVOUT('Codigo Cliente:')
                        DEVPOS(01,01);DEVOUT('Razao Social..:')
                        DEVPOS(02,01);DEVOUT('Nome Fantasia.:')
                        DEVPOS(03,01);DEVOUT('Cidade........:')
                        DEVPOS(04,01);DEVOUT('Endereco......:')
                        DEVPOS(05,01);DEVOUT('CPF/CNPJ......:')
                        DEVPOS(05,32);DEVOUT('Inscricao Est.:')
                        DEVPOS(06,01);DEVOUT('Telefone......:')
                        setcor(3)
                        @ 07,00 TO 07,100
                        DEVPOS(08,01);DEVOUT('Razao Social                             Fantasia                                  Codigo  Cidade                 CPF/CNPJ')
                        @ 09,00 TO 09,100
                        @ 32,00 TO 32,100
                        DEVPOS(33,01);DEVOUT('Total de Clientes:')
                        DEVPOS(33,27);DEVOUT('Tempo da Pesquisa:')
                        setcor(1)
                        @ 00,17 GET mcod_cl PICT '99999'
                        @ 01,17 GET mrazao PICT '@!' WHEN EMPTY(mcod_cl)
                        @ 02,17 GET mfantasia PICT '@!' WHEN EMPTY(mcod_cl)
                        @ 03,17 GET mcidade PICT '@!' WHEN EMPTY(mcod_cl)
                        @ 04,17 GET mendereco PICT '@!' WHEN EMPTY(mcod_cl)
                        @ 05,17 GET mcpfcnpj PICT '@!' WHEN EMPTY(mcod_cl) .AND. EMPTY(mrazao) .AND. EMPTY(mfantasia) .AND. EMPTY(mcidade) .AND. EMPTY(mendereco)  .AND. men_get(0,0,'Digite o CNPJ ou CPF sem pontos e Hifens') VALID  lim_get()
                        @ 05,48 GET minsc PICT '@!' WHEN EMPTY(mcod_cl) .AND. EMPTY(mrazao) .AND. EMPTY(mfantasia) .AND. EMPTY(mcidade) .AND. EMPTY(mendereco)  .AND. men_get(0,0,'Digite a INSCRICAO sem pontos e Hifens') VALID  lim_get()
                        @ 06,17 GET mtelefone PICT '@!' WHEN EMPTY(mcod_cl) .AND. EMPTY(mcpfcnpj) .AND. EMPTY(minsc)
                        READ
                        IF LASTKEY() = 27
                                CLEAR GETS
                                EXIT
                        ENDIF
                        IF EMPTY(mcod_cl) .AND. EMPTY(mrazao) .AND. EMPTY(mfantasia) .AND. EMPTY(mcidade) .AND. EMPTY(mendereco) .AND. EMPTY(mcpfcnpj) .AND. EMPTY(mtelefone) .AND. EMPTY(minsc)
                                LOOP
                        ENDIF
                        mhoras := TIME()
                        cComm  := "SELECT * FROM mastcli WHERE cod_cli IS NOT NULL"
                        IF ! EMPTY(mcod_cl)
                                ccomm := ccomm + " AND cod_cli = "+sr_cdbvalue(STRZERO(mcod_cl,5))
                        ELSE
                                IF ! EMPTY(mcpfcnpj)
                                        mcpfcnpj := STRTRAN(mcpfcnpj,'.','')
                                        mcpfcnpj := STRTRAN(mcpfcnpj,'-','')
                                        mcpfcnpj := STRTRAN(mcpfcnpj,'/','')
                                        IF LEN(ALLTRIM(mcpfcnpj)) < 14
                                                ccomm := ccomm + " AND cpf LIKE "+sr_cdbvalue('%'+ALLTRIM(mcpfcnpj)+'%')
                                        ELSE
                                                ccomm := ccomm + " AND cgc LIKE "+sr_cdbvalue('%'+ALLTRIM(mcpfcnpj)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(minsc)
                                        minsc := STRTRAN(minsc,'.','')
                                        minsc := STRTRAN(minsc,'-','')
                                        minsc := STRTRAN(minsc,'/','')
                                        ccomm := ccomm + " AND insc LIKE "+sr_cdbvalue('%'+ALLTRIM(minsc)+'%')
                                ENDIF
                                IF ! EMPTY(mtelefone)
                                        ccomm := ccomm + " AND (tel1 LIKE "+sr_cdbvalue('%'+ALLTRIM(mtelefone)+'%')+" OR tel2 LIKE "+sr_cdbvalue('%'+ALLTRIM(mtelefone)+'%')+")"
                                ENDIF
                                IF ! EMPTY(mrazao)
                                        IF SUBSTR(mrazao,1,1) = '*'
                                                ccomm := ccomm + " AND razao LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mrazao,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND razao LIKE "+sr_cdbvalue(ALLTRIM(mrazao)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(mfantasia)
                                        IF SUBSTR(mfantasia,1,1) = '*'
                                                ccomm := ccomm + " AND nome LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mfantasia,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND nome LIKE "+sr_cdbvalue(ALLTRIM(mfantasia)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(mcidade)
                                        IF SUBSTR(mcidade,1,1) = '*'
                                                ccomm := ccomm + " AND cidade LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mcidade,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND cidade LIKE "+sr_cdbvalue(ALLTRIM(mcidade)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(mendereco)
                                        IF SUBSTR(mendereco,1,1) = '*'
                                                ccomm := ccomm + " AND endereco LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mendereco,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND endereco LIKE "+sr_cdbvalue(ALLTRIM(mendereco)+'%')
                                        ENDIF
                                ENDIF
                        ENDIF
                        ccomm := ccomm + " ORDER BY razao"
                        cons_m := {}
                        sr_getconnection():exec(ccomm,,.t.,@cons_m)
                        IF LEN(cons_m) = 0
                                atencao('Nao foi encontrado nenhum CLIENTE ...')
                                LOOP
                        ENDIF
                        m_prod := {}
                        m_pos  := {}
                        point  := i := 0
                        DEVPOS(33,20);DEVOUT(STRZERO(LEN(cons_m),5))
                        DEVPOS(33,46);DEVOUT(ELAPTIME(mhoras,TIME()))
                        FOR i = 1 TO LEN(cons_m)
                                AADD(m_prod,' '+cons_m[i,3];
                                           +' '+cons_m[i,4];
                                           +'  '+cons_m[i,2];
                                           +'  '+cons_m[i,24];
                                           +'  '+IF(! EMPTY(cons_m[i,32]),cons_m[i,32],cons_m[i,34]))
                                AADD(m_pos,cons_m[i,141])
                        NEXT
                        point := ACHOICE(10,0,30,100,m_prod,,,point)
                        DO CASE
                                CASE LASTKEY()=27
                                        LOOP
                                CASE LASTKEY() = 13
                                        *************
                                        SELE('cli');ORDSETFOCUS(2)
                                        *************
                                        GO m_pos[point]
                                        EXIT
                        ENDCASE
                ENDDO
                wvw_lclosewindow()
                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba,'cli')
                oconsprod:colorspec :=mcolor
                ocolprod[1] := TBCOLUMNNEW('Razao Social',{||cli->razao})
                ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||cli->nome})
                ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
                ocolprod[4] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(cli->cgc),'CNPJ: '+TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99'),'CPF: '+TRANSFORM(cli->cpf,'@@R 999.999.999-99     '))})
                f7i:=0
                FOR f7i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                        //oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF f7nkey = 73 .OR. f7nkey = 105     // I
                mast130()
                c_cli:={}
                sr_getconnection():exec("SELECT COUNT(*) FROM mastcli",,.t.,@c_cli)
                GO c_cli[1,1]
                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba,'cli')
                oconsprod:colorspec :=mcolor
                ocolprod[1] := TBCOLUMNNEW('Razao Social',{||cli->razao})
                ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||cli->nome})
                ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
                ocolprod[4] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(cli->cgc),'CNPJ: '+TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99'),'CPF: '+TRANSFORM(cli->cpf,'@@R 999.999.999-99     '))})
                f7i:=0
                FOR f7i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                        //oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF f7nkey = 289
                //smedalbum('C',cli->cod_cli,cli->razao,m_cfg[60],m_cfg[5]+'\CLIENTE\')
                //WVW_SetMousePos(,00,00)
                //WVW_SetMouseMove(,.F.)
        ELSEIF f7nkey == K_ENTER
                *************
                SELE('cli');ORDSETFOCUS(2)
                *************
                mcod_cli := VAL(cli->cod_cli)
                IF mop = '*'
                        f7opcao := mensagem1('Deseja <A>lterar <E>xcluir:','A','A,E')
                        IF LASTKEY() = 27
                                LOOP
                        ELSEIF f7opcao = 'A'
                                //mast131()
                        ELSEIF f7opcao = 'E'
                                //mast132()
                        ENDIF
                ELSE
                        CLEAR GETS
                        EXIT
                ENDIF
                setcor(1)
                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba,'cli')
                oconsprod:colorspec :=mcolor
                ocolprod[1] := TBCOLUMNNEW('Razao Social',{||cli->razao})
                ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||cli->nome})
                ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
                ocolprod[4] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(cli->cgc),'CNPJ: '+TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99'),'CPF: '+TRANSFORM(cli->cpf,'@@R 999.999.999-99     '))})
                f7i:=0
                FOR f7i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                        //oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,f7nkey,'cli')
                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba,'cli')
                        oconsprod:colorspec :=mcolor
                        ocolprod[1] := TBCOLUMNNEW('Razao Social',{||cli->razao})
                        ocolprod[2] := TBCOLUMNNEW('Nome Fantasia',{||cli->nome})
                        ocolprod[3] := TBCOLUMNNEW('Cod.',{||cli->cod_cli})
                        ocolprod[4] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(cli->cgc),'CNPJ: '+TRANSFORM(cli->cgc,'@@R 99.999.999/9999-99'),'CPF: '+TRANSFORM(cli->cpf,'@@R 999.999.999-99     '))})
                        f7i:=0
                        FOR f7i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                                //oconsprod:getcolumn(f7i):colorblock=&("{||IF(cli->bloqueio='S',{6,3},{1,3})}")
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f7msele);IF(f7morde>0,ORDSETFOCUS(f7morde),)
RELEASE f7tela,f7tela1,f7lci,f7cci,f7lba,f7cba,f7msele,f7morde,f7men,oconsprod,ocolprod[8],f7i,f7nkey,f7opcao,;
        mcompras:=0
//WVW_PBDestroy( NIL, nPBId )
//WVW_SetMouseMove(,.T.)
wvw_lclosewindow()
IF f7nkey == K_ESC
        RETURN NIL
ELSE
        CLEAR GETS
        RETURN mcod_cli
ENDIF
RETURN NIL
******************************* f i m *********************************************
********************************
* VERIFICA A UF DO ESTADO
********************************
FUNCTION v_uf(ve_uf)
*********************
IF EMPTY(ve_uf) .OR. AT(ve_uf,'AC,AL,AP,AM,BA,CE,ES,GO,MA,MT,MS,MG,PA,PB,PR,PE,PI,RN,RS,RR,RO,RJ,SC,SE,SP,TO,DF,EX') > 0
        RETURN .T.
ELSE
        RETURN .F.
ENDIF
RETURN NIL
*************************** f i m *******************************************
******************************
* PESQUISA O CGC SE EXISTE
******************************
FUNCTION pesq_cgc(ncgc,narq,condicao,pesq_ali)
********************
IF EMPTY(ncgc)
        RETURN .T.
ENDIF
IF ! VCGC(ncgc)
        IF aut_sen('O CNPJ nao confere senha de autorizacao:','LIB_AMB')
                IF LASTKEY() = 27
                        RETURN .F.
                ENDIF
                RETURN .T.
        ENDIF
        RETURN .F.
ENDIF
cons_cgc := {}
sr_getconnection():exec("SELECT * FROM mastcli WHERE cgc = "+sr_cdbvalue(ncgc),,.t.,@cons_cgc)
IF condicao <> NIL .AND. LEN(cons_cgc) > 0
        atencao('CNPJ ja cadastrado...Deseja Incluir mesmo assim')
        RETURN .T.
ENDIF
RETURN .T.
********************************** F I M ***********************************
******************************
* PESQUISA O CPF SE EXISTE
******************************
FUNCTION pesq_cpf(ncpf,narq,condicao)
********************
IF EMPTY(ncpf)
        RETURN .T.
ENDIF
IF SUBSTR(ncpf,10,2) <> GDV2(SUBSTR(ncpf,1,9))
        atencao('C.P.F. nao confere OK !!!')
        RETURN .F.
ENDIF
cons_cpf := {}
sr_getconnection():exec("SELECT * FROM mastcli WHERE cpf = "+sr_cdbvalue(ncpf),,.t.,@cons_cpf)
IF condicao <> NIL .AND. LEN(cons_cpf) > 0
        atencao('C.P.F. ja cadastrado OK !!!')
        RETURN .F.
ENDIF
RETURN .T.
******************************* f i m *********************************************
******************************************
* FUNCAO PARA BLOQUEIO DE ARQUIVO EM REDE
******************************************
FUNCTION bloqarq
***********************
LOCAL vtela
vtela := SAVESCREEN(23,00,23,79)
IF FLOCK()
        RESTSCREEN(23,00,23,79,vtela)
        RETURN (.T.)
ENDIF
mensagem('Aguarde... Tentando Bloquear o Arquivo: '+ALIAS(SELE()))
WHILE LASTKEY() <> 27
        IF FLOCK()
                RESTSCREEN(23,00,23,79,vtela)
                RETURN (.T.)
        ENDIF
ENDDO
RESTSCREEN(23,00,23,79,vtela)
RETURN (.F.)
 ****************************** F I M *****************************************
Function GDV2(xArg1)
********************
Local xVar1,xVar2
xArg1:= Trim(xArg1)
xVar1:= xArg1
xVar2:= gdv1(xVar1)
xVar1:= xVar1+xVar2
Return xVar2+gdv1(xVar1)
************************** F I M ***********************************
Function GDV1(xArg1)
********************
Local xVar1,xVar2,xVar3,xVar4,xVar5,xVar6
xArg1:= Trim(xArg1)
xVar1:= xArg1
xVar2:= Len(xVar1)
xVar5:= xVar6:= 0

Do While (xVar6 < xVar2)
        xVar6++
        valo_:= Val(SubStr(xVar1,xVar2+1-xVar6,1))*(xVar6+1)
        xVar5:= xVar5+valo_
EndDo
xVar3:= xVar5%11
dvc_:= IIf(xVar3 < 2,0,11-xVar3)
Return LTrim(Str(dvc_,1))
******************************* f i m *********************************************
*************************
* VER CIDADE
*************************
FUNCTION ver_cidade(mcid,t)
*********************
LOCAL cid_sele,cid_orde
cid_sele := SELE()
cid_orde := INDEXORD()
********************
SELE('cid');ORDSETFOCUS(1)
GO TOP
********************
cid->(DBSEEK(mcid))
IF t = .T.
        IF FOUND()
                atencao('Cidade ja Cadastrada')
                SELE(cid_sele);ORDSETFOCUS(cid_orde)
                RELEASE cid_sele,cid_orde
                RETURN .F.
        ENDIF
        SELE(cid_sele);ORDSETFOCUS(cid_orde)
        RELEASE cid_sele,cid_orde
        RETURN .T.
ENDIF
IF ! FOUND()
        atencao('Cidade nao Cadastrada em nosso arquivos....')
        SELE(cid_sele);ORDSETFOCUS(cid_orde)
        RELEASE cid_sele,cid_orde
        RETURN .F.
ENDIF
SELE(cid_sele);ORDSETFOCUS(cid_orde)
RELEASE cid_sele,cid_orde
RETURN .T.

****************************  F I M *******************************************
********************************
* FUNCAO P/CONSULTAR MERCADORIAS
********************************
#include "inkey.ch"              // constantes de codigos das teclas

FUNCTION f4_merc(cons,mfab,mvar_atac,mpercentual)
*************************************************
LOCAL f4lci,f4cci,f4lba,f4cba,f4msele,f4morde,f4men,;
      oconsprod,ocolprod[6],i,nkey,f4,lin_br,mopcao:=' ',mprec:=0,mcodmerc,mreg,Local4:='',nPBId

MEMVAR mdata_sis,nivel_acess,mcod_merc,mcod_bc

f4 := '*'
f4lci := f4cci := 0
f4lba := 34
f4cba := 65
f4msele := SELE()
f4morde := INDEXORD()
pula := '*'
op_tela(05,10,53,75,' PRODUTOS   -  Quantd.Reg.: '+TRANSFORM(LASTREC(),'999,999'),'*')
IF ! AbriArq('mastprod','merc');RETURN NIL;ENDIF
*************
SELE('merc');ORDSETFOCUS(2)
mreg := RECNO()
*************
*************
SELE('merc');ORDSETFOCUS(1)
GO BOTT
mcodmerc:=merc->codigo
*************
*************
SELE('merc');ORDSETFOCUS(2)
GO mreg
*************
f4men := SAVESCREEN(MAXROW(),00,MAXROW(),79)
mensagem('<Alt+P>Cod. <Alt+I>nclusao')
IF mpercentual = NIL
        mvar_atac := '1'
        mpercentual:=0
ENDIF
exibi_prg('F4_MERC')
oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-2,f4cba)
ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||merc->descri})
ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->codigo})
ocolprod[3] := TBCOLUMNNEW('Un.',{||merc->unidade})
ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||TRANSFORM(merc->pr_venda,'999,999.99')})
ocolprod[5] := TBCOLUMNNEW('Tipo',{||IF(merc->tipo = 'M','Mat.','Prod')})
ocolprod[6] := TBCOLUMNNEW('Imp.',{||' '+TRANSFORM(merc->porta,'9')})
i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
oconsprod:CARGO := '*****'
//botao(f4lba,f4cci,f4lba+8,f4cba,,' Detalhe do Produto ')
setcor(4)
WvW_PBSetFont( NIL, "Courier New", 15, 0,)
nPBid := wvw_pbCreate(NIL,38,05,39,20, '[ALT+I] INCLUIR',NIL,{||mast110()})
WVW_PBEnable( NIL, nPBId, .T. )

WHILE .T.
        mensagem('<Alt+P>Cod. <ALT+E>Especie <ALT+A>vancada <Alt+I>nclusao <Alt+H>Ajuda')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                setcor(3)
                @ f4lba-1,00 TO f4lba-1,100
                DEVPOS(f4lba,f4cci+1);DEVOUT('Pesquisa:  ')
                @ f4lba+1,00 TO f4lba+1,100
                /*
                DEVPOS(f4lba+1,f4cci+1);DEVOUT(IF(cfg->tip_cod='B','Codigo......','Codigo Barra')+':')
                DEVPOS(f4lba+1,f4cci+32);DEVOUT('Un:')
                DEVPOS(f4lba+1,f4cci+45);DEVOUT('Fab.:')
                DEVPOS(f4lba+2,f4cci+1);DEVOUT('Prc1: ')
                DEVPOS(f4lba+2,f4cci+20);DEVOUT('Prc2: ')
                DEVPOS(f4lba+2,f4cci+39);DEVOUT('Prc3: ')
                DEVPOS(f4lba+2,f4cci+58);DEVOUT('Prc4: ')
                DEVPOS(f4lba+4,f4cci+1);DEVOUT('Aplicacao:')
                setcor(1)
                DEVPOS(f4lba+1,f4cci+16);DEVOUT(IF(cfg->cod_sc='B',merc->codigo,merc->cod_barr))
                DEVPOS(f4lba+1,f4cci+36);DEVOUT(merc->unidade)
                DEVPOS(f4lba+1,f4cci+50);DEVOUT(merc->cod_fab+'-'+LEFT(merc->fabrica,23))
                IF merc->dolar = 'S'
                        mprec := ROUND(IF(mvar_atac='1',merc->pr_venda,merc->pr_venda1)*ver_dolar(mdata_sis),set->aredonda)
                ELSE
                        mprec := IF(mvar_atac='1',merc->pr_venda,merc->pr_venda1)
                ENDIF
                IF ! EMPTY(set->pz_perc1)
                        DEVPOS(f4lba+2,f4cci+7);DEVOUT(TRANSFORM(ROUND(mprec*((set->pz_perc1/100)+1),set->aredonda),ALLTRIM(set->masc_numt)))
                ENDIF
                IF ! EMPTY(set->pz_perc2)
                        DEVPOS(f4lba+2,f4cci+26);DEVOUT(TRANSFORM(ROUND(mprec*((set->pz_perc2/100)+1),set->aredonda),ALLTRIM(set->masc_numt)))
                ENDIF
                IF ! EMPTY(set->pz_perc3)
                        DEVPOS(f4lba+2,f4cci+45);DEVOUT(TRANSFORM(ROUND(mprec*((set->pz_perc3/100)+1),set->aredonda),ALLTRIM(set->masc_numt)))
                ENDIF
                IF ! EMPTY(set->pz_perc4)
                        DEVPOS(f4lba+2,f4cci+64);DEVOUT(TRANSFORM(ROUND(mprec*((set->pz_perc4/100)+1),set->aredonda),ALLTRIM(set->masc_numt)))
                ENDIF
                DEVPOS(f4lba+4,f4cci+11);DEVOUT(merc->aplic0)
                DEVPOS(f4lba+5,f4cci+11);DEVOUT(merc->aplic1)
                DEVPOS(f4lba+6,f4cci+11);DEVOUT(merc->aplic2)
                DEVPOS(f4lba+7,f4cci+11);DEVOUT(merc->aplic3)
                IF ! EMPTY(merc->ref)
                        setcor(3)
                        DEVPOS(f4lba+8,f4cci+1);DEVOUT('Referencia Auxiliar: ')
                        DEVPOS(f4lba+8,f4cci+34);DEVOUT('Loc.: ')
                        setcor(1)
                        DEVPOS(f4lba+8,f4cci+22);DEVOUT(merc->ref)
                        DEVPOS(f4lba+8,f4cci+40);DEVOUT(merc->local)
                ENDIF
                */

                WVW_DrawLabel(,36,45,'P'+merc->codigo+'.jpg',,,,, 'terminal',13,4,,,,,)
                botao(38,42,46,58)
                IF FILE(ALLTRIM(m_cfg[11])+'P'+merc->codigo+'.jpg')
                        WVW_DrawImage( ,38,42,46,58,ALLTRIM(m_cfg[11])+'P'+merc->codigo+'.jpg',.T.,.F.)
                        WVW_DrawLabel(,48,45,'<ALT+F>p/Ampliar',,,,, 'terminal',13,4,,,,,)
                ELSEIF FILE(ALLTRIM(m_cfg[11])+'P'+merc->codigo+'.bmp')
                        WVW_DrawImage( ,38,42,46,58,ALLTRIM(m_cfg[11])+'P'+merc->codigo+'.bmp',.T.,.F.)
                        WVW_DrawLabel(,48,45,'<ALT+F>p/Ampliar',,,,, 'terminal',13,4,,,,,)
                ENDIF
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                mcod_merc := 0
                EXIT
        ELSEIF nkey == 289
                smedalbum('P',merc->codigo,merc->descri,m_cfg[11],m_cfg[1]+'\PRODUTO\')
        ELSEIF nkey == K_ENTER
                mcod_merc := VAL(merc->codigo)
                IF EMPTY(mcod_merc)
                        LOOP
                ENDIF
                IF cons <> NIL
                        mast110(merc->codigo)
                        *************
                        SELE('merc');ORDSETFOCUS(2)
                        *************
                        oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
                        ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||merc->descri})
                        ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->codigo})
                        ocolprod[3] := TBCOLUMNNEW('Un.',{||merc->unidade})
                        ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||TRANSFORM(merc->pr_venda,'999,999.99')})
                        ocolprod[5] := TBCOLUMNNEW('Tipo',{||IF(merc->tipo = 'M','Mat.','Prod')})
                        ocolprod[6] := TBCOLUMNNEW('Imp.',{||' '+TRANSFORM(merc->porta,'9')})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ELSE
                        EXIT
                ENDIF
        ELSEIF nkey = 279
                ORDSETFOCUS(1)
                mast110()
                oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
                ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||merc->descri})
                ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->codigo})
                ocolprod[3] := TBCOLUMNNEW('Un.',{||merc->unidade})
                ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||TRANSFORM(merc->pr_venda,'999,999.99')})
                ocolprod[5] := TBCOLUMNNEW('Tipo',{||IF(merc->tipo = 'M','Mat.','Prod')})
                ocolprod[6] := TBCOLUMNNEW('Imp.',{||' '+TRANSFORM(merc->porta,'9')})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF nkey == -41
                calcu()
        ELSEIF  nkey >= 32 .AND. nkey <= 255
                ORDSETFOCUS(2)
                Local4:= Upper(Local4 + Chr(nkey))
                IF (Len(Local4) > Len(merc->descri))
                        Local4:= Upper(right(Local4, Len(Local4) - 1))
                ENDIF
                @ f4lba, f4cci + (f4cba - f4cci) / 2 - Len(merc->descri) / 2 - 7;
                SAY Local4 color SubStr('g/w,gr+/g', rat(",", 'g/w,gr+/g') + 1)
                set softseek on
                dbSeek(Local4, Nil, Nil)
                set softseek off
                oconsprod:refreshall()
        ELSEIF nkey == 8
                ORDSETFOCUS(2)
                Local4:= Upper(Left(Local4, Len(Local4) - 1))
                @ f4lba, f4cci + (f4cba - f4cci) / 2 - Len(merc->descri) / 2 - 7;
                        SAY Local4 + " " color SubStr('g/w,gr+/g', rat(",", 'g/w,gr+/g') + 1)
                set softseek on
                dbSeek(Local4, Nil, Nil)
                set softseek off
                oconsprod:refreshall()
        ELSE
                IF genkey(oconsprod,nkey,'merc')
                        oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
                        ocolprod[1] := TBCOLUMNNEW('Mercadoria',{||merc->descri})
                        ocolprod[2] := TBCOLUMNNEW('Codigo',{||merc->codigo})
                        ocolprod[3] := TBCOLUMNNEW('Un.',{||merc->unidade})
                        ocolprod[4] := TBCOLUMNNEW(' Preco R$',{||TRANSFORM(merc->pr_venda,'999,999.99')})
                        ocolprod[5] := TBCOLUMNNEW('Tipo',{||IF(merc->tipo = 'M','Mat.','Prod')})
                        ocolprod[6] := TBCOLUMNNEW('Imp.',{||' '+TRANSFORM(merc->porta,'9')})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:CARGO := '*****'
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f4msele);IF(f4morde>0,ORDSETFOCUS(f4morde),)
wvw_lclosewindow()
RETURN .F.
************************** F I M *************************************
********************************
* FUNCAO P/CONSULTAR ALBUM DE CLIENTE
********************************
FUNCTION smedalbum(mletra,mcodfoto,mnomefoto,mcam,mcam1)
*****************
LOCAL alb_tela,alb_tela1,alb_lci,alb_cci,alb_lba,alb_cba,alb_msele,alb_morde,alb_men,;
      ocprod,colprod[1],alb_i,alb_nkey,alb_opcao,mcodcli,mponto,stop:=' '

alb_lci := alb_cci := 0
alb_lba := 22
alb_cba := 15

alb_msele := SELE()
alb_morde := INDEXORD()
USE 'menufoto' ALIAS 'smenu' EXCLUSIVE NEW VIA 'DBFCDX'
*************
SELE('smenu')
BLOQREG()
ZAP
DBUNLOCK()
*************
m_aux1 := DIRECTORY(mcam+mletra+mcodfoto+'*.jpg','D')
m_aux2 := DIRECTORY(mcam+mletra+mcodfoto+'*.bmp','D')
IF LEN(m_aux1)+LEN(m_aux2) = 0
	m_aux1 := DIRECTORY(mcam1+mletra+mcodfoto+'*.jpg','D')
	m_aux2 := DIRECTORY(mcam1+mletra+mcodfoto+'*.bmp','D')
	i := 0
	FOR i = 1 TO LEN(m_aux1)
	        ADIREG()
	        smenu->smenu := mcam1+m_aux1[i,1]
	        smenu->snome := m_aux1[i,1]
	NEXT
	i := 0
	FOR i = 1 TO LEN(m_aux2)
	        ADIREG()
	        smenu->smenu := mcam1+m_aux1[i,2]
	        smenu->snome := m_aux1[i,2]
	NEXT
ELSE
	i := 0
	FOR i = 1 TO LEN(m_aux1)
	        ADIREG()
	        smenu->smenu := mcam+m_aux1[i,1]
	        smenu->snome := m_aux1[i,1]
	NEXT
	i := 0
	FOR i = 1 TO LEN(m_aux2)
	        ADIREG()
	        smenu->smenu := mcam+m_aux1[i,2]
	        smenu->snome := m_aux1[i,2]
	NEXT
ENDIF
//atencao(m_aux1)
DBCOMMIT()
DBUNLOCK()
*************
SELE('smenu')
GO TOP
*************
op_tela(00,00,22,15,'ARQUIVOS')
ocprod := TBROWSEDB(alb_lci,alb_cci,alb_lba-1,alb_cba)
colprod[1] := TBCOLUMNNEW('',{||smenu->snome})
alb_i:=0
FOR alb_i=1 TO LEN(colprod)
        ocprod:ADDCOLUMN(colprod[alb_i])
NEXT
WVW_SetMousePos(,00,00)
WVW_SetMouseMove(,.F.)
WHILE .T.
        exibi_prg('SMEDALBUM')
        mensagem('<ESC>Retornar')
        alb_nkey := 0
        WHILE alb_nkey == 0         //.AND. ! ocprod:STABLE
                ocprod:FORCESTABLE()
                IF mletra = 'C'
                        op_tela(00,17,40,100,'ALBUM DO CLIENTE: '+mcodfoto+'-'+mnomefoto+' - Arquivo: '+smenu->smenu,'1')
                ELSEIF mletra = 'P'
                        op_tela(00,17,40,100,'ALBUM DO PRODUTOS: '+mcodfoto+'-'+mnomefoto+' - Arquivo: '+smenu->smenu,'1')
                ELSEIF mletra = 'R'
                        op_tela(00,17,40,100,'ALBUM DA RACA: '+mcodfoto+'-'+mnomefoto+' - Arquivo: '+smenu->smenu,'1')
                ELSE
                        op_tela(00,17,40,100,'ALBUM: '+mcodfoto+'-'+mnomefoto+' - Arquivo: '+smenu->smenu,'1')
                ENDIF
                WVW_DrawImage( ,00,00,41,83,smenu->smenu,.T.,.F.)
                setcor(1)
                alb_nkey := INKEY(0)
                wvw_lclosewindow()

        ENDDO
        IF alb_nkey == K_ESC
                EXIT
        ELSE
                IF genkey(ocprod,alb_nkey,'smenu')
                        ocprod := TBROWSEDB(alb_lci,alb_cci,alb_lba-1,alb_cba)
                        colprod[1] := TBCOLUMNNEW('Arquivo',{||smenu->snome})
                        alb_i:=0
                        FOR alb_i=1 TO LEN(ocolprod)
                                ocprod:ADDCOLUMN(colprod[alb_i])
                        NEXT
                        ocprod:FORCESTABLE()
                ENDIF
        ENDIF
END
smenu->(DBCLOSEAREA())
SELE(alb_msele);IF(alb_morde>0,ORDSETFOCUS(alb_morde),)
wvw_lclosewindow()
WVW_SetMouseMove(,.T.)
IF alb_nkey == K_ESC
        RELEASE alb_tela,alb_tela1,alb_lci,alb_cci,alb_lba,alb_cba,alb_msele,alb_morde,alb_men,ocprod,ocolprod[8],alb_i,alb_nkey,alb_opcao
        RETURN NIL
ELSE
        RELEASE alb_tela,alb_tela1,alb_lci,alb_cci,alb_lba,alb_cba,alb_msele,alb_morde,alb_men,ocprod,ocolprod[8],alb_i,alb_nkey,alb_opcao
        CLEAR GETS
        RETURN NIL
ENDIF
RETURN NIL
******************************* f i m *********************************************
FUNCTION tira_acento(mpalavra)
******************************
mpalavra := STRTRAN(mpalavra,'Ç','C')
mpalavra := STRTRAN(mpalavra,'ç','C')
mpalavra := STRTRAN(mpalavra,'á','A')
mpalavra := STRTRAN(mpalavra,'Á','A')
mpalavra := STRTRAN(mpalavra,'Ã','A')
mpalavra := STRTRAN(mpalavra,'ã','A')
mpalavra := STRTRAN(mpalavra,'Õ','O')
mpalavra := STRTRAN(mpalavra,'õ','O')
mpalavra := STRTRAN(mpalavra,'º','O')
mpalavra := STRTRAN(mpalavra,'ª','A')
mpalavra := STRTRAN(mpalavra,'','C')
mpalavra := STRTRAN(mpalavra,'','C')
RETURN mpalavra
****************************  F I M *******************************************
********************************
* FUNCAO P/CONSULTAR mesaADORIAS
********************************
#include "inkey.ch"              // constantes de codigos das teclas

FUNCTION f5_mesas()
*****************
LOCAL f4lci,f4cci,f4lba,f4cba,f4msele,f4morde,f4men,;
      oconsprod,ocolprod[3],i,nkey,f4,lin_br,mopcao:=' ',mprec:=0,mcodmesa,mreg,Local4:=''

MEMVAR mdata_sis,nivel_acess,mcod_mesa,mcod_bc

f4 := '*'
f4lci := f4cci := 0
f4lba := 34
f4cba := 79
f4msele := SELE()
f4morde := INDEXORD()
pula := '*'
op_tela(10,10,44,89,' MESAS   -  Quantd.Reg.: '+TRANSFORM(LASTREC(),'999,999'),,1)
IF ! AbriArq('mastmesas','mesa');RETURN NIL;ENDIF
*************
SELE('mesa');ORDSETFOCUS(1)
*************
f4men := SAVESCREEN(MAXROW(),00,MAXROW(),79)

exibi_prg('F5_mesa')
oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-2,f4cba)
ocolprod[1] := TBCOLUMNNEW('Tipo',{||IF(mesa->tipo = 'M','MESA','QUARTO')})
ocolprod[2] := TBCOLUMNNEW('Numero',{||mesa->numero})
ocolprod[3] := TBCOLUMNNEW('Descricao',{||mesa->descri})

i:=0
FOR i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
oconsprod:CARGO := '*****'
//botao(f4lba,f4cci,f4lba+8,f4cba,,' Detalhe do Produto ')
setcor(4)
WHILE .T.
        mensagem('<ENTER> p/ Alterar ou Excluir  <I>nclusao  <ESC>p/Retornar')
        nkey := 0
        WHILE nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                nkey := INKEY(0)
        END
        IF nkey == K_ESC
                EXIT
        ELSEIF nkey == K_ENTER
                mast120(mesa->tipo,mesa->numero)
                *************
                SELE('mesa');ORDSETFOCUS(1)
                *************
                oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
                ocolprod[1] := TBCOLUMNNEW('Tipo',{||IF(mesa->tipo = 'M','MESA','QUARTO')})
                ocolprod[2] := TBCOLUMNNEW('Numero',{||mesa->numero})
                ocolprod[3] := TBCOLUMNNEW('Descricao',{||mesa->descri})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF LASTKEY() = 'i' .OR. LASTKEY() = 'I'
                ORDSETFOCUS(1)
                mast120()
                oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
                ocolprod[1] := TBCOLUMNNEW('Tipo',{||IF(mesa->tipo = 'M','MESA','QUARTO')})
                ocolprod[2] := TBCOLUMNNEW('Numero',{||mesa->numero})
                ocolprod[3] := TBCOLUMNNEW('Descricao',{||mesa->descri})
                i:=0
                FOR i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSEIF nkey == -41
                calcu()
        ELSE
                IF genkey(oconsprod,nkey,'mesa')
                        oconsprod := TBROWSEDB(f4lci,f4cci,f4lba-1,f4cba)
                        ocolprod[1] := TBCOLUMNNEW('Tipo',{||IF(mesa->tipo = 'M','MESA','QUARTO')})
                        ocolprod[2] := TBCOLUMNNEW('Numero',{||mesa->numero})
                        ocolprod[3] := TBCOLUMNNEW('Descricao',{||mesa->descri})
                        i:=0
                        FOR i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:CARGO := '*****'
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f4msele);IF(f4morde>0,ORDSETFOCUS(f4morde),)
RELEASE f4tela,f4tela1,f4lci,f4cci,f4lba,f4cba,f4msele,f4morde,f4men,PULA,y,mcod,;
        oconsprod,ocolprod[8],i,nkey,mteste
wvw_lclosewindow()
RETURN .F.
********************************** F I M ***************************************
*********************************************************
* FUNCAO P/CONSULTAR, INCLUIR, ALTERAR E EXCLUIR SENHAS
*********************************************************
FUNCTION sacsenha(mop)
*****************
LOCAL mprg:='SACSENHA',;
      f7tela,f7tela1,f7lci,f7cci,f7lba,f7cba,f7msele,f7morde,f7men,;
      oconsprod,ocolprod[11],f7i,f7nkey,f7opcao,tela1,opcao,mreg,li,ci,lb,cb,;
      mnome := SPACE(30),vsenha1:='',vsenha := '',vnivel1 := SPACE(1),vnivel2 := SPACE(1),;
      mcomissao := 0,mcom_praz := 0,mcom_oper := 0,mcota := 0,mdata_cad,msituacao,;
      mcod_ven,mult_alt,mexpira,vtipo,vtipo_sis,vsen_atual:='',mdoc_apagar:=' ',mestoq_min:=' ',mestoq_med:=0,;
      mcons_inso:={}

MEMVAR mcod_vend

IF ! ver_nivel(mprg,'MENU DE SENHAS','15',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF
setcor(1)
mcod_vend := f7lci := f7cci := 0
f7lba := 24
f7cba := 80

li := ci := 0
lb := 15
cb := 52

op_tela(05,05,29,85,memp_resa+SPACE(50)+" Cadastro de Operadores / Outros ")

f7msele := SELE()
f7morde := INDEXORD()
***********************************************
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
SELE('sen');ORDSETFOCUS(2)
GO TOP
***********************************************

oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
f7i:=0
FOR f7i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[f7i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('<P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        f7nkey := 0
        WHILE f7nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                f7nkey := INKEY(0)
        ENDDO
        IF f7nkey == K_ESC
                mcod_vend := 0
                EXIT
        ELSEIF f7nkey = 73 .OR. f7nkey = 105
                IF ! ver_nivel(mprg,'INCLUSAO DE OPERADORES','1',nivel_acess,,'AMBIE')
                        wvw_lclosewindow()
                        RETURN NIL
                ENDIF
                op_tela(10,10,28,62,' Inclusao ')
                WHILE .T.
                        mcons_inso := {}
                	sr_getconnection():exec("SELECT * FROM insopera WHERE NOT scod_op = '999' AND NOT scod_op = '111' ORDER BY scod_op",,.t.,@mcons_inso)
                        IF LEN(mcons_inso) = 0
                                mcod_vend = 1
                        ELSE
                                mcod_vend = VAL(mcons_inso[LEN(mcons_inso),1]) + 1
                        ENDIF
                        mnome = SPACE(30)
                        vsenha = ''
                        vnivel1 := vnivel2 := vtipo := vtipo_sis := SPACE(1)
                        mcomissao := mcom_praz := mcom_oper := mcota := mexpira := mestoq_med:=0
                        opcao = 'S'
			mdoc_apagar := mestoq_min := ' '
                        setcor(3)
                        @ li+5,ci TO li+5,cb
                        //janela(li+5,ci,' Comissao do Vendedor ','*','*')
                        @ li+7,ci TO li+7,cb
                        //janela(li+7,ci+1,' Comissao do Operador ','*','*')
                        @ li+9,ci TO li+9,cb
                        setcor(1)
                        mensagem('Preencha os Campos - <ESC> p/Retornar')
                        DEVPOS(li+1,ci+2);DEVOUT('Cod.Operador..:')
                        DEVPOS(li+2,ci+2);DEVOUT('Nome..........:')
                        DEVPOS(li+4,ci+2);DEVOUT('Nivel.........:   e  ')
                        DEVPOS(li+6,ci+2);DEVOUT('Comissao (%)..:')
                        DEVPOS(li+6,ci+24);DEVOUT('Comissao Aprazo (%):')
                        DEVPOS(li+8,ci+2);DEVOUT('Comissao (%)..:')
                        DEVPOS(li+10,ci+2);DEVOUT('Cota R$.......:')
                        DEVPOS(li+11,ci+2);DEVOUT('Data..........:')
                        DEVPOS(li+12,ci+2);DEVOUT('SENHA.........:')
                        DEVPOS(li+13,ci+2);DEVOUT('Confirma SENHA:')
                        DEVPOS(li+14,ci+2);DEVOUT('Qtd.dias Expira Senha..........:')
                        @ li+1,ci+18 GET mcod_vend PICT '999' VALID IF(EMPTY(mcod_vend),.F.,.T.)
                        READ
                        IF LASTKEY() = 27
                                EXIT
                        ENDIF
                        mcons_inso := {}
                	sr_getconnection():exec("SELECT * FROM insopera WHERE scod_op = "+sr_cdbvalue(STRZERO(mcod_vend,3)),,.t.,@mcons_inso)
                        IF LEN(mcons_inso) > 0
                                atencao('Codigo ja Existe no cadastro !!!')
                                LOOP
                        ENDIF
                        setcor(3)
                        mdata_cad = mdata_sis
                        DEVPOS(li+1,ci+18);DEVOUT(STRZERO(mcod_vend,3))
                        DEVPOS(li+10,ci+18);DEVOUT(mdata_cad)
                        setcor(1)
                        WVW_DrawBoxGet(,li+2,ci+18,LEN(mnome))
                        WVW_DrawBoxGet(,li+4,ci+18,1)
                        WVW_DrawBoxGet(,li+4,ci+22,1)
                        WVW_DrawBoxGet(,li+6,ci+18,5)
                        WVW_DrawBoxGet(,li+6,ci+45,5)
                        WVW_DrawBoxGet(,li+8,ci+18,5)
                        WVW_DrawBoxGet(,li+10,ci+18,13)
                        WVW_DrawBoxGet(,li+12,ci+18,10)
                        WVW_DrawBoxGet(,li+13,ci+18,10)
                        WVW_DrawBoxGet(,li+14,ci+25,3)
                        WVW_DrawBoxGet(,li+15,ci+35,3)
                        WVW_DrawBoxGet(,li+16,ci+35,1)
                        WVW_DrawBoxGet(,li+17,ci+35,1)
                        @ li+2,ci+18 GET mnome PICT '@!'
                        @ li+4,ci+18 GET vnivel1 PICT '9'      //VALID vnivel $ '1,2,3,4,5,6,7,8,9,0'
                        @ li+4,ci+22 GET vnivel2 PICT '9'      //VALID vnivel $ '1,2,3,4,5,6,7,8,9,0'
                        @ li+6,ci+18 GET mcomissao PICT '99.99'
                        @ li+6,ci+45 GET mcom_praz PICT '99.99'
                        @ li+8,ci+18 GET mcom_oper PICT '99.99'
                        @ li+10,ci+18 GET mcota PICT '99,999,999.99'
                        READ
                        IF LASTKEY() = 27
                                LOOP
                        ENDIF
                        WHILE .T.
                                vsenha := vsenha1 := ''
                                mensagem('Digite sua Senha')
                                pegasenha(@vsenha,li+12,ci+18,setcor(2))
                                setcor(1)
                                IF LEN(vsenha) <= 1 .OR. EMPTY(vsenha)
                                        LOOP
                                ENDIF
                                IF vsenha = 'NAO'
                                        EXIT
                                ENDIF
                                mensagem('Digite Novamente sua Senha')
                                pegasenha(@vsenha1,li+13,ci+18,setcor(2))
                                setcor(1)
                                IF LEN(vsenha1) <= 1
                                        LOOP
                                ENDIF
                                IF vsenha1 = 'NAO'
                                        EXIT
                                ENDIF
				mdoc_apagar := mestoq_min := ' '

                                WVW_DrawBoxGet(,li+14,ci+25,3)
                                @ li+14,ci+35 GET mexpira PICT '999'
                                READ
                                IF vsenha == vsenha1
                                        opcao := op_simnao('S','Confirma a Inclusao do Operador:')
                                        IF opcao = 'N'
                                                EXIT
                                        ELSE
                                                sr_getconnection():exec('INSERT INTO insopera ('+;
                                                        'scod_op,'+;
                                                        'stipo,'+;
                                                        'stipo_sis,'+;
                                                        'snome  ,'+;
                                                        'ssenha      ,'+;
                                                        'sdata_cad ,'+;
                                                        'snivel ,'+;
                                                        'scomissao     ,'+;
                                                        'scom_oper     ,'+;
                                                        'scom_praz,'+;
                                                        'scota,'+;
                                                        'sult_e_c,'+;
                                                        'sexpira,'+;
                                                        'doc_apagar,'+;
                                                        'estoq_min,'+;
                                                        'estoq_med,'+;
                                                        'SR_DELETED )'+;
                                                        ' VALUES ('+;
                                                        sr_cdbvalue(STRZERO(mcod_vend,3))+','+; //1
                                                        sr_cdbvalue(vtipo)+','+; //2
                                                        sr_cdbvalue(vtipo_sis)+','+; //3
                                                        sr_cdbvalue(mnome)+','+; //4
                                                        sr_cdbvalue(CRIPTO(vsenha))+','+; //5
                                                        sr_cdbvalue(mdata_sis)+','+; //6
                                                        sr_cdbvalue(vnivel1+vnivel2)+','+; //7
                                                        sr_cdbvalue(mcomissao)+','+; //7
                                                        sr_cdbvalue(mcom_oper)+','+; //7
                                                        sr_cdbvalue(IF(EMPTY(mcom_praz),mcomissao,mcom_praz))+','+; //7
                                                        sr_cdbvalue(mcota)+','+; //7
                                                        sr_cdbvalue(mdata_sis)+','+; //7
                                                        sr_cdbvalue(mexpira)+','+; //7
                                                        sr_cdbvalue(mdoc_apagar)+','+; //7
                                                        sr_cdbvalue(mestoq_min)+','+; //7
                                                        sr_cdbvalue(mestoq_med)+','+; //7
                                                        sr_cdbvalue(' ')+')',,.f.)
                                                        sr_getconnection():exec("COMMIT",,.f.)

/*
                                                ADIREG()
                                                sen-> scod_op := STRZERO(mcod_vend,3)
                                                sen-> stipo := vtipo
                                                sen-> stipo_sis := vtipo_sis
                                                sen-> snome := mnome
                                                sen-> ssenha := CRIPTO(vsenha)
                                                sen-> sdata_cad := mdata_sis
                                                sen-> snivel := vnivel1+vnivel2
                                                sen-> scomissao := mcomissao
                                                sen-> scom_oper := mcom_oper
                                                IF EMPTY(mcom_praz)
                                                        sen-> scom_praz := mcomissao
                                                ELSE
                                                        sen-> scom_praz := mcom_praz
                                                ENDIF
                                                sen-> scota := mcota
                                                sen-> sult_e_c := mdata_sis
                                                sen-> sexpira  := mexpira
                                                sen-> doc_apagar  := mdoc_apagar
						sen-> estoq_min := mestoq_min
						sen-> estoq_med := mestoq_med
                                                COMMIT
                                                UNLOCK
*/
                                                EXIT
                                        ENDIF
                                ELSE
                                        atencao('Senha Digitada Errada, Tente novamente !!!')
                                        LOOP
                                ENDIF
                        ENDDO
                        *************
                        SELE('sen');ORDSETFOCUS(2)
                        GO TOP
                        *************
                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
                        ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
                        ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
                        ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
                        ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
                        ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
                        ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
                        ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
                        ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
                        ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
                        f7i:=0
                        FOR f7i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                        EXIT
                ENDDO
                wvw_lclosewindow()
        ELSEIF f7nkey == K_ENTER
                mreg := RECNO()
                mcod_ven := VAL(sen->scod_op)
                mcod_vend := VAL(sen->scod_op)
                IF mop = '*'
                        f7opcao := mensagem1('Deseja <A>lterar <E>xcluir:','A','A,E')
                        IF LASTKEY() = 27
                                EXIT
                        ELSEIF f7opcao = 'A'
                                IF ! ver_nivel(mprg,'ALTERACAO DE OPERADORES','1',nivel_acess,,'AMBIE')
                                        EXIT
                                ENDIF
                                IF cod_operado <> '999' .AND. sen->scod_op = '999'
                                        atencao('Nao e possivel alterar este OPERADOR')
                                        EXIT
                                ENDIF
                                //GO mreg
                                CLEAR GETS
                                op_tela(10,10,28,63,' Alteracao ')
                                WHILE .T.
                                        mnome = SPACE(30)
                                        vnivel1 := vnivel2 := vtipo := SPACE(1)
                                        opcao = SPACE(1)
                                        mcomissao := mcom_praz := mcom_oper := ;
                                        mcota := 0
                                        vsenha := vsenha1 := ''
                                        mensagem('Digite o Codigo do Operador a ser Alterado - <ESC> p/Abandonar')
                                        setcor(3)
                                        @ li+5,ci TO li+5,cb
                                        //janela(li+4,ci,' Comissao do Vendedor ','*','*')
                                        @ li+7,ci TO li+7,cb
                                        //janela(li+7,ci+1,' Comissao do Operador ','*','*')
                                        @ li+9,ci TO li+9,cb
                                        setcor(1)
                                        mensagem('Preencha os Campos - <ESC> p/Retornar')
                                        DEVPOS(li+1,ci+2);DEVOUT('Cod.Operador..:')
                                        DEVPOS(li+2,ci+2);DEVOUT('Nome..........:')
                                        DEVPOS(li+3,ci+2);DEVOUT('Tipo..........:')
                                        DEVPOS(li+3,ci+21);DEVOUT('Modulo:')
                                        DEVPOS(li+4,ci+2);DEVOUT('Nivel.........:   e  ')
                                        DEVPOS(li+6,ci+2);DEVOUT('Comissao (%)..:')
                                        DEVPOS(li+6,ci+24);DEVOUT('Comissao Aprazo (%):')
                                        DEVPOS(li+8,ci+2);DEVOUT('Comissao (%)..:')
                                        DEVPOS(li+10,ci+2);DEVOUT('Cota R$.......:')
                                        DEVPOS(li+11,ci+2);DEVOUT('Data..........:')
                                        DEVPOS(li+12,ci+2);DEVOUT('SENHA ATUAL...:')
                                        DEVPOS(li+13,ci+2);DEVOUT('SENHA.........:')
                                        DEVPOS(li+14,ci+2);DEVOUT('Confirma SENHA:')
                                        DEVPOS(li+15,ci+2);DEVOUT('Quantidade de dias Expira Senha:')
		                        DEVPOS(li+16,ci+2);DEVOUT('Alerta Documento Apagar........:')
                		        DEVPOS(li+17,ci+2);DEVOUT('Alerta Estoque Abaixo do Minimo:')
                        		DEVPOS(li+18,ci+2);DEVOUT('Alerta Estoque Media por Dias..:')

                                        vsenha := ''
                                        mnome := sen->snome
                                        vtipo   := sen->stipo
                                        vtipo_sis   := sen->stipo_sis
                                        vnivel1 := SUBSTR(sen->snivel,1,1)
                                        vnivel2 := SUBSTR(sen->snivel,2,1)
                                        mcomissao := sen->scomissao
                                        mcom_praz := sen->scom_praz
                                        mcom_oper := sen->scom_oper
                                        mcota := sen->scota
                                        msituacao := sen->sh_i_c
                                        mexpira   := sen->sexpira
					mdoc_apagar := sen->doc_apagar
					mestoq_min := sen->estoq_min
					mestoq_med := sen->estoq_med
                                        setcor(3)
                                        DEVPOS(li+1,ci+18);DEVOUT(sen->scod_op)
                                        DEVPOS(li+10,ci+18);DEVOUT(sen->sdata_cad )
                                        DEVPOS(li+15,ci+35);DEVOUT(sen->sexpira)
                                        setcor(1)

                                        WVW_DrawBoxGet(,li+2,ci+18,LEN(mnome))
                                        WVW_DrawBoxGet(,li+3,ci+18,LEN(vtipo))
                                        WVW_DrawBoxGet(,li+3,ci+28,LEN(vtipo_sis))
                                        WVW_DrawBoxGet(,li+4,ci+18,1)
                                        WVW_DrawBoxGet(,li+4,ci+22,1)
                                        WVW_DrawBoxGet(,li+6,ci+18,5)
                                        WVW_DrawBoxGet(,li+6,ci+45,5)
                                        WVW_DrawBoxGet(,li+8,ci+18,5)
                                        WVW_DrawBoxGet(,li+10,ci+18,13)
                                        WVW_DrawBoxGet(,li+12,ci+18,10)
                                        WVW_DrawBoxGet(,li+13,ci+18,10)
                                        WVW_DrawBoxGet(,li+14,ci+18,10)
                                        WVW_DrawBoxGet(,li+15,ci+35,3)
                                        WVW_DrawBoxGet(,li+16,ci+35,1)
                                        WVW_DrawBoxGet(,li+17,ci+35,1)
                                        WVW_DrawBoxGet(,li+18,ci+35,3)
                                        @ li+2,ci+18 GET mnome PICT '@!'
                                        @ li+3,ci+18 GET vtipo PICT '@!' VALID vtipo $ 'O,V,G,A,B' .AND. lim_get() WHEN men_get(li+4,ci,'[O]perador - [V]endedor - [G]erente - [A]dministrador - [B]loqueado')
                                        @ li+3,ci+28 GET vtipo_sis PICT '@!' VALID vtipo_sis $ 'S,V,C,M' .AND. lim_get() WHEN men_get(li+4,ci,'[S]iscom - [V]enda - [C]aixa - [M]Caixa/Venda')
                                        @ li+4,ci+18 GET vnivel1 PICT '9'      //VALID vnivel $ '1,2,3,4,5,6,7,8,9,0'
                                        @ li+4,ci+22 GET vnivel2 PICT '9'      //VALID vnivel $ '1,2,3,4,5,6,7,8,9,0'
                                        @ li+6,ci+18 GET mcomissao PICT '99.99'
                                        @ li+6,ci+45 GET mcom_praz PICT '99.99'
                                        @ li+8,ci+18 GET mcom_oper PICT '99.99'
                                        @ li+10,ci+18 GET mcota PICT '99,999,999.99'
                                        READ
                                        IF LASTKEY() = 27
                                                EXIT
                                        ENDIF
                                        opcao := op_simnao('N','Deseja alterar a senha:')
                                        IF LASTKEY() = 27
                                                UNLOCK
                                                LOOP
                                        ENDIF
                                        IF opcao = 'S'
                                                WHILE .T.
                                                        vsen_atual = ''
                                                        vsenha = ''
                                                        vsenha1 = ''
                                                        mensagem('Digite sua Senha ATUAL')
                                                        pegasenha(@vsen_atual,li+12,ci+18,setcor(2))
                                                        IF EMPTY(vsen_atual)
                                                                setcor(1)
                                                                IF ! aut_sen('Senha para Liberar a Alteracao de SENHA: ','LIB_ALTSENHA')
                                                                        LOOP
                                                                ENDIF
                                                                GO mreg
                                                        ELSEIF ALLTRIM(DCRIPTO(sen->ssenha)) <> ALLTRIM(vsen_atual)
                                                                atencao('Senha nao Confere, Digite a Senha Atual...')
                                                                LOOP
                                                        ENDIF
                                                        mensagem('Digite sua Senha')
                                                        pegasenha(@vsenha,li+13,ci+18,setcor(2))
                                                        setcor(1)
                                                        IF LEN(vsenha) <= 1 .OR. EMPTY(vsenha)
                                                                LOOP
                                                        ENDIF
                                                        IF vsenha = 'NAO'
                                                                vsenha := ''
                                                                EXIT
                                                        ENDIF
                                                        mensagem('Digite Novamente sua Senha')
                                                        pegasenha(@vsenha1,li+14,ci+18,setcor(2))
                                                        setcor(1)
                                                        IF LEN(vsenha1) <= 1
                                                                LOOP
                                                        ENDIF
                                                        IF vsenha1 = 'NAO'
                                                                vsenha := ''
                                                                EXIT
                                                        ENDIF
                                                        IF vsenha == vsenha1
                                                                EXIT
                                                        ELSE
                                                                atencao('Senha Digitada Errada, Tente novamente !!!')
                                                                LOOP
                                                        ENDIF
                                                ENDDO
                                        ENDIF
                                        @ li+15,ci+35 GET mexpira PICT '999'
	                                @ li+16,ci+35 GET mdoc_apagar PICT '@!' VALID mdoc_apagar $ ' ,X'
        	                        @ li+17,ci+35 GET mestoq_min PICT '@!' VALID mestoq_min $ ' ,X'
                	                @ li+18,ci+35 GET mestoq_med PICT '999'
                                        READ
                                        opcao := op_simnao('S','Confirma a Alteracao:')
                                        IF opcao = 'N'
                                                LOOP
                                        ELSE
                                                IF ! BLOQREG()
                                                        atencao('Nao foi possivel acessar o Arquivo !!!')
                                                        LOOP
                                                ENDIF
                                                sen-> snome := mnome
                                                sen-> stipo  := vtipo
                                                sen-> stipo_sis  := vtipo_sis
                                                sen-> snivel := vnivel1+vnivel2
                                                sen-> scomissao := mcomissao
                                                sen-> scom_praz := mcom_praz
                                                sen-> scom_oper := mcom_oper
                                                sen-> scota := mcota
                                                sen-> sh_i_c:= msituacao
                                                sen-> sexpira := mexpira
                                                sen-> doc_apagar  := mdoc_apagar
						sen-> estoq_min := mestoq_min
						sen-> estoq_med := mestoq_med
                                                IF ! EMPTY(vsenha)
                                                        sen-> ssenha := CRIPTO(vsenha)
                                                        sen-> sult_e_c:= mdata_sis
                                                ENDIF
                                                DBCOMMIT()
                                                DBUNLOCK()
                                        ENDIF
                                        *************
                                        SELE('sen');ORDSETFOCUS(2)
                                        GO TOP
                                        *************
                                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
                                        ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
                                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
                                        ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
                                        ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
                                        ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
                                        ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
                                        ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
                                        ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
                                        ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
                                        ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
                                        f7i:=0
                                        FOR f7i=1 TO LEN(ocolprod)
                                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                                        NEXT
                                        oconsprod:HEADSEP := CHR(196)
                                        oconsprod:COLSEP := CHR(179)
                                        oconsprod:FORCESTABLE()
                                        EXIT
                                ENDDO
                                wvw_lclosewindow()
                        ELSEIF f7opcao = 'E'
                                IF ! ver_nivel(mprg,'EXCLUSAO DE OPERADORES','1',nivel_acess,,'AMBIE')
                                        EXIT
                                ENDIF
                                IF cod_operado <> '999' .AND. sen->scod_op = '999'
                                        atencao('Nao e possivel alterar este OPERADOR')
                                        EXIT
                                ENDIF
                                //GO mreg
                                CLEAR GETS
                                op_tela(00,00,17,53,' Exclusao ')
                                WHILE .T.
                                        mensagem('Digite o Codigo do Operador a ser Alterado - <ESC> p/Abandonar')
                                        setcor(3)
                                        @ li+4,ci TO li+4,cb
                                        //janela(li+4,ci,' Comissao do Vendedor ','*','*')
                                        @ li+6,ci TO li+6,cb
                                        //janela(li+6,ci+1,' Comissao do Operador ','*','*')
                                        @ li+8,ci TO li+8,cb
                                        mensagem('Preencha os Campos - <ESC> p/Retornar')
                                        DEVPOS(li+1,ci+2);DEVOUT('Cod.Operador..:')
                                        DEVPOS(li+2,ci+2);DEVOUT('Nome..........:')
                                        DEVPOS(li+3,ci+2);DEVOUT('Nivel.........:   e')
                                        DEVPOS(li+5,ci+2);DEVOUT('Comissao (%)..:')
                                        DEVPOS(li+5,ci+24);DEVOUT('Comissao Aprazo (%):')
                                        DEVPOS(li+7,ci+2);DEVOUT('Comissao (%)..:')
                                        DEVPOS(li+9,ci+2);DEVOUT('Cota R$.......:')
                                        DEVPOS(li+10,ci+2);DEVOUT('Data..........:')
                                        DEVPOS(li+11,ci+2);DEVOUT('SENHA.........:')
                                        DEVPOS(li+12,ci+2);DEVOUT('Confirma SENHA:')

                                        vnivel1 := SUBSTR(sen->snivel,1,1)
                                        vnivel2 := SUBSTR(sen->snivel,2,1)
                                        setcor(3)
                                        DEVPOS(li+1,ci+18);DEVOUT(STRZERO(mcod_vend,3))
                                        DEVPOS(li+10,ci+18);DEVOUT(sen->sdata_cad)
                                        DEVPOS(li+2,ci+18);DEVOUT(sen->snome)
                                        DEVPOS(li+3,ci+18);DEVOUT(vnivel1)
                                        DEVPOS(li+3,ci+22);DEVOUT(vnivel2)
                                        DEVPOS(li+5,ci+18);DEVOUTPICT(sen->scomissao,'99.99')
                                        DEVPOS(li+5,ci+45);DEVOUTPICT(sen->scom_praz,'99.99')
                                        DEVPOS(li+7,ci+18);DEVOUTPICT(sen->scom_oper,'99.99')
                                        DEVPOS(li+9,ci+18);DEVOUTPICT(sen->scota,'99,999,999.99')
                                        setcor(1)
                                        opcao := op_simnao('N','Deseja a Exclusao do Operador:')
                                        IF opcao = 'N'
                                                EXIT
                                        ENDIF
                                        IF opcao = 'S'
                                                IF ! BLOQREG()
                                                        atencao('Nao foi possivel acessar o Arquivo !!!')
                                                        LOOP
                                                ENDIF
                                                DELE
                                                DBCOMMIT()
                                                DBUNLOCK()
                                                sr_getconnection():exec("DELETE FROM insopera WHERE SR_DELETED = 'T'",,.f.)
                                                sr_getconnection():exec("COMMIT",,.f.)
                                        ENDIF
                                        *************
                                        SELE('sen');ORDSETFOCUS(2)
                                        GO TOP
                                        *************
                                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
                                        ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
                                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
                                        ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
                                        ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
                                        ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
                                        ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
                                        ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
                                        ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
                                        ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
                                        ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
                                        f7i:=0
                                        FOR f7i=1 TO LEN(ocolprod)
                                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                                        NEXT
                                        oconsprod:HEADSEP := CHR(196)
                                        oconsprod:COLSEP := CHR(179)
                                        oconsprod:FORCESTABLE()
                                        EXIT
                                ENDDO
                                wvw_lclosewindow()
                        ENDIF
                ELSE
                        CLEAR GETS
                        EXIT
                ENDIF
                *************
                SELE('sen');ORDSETFOCUS(2)
                GO TOP
                *************
                oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
                ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
                ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
                ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
                ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
                ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
                ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
                ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
                ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
                ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
                ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
                f7i:=0
                FOR f7i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f7i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,f7nkey,'sen')
                        *************
                        SELE('sen');ORDSETFOCUS(2)
                        GO TOP
                        *************
                        oconsprod := TBROWSEDB(f7lci,f7cci,f7lba-1,f7cba)
                        ocolprod[1] := TBCOLUMNNEW('Codigo',{||sen->scod_op})
                        ocolprod[2] := TBCOLUMNNEW('Nome',{||sen->snome})
                        ocolprod[3] := TBCOLUMNNEW('Tipo',{||sen->stipo})
                        ocolprod[4] := TBCOLUMNNEW('Modulo',{||sen->stipo_sis})
                        ocolprod[5] := TBCOLUMNNEW('Nivel',{||SUBSTR(sen->snivel,1,1)+' e '+SUBSTR(sen->snivel,2,1)})
                        ocolprod[6] := TBCOLUMNNEW('Data Cad.',{||sen->sdata_cad})
                        ocolprod[7] := TBCOLUMNNEW('Dias Expira',{||sen->sexpira})
                        ocolprod[8] := TBCOLUMNNEW('Comissao Av.',{||TRANSFORM(sen->scomissao,'999.99')+'%'})
                        ocolprod[9] := TBCOLUMNNEW('Comissao Ap.',{||TRANSFORM(sen->scom_praz,'999.99')+'%'})
                        ocolprod[10] := TBCOLUMNNEW('Comi.Operado',{||TRANSFORM(sen->scom_oper,'999.99')+'%'})
                        ocolprod[11] := TBCOLUMNNEW('Cota R$',{||TRANSFORM(sen->scota,'999,999.99')+'%'})
                        f7i:=0
                        FOR f7i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[f7i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f7msele);IF(f7morde>0,ORDSETFOCUS(f7morde),)
wvw_lclosewindow()
IF f7nkey == K_ESC
        RELEASE ALL
        RETURN mcod_ven
ELSE
        RELEASE ALL
        RETURN mcod_ven
ENDIF
RETURN NIL
**************************** F I M ******************************************
***********************
FUNCTION v_fornece(vcod,li,ci,p,loc)
***********************
LOCAL msele,morde
MEMVAR mfornece

msele := SELE()
morde := INDEXORD()
IF EMPTY(vcod)
        mfornece := space(40)
        RETURN .T.
ENDIF
IF ! AbriArq('mastforn','forn');RETURN NIL;ENDIF
*************
SELE('forn');ORDSETFOCUS(1)
GO TOP
*************
IF ! forn->(DBSEEK(STRZERO(vcod,4)))
        IF p = NIL
                atencao('Codigo Fornecedor nao Existe no Arquivo !!!')
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ELSE
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                IF loc <> NIL;RETURN forn->cpostal;ENDIF
                RETURN .T.
        ENDIF
ELSE
        IF li = NIL .AND. ci = NIL
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                IF loc <> NIL;RETURN forn->cpostal;ENDIF
                RETURN .T.
        ENDIF
        setcor(3)
        DEVPOS(li,ci);DEVOUT(forn->razao)
        setcor(1)
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF loc <> NIL;RETURN forn->cpostal;ENDIF
        RETURN .T.
ENDIF
RETURN .T.
******************************* f i m *********************************************
* VERIFICA CARTAO DE CREDITO
****************************
FUNCTION ver_cartao(mcod,li,ci,t)
*********************************
LOCAL msele,morde,ver_cartao:={}
MEMVAR mdesc_cart,mprazo_cart,mcartao
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('mastcarta','car');RETURN NIL;ENDIF
IF EMPTY(mcod) .AND. t = NIL
        RETURN .T.
ENDIF
*************
SELE('car');ORDSETFOCUS(2)
GO TOP
*************
IF ! car->(DBSEEK(STRZERO(mcod,3)))
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF li <> NIL
                atencao('Cartao nao Cadastrado !!!')
                setcor(3)
                DEVPOS(li,ci);DEVOUT(' - '+SPACE(20))
                setcor(1)
                RETURN .F.
        ENDIF
        RETURN 'CARTAO NAO IDENTIFICADO'
ENDIF
IF li <> NIL
        mdesc_cart := car->desconto
        mprazo_cart := car->prazo
        mcartao := car->cartao
        setcor(3)
        DEVPOS(li,ci);DEVOUT(' - '+mcartao)
        setcor(1)
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN car->cartao
*********************** f i m ************************************
#INCLUDE "wingdi.ch"
#INCLUDE "winuser.ch"
FUNCTION SUB_BANNER(LIN,COL,STRING,VCOR)
****************************************
//Wvw_DrawLabel( ,lin,col, string,2,0 , rgb(0,0,255), rgb(198,198,198), 'Arial Black',30,35 , , , , , )
DEVPOS(lin,col);DEVOUT("")
IF vcor = NIL
        WVW_DrawLabel(,lin,col,string,,,,, 'Arial Black',80,40,,,,,)
ELSE
        WVW_DrawLabel(,lin,col,string,,,240,, 'Arial Black',80,40,,,,,)
ENDIF
//WVW_DrawLabel(,lin,col,string,,,,, 'Arial Black',90,50,,PROOF_QUALITY )
//WVW_DrawLabel(,lin,col,string,,,,,"Courier new",90,50,,PROOF_QUALITY )
RETURN NIL
*********************** F I M **************************************
***********************
FUNCTION ver_cli(vcod,li,ci,p)
***********************
LOCAL msele,morde
MEMVAR mcliente,mcpf,mcgc

msele := SELE()
morde := INDEXORD()

IF EMPTY(vcod)
        mcliente := SPACE(40)
        RETURN .T.
ENDIF
IF ! AbriArq('mastcli','cli');RETURN NIL;ENDIF
*************
SELE('cli');ORDSETFOCUS(1)
GO TOP
*************
SEEK STRZERO(vcod,5)
IF ! FOUND()
        IF p = NIL
                atencao('Codigo Cliente nao Existe no Arquivo !!!')
                vcod := 0
                mcliente := SPACE(40)
                vcid := ' '
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ELSE
                mcliente := SPACE(40)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF
ELSE
        IF li = NIL .AND. ci = NIL
                mcliente := cli->razao
                mcpf := cli->cpf
                mcgc := cli->cgc
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
        mcliente := cli->razao
        mcpf := cli->cpf
        mcgc := cli->cgc
        vcid  := cli->cidade
        setcor(3)
        DEVPOS(li,ci);DEVOUT(cli->razao)
        setcor(1)
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
********************************* f i m ******************************************
******************************
* VERIFICA O CPF
******************************
FUNCTION ver_cpf(ncpf)
********************
LOCAL msele,morde,opcao := 'S'
MEMVAR mcgc,mcpf,mcod_cli,mcliente
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('mastcli','cli');RETURN NIL;ENDIF
WHILE .T.
        IF EMPTY(ncpf)
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .T.
        ENDIF
        *****************
        SELE('cli');ORDSETFOCUS(4)
        GO TOP
        *****************
        IF SUBSTR(ncpf,10,2) <> GDV2(SUBSTR(ncpf,1,9))
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                RETURN .F.
        ENDIF

        IF ! cli->(DBSEEK(ncpf))
                CLEAR GETS
                opcao := op_simnao('S','C.P.F nao cadastrado...Deseja Cadastra [S/n]:')
                IF opcao = 'N'
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RETURN .F.
                ELSE
                        mast130(mcpf,mcgc)
                        CLEAR TYPEAHEAD
                        LOOP
                ENDIF
        ENDIF
        mcod_cli := VAL(cli->cod_cli)
        mcliente := cli->razao
        mcgc := cli->cgc
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDDO
RETURN NIL
******************************* f i m *********************************************
******************************
* VERIFICA O CGC
******************************
FUNCTION ver_cgc(ncgc)
********************
LOCAL msele,morde,opcao := 'S'
MEMVAR mcgc,mcpf,mcod_cli,mcliente

msele := SELE()
morde := INDEXORD()
IF ! AbriArq('mastcli','cli');RETURN NIL;ENDIF
WHILE .T.
        IF EMPTY(ncgc)
                RETURN .T.
        ENDIF
        IF ! VCGC(ncgc)
                IF aut_sen('O CNPJ nao confere senha de autorizacao:','LIB_AMB')
                        RETURN .T.
                ENDIF
                RETURN .F.
        ENDIF
        *****************
        SELE('cli');ORDSETFOCUS(3)
        GO TOP
        *****************

        IF ! cli->(DBSEEK(ncgc))
                CLEAR GETS
                opcao := op_simnao('S','CNPJ nao cadastrado...Deseja Cadastra [S/n]:')
                IF opcao = 'N'
                        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                        RETURN .F.
                ELSE
                        mast130(mcpf,mcgc)
                        CLEAR TYPEAHEAD
                        LOOP
                ENDIF
        ENDIF
        mcod_cli := VAL(cli->cod_cli)
        mcliente := cli->razao
        mcpf := cli->cpf
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDDO
RETURN NIL
********************************** F I M ***********************************
FUNCTION ver_ven(mcod_ven,p,tip)
********************
LOCAL men,msele,morde,point,mnome
msele := SELE()
morde := INDEXORD()
point := RECNO()
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
IF tip <> NIL
        IF mcod_ven = '000';RETURN .T.;ENDIF
ENDIF
*****************
SELE('sen');ORDSETFOCUS(2)
GO TOP
*****************
IF ! sen->(DBSEEK(mcod_ven))
        IF p = NIL
                atencao('Codigo do OPERADOR/VENDEDOR nao encontrado')
        ENDIF
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ENDIF
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
RETURN .T.
************************************ F I M ************************************
***************
FUNCTION vencim(mv,t,dup,memi,prz_dia,m_doc)
***************
MEMVAR memissao
IF memi = NIL
        memi := memissao
ENDIF
IF prz_dia = NIL
        prz_dia := 0
ENDIF
IF m_doc <> NIL .AND. EMPTY(m_doc) .AND. EMPTY(mv)
        RETURN .T.
ENDIF
IF t = NIL .AND. mv=ctod("  /  /  ")
        atencao('Data de Vencimento deve ser preenchida! [ÄÙ] Continua.')
        RETURN .F.
ENDIF
IF (dup = NIL .OR. ! EMPTY(dup)) .AND. DTOS(mv)<DTOS(memi)
        atencao('Data de Vencimento menor que Data de Emissao! [ÄÙ] Continua.')
        RETURN .F.
ENDIF
IF (dup = NIL .OR. ! EMPTY(dup)) .AND. DTOS(mv) > DTOS((memi+prz_dia+m_set[1,122])) .AND. ! EMPTY(prz_dia) .AND. ! EMPTY(m_set[1,122])
        IF ! aut_sen('Vencimento maior que Prazo estipulado no PEDIDO mais TOLERANCIA de '+STRZERO(m_set[1,122],3)+' Dias.','PRZ_REC')
                RETURN .F.
        ENDIF
        IF LASTKEY() = 27
                RETURN .F.
        ENDIF
ENDIF
IF dow(mv)=7 .OR. dow(mv)=1
        atencao('Data de Vencimento cai no '+IF(dow(mv)=7,'SABADO','DOMINGO')+' Final de semana')
        ?? chr(7)
ENDIF
RETURN .T.
************************** F I M ***************************************
**************************************
* FUNCAO PARA CHECAR O SPC
**************************************
FUNCTION spc(mcod,mvalor,mtipo,mped,mlib,mcons)
*************************
LOCAL liberado:='*',rodape,ponto,msele,morde,mcont_ch,mpesq,;
      mmensagem:=' ',mok:=' ',mcont_arq:=0,mcam_arq:=' ',i:=0,;
      mcpfcnpj := ' ',mcli_spc,mcam_cli:=' ',mmens:=' '
local nErr, nPos,;
        vEmp := {},;
        nCnn,oSql,;
        cComm, apCode,aret:={}

MEMVAR ok,mdata_sis,mlim_venc,mlim_avenc,mtot_limite

mlim_venc := mlim_avenc := mtot_limite := 0
IF mlib <> NIL .AND. mlib = '*'
        RETURN .T.
ENDIF
aret:={}
cComm  := "SELECT * FROM mastcli WHERE cod_cli = "+sr_cdbvalue(STRZERO(mcod,5))
sr_getconnection():exec(ccomm,,.t.,@aret)
IF LEN(aret) > 0
	IF STRZERO(mcod,5) = m_set[1,84] .OR. aret[1,42] = 'N'
        	RETURN .T.
	ENDIF
ELSE
        RETURN .F.
ENDIF
mok := ' '
msele := SELE()
morde := INDEXORD()
aret:={}
        aret:={}
        cComm  := "SELECT SUM(valor) FROM sacdupr WHERE fornec = "+sr_cdbvalue(STRZERO(mcod,5))+" AND venc < "+sr_cdbvalue(mdata_sis)+" AND datpag IS NULL"
        sr_getconnection():exec(ccomm,,.t.,@aret)
        IF LEN(aret) > 0
                mlim_venc := aret[1,1]
        ELSE
                mlim_venc := 0
        ENDIF

        aret:={}
        cComm  := "SELECT SUM(valor) FROM sacdupr WHERE fornec = "+sr_cdbvalue(STRZERO(mcod,5))+" AND venc >= "+sr_cdbvalue(mdata_sis)+" AND datpag IS NULL"
        sr_getconnection():exec(ccomm,,.t.,@aret)

        IF LEN(aret) > 0
                mlim_avenc :=aret[1,1]
        ELSE
                mlim_avenc :=0
        ENDIF
aret:={}
cComm  := "SELECT conta,venc FROM sacdupr WHERE fornec = "+sr_cdbvalue(STRZERO(mcod,5))+" AND venc < "+sr_cdbvalue(mdata_sis)+" AND datpag IS NULL"
sr_getconnection():exec(ccomm,,.t.,@aret)
IF LEN(aret) > 0
        FOR i = 1 TO LEN(aret)
                IF  aret[i,1] = '*' .AND. mmens = ' '
                        liberado := ' '
                        mmensagem:= mmensagem+' - *** DOCUMENTO VENCIDO (p/CONTA) - MATRIZ !!! ***'
                        mok:=mmens:='*'
                ELSE
                        IF aret[i,2]+m_set[1,106] < mdata_sis .AND. mmens = ' '
                                liberado := ' '
                                mmensagem:= mmensagem+' - *** DOCUMENTO VENCIDO - MATRIZ !!! ***'
                                mok:=mmens:='*'
                        ENDIF
                ENDIF
        NEXT

ENDIF

mtot_limite := mlim_avenc + mlim_venc

aret:={}
cComm  := "SELECT limite FROM mastcli WHERE cod_cli = "+sr_cdbvalue(STRZERO(mcod,5))
sr_getconnection():exec(ccomm,,.t.,@aret)

IF aret[1,1] > 0 .AND. mtot_limite+mvalor > aret[1,1]
        IF mtipo = NIL
                IF (ver_serie() = '141287' .OR. ver_serie() = '14128D') .AND. ;
                   ! aut_sen('CLIENTE COM LIMITE ESTOURADO','LIMIT_EST',,STRZERO(mcod,5))
                        UNLOCK
                        RETURN .F.
                ELSE
/*
			IF mtot_limite+mvalor > (aret[1,1] * 1.5)
		                atencao('Cliente estar BLOQUEADO por ultrapassar o Limite + 50%: Valor do Limite: '+TRANSFORM(aret[1,1],'999,999.99')+' e o Total de Compras mais a compra em andamento: '+TRANSFORM(mtot_limite+mvalor,'999,999.99'))
		                RETURN .F.
			ENDIF
*/
                        mmensagem:= mmensagem+' - *** LIMITE R$: '+TRANSFORM(aret[1,1],'99,999,999.99')+' ESTORADO em '+TRANSFORM((mtot_limite+mvalor) - aret[1,1],'99,999,999.99')+' ***'
                ENDIF
                liberado := ' '
                mok:='*'
        ELSE
                atencao('Cliente com LIMITE R$: '+TRANSFORM(aret[1,1],'99,999,999.99')+' ESTORADO em '+TRANSFORM((mtot_limite+mvalor) - aret[1,1],'99,999,999.99')+' !!!')
        ENDIF

ENDIF

IF mcons = NIL
        IF mok = '*' .AND. ! aut_sen(mmensagem,'LIB_DEV',,STRZERO(mcod,5))
                UNLOCK
                RETURN .F.
        ENDIF
ELSE
        atencao(mmensagem)
ENDIF
mlib := liberado := '*'
IF liberado = '*' .OR. mtipo <> NIL
        RETURN .T.
ELSE
        RETURN .F.
ENDIF
RETURN .F.
************************* F I M ******************************
********************************
 * CONSULTAR CREDITO DO CLIENTE
 *********************************
 FUNCTION c_credito()
 ********************
LOCAL conscred:={},i:=0,point:=0,li:=0,ci:=0,la:=21,ca:=63,mconsdupr:={},;
      mcont_doc:=0,mtotal_doc:=0

mcomando := "SELECT * FROM mastcred WHERE fornec = "+sr_cdbvalue(STRZERO(mcod_cli,5))+" AND (pago IS NULL OR pago = ' ')"
sr_getconnection():exec(mcomando,,.t.,@conscred)
FOR i = 1 TO LEN(conscred)
        AADD(mconsdupr,' '+conscred[i,2]+' '+conscred[i,4]+' '+conscred[i,26]+'  '+conscred[i,3]+'   '+DTOC(conscred[i,11])+'   '+TRANSFORM(conscred[i,19],'999,999.99')+' '+conscred[i,28]+' '+IF(! EMPTY(conscred[i,43]),'S/F','   ')+' '+conscred[i,1])
        mcont_doc ++
        mtotal_doc := mtotal_doc + conscred[i,19]
NEXT
op_tela(li,ci,la+2,ca,'CONSULTA DE CREDITO DO CLIENTES')
mensagem('<ESC> Retorna  -  <ENTER> p/Confirmar')
setcor(3)
DEVPOS(li+1,ci+01);DEVOUT('Documento')
DEVPOS(li+1,ci+18);DEVOUT('Op')
DEVPOS(li+1,ci+21);DEVOUT(' No.')
DEVPOS(li+1,ci+27);DEVOUT('Vencimento')
DEVPOS(li+1,ci+44);DEVOUT('Valor')
DEVPOS(li+1,ci+56);DEVOUT('Emp')
@ li+2,ci+1 TO li+2,ca-1
@ la-2,ci+1 TO la-2,ca-1
DEVPOS(la-1,ci+1);DEVOUT('Quantidade:')
DEVPOS(la-1,ci+24);DEVOUT('Total:')
setcor(1)
DEVPOS(la-1,ci+13);DEVOUT(STRZERO(mcont_doc,4))
DEVPOS(la-1,ci+31);DEVOUT(TRANSFORM(mtotal_doc,'9,999,999.99'))
point := ACHOICE(li+3,ci+1,la-3,ca-1,mconsdupr,,,point)
wvw_lclosewindow()
DO CASE
        CASE LASTKEY()=27
                RETURN 0
                mn_cred := SPACE(8)
        CASE LASTKEY() = 13
                mn_cred := conscred[point,4]
                RETURN conscred[point,4]
ENDCASE
RETURN 0
******************************** F I M ************************************88
/**************************************************************************************************/
static function ExtPorGen(nGenero,xStr)
return if(ValType(xStr) = "A", xStr[1] + xStr[nGenero+1], xStr)

***********************************  F I M ********************************
#xtranslate :fileHandle   => :cargo\[1\]
#xtranslate :fileLine     => :cargo\[2\]
#xtranslate :lineOffset   => :cargo\[3\]
#xtranslate FTell(<fHandle>) => FSeek(<fHandle>, 0, 1)

#define FILE_BRWS_NUM_IVARS 3
#define MAX_LINE_LEN  256
#define CR    Chr(13)
#define LF    Chr(10)
#define CRLF  CR + LF
#define SET_IVAR(iVar, p) iif(p == NIL, NIL, iVar := p)
*------------------------------------------------------------------------------*
**************************************************************************************************/
**************************************************************************************************/
function Extenso(nBase     ,; // valor numérico original
                 lVMonet   ,; // se verdadeiro, trata-se de valor monetário
                 cStrSingul,; // string da moeda (lVMonet=TRUE) no singular
                 cStrPlural,; // idem, no plural
                 nGenero    ; // nGenero que define o artigo de tratamento: 1=Masculino e 2=Feminino
                 )
local cExtenso := ""
local aDenomin := {""," mil"," m"," b"," tr"}
local nInteiro := Int(nBase)
local nVlrFrac
local cStrFrac

lVMonet    := if(lVMonet=nil, .T., lVMonet)
nGenero    := if(nGenero=nil, 1, nGenero)
cStrSingul := if(Empty(cStrSingul), "", " "+AllTrim(cStrSingul))
cStrPlural := if(Empty(cStrPlural), if(Empty(cStrSingul),"",cStrSingul+"s"), " "+AllTrim(cStrPlural))
nVlrFrac   := Val(Right(Str(nBase,18,if(lVMonet,2,3)),if(lVMonet,2,3)))

if !lVMonet
   while nVlrFrac > 0 .and. Right(LTrim(Str(nVlrFrac)),1) = "0"
      nVlrFrac := Int(nVlrFrac/10)
   end
end
cStrFrac := if(lVMonet, "centavo", if(nVlrFrac<10, "décimo", if(nVlrFrac<100, "centésimo", "milésimo")))

for nPasso := 5 to 1 step -1
    nParte := Val(Left(Str(nInteiro,nPasso*3),3))
    if nParte  > 0
       nInteiro -= nParte * Val("1"+Replicate("0",3*(nPasso-1)))
       cExtenso += ExtCentena(nParte,nGenero) + aDenomin[nPasso] + if(nPasso < 3, "", "ilh" + if(nParte = 1, "ao", "oes")) + ", "
    end
next

nInteiro := Int(nBase)
cExtenso := if(nInteiro = 0, "", Left(cExtenso,Len(cExtenso)-2))
nPasso   := RAt(", ",cExtenso)
cExtenso := if(nPasso=0, cExtenso, if(" e " $ SubStr(cExtenso,nPasso), cExtenso, Stuff(cExtenso,nPasso,2," e ")))
cExtenso += if(nInteiro=0, "", if(nInteiro=1, cStrSingul, if(Val(Right(Str(nInteiro,15),6)) = 0, "de", "") + cStrPlural))
cExtenso += if(nVlrFrac=0, "", if(nInteiro=0, "", " e ") + ExtCentena(nVlrFrac,nGenero) + " "+cStrFrac + if(nVlrFrac=1, "", "s"))
return cExtenso


/**************************************************************************************************/
static function ExtCentena(nBase,nGenero)
local cExtenso := ""
priva aUnidade := {{"um","","a"},{"d","ois","uas"},"tres","quatro","cinco","seis","sete","oito","nove"}
priva aDezena1 := {"onze","doze","treze","quatorze","quinze","dezesseis","dezessete","dezoito","dezenove"}
priva aDezena2 := {"dez","vinte","trinta","quarenta","cinquenta","sessenta","setenta","oitenta","noventa"}
priva aCentena := {"cento",{"duzent","os","as"},{"trezent","os","as"},{"quatrocent","os","as"},{"quinhent","os","as"},;
                  {"seiscent","os","as"},{"setecent","os","as"},{"oitocent","os","as"},{"novecent","os","as"}}

nGenero  := if(nGenero=nil, 1, nGenero)
cExtenso += if(nBase < 100, "", if(nBase = 100, "cem", ExtPorGen(nGenero,aCentena[Int(nBase/100)]) + if(nBase%100 > 0, " e ", "")))
nBase    %= 100
cExtenso += if(nBase  = 10, aDezena2[1], "")
cExtenso += if(nBase >  10 .and. nBase < 20, aDezena1[nBase%10], "")
cExtenso += if(nBase >= 20, aDezena2[Int(nBase/10)] + if(nBase%10 > 0, " e ", ""), "")
cExtenso += if(nBase%10 > 0 .and. (nBase >  20 .or. nBase < 10), ExtPorGen(nGenero,aUnidade[nBase%10]), "")
return cExtenso

******************************* F I M ********************************
*************************************
* FUNCAO PROGRESSAO DE IMPRESSAO
*************************************
FUNCTION prog_imp(no,mcampo)
*******************
LOCAL mno:=0
mno := VAL(SUBSTR(STRZERO((no/2),10,2),8,2))
IF mno = 0
        WVW_SBSetText(,1,'Mensagem:  Aguarde o Final da Impressao: /  + - No.Reg.:'+STRZERO(no,6)+' - '+IF(mcampo=NIL,'',mcampo))
ELSE
        WVW_SBSetText(,1,'Mensagem:  Aguarde o Final da Impressao: \  X - No.Reg.:'+STRZERO(no,6)+' - '+IF(mcampo=NIL,'',mcampo))
ENDIF
RETURN NIL
******************************* F I M ********************************
***************************
* CABECALHO RELATORIO
***************************
FUNCTION cabecalho(pag,tit,tipo,vprg,memp,vgru,vsubg,vforn,vcli,vven,vope)
**************************************************************************
LOCAL mtraco2:=REPLI('=',132),mcons_cons:={}

WHILE .T.
        imprt(m_cfg[34],'N')
        imprt(m_cfg[34],'N+')
        DEVPOS(PROW()+1,00);DEVOUT(memp_resa)
        imprt(m_cfg[34],'N-')
        imprt(m_cfg[34],'N')
        DEVPOS(PROW()+1,00);DEVOUT(tit)
        DEVPOS(PROW(),00);DEVOUT(PADL(mdata_sis,80))
        IF tipo <> NIL
                DEVPOS(PROW()+1,00);DEVOUT(tipo)
        ELSE
                DEVPOS(PROW()+1,00);DEVOUT(REPLI('*',LEN(tit)))
        ENDIF
        DEVPOS(PROW(),00);DEVOUT(PADL('Pagina: '+ STRZERO(pag,3),80))
        imprt(m_cfg[34],'C')
        DEVPOS(PROW()+1,00);DEVOUT(memp_resa)
        IF vprg = NIL
                DEVPOS(PROW(),00);DEVOUT(PADL(sistema+' '+mversao,132))
        ELSE
                DEVPOS(PROW(),00);DEVOUT(PADL(sistema+' '+mversao+' - ('+vprg+')',132))
        ENDIF
        imprt(m_cfg[34],'C')
        DEVPOS(PROW()+1,00);DEVOUT(mtraco2)
        imprt(m_cfg[34],'N')
        cons_cons := {}
        IF ! EMPTY(vgru)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM sacgrupo WHERE gru_sub LIKE "+sr_cdbvalue(vgru+'%'),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('GRUPO.....: '+vgru+' - '+cons_cons[1,2])
                ENDIF
        ENDIF
        IF ! EMPTY(vsubg)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM sacgrupo WHERE gru_sub = "+sr_cdbvalue(vsubg),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('SUB-GRUPO.: '+vsubg+' - '+cons_cons[1,2])
                ENDIF
        ENDIF
        IF ! EMPTY(vforn)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM sacforn WHERE cod_forn = "+sr_cdbvalue(vforn),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('FORNECEDOR: '+vforn+' - '+cons_cons[1,2])
                ENDIF
        ENDIF
        IF ! EMPTY(vcli)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM saccli WHERE cod_cli = "+sr_cdbvalue(vcli),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('CLIENTE...: '+vcli+' - '+cons_cons[1,3])
                ENDIF
        ENDIF
        IF ! EMPTY(vven)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM insopera WHERE scod_op = "+sr_cdbvalue(vven),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('VENDEDOR..: '+vven+' - '+cons_cons[1,2])
                ENDIF
        ENDIF
        IF ! EMPTY(vope)
                cons_cons := {}
                sr_getconnection():exec("SELECT * FROM insopera WHERE scod_op = "+sr_cdbvalue(vope),,.t.,@cons_cons)
                IF LEN(cons_cons) > 0
                        DEVPOS(PROW()+1,00);DEVOUT('OPERADOR..: '+vope+' - '+cons_cons[1,2])
                ENDIF
        ENDIF
        IF LEN(cons_cons) > 0
                imprt(m_cfg[34],'C')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco2)
                imprt(m_cfg[34],'N')
        ENDIF
        RETURN NIL
ENDDO
RETURN NIL
******************************* F I M *********************************
************************************************
*FUNCAO P/IMPRIMIR RECIBO BAIXA DE DOC.RECEBER
************************************************
               //  1   2    3     4     5    6       7        8      9
FUNCTION rec_dupr(m_d,m_p,mqtd,mtot_m,mtot,mdat,mtipo_rel,mvlr_parc,mdev)
*************************************************************************
LOCAL mtraco := REPLI('=',60),i:=0,mextenso,mlinha,mlin,lin,mtot_acord:=0,Q_cons:={}
PRIVATE mcliente,mcpf,mcgc,;
        mtipo_imp,mimp_tipo:=2,marq:=SPACE(35)
mtipo_imp := m_cfg[36]
cComm  := "SELECT fornec,cliente,venc FROM sacdupr WHERE sr_recno = " + sr_cdbvalue(m_p)
Q_cons:={}
sr_getconnection():exec(ccomm,,.t.,@Q_cons)
IF LEN(Q_cons) = 0
        atencao('Nao existe nenhum Documento baixado')
        RETURN NIL
ENDIF
IF ! imp_arq('DEMO_DEB.REL','R')
        RETURN NIL
ENDIF
IF m_cfg[24] = 'B' .AND. mtipo_rel <> 'E'
        mtraco := REPLI('=',60)
        imprt(mtipo_imp,'N')
        DEVPOS(PROW()+1,00);DEVOUT(PADC(ALLTRIM(memp_resa),38))
        imprt(mtipo_imp,'C')
        DEVPOS(PROW()+1,00);DEVOUT(PADC(RTRIM(mend_firm),58))
        DEVPOS(PROW()+1,00);DEVOUT(PADC(RTRIM(mcid_firm),58))
        DEVPOS(PROW()+1,00);DEVOUT(PADC(RTRIM('Fone: '+mfone_firm),58))
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        imprt(mtipo_imp,'N')
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT(PADC('RECIBO PAGAMENTO',38))
        ELSE
                DEVPOS(PROW()+1,00);DEVOUT(PADC('DEMONSTRATIVO DE DEBITO',38))
        ENDIF
        imprt(mtipo_imp,'C')
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis)+'    Data do Pagamento: '+DTOC(mdat))
        ELSE
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis))
        ENDIF
        DEVPOS(PROW(),PCOL()+2);DEVOUT('- Oper.:'+cod_operado)
        DEVPOS(PROW()+1,00);DEVOUT('Cliente: '+Q_cons[1,1]+'-'+Q_cons[1,2])
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        DEVPOS(PROW()+1,00);DEVOUT('Documento')
        IF mtipo_rel = NIL
                DEVPOS(PROW(),15);DEVOUT('Vencimento')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('    Valor')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('   Jur+Mul')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Valor Pago')
        ELSE
                DEVPOS(PROW(),15);DEVOUT(' Emissao')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vencimen')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('    Valor')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Jur+Mul')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr.Total')
        ENDIF
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        i:=0
        FOR i = 1 TO LEN(m_d)
                IF EMPTY(m_d[i])
                        LOOP
                ENDIF
                DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7,60))
                //DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7))
        NEXT
        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',60))
        DEVPOS(PROW()+1,00);DEVOUT('TOTAL: '+TRANSFORM(mqtd,'99999'))
        DEVPOS(PROW(),25);DEVOUT(TRANSFORM(mvlr_parc,'999,999.99'))
        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot_m,'99,999.99'))
        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot,'999,9999.99'))
/*
        DEVPOS(PROW(),25);DEVOUT(TRANSFORM(mtot+mtot_m,'999,999.99'))
        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot-mtot_m,'99,999.99'))
        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot,'999,9999.99'))
*/
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
*        mextenso:= '('+RTRIM(extenso(ROUND(mtot,2),10))+')'
        mextenso:= '('+RTRIM(EXTENSO(ROUND(mtot,2),.T.,'real','reais'))+')'

        mlinha := MLCOUNT(mextenso,60)
        lin := 0
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,60,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),60))
        NEXT
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT('Recebemos o valor acima descrito, pelo qual damos quitacao.')
        ENDIF
        IF mdev > 0 //mdev # NIL .OR.
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Saldo Devedor: '+TRANSFORM(mdev,'999,999.99'))
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        ENDIF
        DEVPOS(PROW()+3,00);DEVOUT(PADC('----------------------------------------',58))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('                 Local e data           ',58))
        DEVPOS(PROW()+3,00);DEVOUT(PADC(REPLI('-',LEN(ALLTRIM(memp_resa))+4),58))
        DEVPOS(PROW()+1,00);DEVOUT(PADC(ALLTRIM(memp_resa),58))

        IF mtipo_rel = NIL .AND. m_cfg[50] = 'S'
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+4,00);DEVOUT(PADC(ALLTRIM(memp_resa),38))
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(PADC('COMPROVANTE RECIBO PAGAMENTO',38))
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis)+'        Data do Pagamento: '+DTOC(mdat))
                DEVPOS(PROW()+1,00);DEVOUT('Cliente: '+Q_cons[1,1]+'-'+Q_cons[1,2])
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Documento')
                DEVPOS(PROW(),15);DEVOUT('Vencimento')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('    Valor')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('   Jur+Mul')
                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Valor Pago')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                i:=0
                FOR i = 1 TO LEN(m_d)
                        IF EMPTY(m_d[i])
                                LOOP
                        ENDIF
                        DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7,60))
                NEXT
                DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',60))
                DEVPOS(PROW()+1,00);DEVOUT('Qtd.Doc.: '+TRANSFORM(mqtd,'99999'))
                DEVPOS(PROW(),25);DEVOUT(TRANSFORM(mvlr_parc,'999,999.99'))
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot_m,'99,999.99'))
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot,'999,9999.99'))
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+m_cfg[29],00);DEVOUT(CHR(18))
        ELSE
                DEVPOS(PROW()+m_cfg[29],00);DEVOUT(CHR(18))
        ENDIF
ELSEIF m_cfg[24] = 'F' .OR. m_cfg[24] = 'G' .AND. mtipo_rel <> 'E'
        mtraco := REPLI('=',80)
        imprt(mtipo_imp,'E')
        DEVPOS(PROW()+1,00);DEVOUT(memp_resa)
        imprt(mtipo_imp,'C')
        DEVPOS(PROW()+1,00);DEVOUT(RTRIM(m_set[1,132])+'-'+RTRIM(m_set[1,133])+'-'+RTRIM(m_set[1,134])+'-'+RTRIM(m_set[1,19])+' - Fone: '+m_set[1,136])
        imprt(mtipo_imp,'N')
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT(PADC('RECIBO PAGAMENTO',80))
        ELSE
                DEVPOS(PROW()+1,00);DEVOUT(PADC('DEMONSTRATIVO DE DEBITO',80))
        ENDIF
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis)+'        Data do Pagamento: '+DTOC(mdat))
        ELSE
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis))
        ENDIF
        DEVPOS(PROW(),PCOL()+2);DEVOUT(' - Oper.:'+cod_operado)
        DEVPOS(PROW()+1,00);DEVOUT('Cliente: '+Q_cons[1,1]+'-'+Q_cons[1,2])
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        DEVPOS(PROW()+1,00);DEVOUT('Documento')
        DEVPOS(PROW(),15);DEVOUT(' Emissao')
        DEVPOS(PROW(),PCOL()+1);DEVOUT('Vencimen')
        DEVPOS(PROW(),PCOL()+1);DEVOUT('    Valor')
        DEVPOS(PROW(),PCOL()+1);DEVOUT('Jur+Mul')
        DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr.Total')
        DEVPOS(PROW(),PCOL()+1);DEVOUT('LP')
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        i:=0
        FOR i = 1 TO LEN(m_d)
                IF EMPTY(m_d[i])
                        LOOP
                ENDIF
*               DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7,55))
                DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7))
        NEXT
        DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',80))
        DEVPOS(PROW()+1,00);DEVOUT('Qtd.Doc.: '+TRANSFORM(mqtd,'99999'))
        DEVPOS(PROW(),32);DEVOUT(TRANSFORM(mtot-mtot_m,'999,999.99'))
        DEVPOS(PROW(),PCOL());DEVOUT(TRANSFORM(mtot_m,'99999.99'))
        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot,'999999.99'))
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
*        mextenso:= '('+RTRIM(extenso(ROUND(mtot,2),10))+')'
        mextenso:= '('+RTRIM(EXTenso(ROUND(mtot,2),.T.,'real','reais'))+')'

        mlinha := MLCOUNT(mextenso,60)
        lin := 0
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,60,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),60))
        NEXT
        DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        IF mtipo_rel = NIL
                DEVPOS(PROW()+1,00);DEVOUT('Recebemos o valor acima descrito, pelo qual damos quitacao.')
        ENDIF
        IF mdev > 0 //mdev # NIL .OR.
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Saldo Devedor: '+TRANSFORM(mdev,'999,999.99'))
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
        ENDIF
        DEVPOS(PROW()+3,00);DEVOUT(PADC('----------------------------------------',80))
        DEVPOS(PROW()+1,00);DEVOUT(PADC('                Local e data            ',80))
        DEVPOS(PROW()+3,00);DEVOUT(PADC(REPLI('-',LEN(ALLTRIM(memp_resa))+4),80))
        DEVPOS(PROW()+1,00);DEVOUT(PADC(ALLTRIM(memp_resa),80))
        IF mtipo_rel = NIL .AND. m_cfg[50] = 'S'
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+3,00);DEVOUT(PADC(ALLTRIM(memp_resa),38))
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+1,00);DEVOUT(PADC('COMPROVANTE RECIBO PAGAMENTO',38))
                imprt(mtipo_imp,'C')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Data: '+DTOC(mdata_sis)+'        Data do Pagamento: '+DTOC(mdat))
                DEVPOS(PROW()+1,00);DEVOUT('Cliente: '+Q_cons[1,1]+'-'+Q_cons[1,2])
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+1,00);DEVOUT('Documento')
                DEVPOS(PROW(),15);DEVOUT(' Emissao')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vencimen')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('    Valor')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Jur+Mul')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vlr.Total')
                DEVPOS(PROW(),PCOL()+1);DEVOUT('LP')
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                i:=0
                FOR i = 1 TO LEN(m_d)
                        IF EMPTY(m_d[i])
                                LOOP
                        ENDIF
                        DEVPOS(PROW()+1,00);DEVOUT(SUBSTR(m_d[i],7))
                NEXT
                DEVPOS(PROW()+1,00);DEVOUT(REPLI('-',60))
                DEVPOS(PROW()+1,00);DEVOUT('Qtd.Doc.: '+TRANSFORM(mqtd,'99999'))
                DEVPOS(PROW(),32);DEVOUT(TRANSFORM(mtot-mtot_m,'999,999.99'))
                DEVPOS(PROW(),PCOL());DEVOUT(TRANSFORM(mtot_m,'99999.99'))
                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mtot,'999999.99'))
                DEVPOS(PROW()+1,00);DEVOUT(mtraco)
                DEVPOS(PROW()+m_cfg[29],00);DEVOUT(CHR(18))
        ENDIF
        SETPRC(00,00)
        EJECT
ELSEIF mtipo_rel = 'E'
        mtraco := REPLI('=',80)
        mtot_acord := i := 0
        FOR i = 1 TO LEN(m_dupr)
                mbaixa := 'S'
                IF m_pos[i,2] <> 'X'
                        LOOP
                ENDIF
                IF m_set[1,22] = 'S'
                        imprt(m_cfg[36],'E')
                        DEVPOS(PROW(),00);DEVOUT(memp_resa)
                        imprt(m_cfg[36],'C')
                        DEVPOS(PROW()+1,00);DEVOUT(mend_firm+'-'+mcid_firm+  +'Fone: '+mfone_firm)
                        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   CNPJ: '+mcgc_firm)
                        imprt(m_cfg[36],'N')
                        @ PROW()+1,00 SAY mtraco
                        @ PROW()+1,00 SAY ' '
                ENDIF
                imprt(m_cfg[36],'N')
                ver_cli(VAL(aret[i,7]),,,'*')
                @ PROW(),00 SAY 'Cliente......:'
                @ PROW(),PCOL()+1 SAY aret[i,7]
                @ PROW(),PCOL()+1 SAY aret[i,8]
                @ PROW()+1,00 SAY 'Nome Fantasia:'
                @ PROW(),PCOL()+1 SAY cli->nome
                @ PROW()+1,00 SAY 'Responsavel..:'
                @ PROW(),PCOL()+1 SAY cli->comprado
                @ PROW()+1,00 SAY 'End.: '+cli->endereco+', '+RTRIM(cli->numero)+IF(! EMPTY(RTRIM(cli->complemento)),' - Compl.:'+RTRIM(cli->complemento),'')
                @ PROW()+1,00 SAY 'Bairro: '+RTRIM(cli->bairro)+'-Cidade: '+RTRIM(cli->cidade)+'-'+cli->uf
                @ PROW()+1,00 SAY 'CEP:'+cli->cep+'- Fone:'+cli->tel1
                imprt(m_cfg[36],'N')
                IF ! EMPTY(cli->cgc)
                        @ PROW()+1,00 SAY 'CNPJ:'
                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(cli->cgc,'@@R 99.999.999/9999-99')
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(' - Insc.: '+cli->insc)
                ELSE
                        @ PROW()+1,00 SAY 'CPF:'
                        DEVPOS(PROW(),PCOL()+1);DEVOUTPICT(cli->cpf,'@@R 999.999.999-99')
                ENDIF
                @ PROW()+1,00 SAY mtraco
                @ PROW()+1,00 SAY ''
                imprt(m_cfg[36],'E')
                @ PROW(),00 SAY IF(ver_serie()='141447','NOTA PROMISSORIA:','DUPLICATA No.:')+aret[i,4]
                imprt(m_cfg[36],'N')
                @ PROW()+1,00 SAY 'Emissao:'
                @ PROW(),09 SAY aret[i,10]
                @ PROW(),20 SAY 'Vencimento:'
                @ PROW(),32 SAY aret[i,11]
                @ PROW()+1,00 SAY mtraco
                DEVPOS(PROW()+1,00);DEVOUT(PADC('Valor R$: ('+LTRIM(TRANSFORM(aret[i,19],'99,999,999.99'))+')',80))
*                mextenso:= '('+RTRIM(extenso(dupr->valor,10))+')'
                mextenso:= '('+RTRIM(EXTenso(ROUND(aret[i,19],2),.T.,'real','reais'))+')'

                mlinha := MLCOUNT(mextenso,80)
                FOR lin = 1 TO mlinha
                        mlin := MEMOLINE(mextenso,80,lin,,10)
                        DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
                NEXT
                @ PROW()+1,00 SAY mtraco
                @ PROW()+1,00 SAY 'Descricao:'
                @ PROW(),00 SAY 'Descricao:'
                mextenso:= m_set[1,29]+m_set[1,30]+m_set[1,31]+m_set[1,32]
                mlinha := 0
                mlinha := MLCOUNT(mextenso,60)
                lin := 0
                FOR lin = 1 TO mlinha
                        mlin := MEMOLINE(mextenso,80,lin,,10)
                        IF mlin # ' '
                                DEVPOS(PROW()+1,00);DEVOUT(RTRIM(mlin))
                        ENDIF
                NEXT
                @ PROW()+1,00 SAY mtraco
                imprt(m_cfg[36],'N')
                DEVPOS(PROW()+1,00);DEVOUT('OBSERVACAO:')
                DEVPOS(PROW(),00);DEVOUT('OBSERVACAO:')
                DEVPOS(PROW()+1,00);DEVOUT('Maiores informacoes dirija-se ao '+memp_resa+'.')
                imprt(m_cfg[36],'C')
                DEVPOS(PROW()+1,00);DEVOUT('(Para quitacao da mesma, pois a nao quitacao implicara no bloqueio do seu credito e a inclusao no SPC e SERASA)')
                imprt(m_cfg[36],'N')
                @ PROW()+1,00 SAY mtraco
                @ PROW()+7,00 SAY ' '
                mtot_acord := mtot_acord + dupr->valor
        NEXT
        // COMPROVANTE DE RECEBIMENTOS
        imprt(m_cfg[36],'E')
        DEVPOS(PROW(),00);DEVOUT(memp_resa)
        imprt(m_cfg[36],'C')
        DEVPOS(PROW()+1,00);DEVOUT(mend_firm+'-'+mcid_firm+  +'Fone: '+mfone_firm)
        DEVPOS(PROW()+1,00);DEVOUT('Inscr. '+minsc_firm+'   CNPJ: '+mcgc_firm)
        imprt(m_cfg[36],'N')
        @ PROW()+1,00 SAY mtraco
        @ PROW()+1,00 SAY PADC('COMPROVANTE DE RECEBIMENTO DOS BOLETOS',80)
        @ PROW()+1,00 SAY mtraco
        mextenso:= 'Eu,'+aret[1,7]+'-'+RTRIM(aret[1,8])+' portador do '
        IF ! EMPTY(cli->cgc)
                mextenso := mextenso + 'CNPJ:'+TRANSFORM(cli->cgc,'99.999.999/9999-99')
        ELSE
                mextenso := mextenso + 'CPF:'+TRANSFORM(cli->cpf,'999.999.999-99')
        ENDIF
        mextenso := mextenso + ', Estou ciente e de acordo que a nao quitacao do valor de R$:'+ALLTRIM(TRANSFORM(mtot_acord,'999,999.99'))+' no vencimento e valor determinado nos documentos abaixo citados, ocorrera a inclusao no SPC e SERASA.'
        mlinha := MLCOUNT(mextenso,80)
        FOR lin = 1 TO mlinha
                mlin := MEMOLINE(mextenso,80,lin,,10)
                DEVPOS(PROW()+1,00);DEVOUT(PADR(RTRIM(mlin),80))
        NEXT
        @ PROW()+1,00 SAY mtraco
        @ PROW()+1,00 SAY 'Relacao dos Documentos'
        @ PROW()+1,00 SAY REPLI('-',80)
        i := 0
        FOR i = 1 TO LEN(m_dupr)
                mbaixa := 'S'
                IF m_pos[i,2] <> 'X'
                        LOOP
                ENDIF
                @ PROW()+1,00 SAY 'No.Doc.:'+m_pos[i,7]+' Venc.:'+DTOC(m_pos[i,8])+' Valor: '+TRANSFORM(m_pos[i,3],'999,999.99')
        NEXT
        @ PROW()+1,00 SAY REPLI('-',80)
        @ PROW()+3,00 SAY PADC(RTRIM(m_set[1,134])+', ....../ ....../ ........',80)
        @ PROW()+3,00 SAY PADC('..............................................',80)
        @ PROW()+1,00 SAY PADC('            Assinatura do Cliente             ',80)
        @ PROW()+7,00 SAY ' '
        EJECT
ENDIF
SET DEVICE TO SCREEN;SET PRINT TO;SET PRINT OFF
conf_impressao('DEMO_DEB.REL')
RETURN NIL
***************************  F I M ******************************************
********************************
* FUNCAO P/CONSULTAR FORNECEDOR
********************************
FUNCTION f6_forn(mop)
*****************
LOCAL mprg:='F6_FORN',;
      f6tela,f6tela1,f6lci,f6cci,f6lba,f6cba,f6msele,f6morde,f6men,;
      oconsprod,ocolprod[4],f6i,f6nkey,f6opcao,;
      mcod_f,mrazao,mfantasia,mcidade,mendereco,mcpfcnpj,mtelefone,;
      ccomm,cons_m,m_prod,m_poS,point,i,minsc

MEMVAR mcod_forn

IF ! ver_nivel(mprg,'CADASTRO DE FORNECEDOR','15',nivel_acess,,'AMBIE')
        RETURN NIL
ENDIF

f6lci := f6cci := 0
f6lba := 23
f6cba := 70

f6msele := SELE()
f6morde := INDEXORD()
IF ! AbriArq('mastforn','forn');RETURN NIL;ENDIF
*************
SELE('forn');ORDSETFOCUS(2)
GO TOP
*************
op_tela(00,10,30,80,memp_resa+SPACE(50)+' FORNECEDOR / DESPESAS'+'  -  Quantidades: '+TRANSFORM(LASTREC(),'999,999'))
exibi_prg(mprg)
oconsprod := TBROWSEDB(f6lci,f6cci,f6lba-1,f6cba,'forn')
ocolprod[1] := TBCOLUMNNEW('Fornecedor',{||forn->razao})
ocolprod[2] := TBCOLUMNNEW('Cod.',{||forn->cod_forn})
ocolprod[3] := TBCOLUMNNEW('UF',{||forn->uf})
ocolprod[4] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(forn->cgc),TRANSFORM(forn->cgc,'@@R 99.999.999/9999-99'),TRANSFORM(forn->cpf,'@@R 999.999.999-99'))})
//ocolprod[7] := TBCOLUMNNEW('       CPF',{||TRANSFORM(forn->cpf,'@@R 999.999.999-99')})
f6i:=0
FOR f6i=1 TO LEN(ocolprod)
        oconsprod:ADDCOLUMN(ocolprod[f6i])
NEXT
oconsprod:HEADSEP := CHR(196)
oconsprod:COLSEP := CHR(179)
WHILE .T.
        IF mop = '*'
                mensagem('<P>esquisa <I>nclusao <ENTER>p/Alterar e Excluir <ESC>Retornar')
        ELSE
                mensagem('<PGUP> <PGDN> <P>esquisa <I>nclusao <ENTER> Conf. <ESC>Retornar')
        ENDIF
        f6nkey := 0
        WHILE f6nkey == 0         //.AND. ! oconsprod:STABLE
                oconsprod:FORCESTABLE()
                botao(f6lba+1,f6cci+1,f6lba+4,f6cba,,' Detalhe ')
                setcor(3)
                DEVPOS(f6lba+2,f6cci+1);DEVOUT('End.:')
                DEVPOS(f6lba+3,f6cci+1);DEVOUT('Cidade:')
                DEVPOS(f6lba+3,f6cci+30);DEVOUT('UF:')
                DEVPOS(f6lba+3,f6cci+37);DEVOUT('Tel.:')
                setcor(1)
                DEVPOS(f6lba+2,f6cci+6);DEVOUT(forn->endereco+' - '+forn->bairro)
                DEVPOS(f6lba+3,f6cci+8);DEVOUT(forn->cidade)
                DEVPOS(f6lba+3,f6cci+33);DEVOUT(forn->uf)
                DEVPOS(f6lba+3,f6cci+42);DEVOUT(forn->tel1)
                f6nkey := INKEY(0)
        END
        IF f6nkey == K_ESC
                EXIT
        ELSEIF f6nkey = 73 .OR. f6nkey = 105     // I
                sac140()
        ELSEIF f6nkey = 112 .OR. f6nkey = 80
                op_tela(00,00,33,100,memp_resa+SPACE(40)+' CONSULTA DE FORNECEDOR ')
                CLEAR GETS
                WHILE .T.
                        mcod_f       := 0
                        mrazao          := mfantasia := mcidade := mendereco := SPACE(40)
                        mcpfcnpj        := mtelefone := minsc := SPACE(14)
                        limpa(0,0,31,99)
                        mensagem('Digite a descricao ou *descricao p/Pesquisa qualquer lugar da descricao')
                        setcor(1)
                        DEVPOS(00,01);DEVOUT('Cod.Fornecedor:')
                        DEVPOS(01,01);DEVOUT('Razao Social..:')
                        DEVPOS(02,01);DEVOUT('Nome Fantasia.:')
                        DEVPOS(03,01);DEVOUT('Cidade........:')
                        DEVPOS(04,01);DEVOUT('Endereco......:')
                        DEVPOS(05,01);DEVOUT('CPF/CNPJ......:')
                        DEVPOS(05,32);DEVOUT('Inscricao Est.:')
                        DEVPOS(06,01);DEVOUT('Telefone......:')
                        setcor(3)
                        @ 07,00 TO 07,100
                        DEVPOS(08,01);DEVOUT('Razao Social                             Fantasia                                  Codigo  Cidade                 CPF/CNPJ')
                        @ 09,00 TO 09,100
                        @ 32,00 TO 32,100
                        DEVPOS(33,01);DEVOUT('Total Fornecedor.:')
                        DEVPOS(33,27);DEVOUT('Tempo da Pesquisa:')
                        setcor(1)
                        @ 00,17 GET mcod_f PICT '9999'
                        @ 01,17 GET mrazao PICT '@!' WHEN EMPTY(mcod_f)
                        @ 02,17 GET mfantasia PICT '@!' WHEN EMPTY(mcod_f)
                        @ 03,17 GET mcidade PICT '@!' WHEN EMPTY(mcod_f)
                        @ 04,17 GET mendereco PICT '@!' WHEN EMPTY(mcod_f)
                        @ 05,17 GET mcpfcnpj PICT '@!' WHEN EMPTY(mcod_f) .AND. EMPTY(mrazao) .AND. EMPTY(mfantasia) .AND. EMPTY(mcidade) .AND. EMPTY(mendereco)
                        @ 05,48 GET minsc PICT '@!' WHEN EMPTY(mcod_f) .AND. EMPTY(mrazao) .AND. EMPTY(mfantasia) .AND. EMPTY(mcidade) .AND. EMPTY(mendereco)  .AND. men_get(0,0,'Digite a INSCRICAO sem pontos e Hifens') VALID  lim_get()
                        @ 06,17 GET mtelefone PICT '@!' WHEN EMPTY(mcod_f) .AND. EMPTY(mcpfcnpj) .AND. EMPTY(minsc)
                        READ
                        IF LASTKEY() = 27
                                CLEAR GETS
                                EXIT
                        ENDIF
                        IF EMPTY(mcod_f) .AND. EMPTY(mrazao) .AND. EMPTY(mfantasia) .AND. EMPTY(mcidade) .AND. EMPTY(mendereco) .AND. EMPTY(mcpfcnpj) .AND. EMPTY(mtelefone) .AND. EMPTY(minsc)
                                LOOP
                        ENDIF
                        mhoras := TIME()
                        cComm  := "SELECT * FROM sacforn WHERE cod_forn IS NOT NULL"
                        IF ! EMPTY(mcod_f)
                                ccomm := ccomm + " AND cod_forn = "+sr_cdbvalue(STRZERO(mcod_f,4))
                        ELSE
                                IF ! EMPTY(mcpfcnpj)
                                        IF LEN(ALLTRIM(mcpfcnpj)) < 14
                                                ccomm := ccomm + " AND cpf = "+sr_cdbvalue(ALLTRIM(mcpfcnpj))
                                        ELSE
                                                ccomm := ccomm + " AND cgc = "+sr_cdbvalue(ALLTRIM(mcpfcnpj))
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(minsc)
                                        minsc := STRTRAN(minsc,'.','')
                                        minsc := STRTRAN(minsc,'-','')
                                        minsc := STRTRAN(minsc,'/','')
                                        ccomm := ccomm + " AND insc LIKE "+sr_cdbvalue(ALLTRIM(minsc)+'%')
                                ENDIF
                                IF ! EMPTY(mtelefone)
                                        IF SUBSTR(mtelefone,1,1) = '*'
                                        	ccomm := ccomm + " AND (tel1 LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mtelefone,2))+'%')+" OR tel2 LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mtelefone,2))+'%')+")"
                                        ELSE
                                        	ccomm := ccomm + " AND (tel1 LIKE "+sr_cdbvalue(ALLTRIM(mtelefone)+'%')+" OR tel2 LIKE "+sr_cdbvalue(ALLTRIM(mtelefone)+'%')+")"
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(mrazao)
                                        IF SUBSTR(mrazao,1,1) = '*'
                                                ccomm := ccomm + " AND razao LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mrazao,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND razao LIKE "+sr_cdbvalue(ALLTRIM(mrazao)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(mfantasia)
                                        IF SUBSTR(mfantasia,1,1) = '*'
                                                ccomm := ccomm + " AND fantasia LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mfantasia,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND fantasia LIKE "+sr_cdbvalue(ALLTRIM(mfantasia)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(mcidade)
                                        IF SUBSTR(mcidade,1,1) = '*'
                                                ccomm := ccomm + " AND cidade LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mcidade,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND cidade LIKE "+sr_cdbvalue(ALLTRIM(mcidade)+'%')
                                        ENDIF
                                ENDIF
                                IF ! EMPTY(mendereco)
                                        IF SUBSTR(mendereco,1,1) = '*'
                                                ccomm := ccomm + " AND endereco LIKE "+sr_cdbvalue('%'+ALLTRIM(SUBSTR(mendereco,2))+'%')
                                        ELSE
                                                ccomm := ccomm + " AND endereco LIKE "+sr_cdbvalue(ALLTRIM(mendereco)+'%')
                                        ENDIF
                                ENDIF
                        ENDIF
                        ccomm := ccomm + " ORDER BY razao"
                        cons_m := {}
                        sr_getconnection():exec(ccomm,,.t.,@cons_m)
                        IF LEN(cons_m) = 0
                                atencao('Nao foi encontrado nenhum FORNECEDOR ...')
                                LOOP
                        ENDIF
                        m_prod := {}
                        m_pos  := {}
                        point  := i := 0
                        DEVPOS(33,20);DEVOUT(STRZERO(LEN(cons_m),5))
                        DEVPOS(33,46);DEVOUT(ELAPTIME(mhoras,TIME()))
                        FOR i = 1 TO LEN(cons_m)
                                AADD(m_prod,' '+cons_m[i,2];
                                           +' '+cons_m[i,35];
                                           +'  '+cons_m[i,1];
                                           +'  '+cons_m[i,8];
                                           +'  '+IF(! EMPTY(cons_m[i,16]),cons_m[i,16],cons_m[i,18]))
                                        AADD(m_pos,cons_m[i,36])
                        NEXT
                        point := ACHOICE(10,0,30,100,m_prod,,,point)
                        DO CASE
                                CASE LASTKEY()=27
                                        LOOP
                                CASE LASTKEY() = 13
                                        *************
                                        SELE('forn');ORDSETFOCUS(2)
                                        *************
                                        GO m_pos[point]
                                        EXIT
                        ENDCASE
                ENDDO
                wvw_lclosewindow()
                *************
                SELE('forn');ORDSETFOCUS(2)
                *************
                oconsprod := TBROWSEDB(f6lci,f6cci,f6lba-1,f6cba,'forn')
                ocolprod[1] := TBCOLUMNNEW('Fornecedor',{||forn->razao})
                ocolprod[2] := TBCOLUMNNEW('Cod.',{||forn->cod_forn})
                ocolprod[3] := TBCOLUMNNEW('UF',{||forn->uf})
                ocolprod[4] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(forn->cgc),TRANSFORM(forn->cgc,'@@R 99.999.999/9999-99'),TRANSFORM(forn->cpf,'@@R 999.999.999-99'))})
                f6i:=0
                FOR f6i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f6i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()

        ELSEIF f6nkey == K_ENTER
                mcod_forn := VAL(forn->cod_forn)
                IF mop = '*'
                        f6opcao := mensagem1('Deseja <A>lterar <E>xcluir:','A','A,E')
                        IF LASTKEY() = 27
                                LOOP
                        ELSEIF f6opcao = 'A'
                                sac141()
                        ELSEIF f6opcao = 'E'
                                sac142()
                        ENDIF
                ELSE
                        EXIT
                ENDIF
                *************
                SELE('forn');ORDSETFOCUS(2)
                *************
                GO TOP
                oconsprod := TBROWSEDB(f6lci,f6cci,f6lba-1,f6cba,'forn')
                ocolprod[1] := TBCOLUMNNEW('Fornecedor',{||forn->razao})
                ocolprod[2] := TBCOLUMNNEW('Cod.',{||forn->cod_forn})
                ocolprod[3] := TBCOLUMNNEW('UF',{||forn->uf})
                ocolprod[4] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(forn->cgc),TRANSFORM(forn->cgc,'@@R 99.999.999/9999-99'),TRANSFORM(forn->cpf,'@@R 999.999.999-99'))})
                f6i:=0
                FOR f6i=1 TO LEN(ocolprod)
                        oconsprod:ADDCOLUMN(ocolprod[f6i])
                NEXT
                oconsprod:HEADSEP := CHR(196)
                oconsprod:COLSEP := CHR(179)
                oconsprod:FORCESTABLE()
        ELSE
                IF genkey(oconsprod,f6nkey,'forn')
                        *************
                        SELE('forn');ORDSETFOCUS(2)
                        *************
                        oconsprod := TBROWSEDB(f6lci,f6cci,f6lba-1,f6cba,'forn')
                        ocolprod[1] := TBCOLUMNNEW('Fornecedor',{||forn->razao})
                        ocolprod[2] := TBCOLUMNNEW('Cod.',{||forn->cod_forn})
                        ocolprod[3] := TBCOLUMNNEW('UF',{||forn->uf})
                        ocolprod[4] := TBCOLUMNNEW('  CNPJ/CPF',{||IF(! EMPTY(forn->cgc),TRANSFORM(forn->cgc,'@@R 99.999.999/9999-99'),TRANSFORM(forn->cpf,'@@R 999.999.999-99'))})
                        f6i:=0
                        FOR f6i=1 TO LEN(ocolprod)
                                oconsprod:ADDCOLUMN(ocolprod[f6i])
                        NEXT
                        oconsprod:HEADSEP := CHR(196)
                        oconsprod:COLSEP := CHR(179)
                        oconsprod:FORCESTABLE()
                ENDIF
        ENDIF
END
SELE(f6msele);IF(f6morde>0,ORDSETFOCUS(f6morde),)
RELEASE f6tela,f6tela1,f6lci,f6cci,f6lba,f6cba,f6msele,f6morde,f6men,oconsprod,ocolprod[7],i,f6nkey,f6opcao
wvw_lclosewindow()
IF f6nkey == K_ESC
        RETURN NIL
ELSE
        RETURN mcod_forn
ENDIF
RETURN NIL
*********************** F I M ************************************************

FUNCTION timeout(espera)
************************
LOCAL tini := SECONDS()
WHILE .T.
        IF SECONDS() > (tini + 5)
                mensagem('Aguardando...:  '+; // '('+ProcName(2)+') '+;
                Trim(str(tini + espera - SECONDS(),2)))
        ENDIF
        IF SECONDS() > (tini + espera)
                EXIT
        ENDIF
        INKEY(.10,20)
        IF LASTKEY() = 27
                EXIT
        ENDIF
ENDDO
RETURN NIL
*********************** F I M ************************************************
/*
                  Copyright (C) 2008, 2010
                  Interactive Choice Brasil
                  Todos os Direitos Reservados

ßßßßßßßßßßßßßßßÛßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
 Sistema       Û  GERAL - Funcao para Todos os Sistemas
 Analista      Û  Manoel Angeiras
 Programador   Û  Manoel Angeiras
 Programa      Û  BROWSPESQ.PRG
 Coment rios   Û  Browse para pesquisa dos arquivos
               Û
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÛÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
*/
/*
#include "icbrasil.ch"
#include "button.ch"

#define ALFANUM   " ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*-+/.,\!@#$%^&()"
#define GO_FIRST  900
#define GO_PRIOR  901
#define GO_NEXT   902
#define GO_LAST   903
#define GO_END   1000

memvar _aGet
****************************************************************
FUNCTION BROWPESQ( cTitulo, aGet, nTop, nLeft, nBottom, nRight )
****************************************************************
local nWindow, oBrowse, i, nKey, lEnd, lRet, nCursor := setcursor(), mpesq,cCor := setcolor(), nWidth, nCol, nRow

private _aGet := aGet, bBlock

   //
   // INDICA QUE AS MENSAGENS DA TOOLBAR SERAO PROCESSADAS POR FUNCAO ESPECIFICA
   // PARA A PESQUISA COM O BROWSE ( fVarPesq )
   //
_lPesquisa := .T.

nWindow := WVW_nOpenWindow( cTitulo, nTop, nLeft, nBottom+2, nRight, WS_CAPTION+WS_CLIPCHILDREN, 0, 0 )
wvw_SetLineSpacing( nWindow, 0 )

wvw_tbdestroy(nWindow)
nTBar := wvw_tbcreate( nWindow, .F.,, 1 )

wvw_tbAddButton( nWindow, GO_FIRST, 207, "Primeiro"       , 0, .T.)
wvw_tbAddButton( nWindow, GO_PRIOR, 213, "Página Anterior", 0, .T.)
wvw_tbAddButton( nWindow, GO_NEXT , 212, "Próxima Página" , 0, .T.)
wvw_tbAddButton( nWindow, GO_LAST , 210, "Último"         , 0, .T.)
wvw_tbAddButton( nWindow )
wvw_tbAddButton( nWindow, GO_END  , 219, "Sair"          , 0, .T.)

nBottom := nBottom-nTop
nRight  := nRight-nLeft
nTop    := 0
nLeft   := 0

oBrowse               := TBrowseNew( nTop, nLeft, nBottom-1, nRight-2 )
oBrowse:colorSpec     := "N/W*,N/GR+*,N/B*"
oBrowse:ColSep        := "  "
oBrowse:HeadSep       := "__"
oBrowse:GoTopBlock    := { || dbGoTop() }
oBrowse:GoBottomBlock := { || dbGoBottom() }
oBrowse:SkipBlock     := { |nSkip| dbSkipBlock( nSkip, oBrowse ) }

if empty( _aGet )
        _aGet := DbStruct()
        for i := 1 to len( _aGet )
                bBlock := GeraBloco( i )
                oBrowse:AddColumn( TBColumnNew( _aGet[ i, 1 ], bBlock ) )
        next
else
        for nA := 1 to len( _aGet )
                bBlock             := fBloco( _aGet[ nA, 2 ], _aGet[ nA, 3 ] )
                oTBColumn          := TBColumn():new( _aGet[ nA, 1 ], bBlock )
                oTBColumn:defColor := { 1,2,3,1 }
                oBrowse:addColumn( oTBColumn )
        next
        // aeval( _aGet, {|aG| oBrowse:addColumn( TBColumnNew( aG[1], fBloco( aG[2], aG[3] ) ) ) } )
endif

oBrowse:configure()

LimpaObjetos( nWindow )
WVW_SetPen( 0, 0, RGB( 108,123,139 ) )
AddObjetos( nWindow, {|nWin| WVW_DrawGridHorz( nWin, oBrowse:nTop+3, oBrowse:nLeft, oBrowse:nRight, oBrowse:nBottom - oBrowse:nTop - 1 ) } )
AddObjetos( nWindow, {|nWin| WVW_DrawGridVert( nWin, oBrowse:nTop, oBrowse:nBottom, oBrowse:aColumnsSep, len( oBrowse:aColumnsSep ) ) } )

nVScrollBar := wvw_xbCreate( nWindow, 1, oBrowse:nTop, oBrowse:nRight+2, oBrowse:nBottom-oBrowse:nTop+1, {|nWinNum, nXBid, nXBmsg, nXBpos| VXBscroller(oBrowse, nWinNum, nXBid, nXBmsg) }, { 0, -8, 0, 0 } )

mpesq  := ""
nWidth := (nRight-21) - (nLeft+10)
nRow   := nBottom+1
nCol   := nLeft+10

@ nBottom+1, nLeft+1 say "Pesquisa"
COR_SAY_GET; @ nBottom+1, nLeft+10 say space(nWidth); setcolor(cCor)
AddObjetos( nWindow, {|nWin| wvw_drawboxget( nWin, nBottom+1, nLeft+10, nWidth ) } )
wvw_pbcreate( nWindow, nBottom+1, nRight-20, nBottom+1, nRight-11, "Ok",, {|| __KeyBoard( chr( K_ENTER ) ) } )
wvw_pbcreate( nWindow, nBottom+1, nRight-9 , nBottom+1, nRight-1 , "Sair",, {|| __KeyBoard( chr( K_ESC ) ) } )

oBrowse:ForceStable()
RefreshVXB( oBrowse, nWindow, nVScrollBar )
oBrowse:colorRect( { oBrowse:rowPos, oBrowse:leftVisible, oBrowse:rowPos, oBrowse:rightVisible }, { 2, 1 } )

setcursor(0)
lEnd := lRet := .F.
while !lEnd
        nKey := inkey(0)
        oBrowse:colorRect( { oBrowse:rowPos, oBrowse:leftVisible, oBrowse:rowPos, oBrowse:rightVisible }, { 1, 2 } )
        do case
                case upper( chr( nKey ) ) $ ALFANUM
                mpesq += upper( chr( nKey ) )
                @ nRow, nCol say mpesq color "n/w*"
                dbSeek( mpesq, .T. )
                oBrowse:RefreshAll()
                case nKey == K_BS
                        mpesq := substr( mpesq, 1, len( mpesq ) - 1 )
                        @ nRow, nCol say space(nWidth) color "n/w*"
                        @ nRow, nCol say mpesq         color "n/w*"
                        dbSeek( mpesq, .T. )
                        oBrowse:RefreshAll()
                case nKey == K_ESC
                        lRet := .F.
                        lEnd := .T.
                case nKey == K_ENTER .or. nKey == K_LDBLCLK
                        lEnd := lRet := .T.
                case nKey == K_DOWN .or. nKey == K_MWBACKWARD
                        oBrowse:Down()
                case nKey == K_UP .or. nKey == K_MWFORWARD
                        oBrowse:Up()
                case nKey == K_LEFT
                        if oBrowse:colPos == 1
                                loop
                        endif
                        oBrowse:Left()
                case nKey == K_RIGHT
                        if oBrowse:colPos == oBrowse:colCount()
                                loop
                        endif
                        oBrowse:Right()
                case nKey == K_PGDN
                        oBrowse:pageDown()
                case nKey == K_PGUP
                        oBrowse:pageUp()
                case nKey == K_CTRL_PGUP
                        oBrowse:goTop()
                case nKey == K_CTRL_PGDN
                        oBrowse:goBottom()
                case nKey == K_HOME
                        oBrowse:home()
                case nKey == K_END
                        oBrowse:end()
                case nKey == K_CTRL_LEFT
                        oBrowse:panLeft()
                case nKey == K_CTRL_RIGHT
                        oBrowse:panRight()
                case nKey == K_CTRL_HOME
                        oBrowse:panHome()
                case nKey == K_CTRL_END
                        oBrowse:panEnd()
                case nKey == K_LBUTTONDOWN .or. nKey == K_LBUTTONUP
                        if TBMouse( oBrowse, mRow(), mCol() ) # 0
                                if TBScroll( oBrowse, mRow(), mCol() )
                                        oBrowse:RefreshAll()
                                endif
                        else
                                oBrowse:RefreshAll()
                        endif
                otherwise
                        loop
        endcase
        oBrowse:ForceStable()
        oBrowse:colorRect( { oBrowse:rowPos, oBrowse:leftVisible, oBrowse:rowPos, oBrowse:rightVisible }, { 2, 1 } )
        RefreshVXB( oBrowse, nWindow, nVScrollBar )
enddo
WVW_lCloseWindow()
LimpaObjetos( nWindow )
setcursor(nCursor)
setcolor(cCor)
//
// VOLTA A CONDICAO NORMAL PARA A PESQUISA DA TOOLBAR DA FUNCAO DE ORIGEM
//
_lPesquisa := .F.
RETURN if( lRet, recno(), 0 )

*****************************************
STATIC FUNCTION DbSkipBlock( n, oBrowse )
*****************************************
local nSkipped := 0

if n == 0
        dbSkip( 0 )
elseif n > 0
        while nSkipped # n .and. TBNext( oBrowse )
                nSkipped++
        enddo
else
        while nSkipped # n .and. TBPrev( oBrowse )
                nSkipped--
        enddo
endif
RETURN nSkipped
*********************************
STATIC FUNCTION TBNext( oBrowse )
*********************************
local nSaveRecNum := recno() ,lMoved      := .T.

if eof()
        lMoved := .F.
else
        dbSkip( 1 )
        if eof()
                lMoved := .F.
                dbGoTo( nSaveRecNum )
        endif
endif
RETURN lMoved
*********************************
STATIC FUNCTION TBPrev( oBrowse )
*********************************
local nSaveRecNum := recno() ,lMoved      := .T.

dbSkip(-1)
if bof()
        dbGoTo( nSaveRecNum )
        lMoved := .F.
endif
RETURN lMoved
*****************************************
STATIC FUNCTION fBloco( cEdit, cPicture )
*****************************************
local cMacro

if valtype(cEdit) == "C"
        if cPicture == NIL
                if "->" $ cEdit
                        cMacro := &("{|y| if(pcount()==0," + cEdit + "," + cEdit + " := y ) }")
                else
                        cEdit := ltrim(cEdit)
                        cMacro := &("{ |y| if(pcount()==0, FIELD->" + cEdit + ", FIELD->" + cEdit + " := y ) }")
                endif
        else
                if "->" $ cEdit
                        cMacro := &("{ |y| if(pcount()==0, transform(" + cEdit + ", '" + cPicture + "'), " + cEdit + " := y ) }")
                else
                        cEdit := ltrim(cEdit)
                        cMacro := &("{ |y| if(pcount()==0, transform(FIELD->" + cEdit + ", '" + cPicture + "'), FIELD->" + cEdit + " := y ) }")
                endif
        endif
elseif valtype(cEdit) == "B"
        cMacro := cEdit
endif
RETURN (cMacro)
************************************************************
STATIC FUNCTION VXBscroller( oBrowse, nWinNum, XBid, XBmsg )
************************************************************
local nOldWin, lNeedStabilize

nOldWin := wvw_nSetCurWindow(nWinNum)
lNeedStabilize := .F.
while .t.
        do case
                case XBmsg == 0 //SB_LINEUP
                        if ordKeyNo() == 1
                                exit
                        endif
                        keyboard chr(K_UP)
                //          oBrowse:up()
                case XBmsg == 1 //SB_LINEDOWN
                        if ordKeyNo() == ordKeyCount()
                                exit
                        endif
                        keyboard chr(K_DOWN)
                //          oBrowse:down()
                case XBmsg == 2 //SB_PAGEUP
                        if ordKeyNo() == 1
                                exit
                        endif
                        oBrowse:pageup()
                case XBmsg == 3 //SB_PAGEDOWN
                        if ordKeyNo() == ordKeyCount()
                                exit
                        endif
                        oBrowse:pagedown()
                otherwise
                        lNeedStabilize := .T.
                        exit
        endcase
        lNeedStabilize := .T.
        exit
enddo
if lNeedStabilize
        oBrowse:ForceStable()
        RefreshVXB(oBrowse, nWinNum, XBid)
endif
wvw_nSetCurWindow(nOldWin)
RETURN NIL
****************************************************
STATIC FUNCTION RefreshVXB( oBrowse, nWinNum, XBid )
****************************************************
local nMin, nMax, nPage, nPos, nRatio

if ordKeyCount() < 30000
        nRatio := 1
        nMin   := 1
        nMax   := ordKeyCount()
        nPage  := oBrowse:RowCount()
        nPos   := ordKeyNo()-oBrowse:RowPos+1
else
        nRatio := ordKeyCount() / 10
        do while nRatio > 30000
                nRatio := nRatio / 10
        enddo
        nMin  := 1
        nMax  := round( ordKeyCount() / nRatio, 0)
        nPage := round(oBrowse:RowCount() / nRatio, 0)
        nPos  := round( ( ordKeyNo()-oBrowse:RowPos+1) / nRatio, 0 )
endif
WVW_XBupdate(nWinNum, XBid, nPos, nPage, nMin, nMax)
RETURN NIL
******************************
STATIC FUNCTION GeraBloco( i )
******************************
RETURN  { || fieldget( i ) }
********************************************
FUNCTION VarPesq( cAlias, cTitulo, nEvento )
********************************************
local nRet := nEvento, nRecno
do case
        case nEvento == GO_FIRST
                nRet := K_CTRL_PGUP
        case nEvento == GO_PRIOR
                nRet := K_PGUP
        case nEvento == GO_NEXT
                nRet := K_PGDN
        case nEvento == GO_LAST
                nRet := K_CTRL_PGDN
        case nEvento == GO_END
                nRet := K_ESC
endcase
RETURN nRet
***********************************************
STATIC FUNCTION TBScroll( oBrowse, nRow, nCol )
***********************************************
local nValKey, nPos, lResult := .T.

nValKey := oBrowse:HitTest( nRow, nCol )
do case
        case nValkey == HTSCROLLUNITDEC
                dbSkip( - 1 )
                if bof()
                        dbGoTop()
                else
                        if ( oBrowse:rowPos > 1 )
                                oBrowse:rowPos --
                        endif
                endif
        case nValkey == HTSCROLLUNITINC
                dbSkip( 1 )
                if eof()
                        dbGoBottom()
                else
                        if ( oBrowse:rowPos < oBrowse:rowCount )
                                oBrowse:rowPos ++
                        endif
                endif
        // CASE nValKey = HTSCROLLBLOCKDEC .OR. nValKey = HTSCROLLBLOCKINC
        //    nPos := ( nRow - ::scroll:start ) / ::scroll:barLength * 100
        //    nPos := ROUND( ::scroll:total * nPos / 100, 0 )
        //    dbGoTop()
        //    dbSkip( nPos )
        //    IF EOF()
        //       dbGoBottom()
        //    ENDIF
        otherwise
                lResult := .F.
endcase
RETURN lResult
*/
******************************* F I M ********************************
* CABECALHO DA JANELA
*********************
FUNCTION janela(li,cb,cab,p,lado)
****************
LOCAL mcor
mcor := SETCOLOR()
IF p = NIL
        setcor(3,'*')
ELSE
        setcor(3)
ENDIF
IF lado = NIL
        DEVPOS(li,cb-(LEN(cab)+2));DEVOUT(cab)
ELSE
        DEVPOS(li,cb+2);DEVOUT(cab)
ENDIF
SETCOLOR(mcor)
RETURN NIL
************************************ F I M ************************************
* AREDONDAMENTO DE NUMERO
*************************
FUNCTION iat(mvlr_iat,mind,mqtd_casa)
*************************************
LOCAL mvalor,qtd

IF mqtd_casa # NIL
        IF mind = 'T'
                mvalor := VAL(SUBSTR(STR(mvlr_iat,16,5),1,11+mqtd_casa))
        ELSE
                mvalor := ROUND(mvlr_iat,mqtd_casa)
        ENDIF
        RETURN mvalor
ENDIF


//IF LEN(m_set) > 0 .AND. AT('.',m_set[1,97]) > 0
//        qtd := LEN(SUBSTR(m_set[1,97],AT('.',m_set[1,97])+1))
//ELSE
        qtd := 2
//ENDIF
//IF mind = 'T'
//IF LEN(m_set) > 0 .AND. m_set[1,103] = 'T'
//        mvalor := VAL(SUBSTR(STR(mvlr_iat,16,5),1,11+qtd))
//ELSE
        mvalor := ROUND(mvlr_iat,qtd)
//ENDIF
RETURN mvalor
************************************ F I M ***************************************************
#include "hbclass.ch"

function criptografia(mtext,mtipo)
**********************************
local tempGet,test := EnCrypt():New()
IF mtipo = 'C'
        //atencao( "Palavra criptografada: Ola Mundo!!" )
        test:SetTextToEncrypt(mtext)
        test:EnCrypt()
        tempGet := test:GetEncryptedText()
        //atencao( "Ola Mundo!! : criptografado: " + (tempGet := test:GetEncryptedText()))
ELSE
        // atencao( "Descriptografacao do Ola Mundo!! -> " + tempGet)
        test:SetTextToDecrypt(mtext)
        test:Decrypt()
        tempGet := test:GetDecryptedText()
ENDIF
return tempGet

class EnCrypt
private:
data cEncryptedText init ""
data cDecryptedText init ""

data cTextToEncrypt init ""
data cTextToDecrypt init ""

public:
method new() constructor
method EnCrypt()
method Decrypt()

method SetTextToEncrypt( cText ) inline( ::cTextToEncrypt := cText )
method SetTextToDecrypt( cText ) inline( ::cTextToDecrypt := cText )

inline method GetEncryptedText()
        return ::cEncryptedText
endmethod

inline method GetDecryptedText()
        return ::cDecryptedText
endmethod
endclass

method new() class encrypt ; return self

method EnCrypt() class encrypt
local i
local cRet := ""

local nRand1
local nRand2

for i:=1 to len(::cTextToEncrypt)
        nRand1 := HB_RandomInt() % 2
        nRand2 := HB_RandomInt() % 15

           //cRet += Chr(AscPos(::cTextToEncrypt[i]) + nRand2)
        cRet += Chr(Asc(::cTextToEncrypt[i]) + nRand2)

        if nRand1 == 0
                cRet += Chr(97)
                cRet += Chr((48+nRand2))
        else
                cRet += Chr(48)
                cRet += Chr((97+nRand2))
        endif
next
::cEncryptedText := cRet
return nil

method Decrypt() class encrypt
local i
local nAux := 0
local cRet := ""

for i:=1 to len(::cTextToDecrypt)
        nAux := 0
        if Asc(::cTextToDecrypt[i+1]) == 97
                nAux := Asc(::cTextToDecrypt[i+2]) - 48
                cRet += Chr(Asc(::cTextToDecrypt[i]) - nAux)
        endif

        if Asc(::cTextToDecrypt[i+1]) == 48
                nAux := Asc(::cTextToDecrypt[i+2]) - 97
                cRet += Chr(Asc(::cTextToDecrypt[i]) - nAux)
        endif
         i+=2
next

::cDecryptedText := cRet
return nil
********************** F I M ********************************
* VERIFICA CLASSIFICACAO FISCAL
*******************************
FUNCTION vercst(m_cst,mtp)
**********************
LOCAL mver_cst := {}
m_cst := ALLTRIM(m_cst)
sr_getconnection():exec("SELECT * FROM saccst WHERE cst = "+sr_cdbvalue(m_cst),,.t.,@mver_cst)
IF LEN(mver_cst) = 0
        atencao('Este CST: '+m_cst+' nao estar Cadastrado favor verificar...')
        IF mtp = 1
                RETURN .F.
        ELSE
                RETURN ''
        ENDIF

ENDIF
IF mtp = 1
        RETURN .T.
ELSE
        RETURN mver_cst[1,3]
ENDIF
RETURN
********************************** F I M ******************************************
FUNCTION conf_impressao(marquivo,memail,mtip)
*********************************************
LOCAL mnome_aux:=''
MEMVAR mnome_arq, mimp_tipo,mtp_impre

MYRUN('MD '+CURDRIVE()+':\'+ALLTRIM(IF(LEN(m_indiv)>0,m_indiv[1,5],mdefcam_imp)))
IF mimp_tipo = 5 .OR. mtip # NIL
        MYRUN('DOSPRINTER /PDF /DEL '+ALLTRIM(IF(LEN(m_indiv)>0,m_indiv[1,5],mdefcam_imp))+'HRB.REL')
        INKEY(.10,20)
        IF frename(ALLTRIM(IF(LEN(m_indiv)>0,m_indiv[1,5],mdefcam_imp))+'HRB.REL.PDF',ALLTRIM(IF(LEN(m_indiv)>0,m_indiv[1,5],mdefcam_imp))+'HRB.PDF') = -1
                ferror()
        ENDIF
        marquivo := ALLTRIM(IF(LEN(m_indiv)>0,m_indiv[1,5],mdefcam_imp))+'HRB.PDF'
        enviar_email(memail,,,,marquivo,,mtip)
ELSEIF mimp_tipo = 1
        //atencao(STRZERO(mtp_impre,4))
        IF mtp_impre = 2 //mtipo_imp = 'M'
                MYRUN('DOSPRINTER /SEL /DEL '+ALLTRIM(m_indiv[1,5])+'HRB.REL')
                //MYRUN('DOSPRINTER '+IF(m_cfg[79]='2','/SEL2','/SEL')+' /DEL '+ALLTRIM(m_indiv[1,5])+'HRB.REL')
                //MYRUN('DOSPRINTER /SEL HP /DEL '+ALLTRIM(IF(LEN(m_indiv)>0,m_indiv[1,5],mdefcam_imp))+'HRB.REL')
        ELSE
                MYRUN('DOSPRINTER /RAW /DEL '+ALLTRIM(IF(LEN(m_indiv)>0,m_indiv[1,5],mdefcam_imp))+'HRB.REL')
        ENDIF
ELSEIF mimp_tipo = 2
        MYRUN('DOSPRINTER /SEL2 /DEL '+ALLTRIM(IF(LEN(m_indiv)>0,m_indiv[1,5],mdefcam_imp))+'HRB.REL')
ENDIF
RETURN
********************** F I M ********************************
* VER ARQUIVO DE INICIALIZACAO
******************************
#include "fileio.ch"
FUNCTION ver_ini
****************
LOCAL ret_tam:=0,pos_ret,var_ret_cmd,var_aux,i:=0
IF ! FILE(curdrive()+':\HRBCFG.INI') .AND. FILE(curdrive()+':\CFGHRB.INI')
        SET DEVI TO PRINT
        SET PRINT ON
        SET PRINT TO (curdrive()+':\HRBCFG.INI')
        DEVPOS(00,00);DEVOUT('001')
        DEVPOS(01,00);DEVOUT(' ')
        SET PRINT TO;SET PRINT OFF;SET DEVI TO SCREEN
ELSEIF ! FILE(curdrive()+':\HRBCFG.INI')
        RETURN '001'
ENDIF
While RET_TAM = 0
        H_Handle := Fopen(curdrive()+":\HRBCFG.INI")
        RET_TAM =  FSeek( H_Handle, 0, FS_END )
        Fclose(H_Handle)
enddo
H_Handle:= Fopen(curdrive()+":\HRBCFG.INI")
POS_RET = 0
VAR_RET_CMD=" "
VAR_AUX =" "
*if RET_TAM > 0
        FOR POS_RET = 1 to RET_TAM - 1
                fread( H_Handle, @VAR_AUX, 1)
                if VAR_AUX <> chr(13)
                        VAR_RET_CMD= VAR_RET_CMD + VAR_AUX
                end if
        next
*endif
fclose(H_Handle)
RETURN SUBSTR(ALLTRIM(var_ret_cmd),1,3)
**************************  F I M *******************************************
* FECHA AS CONEXOES COM O DB
****************************
FUNCTION fecha_conexaoDB
************************
IF nCnn = 0
        RETURN NIL
ENDIF
SR_BEGINTRANSACTION()
TRY
        SR_EndConnection(SR_GetActiveConnection(  ))
CATCH e
        SR_ENDTRANSACTION()
END
RETURN NIL
**************************************** F I M ******************************************
* data: 03/12/2013 SENHA DE LIBERACAO DO SISCOM
***********************************************
FUNCTION senha_lib(mtp_senha)
*****************************
LOCAL mdig1,mdig2,mdig3,mdig4,mdig5,mcod_acesso,mdata_aux,mdias_fecha:=0,mchecar :='  /  /  ',mchecar1 :='  /  /  '
mdig1 := SUBSTR(STRZERO(VAL(SUBSTR(DTOC(DATE()),7,2))+VAL(SUBSTR(DTOC(DATE()),1,2))+VAL(SUBSTR(DTOC(DATE()),4,2)),2),1,1)
mdig2 := STRZERO(VAL(SUBSTR(DTOC(DATE()),4,2))+VAL(SUBSTR(DTOC(DATE()),1,2)),2)
mdig3 := STRZERO(VAL(SUBSTR(DTOC(DATE()),7,2))+VAL(SUBSTR(DTOC(DATE()),1,2)),2)
mdig4 := STRZERO(VAL(SUBSTR(DTOC(DATE()),1,2))+VAL(SUBSTR(DTOC(DATE()),1,2)),2)
mdig5 := SUBSTR(STRZERO(VAL(SUBSTR(DTOC(DATE()),7,2))+VAL(SUBSTR(DTOC(DATE()),1,2))+VAL(SUBSTR(DTOC(DATE()),4,2)),2),2,1)
m_set:={}
sr_getconnection():exec("SELECT * FROM sacsetup",,.t.,@m_set)
SET CENTURY ON
IF ! EMPTY(m_set[1,15])
        mdias_fecha := (CTOD(SUBSTR(m_set[1,15],1,2)+'/'+SUBSTR(m_set[1,15],3,2)+'/20'+SUBSTR(m_set[1,15],5,2))) - DATE()
ENDIF
SET CENTURY OFF
setcor(1)
IF (mdias_fecha <= 0 .OR. SUBSTR(m_set[1,15],12,1) = '*') .AND. ! EMPTY(m_set[1,15])
                op_tela(10,10,15,90,'SENHA DE LIBERACAO DO SISTEMA ')
                WHILE .T.
                        mcod_acesso := SPACE(29)
                        setcor(3)
                        DEVPOS(1,1);DEVOUT(' FAVOR ENTRA EM CONTATO COM A  HTI Sistemas - Fone:(81)'+mfone_hrb)
                        DEVPOS(2,1);DEVOUT('    *** PARA SOLICITAR O CODIGO DE LIBERACAO DO SISTEMA ***')
                        setcor(1)
                        DEVPOS(4,1);DEVOUT('Digite o SENHA DE LIBERACAO:')
                        WVW_DrawBoxGet(,4,30,29)
                        @ 4,30 GET mcod_acesso PICT '@!'
                        READ
                        IF LASTKEY() = 27
                                fim('SISCOM','*')
                                //RETURN NIL
                        ENDIF
                        IF LEN(ALLTRIM(mcod_acesso)) > 20
                                IF EMPTY(SUBSTR(dcrip(mcod_acesso),1,14))
                                        LOOP
                                ELSEIF dcrip(mcod_acesso) = tira_pontos(mcgc_firm)
                                        mdata_aux := SUBSTR(dcrip(mcod_acesso),15)
                                        mchecar := CTOD(SUBSTR(mdata_aux,1,2)+'/'+SUBSTR(mdata_aux,3,2)+'/'+SUBSTR(mdata_aux,5,2))
                                        mchecar1 := CTOD(SUBSTR(mdata_aux,9,2)+'/'+SUBSTR(mdata_aux,11,2)+'/'+SUBSTR(mdata_aux,7,2))
                                        //atencao(DTOC(mchecar))
                                        IF (mchecar - mchecar1) # VAL(SUBSTR(mdata_aux,13)) .OR. EMPTY(mchecar)
                                                atencao('SENHA DE LIBERACAO Foi digitada errada, verifique tente novamente...')
                                                LOOP
                                        ENDIF
                                ELSE
                                        atencao('ESTE CODIGO NAO E PARA ESTA EMPRESA....')
                                        LOOP
                                ENDIF
                                SR_BEGINTRANSACTION()
                                        //TRY
                                                sr_getconnection():exec("UPDATE sacsetup SET sysdatlm = "+sr_cdbvalue(SUBSTR(mdata_aux,1,12)),,.f.)
                                                sr_getconnection():exec('COMMIT',,.f.)
                                        //CATCH e
                                SR_ENDTRANSACTION()
                                EXIT
        		ELSEIF SUBSTR(mcod_acesso,1,8) = mdig1+mdig2+mdig3+mdig4+mdig5 .AND. LEN(ALLTRIM(mcod_acesso)) >= 10
                                IF VAL(SUBSTR(mcod_acesso,9)) = 0
                                        mdata_aux :=SPACE(11)
                                ELSE
                                        //mdata_sen := DATE() + VAL(SUBSTR(mcod_acesso,7))
                                        mdata_sen := DATE() + VAL(SUBSTR(mcod_acesso,9))
                                        //mdata_aux := SUBSTR(DTOC(mdata_sen),1,2)+SUBSTR(DTOC(mdata_sen),4,2)+SUBSTR(DTOC(mdata_sen),7,2) + SUBSTR(mcod_acesso,1,6)
                                        mdata_aux := SUBSTR(DTOC(mdata_sen),1,2)+SUBSTR(DTOC(mdata_sen),4,2)+SUBSTR(DTOC(mdata_sen),7,2) + SUBSTR(DTOC(DATE()),7,2)+SUBSTR(DTOC(DATE()),1,2)+SUBSTR(DTOC(DATE()),4,2)
                                ENDIF
                                SR_BEGINTRANSACTION()
                                                sr_getconnection():exec("UPDATE sacsetup SET sysdatlm = "+sr_cdbvalue(mdata_aux),,.f.)
                                                sr_getconnection():exec('COMMIT',,.f.)
                                SR_ENDTRANSACTION()
                                EXIT
                        ELSE
                                atencao('CODIGO DE ACESSO NAO CONFERE....')
                                LOOP
                        ENDIF
                ENDDO
                fecha_tela()
ELSEIF (mdias_fecha <= 5 .AND. ! EMPTY(m_set[1,15])) .OR. mtp_senha # NIL  //.AND. ! EMPTY(CTOD(SUBSTR(m_set[1,15],1,2)+'/'+SUBSTR(m_set[1,15],3,2)+'/'+SUBSTR(m_set[1,15],5,2)))
        op_tela(10,10,15,90,'SENHA DE LIBERACAO DO SISTEMA ')
        WHILE .T.
                mcod_acesso := SPACE(29)
                botao(0,0,7,90)
                limpa(0,0,7,90)
                WVW_DrawImage( ,0,3,5,12,ALLTRIM(m_cfg[1,13])+'HTI.JPG',.T.,.F.)
                setcor(3)
                DEVPOS(1,13);DEVOUT(PADC('ESTAR FALTANDO << '+STRZERO(mdias_fecha,2)+' DIAS >> PARA EXPIRAR O SISTEMA',60))
                DEVPOS(2,13);DEVOUT(PADC('ENTRE EM CONTATO COM A HTI Sistemas - Fone:(81)'+mfone_hrb,60))
                setcor(1)
                DEVPOS(4,21);DEVOUT('Digite o SENHA DE LIBERACAO:')
                WVW_DrawBoxGet(,4,50,29)
                @ 4,50 GET mcod_acesso PICT '@!' VALID lim_get() WHEN men_get(0,0,'Digite CODIGO DE ACESSO, DEIXE EM BRANCO ou <ESC> p/PROSSEGUIR')
                READ
                IF LASTKEY() = 27 .OR. EMPTY(mcod_acesso)
                        EXIT
                ENDIF
                //atencao(dcrip(mcod_acesso))
                /*
                mdig1 := SUBSTR(STRZERO(VAL(SUBSTR(DTOC(DATE()),7,2))+VAL(SUBSTR(DTOC(DATE()),1,2))+VAL(SUBSTR(DTOC(DATE()),4,2)),2),1,1)
                mdig2 := STRZERO(VAL(SUBSTR(DTOC(DATE()),4,2))+VAL(SUBSTR(DTOC(DATE()),1,2)),2)
                mdig3 := STRZERO(VAL(SUBSTR(DTOC(DATE()),7,2))+VAL(SUBSTR(DTOC(DATE()),1,2)),2)
                mdig4 := STRZERO(VAL(SUBSTR(DTOC(DATE()),1,2))+VAL(SUBSTR(DTOC(DATE()),1,2)),2)
                mdig5 := SUBSTR(STRZERO(VAL(SUBSTR(DTOC(DATE()),7,2))+VAL(SUBSTR(DTOC(DATE()),1,2))+VAL(SUBSTR(DTOC(DATE()),4,2)),2),2,1)
                */
                IF LEN(ALLTRIM(mcod_acesso)) > 20
                        IF EMPTY(SUBSTR(dcrip(mcod_acesso),1,14))
                                LOOP
                        ELSEIF SUBSTR(dcrip(mcod_acesso),1,14) = tira_pontos(mcgc_firm)
                                //atencao(SUBSTR(dcrip(mcod_acesso),15,12))
                                mdata_aux := SUBSTR(dcrip(mcod_acesso),15)
                                mchecar := CTOD(SUBSTR(mdata_aux,1,2)+'/'+SUBSTR(mdata_aux,3,2)+'/'+SUBSTR(mdata_aux,5,2))
                                mchecar1 := CTOD(SUBSTR(mdata_aux,9,2)+'/'+SUBSTR(mdata_aux,11,2)+'/'+SUBSTR(mdata_aux,7,2))
                                //atencao(DTOC(mchecar))
                                IF (mchecar - mchecar1) # VAL(SUBSTR(mdata_aux,13)) .OR. EMPTY(mchecar)
                                        atencao('SENHA DE LIBERACAO Foi digitada errada, verifique tente novamente...')
                                        LOOP
                                ENDIF
                        ELSE
                                atencao('ESTE CODIGO NAO E PARA ESTA EMPRESA....')
                                LOOP
                        ENDIF
                        SR_BEGINTRANSACTION()
                                        sr_getconnection():exec("UPDATE sacsetup SET sysdatlm = "+sr_cdbvalue(SUBSTR(mdata_aux,1,12)),,.f.)
                                        sr_getconnection():exec('COMMIT',,.f.)
                        SR_ENDTRANSACTION()
                        EXIT
                ELSEIF SUBSTR(mcod_acesso,1,8) = mdig1+mdig2+mdig3+mdig4+mdig5 .AND. LEN(ALLTRIM(mcod_acesso)) >= 10
                        IF VAL(SUBSTR(mcod_acesso,9)) = 0
                                mdata_aux :=SPACE(11)
                        ELSE
                                //mdata_sen := DATE() + VAL(SUBSTR(mcod_acesso,7))
                                mdata_sen := DATE() + VAL(SUBSTR(mcod_acesso,9))
                                //mdata_aux := SUBSTR(DTOC(mdata_sen),1,2)+SUBSTR(DTOC(mdata_sen),4,2)+SUBSTR(DTOC(mdata_sen),7,2) + SUBSTR(mcod_acesso,1,6)
                                mdata_aux := SUBSTR(DTOC(mdata_sen),1,2)+SUBSTR(DTOC(mdata_sen),4,2)+SUBSTR(DTOC(mdata_sen),7,2) + SUBSTR(DTOC(DATE()),7,2)+SUBSTR(DTOC(DATE()),1,2)+SUBSTR(DTOC(DATE()),4,2)
                        ENDIF
                        SR_BEGINTRANSACTION()
                                sr_getconnection():exec("UPDATE sacsetup SET sysdatlm = "+sr_cdbvalue(mdata_aux),,.f.)
                                sr_getconnection():exec('COMMIT',,.f.)
                        SR_ENDTRANSACTION()
                        atencao('CODIGO DE ACESSO EFETUADO COM SUCESSO.... BOM TRABALHO')
                        EXIT
                ELSE
                        atencao('CODIGO DE ACESSO NAO CONFERE....')
                        LOOP
                ENDIF
        ENDDO
        fecha_tela()
ENDIF
RETURN NIL
***************************  F I M ***********************************
* CONVERTE DBF para BANCO DE DADOS
**********************************
#include "directry.ch"
#include "sqlrdd.ch"       // SQLRDD Main include

Function arq_ncm()
******************
LOCAL qtd_incl:=0,qtd_atu:=0,cons_ :={}

//RddSetDefault( "DBFCDX" )

SET DELETED ON
op_tela(10,10,15,70,"SICRONIZAR ARQUIVO NCM")
WHILE .T.
        qtd_incl := qtd_atu:=0
        setcor(1)
        DEVPOS(00,01);DEVOUT('Total de registro do Arquivo: ')
        DEVPOS(01,01);DEVOUT('Total de registro ATUALIZADO: ')
        DEVPOS(02,01);DEVOUT('Total de registro INCLUSO   : ')
        DEVPOS(03,01);DEVOUT('Quantidade Registro Restante: ')
        IF 'N' = op_simnao('S','Confirma o processamento')
                EXIT
        ENDIF
        IF ! FILE('ibptax.dbf')
                atencao('O arquivo do IBPT nao se encontrar neste caminho....')
                LOOP
        ENDIF
        IF ! abriarq('ibptax.dbf','ibp',,'*')
                atencao('Nao foi possivel abri este arquivo: IBPTAX.DBF')
                LOOP
        ENDIF
        setcor(3)
        DEVPOS(00,30);DEVOUT(TRANSFORM(LASTREC(),'999,999,999'))
        SELE('ibp');GO TOP
        WHILE ! EOF()
                cons_ :={}
                sr_getconnection():exec("SELECT * FROM sacncm WHERE codigo = "+sr_cdbvalue(SUBSTR(ALLTRIM(STR(INT(ibp->codigo))),1,8)),,.t.,@cons_)
                IF LEN(cons_) = 0
                        sr_getconnection():exec('INSERT INTO sacncm (codigo,'+;
                                'descri,'+;
                                'ex,'+;
                                'tabela,'+;
                                'aliqnac,'+;
                                'aliqimp,'+;
                                'SR_DELETED )'+;
                                ' VALUES ('+;
                                sr_cdbvalue(SUBSTR(ALLTRIM(STR(INT(ibp->codigo))),1,8))+','+; //1
                                sr_cdbvalue(SUBSTR(tira_acento(UPPER(ibp->descricao)),1,100))+','+; //2
                                sr_cdbvalue(SUBSTR(ALLTRIM(ibp->ex),1,2))+','+; //3
                                sr_cdbvalue(SUBSTR(ALLTRIM(STR(INT(ibp->tabela))),1,2))+','+; //4
                                sr_cdbvalue(VAL(ALLTRIM(ibp->aliqnac)))+','+; //5
                                sr_cdbvalue(VAL(ALLTRIM(ibp->aliqimp)))+','+; //6
                                sr_cdbvalue(' ')+')',,.f.)
                        DEVPOS(02,30);DEVOUT(TRANSFORM(qtd_incl++,'999,999,999'))

                ELSE
                        sr_getconnection():exec("UPDATE sacncm SET descri = "+sr_cdbvalue(SUBSTR(tira_acento(UPPER(ibp->descricao)),1,100));
                                                +',ex = '+sr_cdbvalue(SUBSTR(ALLTRIM(ibp->ex),1,2));
                                                +',tabela = '+sr_cdbvalue(SUBSTR(ALLTRIM(STR(INT(ibp->tabela))),1,2));
                                                +',aliqnac = '+sr_cdbvalue(VAL(ALLTRIM(ibp->aliqnac)));
                                                +',aliqimp = '+sr_cdbvalue(VAL(ALLTRIM(ibp->aliqimp)))+' WHERE codigo = '+ALLTRIM(STR(INT(ibp->codigo))),,.f.)
                        DEVPOS(01,30);DEVOUT(TRANSFORM(qtd_atu++,'999,999,999'))
                ENDIF
                SKIP
                DEVPOS(03,30);DEVOUT(TRANSFORM(LASTREC() - (qtd_atu + qtd_incl),'999,999,999'))
        ENDDO
        sr_getconnection():exec("COMMIT",,.f.)
        atencao('Foi feito a Atualizacao com SUCESSO....')
        EXIT
ENDDO
wvw_lclosewindow()
Return
************************** F I M **********************
FUNCTION ver_ncm(vncm,m_cst)
****************************
LOCAL mvlrncm:= {}
sr_getconnection():exec( "SELECT * FROM sacncm WHERE codigo = "+sr_cdbvalue(vncm),,.t.,@mvlrncm)
IF LEN(mvlrncm) = 0
        RETURN 0
ELSE
        m_cst := SUBSTR(m_cst,1,1)
        IF m_cst $ '0345'
                RETURN mvlrncm[1,8]
        ELSE
                RETURN mvlrncm[1,9]
        ENDIF
ENDIF
RETURN 0
*********************** F I M ************************************************
* FUNCAO PARA VERIFICAR COD.NAT.OPERACAO
*******************************************
FUNCTION ver_nat(cod,mt_p,li,co)
*********************
LOCAL msele,morde,cons_nat
MEMVAR mnatureza,mcredito,msai_ent
IF EMPTY(cod)
        RETURN .T.
ENDIF
msele := SELE()
morde := INDEXORD()
IF ! AbriArq('sacop','op');RETURN NIL;ENDIF
*****************
SELE('op');ORDSETFOCUS(1)
GO TOP
*****************
IF ! op->(DBSEEK(cod))
        atencao('Este CFOP: '+cod+'  nao esta cadastrado em nossos arquivos !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .F.
ELSE
        IF op->sai_ent = 'S' .AND. mt_p = 'E'
                atencao('Este CFOP e de SAIDA por isso nao pode ser usado na ENTRADA DE MERCADORIA')
                RETURN .F.
        ENDIF
        mnatureza := op->descr_op
        mcredito  := op->credito
        msai_ent  := op->sai_ent
        IF li # NIL
                DEVPOS(li,co);DEVOUT(mnatureza)
        ENDIF
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        RETURN .T.
ENDIF
RETURN NIL
******************************* f i m *********************************************
* VERIFICA CODIGO
******************
FUNCTION ver_cod(vgru,li,ci,t,mzero,p)
**********************
LOCAL msele,morde,posicao:=0

IF ((mzero <> NIL .OR. mzero = 0) .AND. mzero <> 1) .AND. EMPTY(vgru)
        RETURN .T.
ENDIF

msele := SELE()
morde := INDEXORD()
IF RECNO() > 0 .AND. msele > 0
        posicao := RECNO()
ENDIF
IF ! AbriArq('mastprod','merc');RETURN NIL;ENDIF
**************
SELE('merc');ORDSETFOCUS(1)
GO TOP
**************
SEEK STRZERO(vgru,5)

IF t = .T. .AND. FOUND()
        vgru := 0
        atencao('Este Codigo: '+STRZERO(vgru,5)+' ja Cadastrado !!!')
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF posicao > 0 .AND. msele > 0 .AND. morde > 0 .AND. msele <> SELE('merc')
                GO posicao
        ENDIF
        RETURN .F.
ENDIF
IF ! FOUND()
        vgru := 0
        IF p = NIL
                atencao('Codigo: '+STRZERO(vgru,5)+' nao Cadastrado !!!')
        ENDIF
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF posicao > 0 .AND. msele > 0 .AND. morde > 0 .AND. msele <> SELE('merc')
                GO posicao
        ENDIF
        RETURN .F.
ENDIF
IF li = NIL
        SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
        IF posicao > 0 .AND. msele > 0 .AND. morde > 0 .AND. msele <> SELE('merc')
                GO posicao
        ENDIF
        RETURN .T.
ENDIF
setcor(3)
DEVPOS(li,ci);DEVOUT(merc->descri)
setcor(1)
SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
IF posicao > 0 .AND. msele > 0 .AND. morde > 0 .AND. msele <> SELE('merc')
        GO posicao
ENDIF
RETURN .T.
******************************** F I M ************************************
* FUNCAO P/CONSULTAR TRANSPORTADORA
********************************
FUNCTION f5_trans(mnome,mcgc,mend,mmun,muf,minsc,mplaca,mcod)
*******************************************************
LOCAL lci,cci,lba,cba,point,msele,morde,m_transp:={},m_point:={},opcao
MEMVAR mcgccpf,mcpf,mcod_tran
msele := SELE()
morde := INDEXORD()
lci := cci := 0
lba := 22
cba := 40
setcor(1)
************
SELE('tran');ORDSETFOCUS(2)
GO TOP
*************
IF ! EMPTY(mcod)
        ************
        SELE('tran');ORDSETFOCUS(1)
        GO TOP
        *************
        IF tran->(DBSEEK(mcod))
                mnome := tran->razao
                IF ! EMPTY(tran->cgc)
                        mcgc := tran->cgc
                        mcgccpf := 'tran->CGC'
                ELSEIF ! EMPTY(tran->cpf)
                        mcgc := tran->cpf
                        mcgccpf := 'CPF'
                ENDIF
                mcod := tran->cod_tran
                mend := tran->endereco
                mmun := tran->cidade
                muf := tran->uf
                minsc := tran->insc
                mplaca := tran->placa
                mensagem('Preencha os Campos - <ESC> p/Retornar ')
                ******************
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                ******************
                RETURN NIL
        ENDIF
ENDIF
ASIZE(m_transp,0)
ASIZE(m_point,0)
WHILE ! EOF()
        AADD(m_transp,tran->razao+' - '+tran->cod_tran)
        AADD(m_point,RECNO())
        SKIP
ENDDO
op_tela(lci,cci,lba+2,cba,' Consulta de Transportadoras ','*')
WHILE .T.
        setcor(3)
        point := ACHOICE(lci,cci+1,lba,cba-1,m_transp)
        IF point = 0
                ******************
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                ******************
                EXIT
        ELSE
                GO m_point[point]
                mnome := tran->razao
                IF ! EMPTY(tran->cgc)
                        mcgc := tran->cgc
                        mcgccpf := 'CGC'
                ELSEIF ! EMPTY(tran->cpf)
                        mcgc := tran->cpf
                        mcgccpf := 'CPF'
                ENDIF
                mcod_tran := tran->cod_tran
                mend := tran->endereco
                mmun := tran->cidade
                muf := tran->uf
                minsc := tran->insc
                mplaca := tran->placa
                mantt := tran->antt
                mapolice := tran->apolice
                mpluf_trans := tran->uf_placa
                mensagem('Preencha os Campos - <ESC> p/Retornar ')
                ******************
                SELE(msele);IF(morde>0,ORDSETFOCUS(morde),)
                ******************
                EXIT
        ENDIF
ENDDO
setcor(1)
wvw_lclosewindow()
RETURN NIL
******************************* f i m *********************************************
* FIM DA TECLA DE ATALHO
********************************
FUNCTION fimset()
*****************
SET KEY -2 TO
SET KEY -4 TO
SET KEY -5 TO
SET KEY -6 TO
SET KEY -7 TO
SET KEY -8 TO
SET KEY -40 TO
RETURN NIL
